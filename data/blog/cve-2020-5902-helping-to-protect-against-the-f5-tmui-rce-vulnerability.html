<div class="mb2 gray5">1 min read</div><img class="mr2" src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/5fuYETaJHxFMWABlpzwLjD/c36de8ba5b4ae5e12386cd5d828c9532/cve-2020-5902-helping-to-protect-against-the-f5-tmui-rce-vulnerability.png" alt="">
<div class="post-content lh-copy gray1">
	<p>Cloudflare has deployed a new managed rule protecting customers against a <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-5902">remote code execution vulnerability</a> that has been found in F5 BIG-IPâ€™s web-based Traffic Management User Interface (TMUI). Any customer who has access to the Cloudflare <a href="https://www.cloudflare.com/waf">Web Application Firewall (WAF)</a> is automatically protected by <a href="https://developers.cloudflare.com/waf/change-log/2020-07-07---emergency-release">the new rule</a> (100315) that has a default action of BLOCK.</p>
	<p>Initial testing on our network has shown that attackers started probing and trying to exploit this vulnerability starting on July 3.</p>
	<p>F5 has <a href="https://support.f5.com/csp/article/K52145254">published detailed instructions</a> on how to patch affected devices, how to detect if attempts have been made to exploit the vulnerability on a device and instructions on how to add a custom mitigation. If you have an F5 device, read their detailed mitigations before reading the rest of this blog post.</p>
	<p>The most popular probe URL appears to be <code>/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp</code> followed by <code>/tmui/login.jsp/..;/tmui/util/getTabSet.jsp,</code> <code>/tmui/login.jsp/..;/tmui/system/user/authproperties.jsp</code> and <code>/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp.</code> All contain the critical pattern ..; which is at the heart of the vulnerability.</p>
	<p>On July 3 we saw O(1k) probes ramping to O(1m) yesterday. This is because simple test patterns have been added to scanning tools and small test programs made available by security researchers.</p>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/zkvhlag99gkb/jomtn8ocHGzcuOT7cCJYs/dd53f8316167f43d3f5667bcaf165099/image1-3.png" alt="" class="kg-image" width="1640" height="876" loading="lazy">

	</figure>
	<div class="flex anchor relative">
		<h3 id="the-vulnerability">The Vulnerability</h3>
		<a href="https://blog.cloudflare.com/#the-vulnerability" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>The vulnerability was disclosed by the vendor on July 1 and allows both authenticated and unauthenticated users to perform remote code execution (RCE).</p>
	<p>Remote Code Execution is a type of code injection which provides the attacker the ability to run any arbitrary code on the target application, allowing them, in most scenarios such as this one, to gain privileged access and perform a full system take over.</p>
	<p>The vulnerability affects the administration interface only (the management dashboard), not the underlying data plane provided by the application.</p>
	<div class="flex anchor relative">
		<h3 id="how-to-mitigate">How to Mitigate</h3>
		<a href="https://blog.cloudflare.com/#how-to-mitigate" aria-hidden="true" class="relative sm:absolute sm:-left-5">
			<svg width="16" height="16" viewBox="0 0 24 24">
				<path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
			</svg>
		</a>
	</div>
	<p>If updating the application is not possible, the attack can be mitigated by blocking all requests that match the following regular expression in the URL:</p>
	<p><code>.*\.\.;.*</code></p>
	<p>The above regular expression matches two dot characters (.) followed by a semicolon within any sequence of characters.</p>
	<p>Customers who are using the Cloudflare WAF, that have their F5 BIG-IP TMUI interface proxied behind Cloudflare, are already automatically protected from this vulnerability with rule <code>100315</code>. If you wish to turn off the rule or change the default action:</p>
	<ol>
		<li>
			<p>Head over to the Cloudflare Firewall, then click on Managed Rules and head over to the advanced link under the Cloudflare Managed Rule set,</p>
		</li>
		<li>
			<p>Search for rule ID: <code>100315</code>,</p>
		</li>
		<li>
			<p>Select any appropriate action or disable the rule.</p>
		</li>
	</ol>
</div>