<div class="mb2 gray5">6 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/09/image3-14.png" class="kg-image" alt="Cloudflare Fonts: enhancing website font privacy and speed" loading="lazy" width="1999" height="1125"></figure>
	<p>We are thrilled to introduce Cloudflare Fonts! In the coming weeks sites that use Google Fonts will be able to effortlessly load their fonts from the site’s own domain rather than from Google. All at a click of a button. This enhances both privacy and performance. It enhances users' privacy by eliminating the need to load fonts from Google’s third-party servers. It boosts a site's performance by bringing fonts closer to end users, reducing the time spent on DNS lookups and <a href="https://www.cloudflare.com/learning/ssl/transport-layer-security-tls" target="_blank">TLS connections</a>.</p>
	<p>Sites that currently use Google Fonts will not need to self-host fonts or make complex code changes to benefit – Cloudflare Fonts streamlines the entire process, making it a breeze.</p>
	<h3 id="fonts-and-privacy">Fonts and privacy</h3>
	<p>When you load <a href="https://fonts.google.com" target="_blank">fonts</a> from Google, your website initiates a data exchange with Google's servers. This means that your visitors' browsers send requests directly to Google. Consequently, Google has the potential to accumulate a range of data, including IP addresses, user agents (formatted descriptions of the browser and operating system), the referer (the page on which the Google font is to be displayed) and how often each IP makes requests to Google. While <a href="https://policies.google.com/technologies/retention?hl=en-US" target="_blank">Google</a> states that they do not use this data for targeted advertising or set cookies, any time you can prevent sharing your end user’s personal data unnecessarily is a win for privacy.</p>
	<p>With Cloudflare Fonts, when you serve fonts directly from your own domain. This means no font requests are sent to third-party domains like Google, which some privacy regulators have found to be a <a href="https://www.theregister.com/2022/01/31/website_fine_google_fonts_gdpr" target="_blank">problem</a> in the past. Our pro-privacy approach means your end user’s IP address and other data are not sent to another domain. All that information stays within your control, within your domain. In addition, because Cloudflare Fonts eliminates data transmission to third-party servers like Google's, this can enhance your ability to comply with any potential data localization requirements.</p>
	<h3 id="faster-google-font-delivery-through-cloudflare">Faster Google Font delivery through Cloudflare</h3>
	<p>Now that we have established that Cloudflare Fonts can improve your privacy, let's flip to the other side of the coin - how Cloudflare Fonts will improve your performance.</p>
	<p>To do this, we first need to delve into how Google Fonts affects your website's performance. Subsequently, we'll explore how Cloudflare Fonts addresses and rectifies these performance challenges.</p>
	<p><a href="https://fonts.google.com" target="_blank">Google Fonts</a> is a fantastic resource that offers website owners a range of royalty-free fonts for website usage. When you decide on the fonts you would like to incorporate, it’s super easy to integrate. You just add a snippet of HTML to your site. You then add styles to apply these fonts to various parts of your page:</p><!--kg-card-begin: markdown-->
	<pre><code class="language-html">&lt;link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto+Slab" rel="stylesheet"&gt;
&lt;style&gt;
  body {
    font-family: 'Open Sans', sans-serif;
  }
  h1 {
    font-family: 'Roboto Slab', serif;
  }
&lt;/style&gt;
</code></pre>
	<!--kg-card-end: markdown-->
	<p>But this ease of use comes with a performance penalty.</p>
	<p>Upon loading your webpage, your visitors' browser fetches the CSS file as soon as the HTML starts to be parsed. Then, when the browser starts rendering the page and identifies the need for fonts in different text sections, it requests the required font files.</p>
	<p>This is where the performance problem arises. Google Fonts employs a two-domain system: the CSS resides on one domain - fonts.googleapis.com - while the font files reside on another domain - fonts.gstatic.com.</p>
	<p>This separation results in a minimum of four round trips to the third-party servers for each resource request. These round trips are <a href="https://www.cloudflare.com/en-gb/learning/dns/what-is-dns" target="_blank">DNS lookup</a>, socket connection establishment, <a href="https://www.cloudflare.com/en-gb/learning/ssl/what-happens-in-a-tls-handshake" target="_blank">TLS negotiation</a> (for HTTPS), and the final round trip for the actual resource request. Ultimately, getting a font from Google servers to a browser requires eight round trips.</p>
	<p>Users can see this. If they are using Google Fonts they can open their network tab and filter for these Google domains.</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2023/09/pasted-image-0-3.png" class="kg-image" alt="" loading="lazy" width="1600" height="367"></figure>
	<p>You can visually see the impact of the extra DNS request and TLS connection that these requests add to your website experience. For example on my WordPress site that natively uses Google Fonts as part of the theme adds an extra ~150ms.</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2023/09/pasted-image-0--1--3.png" class="kg-image" alt="" loading="lazy" width="1600" height="566"></figure>
	<h3 id="fast-fonts">Fast fonts</h3>
	<p>Cloudflare Fonts streamlines this process, by reducing the number of round trips from eight to one. Two sets of DNS lookups, socket connections and TLS negotiations to third-parties are no longer required because there is no longer a third-party server involved in serving the CSS or the fonts. The only round trip involves serving the font files directly from the same domain where the HTML is hosted. This approach offers an additional advantage: it allows fonts to be transmitted over the same <a href="https://developers.cloudflare.com/support/network/understanding-cloudflare-http2-and-http3-support/#http2" target="_blank">HTTP/2</a> or <a href="https://developers.cloudflare.com/support/network/understanding-cloudflare-http2-and-http3-support/#http3" target="_blank">HTTP/3</a> connection as other page resources, benefiting from <a href="https://blog.cloudflare.com/better-http-2-prioritization-for-a-faster-web">proper prioritization</a> and preventing bandwidth contention.</p>
	<p>The eagle-eyed amongst you might be thinking “<em>Surely it is still two round trips - what about the CSS request?”. </em>Well, with Cloudflare Fonts, we have also removed the need for a separate CSS request. This means there really is only one round-trip - fetching the font itself.</p>
	<p>To achieve both the home-routing of font requests and the removal of the CSS request, we rewrite the HTML as it passes through Cloudflare’s global network. The CSS response is embedded, and font URL transformations are performed within the embedded CSS.</p>
	<p>These transformations adjust the font URLs to align with the same domain as the HTML content. These modified responses seamlessly pass through Cloudflare's caching infrastructure, where they are automatically cached for a substantial performance boost. In the event of any cache misses, we use <a href="https://fontsource.org" target="_blank">Fontsource</a> and <a href="https://www.npmjs.com" target="_blank">NPM</a> to load these fonts and cache them within the Cloudflare infrastructure. This approach ensures that there's no inadvertent data exposure to Google's infrastructure, maintaining both performance and data privacy.</p>
	<p>With Cloudflare Fonts enabled, you are able to see within your Network Tab that font files are now loaded from your own hostname from the <code>/cf-fonts</code> path and served from Cloudflare’s closest cache to the user, as indicated by the <code>cf-cache-status: HIT</code>.</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2023/09/pasted-image-0--2--2.png" class="kg-image" alt="" loading="lazy" width="1600" height="486"></figure>
	<p>Additionally, you can notice that the timings section in the browser no longer needs an extra DNS lookup for the hostname or the setup of a TLS connection. This happens because the content is served from your hostname, and the browser has already cached the DNS response and has an open TLS connection.</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2023/09/pasted-image-0--3--3.png" class="kg-image" alt="" loading="lazy" width="1600" height="486"></figure>
	<p>Finally, you can see the real-world performance benefits of Cloudflare Fonts. We conducted synthetic <a href="https://developers.cloudflare.com/speed/speed-test/run-speed-test" target="_blank">Google Lighthouse</a> tests before enabling Cloudflare Fonts on a straightforward page that displays text. <a href="https://www.cloudflare.com/en-gb/learning/performance/how-dcl-and-fcp-affect-seo" target="_blank">First Contentful Paint (FCP)</a>, which represents the time it takes for the first content element to appear on the page, was measured at 0.9 seconds in the Google fonts tests. After enabling Cloudflare Fonts, the First Contentful Paint (FCP) was reduced to 0.3 seconds, and our overall Lighthouse performance score improved from 98 to a perfect 100 out of 100.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/09/image6-1.png" class="kg-image" alt="" loading="lazy" width="1507" height="980"></figure>
	<h3 id="making-cloudflare-fonts-fast-with-rofl">Making Cloudflare Fonts fast with ROFL</h3>
	<p>In order to make Cloudflare Fonts this performant, we needed to make blazing-fast HTML alterations as responses stream through Cloudflare’s network. This has been made possible by leveraging one of Cloudflare’s more recent technologies.</p>
	<p>Earlier this year, we finished rewriting one of Cloudflare's oldest components, which played a crucial role in dynamically altering HTML content. But as described in <a href="https://blog.cloudflare.com/rust-nginx-module">this blog post</a>, a new solution was required to replace the old - A memory-safe solution, able to scale to Cloudflare’s ever-increasing load.</p>
	<p>This new module is known as <a href="https://blog.cloudflare.com/rust-nginx-module">ROFL</a> (Response Overseer for FL). It now powers various Cloudflare products that need to alter HTML as it streams, such as <a href="https://developers.cloudflare.com/support/more-dashboard-apps/cloudflare-scrape-shield/what-is-email-address-obfuscation" target="_blank">Email Obfuscation</a>, <a href="https://developers.cloudflare.com/speed/optimization/content/rocket-loader" target="_blank">Rocket Loader</a>, and <a href="https://developers.cloudflare.com/speed/optimization/content/auto-minify" target="_blank">HTML Minification</a>.</p>
	<p>ROFL was developed entirely in Rust. This decision was driven by Rust's memory safety, performance, and security. The memory-safety features of Rust are indispensable to ensure airtight protection against memory leaks while we process a staggering volume of requests, measuring in the millions per second. Rust's compiled nature allows us to finely optimize our code for specific hardware configurations, delivering impressive performance gains compared to interpreted languages.</p>
	<p>ROFL paved the way for the development of Cloudflare Fonts. The performance of ROFL allows us to rewrite HTML on-the-fly and modify the Google Fonts links quickly, safely and efficiently. This speed helps us reduce any additional latency added by processing the HTML file and improve the performance of your website.</p>
	<h3 id="unlock-the-power-of-cloudflare-fonts-today-%F0%9F%9A%80">Unlock the power of Cloudflare Fonts today! 🚀</h3>
	<p>Cloudflare Fonts will be available to all Cloudflare customers in October. If you're using Google Fonts, you will be able to supercharge your site's <a href="https://blog.cloudflare.com/tag/privacy">privacy</a> and speed. By enabling this feature, you can seamlessly enhance your website's performance while safeguarding your user’s privacy.</p>
</div>