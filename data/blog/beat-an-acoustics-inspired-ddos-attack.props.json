{
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "Omer Yoachimik",
				"slug": "omer",
				"bio": "Product Manager / Cloudflare's DDoS Protection Service",
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/6TXRnB1v4ZHGiL3nRlvRTZ/946efe152cca5f55320466c0d3208fc1/omer.png",
				"location": "London",
				"website": null,
				"twitter": "@OmerYoahimik",
				"facebook": null
			}
		],
		"excerpt": "On the week of Black Friday, Cloudflare automatically detected and mitigated “Beat” - an acoustics inspired DDoS attacks that targeted a Magic Transit customer.\n",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/5gPAbpXFba20cafcpdZS26/64c5254d8f5a3c4bf6e6db755e4a356e/beat-an-acoustics-inspired-ddos-attack.png",
		"featured": false,
		"html": "\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/1tMtwsT8jBy65DAgY8rvGu/839a8ab8a3d14755200d999501dec143/1-1.png\" alt=\"\" class=\"kg-image\" width=\"1600\" height=\"900\" loading=\"lazy\"/>\n            \n            </figure><p>On the week of Black Friday, Cloudflare automatically detected and mitigated a unique ACK DDoS attack, which we’ve codenamed “Beat”, that targeted a <a href=\"https://www.cloudflare.com/magic-transit/\">Magic Transit</a> customer. Usually, when attacks make headlines, it’s because of their size. However, in this case, it’s not the size that is unique but the method that appears to have been borrowed from the world of acoustics.</p><h3>Acoustic inspired attack</h3><p>As can be seen in the graph below, the attack’s packet rate follows a wave-shaped pattern for over 19 hours. It seems as though the attacker was inspired by an acoustics concept called <a href=\"https://en.wikipedia.org/wiki/Beat_%28acoustics%29\">beat</a>. In acoustics, a beat is a term that is used to describe an interference of two different wave frequencies. It is the superposition of the two waves. When the two waves are nearly 180 degrees <a href=\"https://en.wikipedia.org/wiki/Out_of_phase\">out of phase</a>, they create the beating phenomenon. When the two waves merge they amplify the sound and when they are out of sync they cancel one another, creating the beating effect.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/3lptML3dUmhiTecMKMOwQm/68804f4920bcbf19a5791df21b255239/image24.png\" alt=\"\" class=\"kg-image\" width=\"1894\" height=\"830\" loading=\"lazy\"/>\n            \n            </figure><p>Beat DDoS Attack</p><p>Acedemo.org has a nice tool where you can create your own beat wave. As you can see in the screenshot below, the two waves in blue and red are out of phase and the purple wave is their superposition, the beat wave.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/3je9tkvO6g9Fj83GyJediy/7c337fdea28e225f0a9bb0e2425b3dc5/image27.png\" alt=\"\" class=\"kg-image\" width=\"1111\" height=\"582\" loading=\"lazy\"/>\n            \n            </figure><p>Source: <a href=\"https://academo.org/demos/wave-interference-beat-frequency/\">https://academo.org/demos/wave-interference-beat-frequency/</a> </p><h3>Reverse engineering the attack</h3><p>It looks like the attacker launched a flood of packets where the rate of the packets is determined by the equation of the beat wave: y<sup>&#39;</sup><sub>beat</sub>=y<sub>1</sub>+y<sub>2</sub>. The two equations y<sub>1</sub> and y<sub>2</sub> represent the two waves.</p><p>Each equation is expressed as</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/SfZXT8W0ZP20V1vxZUfzr/ce7b5c74808c0ed752283ad7afd545e9/Screen-Shot-2020-12-21-at-14.06.33.png\" alt=\"Screen-Shot-2020-12-21-at-14.06.33\" class=\"kg-image\" width=\"350\" height=\"80\" loading=\"lazy\"/>\n            \n            </figure><p>where f<sub>i</sub> is the frequency of each wave and <i>t</i> is time.</p><p>Therefore, the packet rate of the attack is determined by manipulation of the equation</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/2PTnbqlI8wLd7hc3AQrpvE/222e323cebbc4cfdba9556a891113a60/Screen-Shot-2020-12-21-at-13.25.40.png\" alt=\"Screen-Shot-2020-12-21-at-13.25.40\" class=\"kg-image\" width=\"688\" height=\"70\" loading=\"lazy\"/>\n            \n            </figure><p>to achieve a packet rate that ranges from ~18M to ~42M pps.</p><p>To get to the scale of this attack we will need to multiply <i>y</i><sup>&#39;</sup><sub>beat</sub> by a certain variable <i>a</i> and also add a constant <i>c</i>, giving us y<sub>beat</sub>=<i>ay</i>&#39;<sub>beat</sub>+<i>c</i>. Now, it’s been a while since I played around with equations, so I’m only going to try and get an approximation of the equation.</p><p>By observing the attack graph, we can guesstimate that</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/27hlcDTbdY4jgCfHide7jC/241880f236f825b169caf627dad973f4/Screen-Shot-2020-12-21-at-13.28.39-1.png\" alt=\"Screen-Shot-2020-12-21-at-13.28.39-1\" class=\"kg-image\" width=\"520\" height=\"60\" loading=\"lazy\"/>\n            \n            </figure><p>by playing around with desmos’s cool <a href=\"https://www.desmos.com/calculator\">graph visualizer tool</a>, if we set f<sub>1</sub>=0.0000345 and f<sub>2</sub>=0.00003455 we can generate a graph that resembles the attack graph. Plotting in those variables, we get:</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/437LtgPNFTP5jC8Y1qt7Ty/438da3d37a2d10512ede0c0c63eab34e/Screen-Shot-2020-12-21-at-13.33.26.png\" alt=\"Screen-Shot-2020-12-21-at-13.33.26\" class=\"kg-image\" width=\"1273\" height=\"113\" loading=\"lazy\"/>\n            \n            </figure><p>Now this formula assumes just one node firing the packets. However, this specific attack was globally distributed, and if we assume that each node, or bot in this botnet, was firing an equal amount of packets at an equal rate, then we can divide the equation by the size of the botnet; the number of bots <i>b</i>. Then the final equation is something in the form of:</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/bVJSt4GhQI9itvE6g4MJI/2b65204321b32e3ca9a5c701d89c28f3/Screen-Shot-2020-12-21-at-13.37.24-1.png\" alt=\"\" class=\"kg-image\" width=\"1400\" height=\"150\" loading=\"lazy\"/>\n            \n            </figure><p>In the screenshot below, g = f<sub>1</sub>. You can view this graph <a href=\"https://www.desmos.com/calculator/7j86q3x9xd\">here</a>.</p><h3>Beating the drum</h3><p>The attacker may have utilized this method in order to try and overcome our <a href=\"https://www.cloudflare.com/ddos/\">DDoS protection systems</a> (perhaps thinking that the rhythmic rise and fall of the attack would fool our systems). However, <a href=\"/announcing-flowtrackd/\">flowtrackd</a>, our unidirectional TCP state tracking machine, detected it as being a flood of ACK packets that do not belong to any existing TCP connection. Therefore, flowtrackd automatically dropped the attack packets at Cloudflare’s edge.</p><p>The attacker was beating the drum for over 19 hours with an <a href=\"https://en.wikipedia.org/wiki/Amplitude\">amplitude</a> of ~7 Mpps, a <a href=\"https://en.wikipedia.org/wiki/Wavelength\">wavelength</a> of ~4 hours, and peaking at ~42 Mpps. During the two days in which the attack took place, Cloudflare systems automatically detected and mitigated over 700 DDoS attacks that targeted this customer. The attack traffic accumulated at almost 500 Terabytes out of a total of 3.6 Petabytes of attack traffic that targeted this single customer in November alone. During those two days, the attackers utilized mainly ACK floods, UDP floods, SYN floods, Christmas floods (where all of the TCP flags are ‘lit’), ICMP floods, and RST floods.</p><h3>The challenge of TCP based attacks</h3><p>TCP is a stateful protocol, which means that in some cases, you’d need to keep track of a TCP connection’s state in order to know if a packet is legitimate or part of an attack, i.e. out of state. We were able to provide protection against out-of-state TCP packet attacks for our “classic” <a href=\"https://www.cloudflare.com/waf/\">WAF/CDN</a> service and <a href=\"https://www.cloudflare.com/products/cloudflare-spectrum/\">Spectrum</a> service because in both cases Cloudflare serves as a reverse-proxy seeing both ingress and egress traffic.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/50TeDfJThryAPOnT6jAyxJ/5c2333b63bf42acc1a69692137f48440/image28.png\" alt=\"While not entirely trivial to implement with Linux, we were able to provide protection for out-of-state TCP packet attacks for our “classic” WAF/CDN service and Spectrum service, where in both cases Cloudflare serves as a reverse-proxy -- and sees both ingress and egress traffic.\" class=\"kg-image\" width=\"1306\" height=\"685\" loading=\"lazy\"/>\n            \n            </figure><p>However, when we launched Magic Transit, which relies on an asymmetric routing topology with a direct server return (DSR), we couldn’t utilize our existing TCP connection tracking systems.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/3K5i1ImnC6qE78Gwgpa3a2/f501fb4f5d8dd8098727179fd83d42bc/image22.png\" alt=\"When we launched Magic Transit, which relies on an asymmetric routing topology with a direct server return (DSR), we couldn’t utilize our existing TCP connection tracking systems.\" class=\"kg-image\" width=\"1999\" height=\"888\" loading=\"lazy\"/>\n            \n            </figure><p>And so, being a software-defined company, we’re able to write code and spin up software when and where needed -- as opposed to vendors that utilize dedicated DDoS protection hardware appliances. And that is what we did. We built flowtrackd, which runs autonomously on each server at our network’s edge. flowtrackd is able to classify the state of TCP flows by analyzing only the ingress traffic, and then drops, challenges, or rate-limits attack packets that do not correspond to an existing flow.</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/77GmYUSg47L9EGsPeljTs/3a59c410fbaeeb6fdeca4dc412eb3f1f/image23.png\" alt=\"flowtrackd is able to classify the state of TCP flows by analyzing only the ingress traffic, and then drops, challenges, or rate-limits attack packets that do not correspond to an existing flow\" class=\"kg-image\" width=\"1612\" height=\"1003\" loading=\"lazy\"/>\n            \n            </figure><p>flowtrackd works together with our two additional DDoS protection systems, dosd and Gatebot, to assure our customers are protected against DDoS attacks, regardless of their size or sophistication -- in this case, serving as a noise-canceling system to the Beat attack; reducing the headaches for our customers.</p><p>Read more about how our DDoS protection systems work <a href=\"/moobot-vs-gatebot-cloudflare-automatically-blocks-botnet-ddos-attack-topping-at-654-gbps/#ddos-detect-mitigate\">here</a>.</p>",
		"id": "25eNmeM8ekxTeAyEZuGKEr",
		"localeList": {
			"name": "Beat - An Acoustics Inspired DDoS Attack Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": "On the week of Black Friday, Cloudflare automatically detected and mitigated “Beat” - acoustics inspired DDoS attacks that targeted a Magic Transit customer.",
		"metadata": {
			"title": "Beat - An Acoustics Inspired DDoS Attack",
			"description": "On the week of Black Friday, Cloudflare automatically detected and mitigated “Beat” - acoustics inspired DDoS attacks that targeted a Magic Transit customer.",
			"imgPreview": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/6K07NdIpvq0FRIFPRd6Qrf/8d6f66944704e43be02ccc99a25f3bff/beat-an-acoustics-inspired-ddos-attack-Cy5KzO.png"
		},
		"primary_author": {},
		"published_at": "2020-12-22T12:00:00.000+00:00",
		"reading_time": 5,
		"slug": "beat-an-acoustics-inspired-ddos-attack",
		"tags": [
			{
				"id": "64g1G2mvZyb6PjJsisO09T",
				"name": "DDoS",
				"slug": "ddos"
			},
			{
				"id": "7qTIAO0WLKVKPVrj8q1vpD",
				"name": "Magic Transit",
				"slug": "magic-transit"
			},
			{
				"id": "5kIxDMJCg3PXQxVINDL0Cw",
				"name": "Attacks",
				"slug": "attacks"
			},
			{
				"id": "6Mp7ouACN2rT3YjL1xaXJx",
				"name": "Security",
				"slug": "security"
			}
		],
		"title": "Beat - An Acoustics Inspired DDoS Attack",
		"updated_at": "2024-08-27T01:54:38.829Z",
		"url": "https://blog.cloudflare.com/beat-an-acoustics-inspired-ddos-attack"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}