{
	"initialReadingTime": "5",
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "Jon Levine",
				"slug": "jpl",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/2xdSqLo0jn89CExvkA5vvj/03599c6af64ea17f04105c94f6ecd37f/jpl.jpg",
				"location": "San Francisco, CA",
				"website": null,
				"twitter": "@jplevine",
				"facebook": null
			}
		],
		"excerpt": "Workers Analytics Engine is a new way to get telemetry about anything using Cloudflare Workers. Workers Analytics Engine provides time series analytics built for the serverless era",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/5kdXwBHbIlmWOjm7vjF1jm/a4e746c2ae81f3b678d372eaa3c2811b/workers-analytics-engine.png",
		"featured": false,
		"html": "\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/7zlbELn1LCl8vl8ySLZB1Q/b908077c20dbe32bea30e7fdc52ce2b7/image2-18.png\" alt=\"Introducing Workers Analytics Engine\" class=\"kg-image\" width=\"1800\" height=\"1013\" loading=\"lazy\"/>\n            \n            </figure><p>Today we’re excited to introduce Workers Analytics Engine, a new way to get telemetry about anything using Cloudflare Workers. Workers Analytics Engine provides time series analytics built for the serverless era.</p><p>Workers Analytics Engine uses the same technology that powers Cloudflare’s analytics for millions of customers, who generate 10s of millions of events per second. This unique architecture provides significant benefits over traditional metrics systems – and even enables our customers to build analytics for <i>their</i> customers.</p><h3>Why use Workers Analytics Engine</h3><p>Workers Analytics Engine can be used to get telemetry about just about anything.</p><p>Our initial motivation for building Workers Analytics Engine was to help internal teams at Cloudflare better understand what’s happening in their Workers. For example, one early internal customer is our <a href=\"https://www.cloudflare.com/developer-platform/r2/\">R2 storage product</a>. The R2 team is using the Analytics Engine to measure how many reads and writes happen in R2, how many users make these requests, how many bytes are transferred, how long the operations take, and so forth.</p><p>After seeing quick adoption from internal teams at Cloudflare, we realized that many customers could benefit from using this product.</p><p>For example, Workers Analytics Engine can also be used to build custom security rules. You could use it to implement something like <a href=\"https://www.fail2ban.org/wiki/index.php/Main_Page\">fail2ban</a>, a program that can ban malicious traffic. Every time someone logs in, you could record information like their location and IP. On subsequent logins, you could query the rate of login attempts from these attackers, and block them if they’ve attempted to sign in too many times in a given period.</p><p>Workers Analytics Engine can even be used to track things in the world that have nothing (yet!) to do with Workers. For example, imagine you have a network of IoT sensors that connect to the Internet to report weather and air quality data, like temperature, air pressure, wind speed, and PM2.5 pollution. Using Workers Analytics Engine, you could deploy a Worker in just a few minutes that collects these reports, and then query and visualize the data using our analytics APIs.</p><h3>How to use Workers Analytics Engine</h3><p>There are three steps to get started with Workers Analytics Engine:</p><ol><li><p>Configure your analytics using <a href=\"https://developers.cloudflare.com/workers/cli-wrangler/configuration/\">Wrangler</a></p></li><li><p>Write data using the <a href=\"https://developers.cloudflare.com/workers/runtime-apis/\">Workers Runtime API</a></p></li><li><p>Query your data using our SQL or <a href=\"https://developers.cloudflare.com/analytics/graphql-api/\">GraphQL API</a>.</p></li></ol><h3>Configuring Workers Analytics Engine in Wrangler</h3><p>To start using Workers Analytics Engine, you first need to configure it in Wrangler. This is done by creating a binding in <a href=\"https://developers.cloudflare.com/workers/cli-wrangler/configuration/\"><code>wrangler.toml</code></a>.</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">[analytics_engine]\nbindings = [\n    { name = &quot;WEATHER&quot; }\n]</pre></code>\n            <p>Your analytics can be named after the event in the world that they represent. For example, readings from our weather sensor above might be named “WEATHER.”</p><p>For our current beta release, customers may only create one binding at a time. In the future, we plan to enable customers to define multiple bindings, or even define them on-the-fly from within the Workers runtime.</p><h3>Writing data from the Workers runtime</h3><p>Once a binding is declared in Wrangler, you get a new <a href=\"https://developers.cloudflare.com/workers/platform/environment-variables/\">environment variable</a> in the Workers runtime that represents your Analytics Engine. This variable has a method, <code>writeDataPoint()</code>. A “data point” is a structured event which consists of a vector of <i>blobs</i> and a vector of <i>doubles</i>.</p><p>A double is just a “number” type field that can be aggregated in some way – for example, it could be summed, averaged, or quantiled. A blob is a “string” type field that can be used for grouping or filtering.</p><p>For example, suppose you are collecting air quality samples. Each data point would represent a reading from your weather sensor. Doubles might include numbers like the temperature or air pressure reading. The blobs could include the location of the sensor and the hardware identifier of the sensor.</p><p>Here’s what this looks like in code:</p>\n            <pre class=\"language-javascript\"><code class=\"language-javascript\">  async fetch(request: Request, env) {\n    env.WEATHER.writeDataPoint({\n      blobs: [&quot;Seattle&quot;, &quot;USA&quot;, &quot;pro_sensor_9000&quot;],\n      doubles: [25, 0.5]\n    });\n    return new Response(&quot;OK!&quot;);\n  }</pre></code>\n            <p>In our initial version, developers are responsible for providing fields in a consistent order, so that they have the same semantics when querying. In a future iteration, we plan to let developers name their blobs and doubles in the binding, and then use these names when writing data points in the runtime.</p><h3>Querying and visualizing data</h3><p>To query your data, Cloudflare provides a rich SQL API. For example:</p>\n            <pre class=\"language-sql\"><code class=\"language-sql\">SELECT blob_1 as city, avg(doubles_2) as avg_humidity\nFROM WEATHER\nWHERE double_1 &gt; 0\nORDER BY avg_humidity DESC\nLIMIT 10</pre></code>\n            <p>The results would show you the top 10 cities that had the highest average humidity readings when the temperature was above 0.</p><p>Note that, for our initial version, blobs and doubles are accessed via names that have 1-based indexing. In the future, when we let developers name blobs and doubles in their binding, these names will also be available via the SQL API.</p><p>Workers Analytics Engine is optimized for powering <i>time series</i> analytics that can be visualized using tools like Grafana. Every event written from the runtime is automatically populated with a <code>timestamp</code> field. This makes it incredibly easy to make time series charts in Grafana:</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/6iEBcfjVdFME7W2G313LEL/6a3f2253dce511e4bf2cd1a3f1979f58/image1-27.png\" alt=\"\" class=\"kg-image\" width=\"1161\" height=\"970\" loading=\"lazy\"/>\n            \n            </figure><p>The macro <code>$timeSeries</code> simply expands to <code>intDiv(toUInt32(timestamp), 60) * 60 * 1000</code> — i.e. the timestamp rounded to the nearest minute (as defined in our \\$step parameter)  and converted into milliseconds. Grafana also provides \\$timeFilter which can be changed at the grafana dashboard level. We could easily add another series here by just “grouping” on another field like “city”.</p><p>Data can also be queried using our GraphQL API. At this time, the GraphQL API only supports querying total counts for each named binding.</p><p>Finally, the Cloudflare dashboard also provides a high-level count of the total number of data points seen for each binding. In the future, we plan to offer rich analytical abilities through the dashboard.</p><h3>How is this different from traditional metrics systems?</h3><p>Many developers are familiar with <i>metrics</i> systems like Prometheus. We built Workers Analytics Engine based on our experience providing analytics for millions of Cloudflare customers. Writing structured event logs and querying them using a relational database model is very different from writing metrics – but it’s also much more powerful.</p><p>Here are some of the benefits of our model, compared with metrics systems:</p><ul><li><p><b><b><b>Unlimited cardinality of label values:</b></b></b> In a traditional metrics system, like Prometheus, every time you add a new label value, under the hood you are actually adding a new metric. If you have multiple labels for one data point, this can rapidly increase the number of metrics. Nearly everyone using a metrics system <a href=\"https://www.google.com/search?q=prometheus+cardinality\">runs into challenges with cardinality</a>. For example, you may start by including a “customer ID” in a label – but what happens when you have thousands or millions of customers? In contrast, when using Workers Analytics Engine, every blob value is stored independently – so every data point can have unique (blob) label values with no problem.</p></li><li><p><b><b><b>Low latency reporting:</b></b></b> Pull-based metrics systems must check for new metrics at some fixed interval, known as a <a href=\"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config\"><i>scrape interval</i></a>. Commonly this is set to one minute or longer – and this is the absolute fastest that your data can be collected. With Workers Analytics Engine, we can report on new data points within a few seconds.</p></li><li><p><b><b><b>Fast queries at any timescale:</b></b></b> Everyone who uses Prometheus knows what happens when you expand that range selector in Grafana to change from looking back 30 minutes to seven days… you wait, and you’re lucky if you get any results at all. <a href=\"https://thanos.io/\">Whole new pieces of software</a> exist just for the challenge of storing Prometheus metrics long-term. In contrast, Workers Analytics Engine is superfast at querying anything from the last five minutes of data to the last seven days. Look for yourself to see!</p></li></ul><!--kg-card-begin: html--><div style=\"position: relative; padding-top: 56.25%;\"><iframe src=\"https://iframe.videodelivery.net/c3796f0517f41d472c393b0414b5ebdb?preload=true&poster=https%3A%2F%2Fvideodelivery.net%2Fc3796f0517f41d472c393b0414b5ebdb%2Fthumbnails%2Fthumbnail.jpg%3Ftime%3D%26height%3D600\" style=\"border: none; position: absolute; top: 0; left: 0; height: 100%; width: 100%;\" allow=\"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;\" allowfullscreen=\"true\"></iframe></div>\n<p></p><!--kg-card-end: html--><p>And of course, Workers Analytics Engine runs on Cloudflare’s global network. So rather than worrying about running your own Prometheus server, setting up Thanos, and closely tracking cardinality, you can just write data and query it using our SQL API.</p><h3>What’s next</h3><p>You can <a href=\"https://developers.cloudflare.com/analytics/analytics-engine/get-started/\">get started here</a> and write data to Workers Analytics Engine from your Worker today. We already have many teams at Cloudflare happily using this and would love to get your feedback at this early stage, as we are quickly adding new functionality.</p><p>We have an ambitious roadmap ahead of us. One critical use case we plan to support is building analytics and usage-based billing <i>for your customers</i> – so if you’re a platform who is looking to build analytics into your product, we’d love to talk to you!</p><p>And of course, if this sounds fun to work on, we’re hiring engineers on the Data team to work in <a href=\"https://boards.greenhouse.io/cloudflare/jobs/2103918?gh_jid=2103918\">San Francisco</a>, <a href=\"https://boards.greenhouse.io/cloudflare/jobs/3702343?gh_jid=3702343\">London</a>, or remote locations!</p>",
		"id": "3rewoqYpo993dwlSkrguct",
		"localeList": {
			"name": "Introducing Workers Analytics Engine Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": "Workers Analytics Engine is a new way to get telemetry about anything using Cloudflare Workers. Workers Analytics Engine provides time series analytics built for the serverless era.",
		"metadata": {
			"title": "Introducing Workers Analytics Engine",
			"description": "Workers Analytics Engine is a new way to get telemetry about anything using Cloudflare Workers. Workers Analytics Engine provides time series analytics built for the serverless era.",
			"imgPreview": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/6W4F5RILoqBUVlFAzaIpKz/3f04f2be7f18695a799fb204c25a85d7/workers-analytics-engine-BEpD6Q.png"
		},
		"primary_author": {},
		"published_at": "2022-05-12T13:58:37.000+01:00",
		"slug": "workers-analytics-engine",
		"tags": [
			{
				"id": "1VkRSlsXf1AYB3QvlWU1JK",
				"name": "Platform Week",
				"slug": "platform-week"
			}
		],
		"title": "Introducing Workers Analytics Engine",
		"updated_at": "2024-08-27T01:31:19.596Z",
		"url": "https://blog.cloudflare.com/workers-analytics-engine"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}