<div class="mb2 gray5">7 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/09/image8-3.png" class="kg-image" alt="API Endpoint Management and Metrics are now GA" loading="lazy"></figure>
	<p>The Internet is an endless flow of conversations between computers. These conversations, the Â&nbsp;constant exchange of information from one computer to another, are what allow us to interact with the Internet as we know it. <a href="https://www.cloudflare.com/learning/security/api/what-is-an-api">Application Programming Interfaces (APIs)</a> are the vital channels that carry these conversations, and their usage is quickly growing: in fact, <a href="https://blog.cloudflare.com/landscape-of-api-traffic">more than half of the traffic</a> handled by Cloudflare is for APIs, and this is increasing twice as fast as traditional web traffic.</p>
	<p>In March, we announced that weâ€™re expanding our API Shield into a full <a href="https://blog.cloudflare.com/api-gateway">API Gateway</a> to make it easy for our customers to protect and manage those conversations. We already offer several features that allow you to secure your endpoints, but thereâ€™s more to endpoints than their security. It can be difficult to keep track of many endpoints over time and understand how theyâ€™re performing. Customers deserve to see whatâ€™s going on with their API-driven domains and have the ability to <em>manage</em> their endpoints.</p>
	<p>Today, weâ€™re excited to announce that the ability to save, update, and monitor the performance of all your API endpoints is now generally available to API Shield customers. This includes key performance metrics like latency, error rate, and response size that give you insights into the overall health of your API endpoints.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/09/image3-19.png" class="kg-image" alt="" loading="lazy"></figure>
	<h3 id="a-refresher-on-apis">A Refresher on APIs</h3>
	<p>The bar for what we expect an application to do for us has risen tremendously over the past few years. When we open a browser, app, or IoT device, we expect to be able to connect to data instantly, compare dozens of flights within seconds, choose a menu item from a food delivery app, or see the weather for ten locations at once.</p>
	<p>How are applications able to provide this kind of dynamic engagement for their users? They rely on APIs, which provide access to data and servicesâ€”either from the application developer or from another company. APIs are fundamental in how computers (or services) talk to each other and exchange information.</p>
	<p>You can think of an API as a waiter: say a customer orders a delicious bowl of Mac n Cheese. The waiter accepts this order from the customer, communicates the request to the chef in a format the chef can understand, and then delivers the Mac n Cheese back to the customer (assuming the chef has the ingredients in stock). The waiter is the crucial <em>channel of communication</em>, which is exactly what the API does.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/09/image7-2.png" class="kg-image" alt="" loading="lazy"></figure>
	<h3 id="managing-api-endpoints">Managing API Endpoints</h3>
	<p>The first step in managing APIs is to get a complete list of all the <a href="https://www.cloudflare.com/learning/learning/security/api/what-is-api-discovery">endpoints exposed to the internet</a>. <a href="https://developers.cloudflare.com/api-shield/security/api-discovery"><em>API Discovery</em></a> automatically does this for any traffic flowing through Cloudflare. Undiscovered APIs canâ€™t be monitored by security teams (since they don't know about them) and they're thus less likely to have proper security policies and best practices applied. However, customers have told us they also want the ability to manually add and manage APIs that are not yet deployed, or they want to ignore certain endpoints (for example those in the process of deprecation). Now, API Shield customers can choose to save endpoints found by Discovery or manually add endpoints to API Shield.</p>
	<p>But security vulnerabilities arenâ€™t the only risk or area of concern with APIs â€“ they can be painfully slow or connections can be unsuccessful. We heard questions from our customers such as: what are my most popular endpoints? Is this endpoint significantly slower than it was yesterday? Are any endpoints returning errors that may indicate a problem with the application?</p>
	<p>Thatâ€™s why we built Performance Metrics into API Shield, which allows our customers to quickly answer these questions themselves with real-time data.</p>
	<h3 id="prioritizing-performance">Prioritizing Performance</h3>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/09/image2-28.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>Once youâ€™ve discovered, saved, or removed endpoints, you want to know whatâ€™s going well and whatâ€™s not. To end-users, a huge part of what defines the experience as â€œgoing wellâ€ is good performance. Poor performance can lead to a frustrating experience: when youâ€™re shopping online and press a button to check out, you donâ€™t want to wait around for minutes for the page to load. And you certainly never want to see a dreaded error symbol telling you that you canâ€™t get what you came for.</p>
	<p>Exposing performance metrics of API endpoints puts concrete numerical data into your developersâ€™ hands to tell you how things are going. When things are going poorly, these dashboard metrics will point out exactly which aspect of performance is causing concern: maybe you expected to see a spike in requests, but find out that request count is normal and latency is just higher than usual.</p>
	<p>Empowering our customers to make data-driven decisions to better manage their APIs ends up being a win for our customers <em>and</em> our customersâ€™ customers, who expect to seamlessly engage with the domainâ€™s APIs and get exactly what they came for.</p>
	<h3 id="management-and-performance-metrics-in-the-dashboard">Management and Performance Metrics in the Dashboard</h3>
	<p>So, whatâ€™s available today? Log onto your Cloudflare dashboard, go to the domain-level Security tab, and open up the API Shield page. Here, youâ€™ll see the Endpoint Management tab, which shows you all the API endpoints that youâ€™ve saved, alongside placeholders for metrics that will soon be gathered.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/09/image10-1.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>Here you can easily delete endpoints you no longer want to track, or click manually add additional endpoints. You can also export schemas for each host to share internally or externally.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/09/image9-3.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>Once youâ€™ve saved the endpoints that you want to keep tabs on, Cloudflare will start collecting data on its performance and make it available to you as soon as possible.</p>
	<p>In Endpoint Management, you can see a few summary metrics in the collapsed view of each endpoint, including recommended rate limits, average latency, and error rate. It can be difficult to tell whether things are going well or not just from seeing a value alone, so we added sparklines that show <em>relative</em> performance, comparing an endpointâ€™s current metrics with its usual or previous data.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/09/image5-10.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>If you want to view further details about a given endpoint, you can expand it for additional metrics such as response size and errors separated by 4xx and 5xx. The expanded view also allows you to view all metrics at a single timestamp by hovering over the charts.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/09/unnamed-1.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>For each saved endpoint, customers can see the following metrics:</p>
	<ul>
		<li><strong>Request count</strong>: total number of requests to the endpoint over time.</li>
		<li><strong>Rate limiting recommendation</strong> per 10 minutes, which is guided by the request count.</li>
		<li><strong>Latency</strong>: average origin response time, in milliseconds (ms). How long does it take from the moment a visitor makes a request to the moment the visitor gets a response back from the origin?</li>
		<li><strong>Error rate</strong> vs. overall traffic: grouped by 4xx, 5xx, and their sum.</li>
		<li><strong>Response size</strong>: average size of the response (in bytes) returned to the request.</li>
	</ul>
	<p>You can toggle between viewing these metrics on a 24-hour period or a 7-day period, depending on the scale on which youâ€™d like to view your data. And in the expanded view, we provide a percentage difference between the averages of the current vs. the previous period. For example, say Iâ€™m viewing my metrics on a 24-hour timeline. My average latency yesterday was 10 ms, and my average latency today is 30 ms, so the dashboard shows a 200% increase. We also use anomaly detection to bring attention to endpoints that have concerning performance changes.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/09/image6-5.png" class="kg-image" alt="" loading="lazy"></figure>
	<h3 id="additional-improvements-to-discovery-and-schema-validation">Additional improvements to Discovery and Schema Validation</h3>
	<p>As part of making endpoint management GA, weâ€™re also adding two additional enhancements to API Shield.</p>
	<p>First, <em><strong>API Discovery now accepts cookies</strong></em> â€” in addition to authorization headers â€” to discover endpoints and suggest rate limiting thresholds. Previously, you could only identify an API session with HTTP headers, which didnâ€™t allow customers to protect endpoints that use cookies as session identifiers. Now these endpoints can be protected as well. Simply go to the API Shield tab in the dashboard, choose edit session identifiers, and either change the type, or click <code>Add additional identifier</code>.<br></p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/09/image1-34.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>Second, we added the ability to <em><strong>validate the body of requests via Schema Validation</strong></em> for all customers. Schema Validation allows you to provide an OpenAPI schema (a template for your API traffic) and have Cloudflare block non-conformant requests as they arrive at our edge. Previously, you provided specific headers, cookies, and other features to validate. Now that we can validate the body of requests, you can use Schema Validation to confirm every element of a request matches what is expected. If a request contains strange information in the payload, weâ€™ll notice. Note: <em>customers who have already uploaded schemas will need to re-upload to take advantage of body validation.</em></p>
	<p>Take a look at our <a href="https://developers.cloudflare.com/api-shield">developer documentation</a> for more details on both of these features.</p>
	<h3 id="get-started">Get started</h3>
	<p>Endpoint Management, performance metrics, schema exporting, discovery via cookies, and schema body validation are all available now for all API Shield customers. To use them, log into the Cloudflare dashboard, click on <code>Security</code> in the navigation bar, and choose API Shield. Once API Shield is enabled, youâ€™ll be able to start discovering endpoints immediately. You can also use all features <a href="https://api.cloudflare.com/#api-shield-settings-properties">through our API</a>.</p>
	<p>If you arenâ€™t yet protecting a website with Cloudflare, it only takes a few minutes to <a href="https://dash.cloudflare.com/sign-up">sign up</a>.</p>
</div>