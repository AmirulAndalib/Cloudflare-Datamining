<div class="mb2 gray5">9 min read</div>
<div class="post-content lh-copy gray1"><!--kg-card-begin: markdown-->
	<p><em><small>This post is also available in <a href="https://blog.cloudflare.com/zh-cn/cache-reserve-open-beta-zh-cn">ç®€ä½“ä¸­æ–‡</a>, <a href="https://blog.cloudflare.com/zh-tw/cache-reserve-open-beta-zh-tw">ç¹é«”ä¸­æ–‡</a>, <a href="https://blog.cloudflare.com/ko-kr/cache-reserve-open-beta-ko-kr">í•œêµ­ì–´</a>, <a href="https://blog.cloudflare.com/ja-jp/cache-reserve-open-beta-ja-jp">æ—¥æœ¬èªž</a>, <a href="https://blog.cloudflare.com/de-de/cache-reserve-open-beta-de-de">Deutsch</a>, <a href="https://blog.cloudflare.com/fr-fr/cache-reserve-open-beta-fr-fr">FranÃ§ais</a>, <a href="https://blog.cloudflare.com/es-es/cache-reserve-open-beta-es-es">EspaÃ±ol</a> and <a href="https://blog.cloudflare.com/pt-br/cache-reserve-open-beta-pt-br">PortuguÃªs</a>.</small></em></p>
	<!--kg-card-end: markdown-->
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/11/Cache-Reserve-Open-Beta.png" class="kg-image" alt="Reduce origin load, save on cloud egress fees, and maximize cache hits with Cache Reserve" loading="lazy"></figure>
	<p>Earlier this year, we introduced Cache Reserve. Cache Reserve helps users serve content from Cloudflareâ€™s cache for longer by using <a href="https://www.cloudflare.com/products/r2">R2</a>â€™s persistent data storage. Serving content from Cloudflareâ€™s cache benefits website operators by reducing their bills for <a href="https://www.cloudflare.com/learning/cloud/what-are-data-egress-fees">egress fees</a> from origins, while also benefiting website visitors by having content load faster. </p>
	<p>Cache Reserve has been in <a href="https://blog.cloudflare.com/introducing-cache-reserve">closed beta</a> for a few months while weâ€™ve collected feedback from our initial users and continued to develop the product. After several rounds of iterating on this feedback, today weâ€™re extremely excited to announce that <strong>Cache Reserve is graduating to open beta</strong> â€“ users will now be able to test it and integrate it into their content delivery strategy without any additional waiting. </p>
	<p>If you want to see the benefits of Cache Reserve for yourself and give us some feedbackâ€“ you can go to the Cloudflare dashboard, navigate to the Caching section and enable Cache Reserve by pushing <a href="https://dash.cloudflare.com/caching/cache-reserve">one button</a>.</p>
	<h2 id="how-does-cache-reserve-fit-into-the-larger-picture">How does Cache Reserve fit into the larger picture?</h2>
	<p>Content served from Cloudflareâ€™s cache begins its journey at an origin server, where the content is hosted. When a request reaches the origin, the origin compiles the content needed for the response and sends it back to the visitor.</p>
	<p>The distance between the visitor and the origin can affect the performance of the asset as it may travel a long distance for the response. This is also where the user is charged a fee to move the content from where itâ€™s stored on the origin to the visitor requesting the content. These fees, known as â€œbandwidthâ€ or â€œegressâ€ fees, are familiar monthly line items on the invoices for users that host their content on cloud providers.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/11/Response-Flow.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>Cloudflareâ€™s CDN sits between the origin and visitor and evaluates the originâ€™s response to see if it can be cached. If it can be added to Cloudflareâ€™s cache, then the next time a request comes in for that content, Cloudflare can respond with the cached asset, which means there's no need to send the request to the originâ€“ reducing egress fees for our customers. We also cache content in data centers close to the visitor to improve the performance and cut down on the transit time for a response.</p>
	<p>To help assets remain cached for longer, a few years ago we introduced <a href="https://blog.cloudflare.com/introducing-smarter-tiered-cache-topology-generation">Tiered Cache</a> which organizes all of our 250+ global data centers into a hierarchy of lower-tiers (generally closer to visitors) and upper-tiers (generally closer to origins). When a request for content cannot be served from a lower-tierâ€™s cache, the upper-tier is checked before going to the origin for a fresh copy of the content. Organizing our data centers into tiers helps us cache content in the right places for longer by putting multiple caches between the visitorâ€™s request and the origin.</p>
	<p><strong>Why do cache misses occur?</strong><br>Misses occur when Cloudflare cannot serve the content from cache and must go back to the origin to retrieve a fresh copy. This can happen when a customer sets the <a href="https://developers.cloudflare.com/cache/about/cache-control">cache-control</a> time to signify when the content is out of date (stale) and needs to be <a href="https://developers.cloudflare.com/cache/about/cache-control/#revalidation">revalidated</a>. The other element at play â€“ how long the network wants content to remain cached â€“ is a bit more complicated and can fluctuate depending on eviction criteria.</p>
	<p><a href="https://www.cloudflare.com/learning/cdn/what-is-a-cdn">CDNs</a> must consider whether they need to evict content early to optimize storage of other assets when cache space is full. At Cloudflare, we prioritize eviction based on how recently a piece of cached content was requested by using an algorithm called â€œleast recently usedâ€ or <a href="https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)">LRU</a>. This means that even if cache-control signifies that a piece of content should be cached for many days, we may still need to evict it earlier (if it is least-requested in that cache) to cache more popular content.</p>
	<p>This works well for most customers and website visitors, but is often a point of confusion for people wondering why content is unexpectedly displaying a miss. If eviction did not happen then content would need to be cached in data centers that were further away from visitors requesting that data, harming the performance of the asset and injecting inefficiencies into how Cloudflareâ€™s network operates.</p>
	<p>Some customers, however, have large libraries of content that may not be requested for long periods of time. Using the traditional cache, these assets would likely be evicted and, if requested again, served from the origin. Keeping assets in cache requires that they remain popular on the Internet which is hard given whatâ€™s popular or current is constantly changing. Evicting content that becomes cold means additional origin egress for the customer if that content needs to be pulled repeatedly from the origin.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/11/Cache-Reserve-Response-Flow.png" class="kg-image" alt="" loading="lazy"></figure>
	<p><strong>Enter Cache Reserve</strong><br>This is where Cache Reserve shines. Cache Reserve serves as the ultimate upper-tier data center for content that might otherwise be evicted from cache. Once <a href="https://developers.cloudflare.com/cache/about/cache-reserve/#cache-reserve-asset-eligibility">admitted</a> to Cache Reserve, content can be stored for a much longer period of timeâ€“ 30 days by <a href="https://developers.cloudflare.com/cache/about/cache-reserve">default</a>. If another request comes in during that period, it can be extended for another 30 days (and so on) or until cache-control signifies that we should no longer serve that content from cache. Cache Reserve serves as a safety net to backstop all cacheable content, so customers don't have to worry about unwanted cache eviction and origin egress fees.</p>
	<h2 id="how-does-cache-reserve-save-egress">How does Cache Reserve save egress?</h2>
	<p>The promise of Cache Reserve is that hit ratios will increase and egress fees from origins will decrease for long tail content that is rarely requested and may be evicted from cache. </p>
	<p>However, there are additional egress savings built into the product. For example, objects are written to Cache Reserve on misses. This means that when fetching the content from the origin on a cache miss, we both use that to respond to a request while also writing the asset to Cache Reserve, so customers wonâ€™t experience egress from serving that asset for a long time.</p>
	<p>Cache Reserve is designed to be used with tiered cache enabled for maximum origin shielding. When there is a cache miss in both the lower and upper tiers, Cache Reserve is checked and if there is a hit, the response will be cached in both the lower and upper tier on its way back to the visitor without the origin needing to see the request or serve any additional data.</p>
	<p>Cache Reserve accomplishes these origin egress savings for a low price, based on R2 costs. For more information on Cache Reserve prices and operations, please see the documentation <a href="https://developers.cloudflare.com/cache/about/cache-reserve/#pricing">here</a>.</p>
	<h2 id="scaling-cache-reserve-on-cloudflare-s-developer-platform">Scaling Cache Reserve on Cloudflareâ€™s developer platform</h2>
	<p>When we first announced Cache Reserve, the response was overwhelming. Over 20,000 users wanted access to the beta, and we quickly made several interesting discoveries about how people wanted to use Cache Reserve. </p>
	<p>The first big challenge we found was that users hated egress fees as much as we do and wanted to make sure that as much content as possible was in Cache Reserve. During the closed beta we saw usage above 8,000 PUT operations per second sustained, and objects served at a rate of over 3,000 GETs per second. We were also caching around 600Tb for some of our large customers. We knew that we wanted to open the product up to anyone that wanted to use it and in order to scale to meet this demand, we needed to make several changes quickly. So we turned to Cloudflareâ€™s developer platform. </p>
	<p>Cache Reserve stores data on R2 using its <a href="https://developers.cloudflare.com/r2/data-access/s3-api/api">S3-compatible API</a>. Under the hood, R2 handles all the complexity of an <a href="https://www.cloudflare.com/learning/cloud/what-is-object-storage">object storage</a> system using our performant and scalable developer primitives: <a href="https://developers.cloudflare.com/workers">Workers</a> and <a href="https://developers.cloudflare.com/workers/runtime-apis/durable-objects">Durable Objects</a>. We decided to use developer platform tools because it would allow us to implement different scaling strategies quickly. The advantage of building on the Cloudflare developer platform is that Cache Reserve was easily able to experiment to see how we could best distribute the high load we were seeing, all while shielding the complexity of how Cache Reserve works from users. Â&nbsp;</p>
	<p>With the single press of a button, Cache Reserve performs these functions: </p>
	<ul>
		<li>On a cache miss, <a href="https://blog.cloudflare.com/how-we-built-pingora-the-proxy-that-connects-cloudflare-to-the-internet">Pingora</a> (our new L7 proxy) reaches out to the origin for the content and writes the response to R2. This happens while the content continues its trip back to the visitor (thereby avoiding needless latency). </li>
		<li>Inside R2, a Worker writes the content to R2â€™s persistent data storage while also keeping track of the important metadata that Pingora sends about the object (like origin headers, freshness values, and retention information) using Durable Objects storage.</li>
		<li>When the content is next requested, Pingora looks up where the data is stored in R2 by computing the cache key. The cache keyâ€™s hash determines both the object name in R2 and which bucket it was written to, as each zoneâ€™s assets are sharded across multiple buckets to distribute load. </li>
		<li>Once found, Pingora attaches the relevant metadata and sends the content from R2 to the nearest upper-tier to be cached, then to the lower-tier and finally back to the visitor. </li>
	</ul>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/11/Screen-Shot-2022-11-14-at-4.31.20-PM.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>This is magic! None of the above needs to be managed by the user. By bringing together R2, Workers, Durable Objects, Pingora, and Tiered Cache we were able to quickly build and make changes to Cache Reserve to scale as neededâ€¦</p>
	<h2 id="what-s-next-for-cache-reserve">Whatâ€™s next for Cache Reserve</h2>
	<p>In addition to the work weâ€™ve done to scale Cache Reserve, opening the product up also opens the door to more features and integrations across Cloudflare. We plan on putting additional analytics and metrics in the hands of Cache Reserve users, so they know precisely whatâ€™s in Cache Reserve and how much egress itâ€™s saving them. We also plan on building out more complex integrations with R2 so if customers want to begin managing their storage, they are able to easily make that transition. Finally, weâ€™re going to be looking into providing more options for customers to control precisely what is eligible for Cache Reserve. These features represent just the beginning for how customers will control and customize their cache on Cloudflare.</p>
	<h2 id="what-s-some-of-the-feedback-been-so-far">Whatâ€™s some of the feedback been so far?</h2>
	<blockquote>As a long time Cloudflare customer, we were eager to deploy Cache Reserve to provide cost savings and improved performance for our end users. Ensuring our application always performs optimally for our global partners and delivery riders is a primary focus of Delivery Hero. With Cache Reserve our cache hit ratio improved by 5% enabling us to scale back our infrastructure and simplify what is needed to operate our global site and provide additional cost savings.<br><strong>Wai Hang Tang</strong>, Director of Engineering at <a href="https://www.deliveryhero.com">Delivery Hero</a></blockquote>
	<blockquote>Anthology uses Cloudflare's global cache to drastically improve the performance of content for our end users at schools and universities. By pushing a single button to enable Cache Reserve, we were able to provide a great experience for teachers and students and reduce two-thirds of our daily egress traffic.<br><strong>Paul Pearcy</strong>, Senior Staff Engineer at <a href="https://www.anthology.com/blackboard">Anthology</a></blockquote>
	<blockquote>At Enjoei weâ€™re always looking for ways to help make our end-user sites faster and more efficient. By using Cloudflare Cache Reserve, we were able to drastically improve our cache hit ratio by more than 10% which reduced our origin egress costs. Cache Reserve also improved the performance for many of our merchantsâ€™ sites in South America, which improved their SEO and discoverability across the Internet (Google, Criteo, Facebook, Tiktok)â€“ and it took no time to set it up.<br><strong>Elomar Correia</strong>, Head of DevOps SRE | Enterprise Solutions Architect at <a href="https://www.enjoei.com.br">Enjoei</a></blockquote>
	<blockquote>In the live events industry, the size and demand for our cacheable content can be extremely volatile, which causes unpredictable swings in our egress fees. Additionally, keeping data as close to our users as possible is critical for customer experience in the high traffic and low bandwidth scenarios our products are used in, such as conventions and music festivals. Cache Reserve helps us mitigate both of these problems with minimal impact on our engineering teams, giving us more predictable costs and lower latency than existing solutions.<br><strong>Jarrett Hawrylak</strong>, VP of Engineering | Enterprise Ticketing at <a href="https://www.patrontechnology.com">Patron Technology</a></blockquote>
	<h2 id="how-can-i-use-it-today">How can I use it today?</h2>
	<p>As of today, Cache Reserve is in open beta, meaning that itâ€™s available to anyone who wants to use it.</p>
	<p>To use the Cache Reserve:</p>
	<ul>
		<li>Simply go to the Caching tile in the dashboard.</li>
		<li>Navigate to the<a href="https://dash.cloudflare.com/caching/cache-reserve"> Cache Reserve page</a> and push the enable data sync button (or purchase button).</li>
	</ul>
	<p>Enterprise Customers can work with their Cloudflare Account team to access Cache Reserve.</p>
	<p>Customers can ensure Cache Reserve is working by looking at the baseline metrics regarding how much data is cached and how many operations weâ€™ve seen in the Cache Reserve section of the dashboard. Specific requests served by Cache Reserve are available by using <a href="https://developers.cloudflare.com/logs/reference/log-fields/zone/http_requests">Logpush v2</a> and finding HTTP requests with the field â€œCacheReserveUsed.â€</p>
	<p>We will continue to make sure that we are quickly triaging the feedback you give us and making improvements to help ensure Cache Reserve is easy to use, massively beneficial, and your choice for reducing egress fees for cached content.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/11/Screen-Shot-2022-11-10-at-12.00.31-PM.png" class="kg-image" alt="" loading="lazy"></figure>
	<h2 id="try-it-out">Try it out</h2>
	<p>Weâ€™ve been so excited to get Cache Reserve in more peopleâ€™s hands. There will be more exciting developments to Cache Reserve as we continue to invest in giving you all the tools you need to build your perfect cache. </p>
	<p>Try Cache Reserve today and <a href="https://discord.com/invite/aTsevRH3pG">let us know</a> what you think.</p>
</div>