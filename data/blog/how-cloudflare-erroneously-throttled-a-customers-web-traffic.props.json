{
	"locale": "en-us",
	"post": {
		"id": "63e28aefea5b01000ae29064",
		"uuid": "a7e7f590-ee95-4656-91d4-5dff6609771d",
		"title": "How Cloudflare erroneously throttled a customer’s web traffic",
		"slug": "how-cloudflare-erroneously-throttled-a-customers-web-traffic",
		"html": "<!--kg-card-begin: markdown--><p><small>This post is also available in <a href=\"http://blog.cloudflare.com/zh-cn/how-cloudflare-erroneously-throttled-a-customers-web-traffic-zh-cn/\">简体中文</a>, <a href=\"http://blog.cloudflare.com/zh-tw/how-cloudflare-erroneously-throttled-a-customers-web-traffic-zh-tw/\">繁體中文</a>.</small></p>\n<!--kg-card-end: markdown--><figure class=\"kg-card kg-image-card\"><img src=\"http://blog.cloudflare.com/content/images/2023/02/BLOG-1707-header-1.png\" class=\"kg-image\" alt=\"How Cloudflare erroneously throttled a customer’s web traffic\" loading=\"lazy\"></figure><p>Over the years when Cloudflare has had an <a href=\"http://blog.cloudflare.com/tag/outage/\">outage</a> that affected our customers we have very quickly blogged about what happened, why, and what we are doing to address the causes of the outage. Today’s post is a little different. It’s about a single customer’s website <a href=\"https://news.ycombinator.com/item?id=34639212\">not working correctly</a> because of incorrect action taken by Cloudflare.</p><p>Although the customer was not in any way banned from Cloudflare, or lost access to their account, their website didn’t work. And it didn’t work because Cloudflare applied a bandwidth throttle between us and their origin server. The effect was that the website was unusable.</p><p>Because of this unusual throttle there was some internal confusion for our customer support team about what had happened. They, incorrectly, believed that the customer had been limited because of a breach of section 2.8 of our <a href=\"https://www.cloudflare.com/terms/\">Self-Serve Subscription Agreement</a> which prohibits use of our self-service CDN to serve excessive non-HTML content, such as images and video, without a paid plan that includes those services (this is, for example, designed to prevent someone building an image-hosting service on Cloudflare and consuming a huge amount of bandwidth; for that sort of use case we have paid <a href=\"https://www.cloudflare.com/products/cloudflare-images/\">image</a> and <a href=\"https://www.cloudflare.com/products/cloudflare-stream/\">video</a> plans).</p><p>However, this customer wasn’t breaking section 2.8, and they were both a paying customer and a paying customer of Cloudflare Workers through which the throttled traffic was passing. This throttle should not have happened. In addition, there is and was no need for the customer to upgrade to some other plan level.</p><p>This incident has set off a number of workstreams inside Cloudflare to ensure better communication between teams, prevent such an incident happening, and to ensure that communications between Cloudflare and our customers are much clearer.</p><p>Before we explain our own mistake and how it came to be, we’d like to apologize to the customer. We realize the serious impact this had, and how we fell short of expectations. In this blog post, we want to explain what happened, and more importantly what we’re going to change to make sure it does not happen again.</p><h3 id=\"background\">Background</h3><p>On February 2, an on-call network engineer received an alert for a congesting interface with Equinix IX in our Ashburn data center. While this is not an unusual alert, this one stood out for two reasons. First, it was the second day in a row that it happened, and second, the congestion was due to a sudden and extreme spike of traffic.</p><figure class=\"kg-card kg-image-card kg-width-wide\"><img src=\"http://blog.cloudflare.com/content/images/2023/02/image2-1.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>The engineer in charge identified the customer’s domain, tardis.dev, as being responsible for this sudden spike of traffic between Cloudflare and their origin network, a storage provider. Because this congestion happens on a physical interface connected to external peers, there was an immediate impact to many of our customers and peers. A port congestion like this one typically incurs packet loss, slow throughput and higher than usual latency. While we have automatic mitigation in place for congesting interfaces, in this case the mitigation was unable to resolve the impact completely.</p><p>The traffic from this customer went suddenly from an average of 1,500 requests per second, and a 0.5 MB payload per request, to 3,000 requests per second (2x) and more than 12 MB payload per request (25x).</p><figure class=\"kg-card kg-image-card kg-width-wide\"><img src=\"http://blog.cloudflare.com/content/images/2023/02/image1-4.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>The congestion happened between Cloudflare and the origin network. Caching did not happen because the requests were all unique URLs going to the origin, and therefore we had no ability to serve from cache.</p><p><strong>A Cloudflare engineer decided to apply a throttling mechanism to prevent the zone from pulling so much traffic from their origin. Let's be very clear on this action: Cloudflare does not have an established process to throttle customers that consume large amounts of bandwidth, and does not intend to have one. This remediation was a mistake, it was not sanctioned, and we deeply regret it.</strong></p><p>We lifted the throttle through internal escalation 12 hours and 53 minutes after having set it up.</p><h3 id=\"what-s-next\">What's next</h3><p>To make sure a similar incident does not happen, we are establishing clear rules to mitigate issues like this one. Any action taken against a customer domain, paying or not, will require multiple levels of approval and clear communication to the customer. Our tooling will be improved to reflect this. We have many ways of traffic shaping in situations where a huge spike of traffic affects a link and could have applied a different mitigation in this instance.</p><p>We are in the process of rewriting our terms of service to better reflect the type of services that our customers deliver on our platform today. We are also committed to explaining to our users in plain language what is permitted under self-service plans. As a developer-first company with transparency as one of its core principles, we know we can do better here. We will follow up with a blog post dedicated to these changes later.</p><p>Once again, we apologize to the customer for this action and for the confusion it created for other Cloudflare customers.</p>",
		"comment_id": "63e28aefea5b01000ae29064",
		"feature_image": "http://blog.cloudflare.com/content/images/2023/02/BLOG-1707-header.png",
		"featured": false,
		"visibility": "public",
		"created_at": "2023-02-07T17:31:27.000+00:00",
		"updated_at": "2023-03-28T09:19:14.000+01:00",
		"published_at": "2023-02-07T18:20:49.000+00:00",
		"custom_excerpt": "Today’s post is a little different. It’s about a single customer’s website not working correctly because of incorrect action taken by Cloudflare.",
		"codeinjection_head": null,
		"codeinjection_foot": null,
		"custom_template": null,
		"canonical_url": null,
		"authors": [
			{
				"id": "61efe3296bbdce000ac8bb0c",
				"name": "Jeremy Hartman",
				"slug": "jeremy-hartman",
				"profile_image": "http://blog.cloudflare.com/content/images/2022/01/IMG_0285.jpeg",
				"cover_image": null,
				"bio": null,
				"website": null,
				"location": null,
				"facebook": null,
				"twitter": null,
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/jeremy-hartman/"
			},
			{
				"id": "5d1644b141acde0011a94f3c",
				"name": "Jérôme Fleury",
				"slug": "jerome-fleury",
				"profile_image": "http://blog.cloudflare.com/content/images/2017/03/1c11387.jpg",
				"cover_image": null,
				"bio": null,
				"website": null,
				"location": null,
				"facebook": null,
				"twitter": "@Jerome_UZ",
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/jerome-fleury/"
			}
		],
		"tags": [
			{
				"id": "63e4e0d6ea5b01000ae292e1",
				"name": "#BLOG-1707",
				"slug": "hash-blog-1707",
				"description": null,
				"feature_image": null,
				"visibility": "internal",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/404/"
			},
			{
				"id": "5d16450341acde0011a9516a",
				"name": "Customers",
				"slug": "customers",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/customers/"
			},
			{
				"id": "63e4e0f0ea5b01000ae292e5",
				"name": "Transparency",
				"slug": "transparency",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/transparency/"
			}
		],
		"primary_author": {
			"id": "61efe3296bbdce000ac8bb0c",
			"name": "Jeremy Hartman",
			"slug": "jeremy-hartman",
			"profile_image": "http://blog.cloudflare.com/content/images/2022/01/IMG_0285.jpeg",
			"cover_image": null,
			"bio": null,
			"website": null,
			"location": null,
			"facebook": null,
			"twitter": null,
			"meta_title": null,
			"meta_description": null,
			"url": "http://blog.cloudflare.com/author/jeremy-hartman/"
		},
		"primary_tag": null,
		"url": "http://blog.cloudflare.com/how-cloudflare-erroneously-throttled-a-customers-web-traffic/",
		"excerpt": "Today’s post is a little different. It’s about a single customer’s website not working correctly because of incorrect action taken by Cloudflare.",
		"reading_time": 4,
		"access": true,
		"comments": false,
		"og_image": "http://blog.cloudflare.com/content/images/2023/02/How-Cloudflare-erroneously-throttled-a-customer-s-web-traffic-OG-1.png",
		"og_title": null,
		"og_description": null,
		"twitter_image": "http://blog.cloudflare.com/content/images/2023/02/How-Cloudflare-erroneously-throttled-a-customer-s-web-traffic-OG.png",
		"twitter_title": null,
		"twitter_description": null,
		"meta_title": null,
		"meta_description": "Today’s post is a little different. It’s about a single customer’s website not working correctly because of incorrect action taken by Cloudflare.",
		"email_subject": null,
		"frontmatter": null,
		"feature_image_alt": null,
		"feature_image_caption": null
	}
}