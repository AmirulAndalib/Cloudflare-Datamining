{
	"post": {
		"id": "64c3f11f0bf98b000ab4f8d6",
		"uuid": "c935de2d-101e-412e-9102-6e8fb008d860",
		"title": "Cloudflare Workers database integration with Upstash",
		"slug": "cloudflare-workers-database-integration-with-upstash",
		"html": "<figure class=\"kg-card kg-image-card\"><img src=\"http://blog.cloudflare.com/content/images/2023/07/1.png\" class=\"kg-image\" alt=\"Cloudflare Workers database integration with Upstash\" loading=\"lazy\" width=\"1600\" height=\"898\"></figure><p>During <a href=\"https://www.cloudflare.com/developer-week/\">Developer Week</a> we announced <a href=\"http://blog.cloudflare.com/announcing-database-integrations/\">Database Integrations on Workers</a> ¬†a new and seamless way to connect with some of the most popular databases. You select the provider, authorize through an OAuth2 flow and automatically get the right configuration stored as encrypted environment variables to your Worker.</p><p>Today we are thrilled to announce that we have been working with Upstash to expand our integrations catalog. We are now offering three new integrations: Upstash Redis, Upstash Kafka and Upstash QStash. These integrations allow our customers to unlock new capabilities on Workers. Providing them with a broader range of options to meet their specific requirements.</p><h3 id=\"add-the-integration\">Add the integration</h3><p>We are going to show the setup process using the Upstash Redis integration.</p><p>Select your Worker, go to the Settings tab, select the Integrations tab to see all the available integrations.</p><figure class=\"kg-card kg-image-card\"><img src=\"http://blog.cloudflare.com/content/images/2023/07/2.png\" class=\"kg-image\" alt=\"Workers Integration tab showing all Integrations\" loading=\"lazy\" width=\"1600\" height=\"969\"></figure><p>After selecting the Upstash Redis integration we will get the following page.</p><figure class=\"kg-card kg-image-card\"><img src=\"http://blog.cloudflare.com/content/images/2023/07/3.png\" class=\"kg-image\" alt=\"Upstash Integration flow showing all steps to complete this Integration\" loading=\"lazy\" width=\"1484\" height=\"1600\"></figure><p>First, you need to review and grant permissions, so the Integration can add secrets to your Worker. Second, we need to connect to Upstash using the OAuth2 flow. Third, select the Redis database we want to use. Then, the Integration will fetch the right information to generate the credentials. Finally, click ‚ÄúAdd Integration‚Äù and it's done! We can now use the credentials as environment variables on our Worker.</p><h3 id=\"implementation-example\">Implementation example</h3><p>On this occasion we are going to use the <a href=\"https://developers.cloudflare.com/fundamentals/get-started/reference/http-request-headers/#cf-ipcountry\">CF-IPCountry</a> ¬†header to conditionally return a custom greeting message to visitors from Paraguay, United States, Great Britain and Netherlands. While returning a generic message to visitors from other countries.</p><p>To begin we are going to load the custom greeting messages using Upstash‚Äôs online CLI tool.</p><pre><code class=\"language-bash\">‚ûú set PY \"Mba'·∫Ωichapa üáµüáæ\"\nOK\n‚ûú set US \"How are you? üá∫üá∏\"\nOK\n‚ûú set GB \"How do you do? üá¨üáß\"\nOK\n‚ûú set NL \"Hoe gaat het met u? üá≥üá±\"\nOK</code></pre><p>We also need to install <code>@upstash/redis</code> package on our Worker before we upload the following code. </p><pre><code class=\"language-javascript\">import { Redis } from '@upstash/redis/cloudflare'\n \nexport default {\n  async fetch(request, env, ctx) {\n    const country = request.headers.get(\"cf-ipcountry\");\n    const redis = Redis.fromEnv(env);\n    if (country) {\n      const localizedMessage = await redis.get(country);\n      if (localizedMessage) {\n        return new Response(localizedMessage);\n      }\n    }\n    return new Response(\"üëãüëã Hello there! üëãüëã\");\n  },\n};\n</code></pre><p>Just like that we are returning a localized message from the Redis instance depending on the country which the request originated from. Furthermore, we have a couple ways to improve performance, for write heavy use cases we can use <a href=\"http://blog.cloudflare.com/announcing-workers-smart-placement/\">Smart Placement</a> with no replicas, so the Worker code will be executed near the Redis instance provided by Upstash. Otherwise, creating a <a href=\"https://docs.upstash.com/redis/features/globaldatabase\">Global Database</a> on Upstash to have multiple read replicas across regions will help.</p><h3 id=\"try-it-now\"><a href=\"https://developers.cloudflare.com/workers/databases/native-integrations/upstash/\">Try it now</a></h3><p>Upstash Redis, Kafka and QStash are now available for all users! Stay tuned for more updates as we continue to expand our Database Integrations catalog.</p>",
		"comment_id": "64c3f11f0bf98b000ab4f8d6",
		"feature_image": "http://blog.cloudflare.com/content/images/2023/07/1-1.png",
		"featured": false,
		"visibility": "public",
		"created_at": "2023-07-28T17:47:27.000+01:00",
		"updated_at": "2024-02-15T23:30:28.000+00:00",
		"published_at": "2023-08-02T14:00:22.000+01:00",
		"custom_excerpt": "Announcing the new Upstash database integrations for Workers. Now it is easier to use Upstash Redis, Kafka and QStash inside your Worker ",
		"codeinjection_head": null,
		"codeinjection_foot": null,
		"custom_template": null,
		"canonical_url": null,
		"authors": [
			{
				"id": "64c3f4c80bf98b000ab4f947",
				"name": "Joaquin Gimenez",
				"slug": "joaquingimenez1",
				"profile_image": "http://blog.cloudflare.com/content/images/2023/07/IMG_6036-2.jpg",
				"cover_image": null,
				"bio": null,
				"website": "https://joaquingimenez.com/",
				"location": "Texas, US",
				"facebook": null,
				"twitter": "@joaquingimenez1",
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/joaquingimenez1/"
			},
			{
				"id": "645e9c424ca802000af83060",
				"name": "Shaun Persad",
				"slug": "shaun",
				"profile_image": "http://blog.cloudflare.com/content/images/2023/05/Screen-Shot-2022-04-04-at-2.12.35-PM.png",
				"cover_image": null,
				"bio": null,
				"website": null,
				"location": null,
				"facebook": null,
				"twitter": null,
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/shaun/"
			}
		],
		"tags": [
			{
				"id": "64c3f3e70bf98b000ab4f930",
				"name": "#BLOG-1984",
				"slug": "hash-blog-1984",
				"description": null,
				"feature_image": null,
				"visibility": "internal",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/404/"
			},
			{
				"id": "5d16450341acde0011a95253",
				"name": "Cloudflare Workers",
				"slug": "workers",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/workers/"
			},
			{
				"id": "5d16450341acde0011a95204",
				"name": "Developers",
				"slug": "developers",
				"description": null,
				"feature_image": "http://blog.cloudflare.com/content/images/2020/10/Developers-1.png",
				"visibility": "public",
				"meta_title": "Cloudflare Blog: Developers",
				"meta_description": "Collection of Cloudflare blog posts tagged 'Developers'.",
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/developers/"
			},
			{
				"id": "5d16450341acde0011a95242",
				"name": "Kafka",
				"slug": "kafka",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/kafka/"
			},
			{
				"id": "6332ccf5f9a3dd000ae691bd",
				"name": "Database",
				"slug": "database",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/database/"
			},
			{
				"id": "5e85af03c3ae9c01bc5711e7",
				"name": "Internship Experience",
				"slug": "internship-experience",
				"description": null,
				"feature_image": "http://blog.cloudflare.com/content/images/2022/08/image1-2-1.png",
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/internship-experience/"
			},
			{
				"id": "64a3e2b834124c000b00b717",
				"name": "Developer Platform",
				"slug": "developer-platform",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/developer-platform/"
			}
		],
		"primary_author": {
			"id": "64c3f4c80bf98b000ab4f947",
			"name": "Joaquin Gimenez",
			"slug": "joaquingimenez1",
			"profile_image": "http://blog.cloudflare.com/content/images/2023/07/IMG_6036-2.jpg",
			"cover_image": null,
			"bio": null,
			"website": "https://joaquingimenez.com/",
			"location": "Texas, US",
			"facebook": null,
			"twitter": "@joaquingimenez1",
			"meta_title": null,
			"meta_description": null,
			"url": "http://blog.cloudflare.com/author/joaquingimenez1/"
		},
		"primary_tag": null,
		"url": "http://blog.cloudflare.com/cloudflare-workers-database-integration-with-upstash/",
		"excerpt": "Announcing the new Upstash database integrations for Workers. Now it is easier to use Upstash Redis, Kafka and QStash inside your Worker ",
		"reading_time": 2,
		"access": true,
		"comments": false,
		"og_image": null,
		"og_title": null,
		"og_description": null,
		"twitter_image": null,
		"twitter_title": null,
		"twitter_description": null,
		"meta_title": null,
		"meta_description": null,
		"email_subject": null,
		"frontmatter": null,
		"feature_image_alt": "Cloudflare Workers database integration with Upstash",
		"feature_image_caption": null
	},
	"locale": "en-us"
}