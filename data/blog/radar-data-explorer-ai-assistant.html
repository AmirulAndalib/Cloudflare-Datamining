<div class="mb2 gray5">10 min read</div><img class="mr2" src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/BFOT0I7ZKBwIVWNYAH3YX/663093e20bc23f70ace350ce90416e18/image9.png" alt="">
<div class="post-content lh-copy gray1">
	<p><b></b><a href="https://radar.cloudflare.com"><u>Cloudflare Radar</u></a> showcases global Internet traffic patterns, attack activity, and technology trends and insights. It is powered by data from Cloudflare's global network, as well as aggregated and anonymized data from Cloudflare's <a href="https://1.1.1.1/dns"><u>1.1.1.1 public DNS Resolver</u></a>, and is built on top of a rich, publicly accessible <a href="https://developers.cloudflare.com/radar"><u>API</u></a>. This API allows users to explore Radar data beyond the default set of visualizations, for example filtering by protocol, comparing metrics across multiple locations or autonomous systems, or examining trends over two different periods of time. However, not every user has the technical know-how to make a raw API query or process the JSON-formatted response.</p>
	<p>Today, we are launching the <a href="https://radar.cloudflare.com/explorer"><u>Cloudflare Radar Data Explorer</u></a>, which provides a simple Web-based interface to enable users to easily build more complex API queries, including comparisons and filters, and visualize the results. And as a complement to the Data Explorer, we are also launching an AI Assistant, which uses <a href="https://developers.cloudflare.com/workers-ai"><u>Cloudflare Workers AI</u></a> to translate a user’s natural language statements or questions into the appropriate Radar API calls, the results of which are visualized in the Data Explorer. Below, we introduce the AI Assistant and Data Explorer, and also dig into how we used Cloudflare Developer Platform tools to build the AI Assistant.</p>
	<h2>Ask the AI Assistant</h2>
	<p>Sometimes, a user may know what they are looking for, but aren’t quite sure how to build the relevant API query by selecting from the available options and filters. (The sheer number may appear overwhelming.) In those cases, they can simply pose a question to the AI Assistant, like “Has there been an uptick in malicious email over the last week?” The AI Assistant makes a series of Workers AI and Radar API calls to retrieve the relevant data, which is visualized within seconds:</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/3HRBy5Bm5aNQ1gUj1MBCj5/0e132eac34a3591432b76f3f0dc09a16/image8.png" alt="" class="kg-image" width="1999" height="1170" loading="lazy">
	</figure>
	<p>The AI Assistant pane is found on the right side of the page in desktop browsers, and appears when the user taps the “AI Assistant” button on a mobile browser. To use the AI Assistant, users just need to type their question into the “Ask me something” area at the bottom of the pane and submit it. A few sample queries are also displayed by default to provide examples of how and what to ask, and clicking on one submits it.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/79srygHorwU84nyQg9KLSl/8c0f62a9553e882afdbbd32aa34dd802/Screenshot_2024-09-26_at_20.32.43.png" alt="" class="kg-image" width="2066" height="1278" loading="lazy">
	</figure>
	<p>The submitted question is evaluated by the AI Assistant (more <a href="https://blog.cloudflare.com/#AIAssistant"><u>below</u></a> on how that happens), and the resulting visualization is displayed in the <b>Results</b> section of the Data Explorer. In addition to the visualization of the results, the appropriate <b>Data</b>, <b>Filter</b>, and <b>Compare</b> options are selected in the <b>Query</b> section above the visualization, allowing the user to further tune or refine the results if necessary. The <i>Keep current filters</i> toggle within the AI Assistant pane allows users to build on the previous question. For example, with that toggle active, a user could ask “Traffic in the United States”, see the resultant graph, and then ask “Compare it with traffic in Mexico” to add Mexico’s data to the graph.</p>
	<h2>Building a query directly</h2>
	<p>For users that prefer a more hands-on approach, a wide variety of Radar datasets are available to explore, including traffic metrics, attacks, Internet quality, email security, and more. Once the user selects a dataset, the <i>Breakdown By:</i> dropdown is automatically populated with relevant options (if any), and <b>Filter</b> options are also dynamically populated. As the user selects additional options, the visualization in the <b>Result</b> section is automatically updated.</p>
	<p>In addition to building the query of interest, Data Explorer also enables the user to compare the results, both against a specific date range and/or another location or <a href="https://www.cloudflare.com/en-gb/learning/network-layer/what-is-an-autonomous-system"><u>autonomous system (AS)</u></a>. To compare results with the immediately previous period (the last seven days with the seven days before that, for instance), just toggle on the <i>Previous period</i> switch. Otherwise, clicking on the <i>Date Range</i> field brings up a calendar that enables the user to select a starting date — the corresponding date range is intelligently selected, based on the date range selected in the <b>Filter</b> section. To compare results across locations or ASNs, clicking on the “Location or ASN” field brings up a search box in which the user can enter a location (country/region) name, AS name, or AS number, with search results updating as the user types. Note that locations can be compared with other locations or ASes, and ASes can be compared with other ASes or locations. This enables a user, for example, to compare trends for their ISP with trends for their country.</p>
	<figure class="kg-card kg-image-card kg-width-wide">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/1R9F5Cxe8gkJCUHzLitNH3/2b2bd6cb7d8d29365dd3442dafeb1d89/image7.png" alt="" class="kg-image" width="1598" height="447" loading="lazy">

	</figure>
	<h2>Visualizing the results</h2>
	<p>Much of the value of Cloudflare Radar comes from its visualizations – the graphs, maps, and tables that illustrate the underlying data, and Data Explorer does not disappoint here. Depending on the dataset and filters selected, and the volume of data returned, results may be visualized in a time series graph, bar chart, <a href="https://en.wikipedia.org/wiki/Treemapping"><u>treemap</u></a>, or global <a href="https://en.wikipedia.org/wiki/Choropleth_map"><u>choropleth map</u></a>. The visualization type is determined automatically based on the contents of the API response. For example, the presence of countryalpha2 keys in the response means a choropleth map will be used, the presence of timestamps in the response means a line graph (“xychart”) should be shown, and more than 40 items in the response selects a treemap as the visualization type.</p>
	<p>To illustrate the extended visualizations available in Data Explorer, the figure below is an expanded version of one that would normally be found on <a href="https://radar.cloudflare.com/adoption-and-usage/us#http-1-x-vs-http-2-vs-http-3"><u>Radar’s </u><b><u>Adoption &amp; Usage</u></b><u> page</u></a>. The “standard” version of the graph plots the shares of the HTTP versions over the last seven days for the United States, as well as the summary share values. In this <a href="https://radar.cloudflare.com/explorer?dataSet=http&amp;groupBy=http_version&amp;loc=US&amp;filters=botClass%253DLikely_Human%252CdeviceType%253DMobile&amp;dt=7d&amp;timeCompare=1&amp;compareWith=701"><u>extended version of the graph generated in the Data Explorer</u></a>, we compare data for the United States with HTTP version share data for <a href="https://radar.cloudflare.com/as701"><u>AS701 (Verizon)</u></a>, for both the past seven days and the previous seven-day period. In addition to the comparisons plotted on the time series graph, the associated summary values are also compared in an accompanying bar chart. This comprehensive visualization makes comparisons easy.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/1Euh3n9A79zjXN05GQsTu0/eb4cfc4860d8709b9d8a6140b4d01a72/image2.png" alt="" class="kg-image" width="1559" height="908" loading="lazy">
	</figure>
	<p>For some combinations of datasets/filters/comparisons, time series graphs can get quite busy, with a significant number of lines being plotted. To isolate just a single line on the graph, double-click on the item in the legend. To add/remove additional lines back to/from the graph, single-click on the relevant legend item.</p>
	<p>Similar to other visualizations on Radar, the resulting graphs or maps can be downloaded, copied, or embedded into another website or application. Simply click on the “Share” button above the visualization card to bring up the <b>Share</b> modal dialog. We hope to see these graphs shared in articles, blog posts, and presentations, and to see embedded visualizations with real-time data in your portals and operations centers!</p>
	<h2>Still want to use the API? No problem.</h2>
	<p>Although Data Explorer was designed to simplify the process of building, and viewing the results of, more complex API queries, we recognize that some users may still want to retrieve data directly from the API. To enable that, Data Explorer’s <b>API</b> section provides copyable API calls as a direct request URL and a <a href="https://curl.se"><u>cURL</u></a> command. The raw data returned by the query is also available to copy or download as a JSON blob, for those users that want to save it locally, or paste it into another application for additional manipulation or analysis.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/1W3Zqrpfdtb0BgTnyV0bhu/ef38187b2c5107d1f5dce2c2d60c5ad5/image6.png" alt="" class="kg-image" width="1999" height="1291" loading="lazy">
	</figure>
	<h2 id="AIAssistant">How we built the AI Assistant</h2>
	<p>Knowing all that AI is capable of these days, we thought that creating a system for an <a href="https://www.cloudflare.com/en-gb/learning/ai/what-is-large-language-model"><u>LLM</u></a> to answer questions didn’t seem like an overly complex task. While there were some challenges, Cloudflare’s developer platform tools thankfully made it fairly straightforward.&nbsp;</p>
	<h3>LLM-assisted API querying</h3>
	<p>The main challenge we encountered in building the API Assistant was the large number of combinations of datasets and parameters that can potentially be visualized in the Data Explorer. There are around 100 <a href="https://developers.cloudflare.com/radar"><u>API endpoints</u></a> from which the data can be fetched, with most able to take multiple parameters.</p>
	<p>There were a few potential approaches to getting started. One was to take a previously trained LLM and further train it with the API endpoint descriptions in order to have it return the output in the required structured format which would then be used to execute the API query. However, for the first version, we decided against this approach of <a href="https://developers.cloudflare.com/workers-ai/fine-tunes"><u>fine-tuning</u></a>, as we wanted to quickly test a few different models supported by <a href="https://developers.cloudflare.com/workers-ai"><u>Workers AI</u></a>, and we wanted the flexibility to easily add or remove parameter combinations, as Data Explorer development was still under way. As such, we decided to start with prompt engineering, where all the endpoint-specific information is placed in the instructions sent to the LLM.</p>
	<p>Putting the full detailed description of the API endpoints supported by the Data Explorer into the system prompt would be possible for an LLM with a larger context window (the number of tokens the model takes as input before generating output). Newer models are getting better with the <a href="https://github.com/gkamradt/LLMTest_NeedleInAHaystack"><u>needle in a haystack problem</u></a>, which refers to the issue whereby LLMs do not retrieve information (the needle) equally well if it is placed in different positions within the long textual input (the haystack). However, <a href="https://cs.stanford.edu/~nfliu/papers/lost-in-the-middle.arxiv2023.pdf"><u>it has been empirically shown</u></a> that the position of information within the large context still matters. Additionally, many of the Radar API endpoints have quite similar descriptions, and putting all the descriptions in a single instruction could be more confusing for the model, and the processing time also increases with larger contexts. Based on this, we adopted the approach of having multiple inference calls to an LLM.</p>
	<p>First, when the user enters a question, a <a href="https://workers.cloudflare.com"><u>Worker</u></a> sends this question and a short general description of the available datasets to the LLM, asking it to determine the topic of the question. Then, based on the topic returned by the model, a system prompt is generated with the endpoint descriptions, including only those related to the topic. This prompt, along with the original question, is sent to the LLM asking it to select the appropriate endpoint and its specific parameters. At the same time, two parallel inference calls to the model are also made, one with the question and the system prompt related to the description of location parameters, and another with the description of time range parameters. Then, all three model outputs are put together and validated.</p>
	<p>If the final output is a valid dataset and parameter combination, it is sent back to the Data Explorer, which executes the API query and displays the resulting visualization for the user. Different LLMs were tested for this task, and at the end, <a href="https://developers.cloudflare.com/workers-ai/models/openhermes-2.5-mistral-7b-awq"><u>openhermes-2.5-mistral-7b</u></a>, trained on code datasets, was selected as the best option. To give the model more context, not only is the user’s current question sent to the model, but the previous one and its response are as well, in case the next question asked by the user is related to the previous one. In addition, calls to the model are sent through Cloudflare’s <a href="https://developers.cloudflare.com/ai-gateway"><u>AI Gateway</u></a>, to allow for caching, rate limiting, and logging.</p>
	<p>After the user is shown the result, they can indicate whether what was shown to them was useful or not by clicking the “thumbs up” or “thumbs down” icons in the response. This rating information is saved with the original question in <a href="https://developers.cloudflare.com/d1"><u>D1</u></a>, our serverless SQL database, so the results can be analyzed and applied to future AI Assistant improvements.</p>
	<p>The full end-to-end data flow for the Cloudflare Radar AI Assistant is illustrated in the diagram below.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/1EMv28isng00dvxUwmVKWE/89ab01ab15ad9dd2ae09c850223ffb4a/image1.png" alt="" class="kg-image" width="1405" height="1081" loading="lazy">
	</figure>
	<h3>When the LLM doesn’t know the answer</h3>
	<p>In some cases, however, the LLM may not “know” the answer to the question posed by the user. If the model does not generate a valid final response, then the user is shown three alternative questions. The intent here is to guide the user into asking an answerable question — that is, a question that is answerable with data from Radar.</p>
	<p>This is achieved using a previously compiled (static) list of various questions related to different Radar datasets. For each of these questions, their <a href="https://www.cloudflare.com/en-gb/learning/ai/what-are-embeddings"><u>embedding</u></a> is calculated using an <a href="https://developers.cloudflare.com/workers-ai/models/bge-small-en-v1.5"><u>embeddings model</u></a>, and stored in our <a href="https://developers.cloudflare.com/vectorize"><u>Vectorize</u></a> <a href="https://www.cloudflare.com/en-gb/learning/ai/what-is-vector-database"><u>vector database</u></a>. “Embeddings” are&nbsp; numerical representations of textual data (vectors) capturing their semantic meaning and relationships, with similar text having vectors that are closer. When a user’s question does not generate a valid model response, the embedding of that question is calculated, and its vector is compared against all the stored vectors from the vector database, and the three most similar ones are selected. These three questions, determined to be similar to the user's original question, are then shown to the user.</p>
	<p>There are also cases when the LLM gives answers which do not correspond to what the user asked, as hallucinations <a href="https://arxiv.org/pdf/2401.11817"><u>are currently inevitable</u></a> in LLMs, or when time durations are calculated inaccurately, as LLMs sometimes struggle with mathematical calculations. To help guard against this, AI Assistant responses are first validated against the API schema to confirm that the dataset and the parameter combination is valid. Additionally, Data Explorer dropdown options are automatically populated based on the AI Assistant’s response, and the chart titles are also automatically generated, so the user always knows exactly what data is shown in the visualization, even if it might not answer their actual question.&nbsp;</p>
	<h2>Looking ahead</h2>
	<p>We’re excited to enable more granular access to the rich datasets that currently power Cloudflare Radar. As we add new datasets in the future, such as DNS metrics, these will be available through Data Explorer and AI Assistant as well.</p>
	<p>As noted above, Radar offers a predefined set of visualizations, and these serve as an excellent starting point for further exploration. We are adding links from each Radar visualization into Data Explorer, enabling users to further analyze the associated data to answer more specific questions. Clicking the “pie chart” icon next to a graph’s description brings up a Data Explorer page with the relevant metrics, options, and filters selected.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/3O1sG7QnjASEX81lu6ooBy/091ca695a9e89458c1725ea5f09207f7/image5.png" alt="" class="kg-image" width="908" height="118" loading="lazy">
	</figure>
	<p>Correlating observations across two different metrics is another capability that we are also working on adding to Data Explorer. For example, if you are investigating an Internet disruption, you will be able to plot traffic trends and announced IP address space for a given country or autonomous system on the same graph to determine if both dropped concurrently.</p>
	<p>But for now, use the Data Explorer and AI Assistant to go beyond what Cloudflare Radar offers, finding answers to your questions about what’s happening on the Internet.&nbsp; If you share Data Explorer visualizations on social media, be sure to tag us: <a href="https://x.com/CloudflareRadar"><u>@CloudflareRadar</u></a> (X), <a href="https://noc.social/@cloudflareradar"><u>noc.social/@cloudflareradar</u></a> (Mastodon), and <a href="https://bsky.app/profile/radar.cloudflare.com"><u>radar.cloudflare.com</u></a> (Bluesky). You can also reach out on social media, or contact us via email, with suggestions for future Data Explorer and AI Assistant functionality.</p>
	<figure class="kg-card kg-image-card">
		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/6LCKQEfkvBhOQFugqOGhy2/e29a0e91aab2c29fd55fa26cd7ef864f/image4.png" alt="" class="kg-image" width="1800" height="401" loading="lazy">
	</figure>
	<p></p>
</div>