<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/11/image3-31.png" class="kg-image" alt="An Open-Source CMS on the Cloudflare Stack: Introductory Post"></figure>
	<p><a href="https://developers.cloudflare.com/" target="_blank">Cloudflareのドキュメント</a>は、コンセプトを学習したり、APIの使用上の注意を確認したりする場合や、APIやコンセプトを説明するための簡潔なスニペットが必要な場合に役立つ資料です。しかし、その資料が網羅的であるとしても、Cloudflare Workersプラットフォームの新規ユーザーは、導入例に掲載されているスニペットと実際の本番環境に対応したアプリケーションの移行の間の、大きなギャップを埋める必要があります。この一部は（他のプラットフォームと同様に）Wokersに固有である可能性がありますが、<em>世界中</em>の開発者は、サーバーレスの世界でアプリケーションを構築する方法を考えています。大規模なサーバーレスアプリケーションの構築には、開発者の経験レベルに関係なく、学習曲線の行程が必要です。</p>
	<p>Cloudflareでも、同じ変遷をたどらなければならなかったため、そのことは十分に承知しています。当社には世界クラスのエンジニアが在籍しており、分散パラダイムを補完する製品を巧みに設計および製造をしています…しかし、専門家は一夜にして生まれるわけではありません。当社にはその経験があり、より速いスタートと理解の助けになれることを望んでいます。</p>
	<p>これを念頭に置いて、業界特有の何かを行うことにし、Cloudflareスタック上に完全に構築されるフィーチャーコンプリートSaaSアプリケーションの例を作成しています。これは完全に無料で、<a href="https://github.com/cloudflare/production-saas" target="_blank">GitHubでオープンソース化</a>され、公に開発されています。独自のSaaSアプリケーションを起動するためのテンプレートとしても使用できるので、これは素晴らしい時間になります。実際、GitHubリポジトリのクローンを作成し、いくつかのサービストークンを更新し、ビルド済みのアプリケーションを数分以内に独自のCloudflareアカウントにデプロイできます。</p>
	<p>もちろん、例とテンプレートは素晴らしいですが、テクノロジーとベストプラクティスは決して進化を止めません。 Cloudflareも例外ではなく、常に新しい製品や製品機能を繰り返し導入しています。さらに、これにはSaaSアプリケーションがWorkersプラットフォームとともに進化する<em>生きた手本</em>である必要があります — これは私たちの取り組みの一環です。</p>
	<p>||<strong>お見逃しなく！</strong><a href="https://github.com/cloudflare/production-saas" target="_blank">GitHubのプロジェクト</a>に注意して、開発の進捗状況を追跡し、最新の変更と推奨事項を常に把握してください。</p>
	<h2 id="-"><strong>アプリケーションの概要</strong></h2>
	<p>ここで、実際にアプリケーションを構築することとは別に、ケーススタディの役割として納得できる、十分な複雑さと十分なシンプルさ（あるいは自己完結型の）の両方を持ったSaaSアプリケーションの例をバランスよく選択する必要がありました。これにより開発者はすぐにソースを辿り、関連するコンポーネントと、それらが使用される理由および/または方法を理解することができます。</p>
	<p>最終的に、当社はアプリケーションの原型として長年にわたって変化してきたコンテンツ管理システム（CMS）のサンプルを作成することに決めました。従来、CMSはハードウェアを借りて運用し、長寿命のサーバーが受信するリクエストを処理し、SQLのようなデータベースを照会してリクエストされたコンテンツを取得し、HTMLページにレンダリングし、それを何度も繰り返してきました。<a href="https://wordpress.org/" target="_blank">WordPress</a>は、このアプローチの非常に一般的な例であり、現在も変わりありません。</p>
	<p>当然、このアプリケーションアーキテクチャは何年にもわたって改善されてきました。キャッシングのレイヤーが導入され、処理される行数を最小限に抑えるようにデータベーススキーマが再設計され、一部のフレームワークはデータベースを完全にスキップし始め、すべてのコンテンツを静的HTMLページとして事前にレンダリングするビルドステップを好むようになりました。（これは現在「静的サイトジネレーション」として知られており、今でも非常に人気のあるアプローチです。）</p>
	<p>サーバーレスの時代の現在では、多くの「ヘッドレスCMS」の選択肢が数多く用意されています。これらは、リクエストごとにHTMLをレンダリングするモノリシックWebサーバーではないため、「ヘッドレス」になっています。代わりに、コンテンツを生のJSONデータとして返すAPIエンドポイントを提供します。これにより、Web開発者は、好みのツールやフレームワークを使用して、Webサイト用の完全にカスタム化されたテンプレートを作成できます。このアプローチは、コンテンツや画像アセットなどを整理する機能を損なうことなく、開発者に非常に大きな柔軟性を与えます。経験豊かな老舗ともいえるWordPressは、ヘッドレスモード<em>と</em>「ヘッドフル」モードを提供できる数少ないものの1つです。<a href="https://www.sanity.io/" target="_blank">Sanity.io</a>と<a href="https://www.contentful.com/" target="_blank">Contentful</a>などの他のヘッドレスの選択肢も非常に人気があります。</p>
	<p>CMSアプリケーションモデルは、オープンソースの例の優れたケーススタディです。エッジファーストデザインの主要理念の1つは、コンテンツを要求するユーザーに物理的に可能な限り近い場所で提供することです。また、サーバーレスアーキテクチャは、もはや単一障害点が存在しない、あるいは存在すべきではないことを意味します。これらは両方ともCMSの原型に直接利益をもたらし、実装すると明確なパフォーマンスの向上が期待できます。</p>
	<h2 id="--1"><strong>現在の進捗</strong></h2>
	<p>ロードマップへと突入してこのプロジェクトがどのように進行するかを説明する前に、このプロジェクトは<em>すでに継続的な取り組みであり</em>、今後も継続していくことをお伝えすることが重要です。現在、<a href="https://github.com/cloudflare/production-saas" target="_blank">GitHubでプロジェクト</a>を検索して、完了済みの作業をお調べいただくことができます。今のところ、このアプリケーションは、Workers、Workers KV、Cloudflare for SaaSをすでに組み合わせており、PagesとDurable Objectsによるレート制限機能は、今後のマイルストーンで追加される予定です。</p>
	<p><strong>フェーズ1</strong>（以下を参照）は完了に近づいており、これが完了すると、非常に重要なマイルストーンの終わりを告げることになります。これまでのプロジェクトのハイライトと技術概要を網羅した本ブログ投稿シリーズの新しいアップデートが発行されます。<strong>フェーズ1</strong>は、<em>それ自体</em>でフルスタックアプリケーションを正常に動かすことができるため、重要であり、すぐに役立ちます。</p>
	<h2 id="--2"><strong>開発のマイルストーン</strong></h2>
	<p>CMSアプリケーションはマイルストーン形式で進行します。当社はすでにプロジェクトをリリースしており、ロードマップ（下記）に従ってプロジェクトを構築し続けます。<a href="https://github.com/cloudflare/production-saas" target="_blank">GitHubの熱心な読者</a>は、進捗状況を把握するか、少なくとも、フォローしたいマイルストーンの更新分のみを購読することができます。</p>
	<p>各マイルストーンは、それ自体がかなり大きなチェックポイントです。以下に示すように、プロジェクトのロードマップは、各フェーズでかなりの数の新機能が追加されたり、新しいCloudflare製品と統合されたりするように計画されています。すべてのポイントで、アプリケーションは機能を維持します。また、実演形式のインタラクティブデモを継続して、立ち寄っていただいた方に最新の機能をすぐに実演します。</p>
	<p>この形式が選択されたのは、実際のアプリケーション（および実際の製品）が開発される方法だからです。当社の目標は、GitHubリポジトリが<strong>決して</strong>時代遅れにならないようにすることです。また、開発構造により、過去のマイルストーンのリストを<em>常に</em>検討し、Xの移行に必要だった変更や、製品Yがどのように統合されたかを確認することができます。</p>
	<p>||<strong>注：</strong><a href="https://github.com/cloudflare/production-saas/milestones" target="_blank">GitHubマイルストーン</a>にアクセスして、詳細を表示し、更新をサブスクライブしてください。ここにリストされるより多くのものがあります。</p>
	<h3 id="-1-json-api"><strong>フェーズ1 – JSON API</strong></h3>
	<p>プロジェクトは、データの管理と操作を開始するために、いくつかのAPIエンドポイントから開始する必要があります。このマイルストーン内の作業では、WorkersとWorkers KVを使用して残りのアプリケーションが必要とするコア機能を処理する堅牢なJSON APIの構築に焦点を当てます。</p>
	<p>このフェーズには、HTML、CSS、またはクライアント側のJavaScriptは含まれていません。代わりに、ここでの作業は、データへのアクセス方法、モデルの相互関係、およびこれらの関係をWorkers KV内で構造化および保存するための最適な方法にのみ焦点を当てる必要があります。たとえば、個人は、個人のユーザーアカウントまたは所属する組織に属するワークスペースを作成および管理できる必要があります。</p>
	<p>さらに、コンテンツを作成するときは、ドキュメントが割り当てられた既存のスキーマに対してドキュメントを検証する必要があります。この機能は、ワークスペース内で数千のドキュメントを処理することを計画しているCMSプラットフォームで重要です。これがないと、コンテンツのJSON表現が一貫して構造化されているという確信はほぼ持てません。</p>
	<p>他にも多くの機能（<a href="https://stripe.com/" target="_blank">Stripe</a>を介したサブスクリプション管理と請求、<a href="https://sendgrid.com/" target="_blank">SendGrid</a>を介したトランザクションメールの送信、<a href="https://blog.cloudflare.com/cloudflare-for-saas-for-all-now-generally-available/">Cloudflare for SaaS</a>を介したワークスペースへのバニティードメインの割り当て）が計画されています。最後に、もちろん、標準的なハウスキーピングタスクが設定されます。これには、APIテストとの継続的統合（CI）および自動化された継続的展開（CD）が含まれます。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/11/image2-20.png" class="kg-image"></figure>
	<p>このフェーズの終了時には、プロジェクトは、それ自体が完全なアプリケーションであるAPIエンドポイントの集合として存在することになります。curlコマンド（またはHTTPリクエストを手動で作成するためのその他の推奨される方法）でのみアクセスできますが、<strong>フェーズ1</strong>を完了すると、プロジェクトはすでにフルスタックアプリケーションとして認定され、実際のSaaS製品にサービスを提供<em>することが可能になります</em>。</p>
	<p>さらに、リポジトリには、長期的な成長と保守のためにテストの作成、デプロイの自動化、およびソースの整理を行うためのすべてのベストプラクティスが含まれます。また、JSON APIから始めたため、プロジェクトは既存のビルドツールやフレームワークと統合できすぐに役立ちます。言い換えれば、<a href="https://github.com/cloudflare/production-saas" target="_blank">熱心な読者</a>であればプロジェクトをパーソナライズされたヘッドレスCMSとして自分のアカウントにデプロイできます。もしかしたら、GatsbyまたはEleventyプラグインを作成する人もいるかもしれませんが、その場合は、お知らせください。</p>
	<h3 id="-2-ui"><strong>フェーズ2 —ダッシュボードUI</strong></h3>
	<p>curlと同じくらい楽しいかもしれませんが、多くのユーザーは、何らかの形で対話できる視覚的なインターフェイスを好みます。このフェーズでは、CMSアプリケーションのダッシュボードとして機能するフロントエンドを組み立てます。</p>
	<p>当社ではユーザーインターフェースを構築するためのJavaScriptフレームワークである<a href="https://svelte.dev/" target="_blank">Svelte</a>を使用します。すべての人がこの決定に満足し同意しているわけではありませんが、テンプレート構文は標準のHTMLマークアップに似ており、フロントエンドの開発者でない人でも何が起こっているかを追跡して測定できます。</p>
	<p>Svelteは、設計システム用の<a href="https://tailwindcss.com/" target="_blank">Tailwind CSS</a>と組み合わされます。Tailwindは、非常に人気のあるユーティリティファーストのCSSフレームワークであり、開発者は事前定義された再利用可能なHTML「クラス」名を使用してスタイルを作成できます。</p>
	<p>結果はシングルページアプリケーション（SPA）になり、Cloudflare Pagesでホストされます。これはつまり、ダッシュボードは、<a href="https://developers.cloudflare.com/pages/platform/preview-deployments#customizing-preview-deployments-access" target="_blank">Accessで保護されたプレビュー展開</a>、<a href="https://developers.cloudflare.com/pages/platform/rollbacks" target="_blank">インスタントロールバック</a>、自動展開、包括的な分析などが、すぐに利用できるということです。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/11/image1-53.png" class="kg-image"></figure>
	<p>最後に、<a href="https://blog.cloudflare.com/ja-jp/cloudflare-pages-goes-full-stack-ja-jp/">PagesがWorkersと直接統合したため</a>、<strong>フェーズ1</strong>のJSON APIは新しいリポジトリ構造に移行されます。これは純粋なリファクタリングのように見えるかもしれませんが、実際にはJSON APIの驚くべき機能セット（<a href="https://developers.cloudflare.com/pages/platform/preview-deployments#customizing-preview-deployments-access" target="_blank">アクセス防止のプレビューデプロイメント</a>、<a href="https://developers.cloudflare.com/pages/platform/rollbacks" target="_blank">インスタントロールバック</a>、自動デプロイメント）を解き放つものです。そうです、これらは上記のPages機能と同じです。これは、当社のAPIが継続的かつアトミックにバージョン管理されており、APIに依存するクライアントダッシュボードと<em>一緒に</em>安全に開発を継続できることを意味しているため、驚くべきことです。言い換えれば、APIとダッシュボードが分岐して互いの期待がずれてしまうようなリスクはゼロということです。アプリケーション<em>全体</em>が単一のPagesユニットとして動作するため、インスタントロールバックもAPIに適用されます。</p>
	<p>前のフェーズではSaaS製品機能のコアを構築することができますが、このフェーズを完了すると、日常的に起動して使用できる実際の製品のように感じることができます。実のところ、<strong>フェーズ2</strong>が終了したことで、このアプリケーションはヘッドレスCMSサービス分野の有力な候補に位置付けられます。</p>
	<h3 id="-3-"><strong>フェーズ3 — 記事のエッジレンダリング</strong></h3>
	<p>前のフェーズは、最小限の実行可能なヘッドレスCMS製品の組み立てに焦点を当てていますが、<strong>フェーズ3</strong>は、この既成概念にとらわれずに成長することを目指します。これは、JSONコンテンツを事前定義されたテンプレートに挿入することでアプリケーションがHTML Webページをレンダリングできるようにすることで実現します。</p>
	<p>WordPressと同様に、CMSアプリケーションでは、ユーザーが「ヘッドレス」機能を引き続き使用するか、完全なテンプレートエンジンを使用するかを選択できるようにする必要があります。HTML出力を選択した場合、Cloudflareプロジェクトには、ユーザーが選択できるいくつかの既成のテンプレートのみが含まれますが、もちろん、これは独自のプロジェクトでカスタマイズできます。</p>
	<p>このフェーズではモノリシックCMSの原型が再導入されますが、これは、以前の単一のオールインワンサーバーよりもはるかに安全かつ高速で、復元力のあるアーキテクチャです。CMSコンテンツは引き続き世界中に配布され、お客様の読者の近くにありますが、コンテンツは世界中のどこからでも非常に低い遅延で<em>レンダリング</em>できるようになりました。</p>
	<h3 id="-4-"><strong>フェーズ4 — 機能のアップグレード</strong></h3>
	<p>この段階で、アプリケーションは（ほとんどの部分が）完成しています。機能的で見栄えがよく、グローバルに機能する、2つのまったく異なる方法で使用できます。</p>
	<p>実際のSaaS製品に関しては、開発はユーザーが喜ぶ新機能の追加またはプロジェクトの健全性の維持にシフトし始めます。たとえば、<strong>フェーズ4</strong>では、<a href="https://blog.cloudflare.com/ja-jp/durable-objects-ga-ja-jp/">Durable Objects</a>を利用して、複数のユーザーがリアルタイムのコラボレーション環境で同じドキュメントを編集できるドキュメントエディタを導入します。</p>
	<p>また、<a href="https://blog.cloudflare.com/ja-jp/introducing-r2-object-storage-ja-jp/">Cloudflare R2ストレージ</a>がメディアアセットのバックエンドとして導入され、ユーザーがワークスペース内で画像をアップロードおよび管理できるようになる可能性が非常に高くなります。恐らく当社ではこれに<a href="https://blog.cloudflare.com/announcing-cloudflare-images/">Cloudflare Images</a>を使用することにして、コンテンツバックアップのインポートとエクスポートにR2を使用します。</p>
	<p>ご想像のとおり、このマイルストーンは未知のもので溢れていますが、それは未来が無限の可能性を秘めているためです。プロジェクトは、Cloudflareと時間とともに進化し、拡大し続けます。</p>
	<p>もちろん、機能に関するアイデアや提案がある場合は、GitHubでディスカッションを開始してください。ご連絡をお待ちしております。</p>
	<h2 id="--3"><strong>次のステップ</strong></h2>
	<p>本記事は、進行中のシリーズ（今後の予定）の紹介記事でした。各マイルストーンが完了した際には、過去の情報やその章の作業の重要な側面の技術的なウォークスルーを交えてこのシリーズの新しい投稿を公開していきます。</p>
	<p>さあエキサイティングな旅の始まりです。あなたが興味を持ってくれることを願っています！</p>
	<p>GitHubでプロジェクトにスターを付けるか<a href="https://github.com/cloudflare/production-saas" target="_blank">フォローする</a>ことで、サポートを表明することができます。すべてのリリース、ディスカッション、およびマイルストーントラッキングは、リポジトリ内に存在します。次世代のSaaSアプリケーションはCloudflare上に構築されます—サブスクライブしてさっそく始めましょう！</p>
</div>