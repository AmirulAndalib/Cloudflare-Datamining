<div class="mb2 gray5">7 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2019/05/image1-3.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>スピードウィークへようこそ!今週は毎日、Cloudflareが誰にとっても有意義にインターネットを高速化するために何をしているかについて話していきます。</p>
	<p>Cloudflareは、世界75か国180都市にデータセンターの大規模なネットワークを構築しています。Cloudflareは、この地球上でA地点からB地点にビットを安全に、迅速に、そして確実に届けるグローバルシステムと考えることができます。</p>
	<p>それを実現するために、Argoを構築したのです。Argoはリアルタイムのグローバルネットワーク情報を利用して、計画停電、ケーブル切断、パケットロス、その他のインターネット上の問題を回避します。Argoは、Cloudflareが依存するネットワーク（インターネット）を、世界中のあらゆるホップにおいて迅速性、信頼性、安全性を高めます。</p>
	<p>当社は2年前にArgoを立ち上げましたが、今ではCloudflareのトラフィックの22%以上を占めています。平均的な1日に、Argoはインターネットユーザーがコンテンツを待って過ごす時間を112年相当も短縮しています。</p>
	<p>Cloudflareと当社のトラフィック量の拡大に伴い、Cloudflareのロケーション間の主要な接続の安全性、信頼性、速度をさらに高めるために、独自のプライベートバックボーンを構築するのは、自然な成り行きでしょう。</p>
	<p>本日は、Cloudflare グローバルプライベートバックボーンをご紹介します。これは、ここしばらく運用しており、Cloudflareのロケーション間をプライベートファイバー接続でリンクしています。</p>
	<p>このプライベートバックボーンは、すべてのCloudflareのお客様にメリットがあり、Argoとの組み合わせで輝きます。Argoは、データセンターごとにインターネット上で利用できる最適なリンクが選択でき、Cloudflare グローバルプライベートバックボーンを自動的に最大限に活用できます。</p>
	<p>Argoの舞台裏をお見せして、バックボーンネットワークがどのようにお客様のパフォーマンスを向上させているかをご説明します。</p>
	<h3 id="argo-"><strong>Argoとは？</strong></h3>
	<p>Argoとはインターネット用のWazeのようなものです。Cloudflareは毎日、ネットワークとインターネットを通じて何千億ものリクエストを運んでいます。当社のネットワーク、お客様、お客様のエンドユーザーは世界中のいたるところにいらっしゃるため、インフラストラクチャ全体を流れるこれらの要求をつなぎ合わせると、常に、インターネットの様々な部分でのパフォーマンスを見事に表します。</p>
	<p>ちょうどWazeが本物の運転手から集める実際のデータを調べて、町全体で混雑の少ない（時にはあまり使わないような）ルートを正確に提供するように、Argoスマートルーティングは、Cloudflareが各要求から収集するタイミングデータを使用して、インターネット上でより速く、より効率的なルートを選択します。</p>
	<p>実際のところ、Cloudflareのネットワークは広範囲に広がっています。指定された地域のインターネットリンクが混雑を起こし、パフォーマンスの質を落とすかもしれません（文字通り、交通渋滞）。Argoは現状を把握し、代替ネットワークのロケーションとプロバイダを利用することで、発信元から発信先まで、最短距離ではないないながら最速のルートにトラフィックを置くことができます。</p>
	<p>これは、理論上の利点ではりません。Argo Smart Routingを有効にすると、HTTP時間から最初のバイト（TTFB）までの時間を平均33%も短縮するのです。</p>
	<p>もう一つ誇りに思っているのは、当社が使いやすさに重点を置いてきたことです。ダッシュボードをワンクリックすると、より良く、賢いルーティングが有効になり、あなたのトラフィックを高速化させるためにCloudflareのネットワーク、データ、専門知識の力をフルに発揮します。高度な分析により、Argoが世界中でどのように動作しているかを正確に把握できます。</p>
	<p>Argoの仕組みについては、以前発表した<a href="https://blog.cloudflare.com/argo">ローンチブログ記事</a>をご覧ください。</p>
	<p>ここまで、Argoの機能レベルについて話してきましたが、電源を入れると、要求があなたの発信元まで高速でインターネットを横切ります。実際にどのように動作するのか?Argoは、その魔法をかけるためにいくつかの条件に依存しています。Cloudflareのネットワーク、インターネット上でのトラフィックの移動方法に関する最新のパフォーマンスデータ、そして機械学習ルーティングアルゴリズムです。</p>
	<h3 id="cloudflare-"><strong>Cloudflareのグローバルネットワーク</strong></h3>
	<p>Cloudflareは世界中でデータセンターのネットワークを保守しており、そのネットワークは大きく成長し続けています。当社は現在、世界75か国に<a href="https://www.cloudflare.com/network" target="_blank">180以上のデータセンター</a>を擁します。2017年5月にArgoを立ち上げて以来、さらに69のデータセンターが加わっています。</p>
	<p>Cloudflareは、新しいロケーションの追加に加えて、ネットワークパートナーと常に協力し、ネットワークロケーションに接続オプションを追加しています。単一のCloudflareデータセンターは10余りのネットワークとピアリングし、複数のIntermet eXchange（IX）に接続され、複数のトランジットプロバイダ（Telia、GTTなど）に接続され、現在は独自のフィジカルバックボーンに接続されています。任意の宛先が、同じロケーションから複数の異なるリンクを介して到達できるかもしれません。これらのリンクはそれぞれ、パフォーマンスも信頼性も特性が異なります。</p>
	<p>このネットワーク拠点の拡大は、Argoをさらに加速させる上で重要です。ネットワークロケーションとプロバイダを追加するということは、Argoがネットワークの中断や輻輳を回避するために、より多くのオプションを自由に使えるようになるということです。新しいネットワークロケーションを追加するたびに、任意の要求で利用できるルーティングオプションの数を大幅に追加します。</p>
	<h3 id="-"><strong>より良いルーティングでパフォーマンス向上</strong></h3>
	<p>Argoには、当社が構築した巨大なグローバルネットワークを必要です。しかし、実際にすべてのデータセンターとケーブルを利用してトラフィックをより速く移動させる知性がArgoになければ、大したことはできません。</p>
	<p>Argoは、複数の機械学習技術を組み合わせて、ルートの構築、テストを行い、予測通りに実行されなかったルートを失格とみなします。</p>
	<p>ルートの生成は、「オフライン」最適化手法を用いてデータ上で実行されます。Argoのルート構築アルゴリズムは、入力データセット(タイミングデータ)と固定最適化ターゲット(「TTFBを最小化」)を受け取り、この制約を満たすと思われるルートを出力します。</p>
	<p>ルートの失格は、ルート構築アルゴリズムの知識を持たない別のパイプラインによって実行されます。この2つのシステムは、意図的に敵対的になるように設計され、Argoがインターネット上でより良いルートを見つけるのに積極的であるだけでなく、急速に変化するネットワーク状態に適応できるようにします。</p>
	<p>Argoの知性を示す具体例として、指定されたデータセンターを離れるにつれ、複数の潜在的な接続オプションを区別する能力が挙げられます。当社ではこれを「トランジットセレクション」と呼びます。</p>
	<p>上述のように、一部のデータセンターには、特定の宛先IP アドレスに到達するために、実行できるオプションが10余りあります。ご自宅で利用できるすべてのISPに加入していて、アクセスしようとするWebサイトごとにどれを使用するが選択できるようなものです。トランジットセレクションにより、Cloudflareはすべてのホップで利用できる最速のパスをリアルタイムで選択して送信先に到達できます。</p>
	<p>トランジットセレクションでは、Argoは次の両方を指定することができます。</p>
	<p>1)配信元に向かう途中のネットワークロケーションウェイポイント。</p>
	<p>2)<em>パケットの送信時にソースから配信先まで各ウェイポイントにある特定のトランジットプロバイダまたはリンク。</em></p>
	<p>これをWazeにたとえると、トランジットセレクション<em>なし</em>で方向付けするArgoは、ソルトレイクシティまたはニューヨーク<em>まで</em>、通る道を特定しないまま、（サンフランシスコからニューヨークに行き、ソルトレイクシティを通過する）ウェイポイントに運転するように指示を出すようなものです。トランジットセレクション<em>により</em>、「サンフランシスコからI-80を通り、ここで左に曲がり、SR-201を使ってソルトレイクシティエリアに入ります（I-80はSLCの周りで混雑しているため）」といった細かな指示を出すことができます。これのおかげで、インターネット上の問題をより正確に回避できるようになりました。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2019/05/Argo-Map@2x.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>トランジットセレクションは、各ロケーションで利用できる様々なプロバイダとリンクの差別化を可能にするデータセンターの間のデータプレーン（実際にネットワーク経由でデータを移動するコンポーネント）のロジックが必要です。興味深いネットワークオートメーションと広告技術により、実際にどのリンクがトラフィックを移動するために選択されるのか、目が利くようになります。</p>
	<p>Argo データプレーンに変更を加えなければ、BGPに残されたトランジットの選択とともにこれらのオプションはエッジルーターによって抽象化されます。今後、使用されるルーティング技術について、広く公開する予定です。</p>
	<p>当社は、トランジションセレクションがArgoのお客様トラフィックに与える影響を直接測定することができます。世界における平均的改善を見ると、トランジットセレクションを使うと、標準 BGPで生成されたルートを取るよりも、さらに16%のTTFBレイテンシーの利点をお客様にもたらします。すごいですよね！</p>
	<p>私たちが考えることは、こういうことです。Argoはそれ自体でネットワークの状態を変更できます。一つのロケーションまたはプロバイダから別のロケーションまたはプロバイダにトラフィックが移動する際、<a href="https://www.citylab.com/transportation/2018/09/citylab-university-induced-demand/569455" target="_blank">デマンドを誘発</a>することで（改善されたパフォーマンスのおかげで追加データ量を追加）偉大なパワーは、複雑性も大きくなります。</p>
	<h3 id="cloudflare--1"><strong>Cloudflareグローバルプライベートバックボーンの追加</strong></h3>
	<p>各データセンターのトランジットと接続オプションの多様性と、それらの間を選ぶことができる知性を考えると、なぜ当社は自分たちのためにバックボーンを構築する時間と苦労をかけたのでしょうか?簡単に言えば、独自のプライベートバックボーンを運用することで、エンドツーエンドのパフォーマンスと容量管理がより詳細に制御できるからです。</p>
	<p>トランジットを購入したり、接続にパートナーを利用したりする場合、リンクの正常性を管理し、リンクが混乱せずに利用できる状態を維持するために、そのプロバイダに依存します。一部のネットワークは他のネットワークよりも優れていますし、条件は常に変化します。</p>
	<p>たとえば、トランジットプロバイダのネットワーク上の 2 つのデータセンター（シカゴとニューアーク）間のジッター（往復時間の差異）の測定値を次に示します。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2019/05/image4-1.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>写真の 6 時間にわたる平均ジッターは4ミリ秒で、平均ラウンドトリップ遅延は27ミリ秒です。ある程度のレイテンシーは、当たり前のことなので慣れるべきでしょう。光の速度は物理定数であり、手強い相手です。ネットワークプロトコルは、高レイテンシーまたは低レイテンシーがあるリンク上で機能するように構築されています。</p>
	<p>その一方、ジッターは「悪いヤツ」です。なぜかと言うと、予測不能であり、ジッターが上昇するとネットワークプロトコルやアプリケーションが急速に劣化する可能性があるからです。リンク上のジッターは、通常、接続の両側にあるルーティングハードウェア内のリソースをめぐるバッファリング、キューイング、一般的な競合が原因となって、発生します。例として、高レイテンシーのネットワーク経由で VoIP会話を行うことは面倒ですが、管理しやすいのです。通話をしている当事者たちは、「ラグ」に気付きますが、音声品質は損なわれるわけではありません。ジッターによって、会話に悪影響を与えます。パケットの到着が乱れたり、会話を分かりにくくする不具合が急に起きたりして、会話に悪影響を与えます。</p>
	<p>同じシカゴとニューアークの間のジッターチャートで、こちらはCloudflareグローバルプライベートバックボーンを通過する場合です。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2019/05/image3.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>こっちの方がずっといい！ここでは、536μs（マイクロ秒）のジッター測定値があります。同じ2つのサイト間にあるトランジットプロバイダ間の測定のほぼ8倍も優れています。</p>
	<p>エンドツーエンドで制御するファイバとArgo Smart Routingを組み合わせると、Cloudflareのバックボーンネットワークの可能性を最大限に引き出すことができます。Argoのルーティングシステムは、バックボーンが使用できる容量を正確に把握し、バックボーンをプッシュしようとする追加データの量の管理ができます。パイプの両端とパイプ全体を制御することで、特定のパフォーマンス特性を保証し、見込みをルーティングモデルに組み込むことができます。同じ原則を、当社が管理していないトランジットプロバイダおよびネットワークに適用はできません。</p>
	<h3 id="--1"><strong>レイテンシーよとんで行け！</strong></h3>
	<p>当社のプライベートバックボーンは、インターネット上のパフォーマンスを向上させるために利用できる、もう一つのツールです。Argoの最先端の機械学習と当社の大規模なネットワーク上のポイント間にあるダイレクトなファイバー接続を組み合わせることで、予測可能で優れたパフォーマンスでお客様のトラフィックをルーティングできます。</p>
	<p>バックボーンとその影響が拡大し続けることを楽しみにしています。</p>
	<p>私自身、プロジェクトマネージャーとしてArgoは取り組むのは、実に楽しいです。ウェブサイト、API、ネットワークを加速させることで、お客様にさらに満足していただけます。お客様は、ワンクリックでArgoを有効にでき、すぐにその効果を実感できます。トラフィックが配信元から配信先まで流れるのと同じように、見えないところで、物理インフラストラクチャと仮想インフラストラクチャへの巨大な投資もトラフィックの加速化に流れます。</p>
	<p>エンジニアリングの観点から見ると、当社の週次目標と目的は直接測定が可能です。当社が行った追加のエンジニアリング作業で、お客様はスピードアップできたのでしょうか？新しい最適化をArgoに送り出してすぐにチャートが右肩上がりするのを見た時、自分たちの仕事をやり遂げたと感じました。</p>
	<p>私たちの物理的プライベートバックボーンを構築することは、スピード感を必要としている我々にとって最も新しいことです。</p>
	<p>スピードウィークへようこそ!</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2019/05/image1-2.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>今から<a href="https://dash.cloudflare.com/traffic" target="_blank">Argoをアクティブにする</a>か販売部門に連絡して詳細情報を！</p>
</div>