<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/05/image3-2.png" class="kg-image" alt="" loading="lazy"></figure>
	<h3 id="-">始めに</h3>
	<p>Cloudflareボット管理プラットフォームの構築は、刺激的な経験でした。分散型システム、Web開発、機械学習、セキュリティ&amp;リサーチ（その他全ての分野）を混ぜ合わせながら、適応力が高く諦めの悪い敵と戦っています。</p>
	<p>これはCloudflareで進行中のボット管理に関するストーリーであり、ボットの根底にある検出のメカニズムに関する一連のブログの紹介でもあります。まず、ボット管理の世界からいくつか定義を紹介するところから始めましょう。それから、製品および技術的要件を紹介し、当社が構築したプラットフォームの概要へと続けます。最後に、Cloudflareのプラットフォームの根底にある検出のメカニズムについて詳しく説明します。</p>
	<p>では、ボット管理用語から始めます。</p>
	<h3 id="--1">定義</h3>
	<p>ボット- コンピューターシステムやユーザーと対話することができるネットワーク上の自律型プログラムであり、人間のユーザーの行動を模倣したり代替して、人間のユーザーよりもはるかに高速で反復的なタスクが実行できる。</p>
	<p>良性ボット- ビジネスに有用な、相互作用するボットのこと。たとえば、GooglebotやBingbotなどの検索エンジンボット、Facebook Botのようにソーシャルメディアプラットフォームで動作するボットなど。</p>
	<p>悪性ボット - 悪意のある行動を取るようにデザインされていて、最終的にビジネスに損害を与えるボットのこと。たとえば、クレデンシャルスタッフィングボット、サードパーティのスクレイピングボット、スパムボット、スニーカーボット。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/05/image12.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>ボット管理 - 不要または悪意のあるインターネットボットトラフィックをブロックする一方で、有用なボットがWebプロパティにアクセスできるようにすること。このためにボットのアクティビティを検出し、ボットの望ましい挙動と望ましくない挙動を識別して望ましくないアクティビティの根源を特定する。</p>
	<p>WAF -一連のセキュリティ規制に基づいて、ネットワークトラフィックを監視し、制御するセキュリティシステムのこと。</p>
	<h3 id="--2">要件の収集</h3>
	<p>Cloudflareは非常に<a href="https://blog.cloudflare.com/cloudflare-uses-intelligent-caching-to-avoid">早い段階</a>から悪意のあるボットによるWebサイトへのアクセスやAPIの悪用を阻止してきました。それと同時に、ボットによる炭素コストを相殺することで<a href="https://blog.cloudflare.com/cleaning-up-bad-bots">環境問題に取り組んで</a>きました。時代の流れとともに、ボット問題に取り組む様々なテクニックを統合し、顧客体験を効率化する専用のプラットフォームが必要だということが明らかになってきました。この新しいプラットフォームのデザインの際、次の重要要件を満たすようにしました。</p>
	<ul>
		<li>完全であり単純 - お客様がボタンを一回クリックするだけで、ボット管理をオン/オフでき、webサイトやモバイルアプリケーション、APIの保護ができる。</li>
		<li>信頼性 - お客様の望みは、webサイトの訪問者が本人であると信頼できるかどうかが分かり、その信頼レベルの確実性インジケーターが提供されること。</li>
		<li>柔軟性- お客様はトラフィックボット管理緩和策のうちどのサブセットを適用するべきか、定義できること。たとえば、ログインURLのみか、料金ページか、サイト全体か。</li>
		<li>正確性 - ボット管理検出のエラーは、ほぼ皆無であること。たとえば、人間の訪問者がボットとして誤って識別されることはほとんどまたはまったくいないこと。</li>
		<li>回復可能 - 予測が誤った場合でも、人間の訪問者はwebサイトにアクセスできること、また良性ボットは許可されること。</li>
	</ul>
	<p>さらに、新しいボット管理製品が目指したのは、次の利用ケースでも同様に機能させることでした。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/05/image8.png" class="kg-image" alt="" loading="lazy"></figure>
	<h3 id="--3">技術的要件</h3>
	<p>上記の製品要件に加えて、私たちエンジニアには、新しいボット管理プラットフォームの必須アイテムリストがありました。最重要事項：</p>
	<ul>
		<li>スケーラビリティ- プラットフォームは、1秒あたり1,000万を超えるリクエストでも、全てのリクエストのスコアを計算する能力があること。</li>
		<li>低レイテンシー - 検出は非常に高速で実行し、リクエストの処理の遅れは100ミリ秒を超えることなく、追加のハードウェアも必要としないこと。</li>
		<li>設定可能 - ドメインごとに、データセンターごとに、そしてサーバーごとのレベルで、どの検出機能をどのトラフィックに適用するか設定できること。</li>
		<li>変更可能- プラットフォームは、追加の検出メカニズム、さまざまな緩和アクション、より豊富なAnalyticsやログを使い、簡単に拡張できること。</li>
		<li>セキュリティ -お客様の機密情報を利用して別のお客様を保護するモデルを構築することはあってはならない。</li>
		<li>説明可能 &amp; デバッグ可能 - 予測は直感的に説明および調整ができること。</li>
	</ul>
	<p>2018年、こうした要件を備えて、少数のエンジニアからなるチームは、次世代のCloudflareボット管理のデザインと構築を開始したのです。</p>
	<h3 id="--4">スコアを満たす</h3>
	<p><em>「シンプルさは究極の洗練である」<br>- レオナルド·ダ·ヴィンチ</em></p>
	<p>Cloudflareは大規模に運営しています。この文章を書いている時点で、これは2600万以上のインターネットプロパティをカバーし、1秒あたり平均1100万件（ピーク時は1400万件以上）のリクエストを処理し、さまざまなプロトコルレベルから250件を超えるリクエスト属性の調査という規模です。重要な論点は、「途方もなく巨大な」データの力をどのように活用すれば、シンプルで確実、そして説明可能な方法で最新のサイバー脅威からすべてのお客様を保護することができるのか、ということです。</p>
	<p>ボット管理は難しいものです。ボットの中には検出が困難で、長期間、複数のリクエスト属性の多様な側面を調べる必要があるものもありますし、時には単一のリクエスト属性から発覚することもあります。シグナルは多いければ多いほど役立ちますが、それらを一般化できるのでしょうか。</p>
	<p>当社がトラフィックを分類する際、お客様は処理方法を決定しなければならないのか、またはお客様に代わって決定してもいいのか考えなければなりません。こうした不確実性の問題すべてに対処できて、上記の要件を実現するのに役立つ概念とはなんでしょうか。</p>
	<p>セクションのタイトルからお分かりかもしれませんが、当社が考えたのは、信用スコアまたは単にスコア<em> - </em>すべてを支配する唯一のもの - という概念でした。これは、0から100までの数値で、リクエストが、人間が生成した（高スコア）か、自律型プログラムが生成した（低スコア）かの可能性を示すものです。</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2020/05/image5-1.jpg" class="kg-image" alt="" loading="lazy">
		<figcaption><a href="https://www.flickr.com/photos/purple-lover/13583362554" target="_blank">「一つの指輪がすべてを統べる」</a> idreamlikecrazy 出典 <a href="https://creativecommons.org/licenses/by/2.0" target="_blank">CC BY</a> / 原版を非飽和</figcaption>
	</figure>
	<p>では、受信するHTTP/HTTPSリクエストすべてにこのスコアを割り当てられると仮定して、お客様や当社は何をするべきでしょうか。こうしたスコアをログに提供するだけで十分かもしれません。お客様が自分で分析し、最も頻繁に最低スコアがついているIPを見つけ、Cloudflareファイアウォールを使って、こうしたIPをブロックできるかもしれません。このようなプロセスは便利ですが、マニュアルで行うことが多く、エラーが発生しやすいものです。最も重要な点は、お客様のインターネットプロパティを保護するために、リアルタイムで実行することができません。</p>
	<p>幸運にも、私たちがこのシステム開発に着手したころに、ファイアウォールチームの同僚たちが<a href="https://blog.cloudflare.com/announcing-firewall-rules">ファイアウォールルールを発表していました</a>。この新しい機能を使い、広く知られているWireshark®言語に触発された、柔軟で直感的な方法でお客様がリクエストを制御することが可能になりました。ファイアウォールルールはさまざまなリクエストフィールドをサポートしていたため、私たちは、スコアをこうしたフィールドの一つすることを考えたのです。そうすると、お客様は詳細なルールを書き込んで特定の攻撃タイプをブロックすることもできます。このように、cf.bot_management.scoreフィールドが誕生しました。</p>
	<p>Cloudflareボット管理の中心にスコアを据えることで、一打で複数の製品要件と技術的要件に対応したわけです。シンプルかつ柔軟で、設定可能、さらにお客様はリクエストごとにボットを管理することが可能になります。擬陽性と偽陰性に対する許容度に応じて、お客様はファイアウォールルールにおいてスコアのしきい値を調整できます。さらに、スコアは直感的なため、当社は内部で検出機能を拡張することができ、お客様が設定を調整する必要はありません。</p>
	<p>それでは、このスコアはどのように作成し、それはどの程度難しいのでしょうか。次のセクションで詳しくみていきましょう。</p>
	<h3 id="--5">アーキテクチャの概要</h3>
	<p>ボット管理スコアの根底にあるのは何でしょうか。単純な答えは、一連のマイクロサービスです。このプラットフォームを構築するために、私たちはできるだけ多くの既存のパイプライン、データベース、コンポーネントを流用しようとしましたが、サービスの多くは一から構築する必要がありました。アーキテクチャ全体を見てみましょう（ボット管理関連サービスを含んだ簡略化した図）。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/05/image13.png" class="kg-image" alt="" loading="lazy"></figure>
	<h3 id="--6">主要なボット管理サービス</h3>
	<p>手短に言うと、当社のシステムはエッジデータセンターから受信したデータを処理し、後述の技術を使ってボット検出のメカニズムに必要となるデータを生成し、保存します。</p>
	<ul>
		<li>データベース &amp; データ保存 - <a href="https://blog.cloudflare.com/squeezing-the-firehose">Kafka</a>、<a href="https://blog.cloudflare.com/http-analytics-for-6m-requests-per-second-using-clickhouse">ClickHouse</a>、Postgres、Redis、Ceph。</li>
		<li>プログラミング言語 - Go、Rust、Python、Java、Bash。</li>
		<li>設定 &amp; テーマ管理 - Salt、<a href="https://blog.cloudflare.com/introducing-quicksilver-configuration-distribution-at-internet-scale">Quicksilver</a>、<a href="https://capnproto.org" target="_blank">Cap’n Proto</a>。</li>
		<li>コンテナ化 - Docker、Kubernetes、Helm、Mesos/Marathon</li>
	</ul>
	<p>耐障害性、パフォーマンス、可観測性、セキュリティを考慮に入れて、各サービスを構築しています。</p>
	<h3 id="--7">エッジボット管理モジュール</h3>
	<p>Cloudflareのエッジロケーションにあるすべての機器で、ボット検出のメカニズムすべてが、すべてのリクエストに対して、ボット管理モジュールの実行時のリクエスト処理段階でリアルタイムに適用されます。リクエストを受信すると、当社は必要なリクエスト属性を抽出、変換し、検出のメカニズムに入力します。ボット管理モジュールは次の出力を生成します。</p>
	<p>ファイアウォールフィールド -<a href="https://support.cloudflare.com/hc/en-us/articles/360027519452-Understanding-Cloudflare-Bot-Management" target="_blank">ボット管理フィールド</a></p>
	<p>- cf.bot_management.score - 整数値で、0～100の間で、リクエストが自動プログラム（低スコア）により生成されたのか、人間（高スコア）により生成されたのかの可能性を示す。</p>
	<p>- cf.bot_management.verified_bot- 当該リクエストがCloudflareのホワイトリストに載っているボットによるかどうかを示すブール値。</p>
	<p>- cf.bot_management.static_resource- リクエストが多くの静的リソースタイプのファイル拡張子と一致するかどうかを示すブール値。</p>
	<p>Cookie - 最も顕著には<a href="https://community.cloudflare.com/t/cf-bm-cookie/56696" target="_blank">cf_bm</a>を作成し、ボットに関連づけられた基準と一致する受信トラフィックを管理する手助けをします。</p>
	<p>JSの課題 - 一部の検出とお客様に対しては、不可視のJavaScriptの課題を挿入して、ボット検出用の信号をより多く得ます。</p>
	<p>検出ログ- 当社のデータパイプラインは、ClickHouseで管理します。適用された各検出、使用された機能とフラグに関する詳細を記録、一部はデータ分析や顧客ログに用い、また一部はデバッグや当社のモデル改善に役立てています。</p>
	<p>ボット管理モジュールが必須フィールドを作成すると、ファイアウォールが実際のボット緩和を引き継ぎます。</p>
	<h3 id="--8">ファイアウォールの統合</h3>
	<p>Cloudflareファイアウォールの直感的なダッシュボードを使えば、ユーザーは強力なルールを数回のクリックで容易に設定でき、Terraformの統合も可能です。ファイアウォールへのリクエストはすべてルールエンジンと照会して検査されます。疑わしいリクエストは、ユーザーのニーズに合わせてブロックされたり、認証または記録することができ、ボット管理モジュールによって作成されたスコアと設定されたしきい値に基づいて、正当なリクエストは、配信先へとルーティングされます。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/05/image6.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>ファイアウォールルールでは、次のボット緩和<a href="https://developers.cloudflare.com/firewall/cf-firewall-rules/actions" target="_blank">行動</a>が提供されます。</p>
	<ul>
		<li>ログ- 顧客に提供されたCloudflareログのリクエストと一致した記録。</li>
		<li>バイパス- お客様は特定のリクエストに対してCloudflareのセキュリティ機能を動的に無効にすることができます。</li>
		<li>許可- 一致したリクエストは、ほかのファイアウォールルールコンテンツによってトリガーされるチャレンジおよびブロックアクションの対象から除外されます。</li>
		<li>チャレンジ（Captcha）- サイトにアクセスしている訪問者が自動化されたソースではなく人間であることを確認するのに有用です。</li>
		<li>JSチャレンジ- ボットやスパムがリクエストしたリソースにアクセスできないようにします。ただし、ブラウザは自由にチャレンジを自動的に解決できます。</li>
		<li>ブロック- 一致したリクエストはサイトへのアクセスが拒否されます。</li>
	</ul>
	<p>当社の<a href="https://blog.cloudflare.com/updates-to-firewall-analytics">ファイアウォール Analytics</a>ツールはClickHouseと<a href="https://blog.cloudflare.com/introducing-the-graphql-analytics-api-exactly-the-data-you-need-all-in-one-place">GraphQL API</a>を基盤とし、お客様は直感的インターフェースを利用してセキュリティ脅威を特定し、調べることができます。Analyticsのほか、当社ではすべてのボット関連アクティビティについての詳細なログを<a href="https://developers.cloudflare.com/logs/logpull-api" target="_blank">Logpull API</a>および/または<a href="https://blog.cloudflare.com/cloudflare-logpush-the-easy-way-to-get-your-logs-to-your-cloud-storage">LogPush</a>のどちらかを使って提供しており、お客様が自社のログを自社のクラウドストレージに簡単に入れることが可能です。</p>
	<h3 id="cloudflare-workers-">Cloudflare Workersの統合</h3>
	<p>お客様がスコアに基づくリクエストの処理にさらに柔軟性をご希望の場合、例えば新規のHTMLページコンテンツを挿入したり既存のHTMLページコンテンツを変更する、またはボットに誤ったデータを提供する、特定のリクエストを妨害するなどの希望があれば、Cloudflare Workersはそれを実現します。たとえば、この小さなコードスニペットを使うと、配信元サーバーにスコアを返して、さらに高度なリアルタイム分析、または緩和ができます。</p><!--kg-card-begin: markdown-->
	<pre><code class="language-javascript">addEventListener('fetch', event =&gt; {
  event.respondWith(handleRequest(event.request))
})
 
async function handleRequest(request) {
  request = new Request(request);
 
  request.headers.set("Cf-Bot-Score", request.cf.bot_management.score)
 
  return fetch(request);
}
</code></pre>
	<!--kg-card-end: markdown-->
	<p>次に複数の検出メカニズムを用いて、単一のスコアがどのように生成されるかを見ていきましょう。</p>
	<h3 id="--9">検出のメカニズム</h3>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/05/image10.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>現在のところ、Cloudflareボット管理プラットフォームは補完的な検出メカニズムを5つ用いています。このメカニズムはそれぞれ独自のスコアを生成し、当社はこれらを組み合わせてファイアウォールに向かう単一のスコアを生成します。検出メカニズムのほとんどが、すべてのリクエストに適用されますが、一部は顧客のニーズに合わせて顧客ごとに有効化されています。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/05/image14.png" class="kg-image" alt="" loading="lazy" title="Chart"></figure>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/05/image4-1.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>全てのお客様のために全てのリクエストにスコアをつけると、次のような利点があります。</p>
	<ul>
		<li>簡単なオンボーディング - ボット管理をアクティブモードにする前でも、ボットのアクテビティに関する履歴データの提供を含め、特定のお客様にどのような効果が出るのかを推察することができます。</li>
		<li>フィードバックループ-すべてのリクエストについてスコアが利用できることは、その他のあらゆる機能と合わせて、当社の検出メカニズムの継続的改善にとって大きな価値があります。</li>
		<li>スケーリングの保証 - すべてのリクエストと顧客にスコアをつける計算力を持つならば、Cloudflareのインターネットプロパティすべてが、潜在的なボット管理の顧客でとなり得ます。</li>
		<li>グローバルボットの洞察 - Cloudflareは2600万以上のインターネットプロパティの前に位置しており、セキュリティと脅威インテリジェンスで起きている構造的な変化を経時的に把握し、対応することができます。</li>
	</ul>
	<p>世界的に見ると、Cloudflareが確認できるインターネットトラフィックの３分の1以上が悪性のボットから発生しているのに対して、ボット管理の顧客では悪性ボットの確率が最大43％とさらに高いのです。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/05/image7.png" class="kg-image" alt="" loading="lazy" title="Chart"></figure>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/05/image9.png" class="kg-image" alt="" loading="lazy" title="Chart"></figure>
	<p>ここで、Cloudflareボット管理との統合の時系列で、具体的な検出メカニズムを詳しくみていきましょう。</p>
	<h3 id="--10">機械学習</h3>
	<p>スコアに関する決定の大半は、当社の機械学習モデルを用いています。このモデルは、2018年に、スコアを生成して顧客に展開した最初の検出メカニズムでもあります。機械学習を成功裏に活用するには、<a href="https://blog.cloudflare.com/stop-the-bots-practical-lessons-in-machine-learning">量、多様性、質</a>が高いデータを必要とします。そして、無料プランおよび有料プランでご利用くださるお客様のおかげで、Cloudflareはこの三つを備え、当社のすべてのお客様のためにモデルの学習と向上を継続的に行うことができています。</p>
	<p>機械学習検出メカニズムの中核にあるのは、CatBoostです。これは、勾配ブースティング決定木のための高性能なオープンソースライブラリです。CatBoostは、ライブラリの卓越した機能に基づいて選択されました。</p>
	<ul>
		<li>カテゴリ特性の完全サポート - カーディナリティの非常に高い特性であってもトレーニングが可能です。</li>
		<li>優れた精度- 新しい勾配ブースティングスキームを使って過学習を減らすことができます。</li>
		<li>推論の速度 - 当社の場合、どのモデルでも適用にかかる時間は50マイクロ秒未満であり、リクエスト処理の速度に影響を与えません。</li>
		<li>CとRust API - エッジでの当社のビジネスロジックのほとんどはLua、具体的にはLuaJITで書かれており、モデルに適用できる互換性のあるFFIインターフェイスがあることは、非常に望ましいと言えます。</li>
	</ul>
	<p>Cloudflareのエッジでは、複数のCatBoostモデルが、<a href="https://christophergs.com/machine%2520learning/2019/03/30/deploying-machine-learning-applications-in-shadow-mode/#what" target="_blank">シャドーモード</a>で、すべてのリクエストに、すべての機器で、実行されています。これらのモデルの一つはアクティブモードで実行されており、ファイアウォールに送られる最終スコアに影響を及ぼします。すべてのML検出結果と機能はClickHouseに記録されて、さらなる分析、モデル改良、分析や顧客向けのログに記載されます。当社は、カテゴリ特性も数値特性も両方当社のモデルに入力しています。これは、リクエスト属性や、リクエスト属性を使用して構築したリクエスト間特性から抽出したもので、<em>Gagarin</em>のリクエスト間特性プラットフォームにより計算し、提供されています。</p>
	<p>当社は新しいMLモデルのリリースに非常に信頼性が高く、優れたパフォーマンスの<a href="https://blog.cloudflare.com/introducing-quicksilver-configuration-distribution-at-internet-scale">Quicksilver</a>構成データベースを用いており、わずか数秒で実行することができます。この同じメカニズムは、特定の顧客向けにアクティブモードで実行するべきMLモデルを設定するのに使えます。</p>
	<p>当社の機械学習検出メカニズムをさらに説明するには、それに特化したブログを投稿するだけの価値があります。ブログでは、GPUを活用して何兆ものリクエストを使ってどのように当社のモデルをトレーニングし、検証するか、このモデル機能の配信および抽出がどのように動作するか、どのように内部と外部の両方でモデル予測を説明し、デバッグするのかをご紹介します。</p>
	<h3 id="--11">ヒューリスティックエンジン</h3>
	<p>もちろん世界中の問題が、機械学習で解決するのが一番良いというわけではありません。MLモデルを微調整する方法はいろいろありますが、場合によっては基本的なヒューリスティックを下回ることもあります。機械学習で解決しようとしている問題が、目新しいものでないこともあります。ボット管理ソリューションを構築する際、時にリクエストの単一属性からボットであることが発覚することが明らかになりました。つまり、単純な方法でボットを特定できるシンプルなルールをいくつか作成することができると同時に、誤検出を最小限に抑えることができるということです。</p>
	<p>ヒューリスティックエンジンは、2019年にCloudflareボット管理プラットフォームに統合された二番目の検出メカニズムで、すべてのリクエストに適用されます。当社では、複数のヒューリスティックタイプとリクエストの特定の属性に基づく何百もの具体的なルールを設定しており、その一部はなりすましが非常に困難です。リクエストがいずれかのヒューリスティックと一致する場合、可能な限り低いスコア、1を割り当てます。</p>
	<p>エンジンは次のプロパティを備えています。</p>
	<ul>
		<li>速度-MLモデルの推論がモデル1つあたり50マイクロ秒未満である場合、数百のヒューリスティックの適用は、なんと20ミリ秒を下回ることもあり得ます。</li>
		<li>展開力 - ヒューリスティックエンジンのおかげで、<a href="https://blog.cloudflare.com/introducing-quicksilver-configuration-distribution-at-internet-scale">Quicksilver</a>を使ってほんの数秒で新しいヒューリスティックを追加することが可能となり、すべてのリクエストに適用されます。</li>
		<li>広いカバレッジ - シンプルなヒューリスティック一式でグローバルトラフィックは最大15%、ボット管理の顧客のトラフィックは最大30%までボットとして分類できます。簡単な方法で、これだけ見つけられたら十分だと思いませんか。</li>
		<li>最低限の誤検出 -追加するヒューリスティックについて、当社は強い確信を持っており、慎重でもあるため、この検出メカニズムがすべての検出メカニズムの中でも誤検出を最低限に抑えられています。</li>
		<li>MLのラベル- MLモデルのトレーニングには、その確度の高さからヒューリスティックを使って分類したリクエストを用いているため、ヒューリスティックから学んだ行動を一般化し、検出精度を向上させることができます。</li>
	</ul>
	<p>つまり、ヒューリスティックを採用し、<a href="https://developers.google.com/machine-learning/guides/rules-of-ml#rule_7_turn_heuristics_into_features_or_handle_them_externally" target="_blank">機械学習による微調整を加えることで当社はさらなる高みへと達することができたのです。</a>そしてヒューリスティックの持つボットに関する多くの直感は、Cloudflare ボット管理プラットフォームをさらに前進させ、より多くのお客様に採用いただけています。</p>
	<h3 id="--12">行動分析</h3>
	<p>機械学習とヒューリスティックの検出がもたらす価値は大きいのですが、両方とも人間がラベルに入力する必要があるか、基本的に教える人間が正誤を区別する必要があります。教師ありのMLモデルは教え込んだものと似た新しい脅威ならば、十分に一般化できるのですが、当社はさらに踏み込むことにしました。教師を必要とせず、悪い挙動と通常の挙動を見分けることを学習できる、新しいアプローチがあったとしたらどうでしょうか。</p>
	<p>2018年に最初に開発され、2019年にボット管理プラットフォームと統合された行動分析検出メカニズムに入りましょう。これは教師なしの機械学習アプローチで、次のプロパティを持ちます。</p>
	<ul>
		<li>顧客の特定ニーズに応える- すべてのボット管理顧客に対して自動的に有効になります。通常の訪問者の行動を長期間計算し、分析します。</li>
		<li>まったく新しいボットの検出 - これは既知のボットのラベルを使用しないので、特定のお客様のWebサイトにおける通常の挙動からボットと異常を検出することができます。</li>
		<li>回避が困難 - 異常な挙動とは、ボットの特定目的から生じた直接的な結果であることが多いです。</li>
	</ul>
	<p>行動分析モデルや、この素晴らしい検出メカニズムの基盤であり、前例のない攻撃からお客様の多くを保護するプラットフォームについて、詳しく説明するブログを投稿する予定ですので、お楽しみに。</p>
	<h3 id="--13">検証済みボット</h3>
	<p>ここまでのところ、悪性のボットと人間の検出方法について話してきましたが、良性のボットについてはどうでしょうか。お客様のWebサイトで非常に役立っている良性ボットもあります。専用の検出メカニズムの需要や、前述の検出メカニズムで利用できるものはないでしょうか。良性のボットリクエスト（Googlebot, Bingbot, LinkedInbotなど）の大部分が、すでに他の検出メカニズムで低いスコアを生成していますが、当社でも有用なボットを偶発的にブロックする事態を避ける方法が必要だと考えていました。そこで、ファイアウォールフィールド<em>cf.bot_management.verified_bot</em>が2019年に登場し、お客様ご自身が良性のボットすべてを許可するか、部分的にWebサイトへのアクセスを制限するかを決められるようになりました。</p>
	<p>検証済みボットフラグを計算する実際のプラットフォームは、それについて詳しくブログで紹介する価値があると思いますが、ここで簡単に次のプロパティを紹介します。</p>
	<ul>
		<li>検証ツールベースのアプローチ -当社では検証メカニズムを複数サポートしており、それぞれが一連のIPをクラスター化することで良性ボットIDを確実に特定することができます。</li>
		<li>逆引きDNS検証ツール - 逆引きDNSチェックを実行し、ボットのIPアドレスが、名乗っているホスト名と一致するかどうかを決定します。</li>
		<li>ASNブロック検証ツール - rDNSチェックに似ていますが、ASNブロックで実行されます。</li>
		<li>ダウンローダー検証ツール - ボットの所有者サイトでホストされているテキストファイルかHTMLページで、良性ボットのIPを収集します。</li>
		<li>機械学習検証ツール - 教師なし学習アルゴリズムを使い、他の方法では検証することが不可能な良性ボットのIPをクラスター化します。</li>
		<li>ボットディレクトリ- Cloudflareネットワークを通過するボットを保存、管理するUIを備えたデータベースです。</li>
	</ul>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2020/07/image2-1.png" class="kg-image" alt="" loading="lazy">
		<figcaption>ボットディレクトリUIのサンプル‌‌</figcaption>
	</figure>
	<p><em>検証</em>済みボット検出メカニズムが、上記の複数の検証方法を用いて、さまざまな企業やカテゴリーに属する、何百もの固有の良性ボットIDを識別します。</p>
	<h3 id="js-">JS フィンガープリンティング</h3>
	<p>ボット管理検出の質に関して大切なことは、シグナルの質と量です。前述の検出はすべて、ネットワークを通じて送信され、異なるテクニックでサーバー側が分析したリクエスト属性を使います。当社の検出を改善するためにクライアントから抽出して、利用できるシグナルがほかにないでしょうか。</p>
	<p>実際のところ、たくさんあります。なぜなら、どのブラウザにも実装に固有のクセがあるからです。Canvasなど、すべてのWebブラウザグラフィック出力はハードウェア（GPU）とソフトウェア（ドライバー、オペレーティングシステムのレンダリング）のように複数の層に依存しています。この極めて特有な出力によって、ブラウザやデバイスタイプの違いは、はっきりと正確に区別できます。さらに、これはスーパーCookieではないので、Webサイト訪問者のプライバシーを害することなく達成できます。個々のユーザーを追跡したり識別したりするのに使うことはできず、リクエストのユーザーエージェントが、ブラウザキャンバスAPIを介して収集した他の測定値と一致するかを確認するだけです。</p>
	<p>この検出メカニズムは、CloudflareのエッジでWebページに挿入されるチャレンジとともにチャレンジ応答システムとして実装されます。提示されたグラフィック指示を用いてバックグラウドでチャレンジがレンダリングされ、その結果は、Cloudflareに返信され、検証およびスコアの生成などのさらなる処理に使用されます。ユーザーのプライバシーを害することなく、リプレイ攻撃への耐タンパー性を維持しつつ、信頼できる結果をもたらすために裏で多くのことが行われています。システムは現在プライベートベータ版で、その有効性が評価されており、すでに期待できる結果が出ています。この新しい検出メカニズムがみなさんに広く使っていただけるようになる日を楽しみしていてください。どのように構築したかに関するブログも近日掲載します。</p>
	<p>以上が、これまでに構築した5つの検出メカニズムの概要です。では、まとめの時間です。</p>
	<h3 id="--14">まとめ</h3>
	<p>Cloudflareは、自社のネットワークを通過する毎週何兆という数のリクエストからデータを収集する独自の能力を持っています。Cloudflareはこのデータを使って、機械学習、ヒューリスティック、行動分析、その他の検出メカニズムによりボットの可能性が高いアクティビティを識別できます。Cloudflareボット管理は、WAFやWorkersといたCloudflare製品とシームレスに統合できます。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2020/05/image1-1.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>多くのチームが一生懸命働いてくれたからこそ、実現できました。まず、このプラットフォームを生み出すために多大な努力を尽くしてくれたボットチームの全員に感謝の意を表したいと思います。他のCloudflareチーム、特にファイアウォール、データ、ソリューションエンジニアリング、パフォーマンス、SREからも、この信じられないほど素晴らしいプラットフォームのデザイン、構築、サポートについて、多大な貢献がありました。</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2020/05/image11-1.jpg" class="kg-image" alt="" loading="lazy">
		<figcaption>オースティンチームサミット2019でボットを斧で仕留めてくれたボットチーム</figcaption>
	</figure>
	<p>最後に、近日中にボットシリーズのブログを掲載していきます。当社の検出メカニズムの内側を深く掘り下げて、詳細情報をご紹介しますので、Cloudflareボット管理の面白い話をぜひ楽しみにしていてください。</p>
</div>