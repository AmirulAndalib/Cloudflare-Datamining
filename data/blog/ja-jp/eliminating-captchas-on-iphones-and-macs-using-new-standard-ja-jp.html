<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/06/image.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>本日、当社はプライベートアクセストークンを発表しました。これは、本物のユーザーがお客様のサイトを訪れていることを検証する、完全に不可視でプライベートな方法です。<a href="https://developer.apple.com/wwdc22/10077" target="_blank">macOSまたはiOSの次期バージョン</a>など、これらのトークンをサポートするオペレーティングシステムを使用している訪問者は、CAPTCHAを完了したり個人データを提供することなく、自分が人間であることを証明できるようになりました。これにより、これらのユーザーに提供されるCAPTCHAのほぼ100%が排除されます。<br></p>
	<p>これはどういうことなのでしょうか？ <br></p>
	<p>インターネットユーザーの場合：</p>
	<ul>
		<li>当社は、お客様のモバイルWeb体験をより快適にすると同時に、他のネットワークよりもさらにプライベートなものにします。</li>
		<li>サポートされているiOSまたはMacデバイス(その他のデバイスは近日公開予定！)がCloudflareネットワークにアクセスする際にCAPTCHAが表示されることはありません。<br></li>
	</ul>
	<p>Webやアプリケーション開発者の場合：</p>
	<ul>
		<li>デバイスベンダーによって直接検証された、本物のデバイスと署名されたアプリケーションからユーザーがアクセスしていることを確認できます。</li>
		<li>面倒なSDKを維持することなく、ユーザーを検証することができます。<br></li>
	</ul>
	<p>Cloudflareのお客様の場合：</p>
	<ul>
		<li>何もする必要はありません！Cloudflareは自動的にプライベートアクセストークンを要求し、利用します</li>
		<li>訪問者にはCAPTCHAが表示されず、訪問者のデバイスからのデータ要求も少なくなります。</li>
	</ul>
	<h3 id="-">プライベートアクセストークンの導入 </h3>
	<p>過去1年間、CloudflareはApple、Google、その他の業界リーダーと協力し、<a href="https://www.ietf.org/archive/id/draft-ietf-privacypass-auth-scheme-01.html" target="_blank">プライバシーパスプロトコル</a>を拡張し、新しい暗号トークンをサポートするようになりました。これらのトークンは、開発者やセキュリティチームにとってアプリケーションのセキュリティを簡素化し、人がデバイスを使用しているかどうかを判断するための従来のサードパーティ製SDKベースのアプローチを陳腐化させます。これらのトークンは、ブラウザ、ブラウザから呼び出されるAPI、およびアプリケーション内で呼び出されるAPIで機能します。当社は、これらの新しいトークンをプライベートアクセストークン(PAT)と呼んでいます。今朝、<a href="https://developer.apple.com/wwdc22/10077" target="_blank">Appleは、PATがiOS 16、iPad 16、macOS 13に組み込まれると発表しました。</a>近い将来、他のベンダーもサポートを発表すると思われます。</p>
	<p>CloudflareはすでにPATを<a href="https://blog.cloudflare.com/end-cloudflare-captcha/">Managed Challengeプラットフォーム</a>に組み込んでおり、この機能を利用するお客様は自動的にこの新しい技術を利用し、対応デバイスのブラウジング体験を向上させることができます。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/06/image2-4.png" class="kg-image" alt="" loading="lazy"></figure>
	<p><br>モバイル環境ではCAPTCHAは機能せず、PATがその必要性をなくします</p>
	<p>当社は、CAPTCHAがいかにひどいユーザーエクスペリエンスであるかについて<a href="https://blog.cloudflare.com/ja-jp/introducing-cryptographic-attestation-of-personhood-ja-jp/">何</a><a href="https://blog.cloudflare.com/ja-jp/moving-from-recaptcha-to-hcaptcha-ja-jp/">度も</a><a href="https://blog.cloudflare.com/end-cloudflare-captcha/">書いてきました。</a>ただし、モバイル端末でのユーザーエクスペリエンスがどれほど悪いかについては、特に説明していません。技術としてのCAPTCHAは、ブラウザベースの世界向けに構築され、最適化されました。これらは、一般的に1つのサイズがすべてにフィットするウィジェットまたはiframeを介してデプロイされ、レンダリングの問題を引き起こしたり、入力ウィンドウがデバイス上で部分的にしか表示されません。モバイル画面上の面積が小さいため、本質的に技術のアクセス性が低下し、CAPTCHAの解決がより困難になり、JavaScriptと画像ファイルをレンダリングする必要があるため、画像の読み込みが遅くなり、お客様の帯域幅を過剰に消費します。<br></p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/06/image5-2.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>使いやすさは別として、モバイル環境はAPI駆動型になりつつあるという点で、さらなる課題を抱えています。CAPTCHAは、JavaScriptがレンダリングできない、あるいはWebViewが呼び出せないAPI環境では、単純に機能しないのです。そのため、モバイルアプリの開発者は、必要なときにユーザーに挑戦するための簡単な選択肢を持っていないことがよくあります。不便なSDKを使ってCAPTCHAをアプリに直接埋め込むという手段を用いることもあります。この場合、CAPTCHAの埋め込みとカスタマイズに手間がかかり、メンテナンスと監視を続ける必要があり、その結果、放棄率が高くなります。このような理由から、現在、当社のお客様がCAPTCHAの表示を選択した場合、モバイルでは20％の割合でしか表示されません。</p>
	<p>先日、Managed Challengeのプラットフォームを利用して、<a href="https://blog.cloudflare.com/end-cloudflare-captcha/">CAPTCHAの使用量を91%削減</a>した方法をご紹介しました。しかし、モバイルでのCAPTCHA体験は非常に悪いので、特にモバイルでのCAPTCHA使用をさらに減らすことができる方法を別途検討しています。</p>
	<h3 id="--1">サイトが訪問者に異議を唱えられない場合は、より多くのデータを収集します</h3>
	<p>つまり、APIを保護するためにCAPTCHAを使うことはできないか、あるいはUXがひどすぎてモバイルWebサイトで使うことはできない、ということです。訪問者が本物かどうかを確認するためには、どのような選択肢が残されているのでしょうか。よくあるのは、一般にフィンガープリンティングとして知られている、クライアント固有のデータを見ることです。 <br></p>
	<p>デバイスのIMEIやセキュリティパッチのバージョンを尋ねたり、画面サイズやフォントを調べたり、インタラクティブなタッチスクリーンイベントのような人間の行動を示すAPIの存在を確認したり、それらを指定されたクライアントの期待される結果と比較したりすることができます。しかし、このようなデータ収集はすべてコストがかかり、結局はエンドユーザーを尊重したものではありません。プライバシーを重視し、インターネットをより良くすることに貢献する企業として、当社は提供するサービスの安全性を損なうことなく、できるだけ少ないデータを使用したいと考えています。<br></p>
	<p>もう1つの方法は、デバイス検証チェックを提供するシステムレベルのAPIを使用することです。これには、Appleプラットフォームの<a href="https://developer.apple.com/documentation/devicecheck" target="_blank">DeviceCheck</a>およびAndroidの<a href="https://developer.android.com/training/safetynet/attestation" target="_blank">SafetyNet</a>があります。アプリケーションサービスは、これらのクライアントAPIを独自のサービスで使用して、通信しているクライアントが有効なデバイスであることを表明することができます。ただし、これらのAPIを採用するには、アプリケーションとサーバーの両方を変更する必要があり、SDKと同様に保守が困難な場合があります。</p>
	<h3 id="--2">プライベートアクセストークンは、フィンガープリンティングなしで検証することにより、プライバシーを大幅に向上させます</h3>
	<p>これは、PATの最も強力な側面です。デバイスの検証に役立つデータをすでに持っているデバイスメーカーのようなサードパーティと提携することで、検証プロセスの一部を抽象化し、<em><strong>実際に収集したり</strong>、<strong>触ったり、そのデータを自分で保存したりせずに</strong></em>データを確認することができるのです。当社はデバイスに直接問い合わせるのではなく、デバイスベンダーに依頼します。<br></p>
	<p>従来のWebサイトのセットアップにおいて、最も一般的なCAPTCHAプロバイダーを使用した場合：</p>
	<ul>
		<li>訪問したWebサイトは、URL、お客様のIPおよびいくつかの追加のユーザーエージェントデータを把握しています。</li>
		<li>CAPTCHAプロバイダーは、お客様の訪問したWebサイト、IP、デバイス情報を把握し、ページ上でのインタラクションデータを収集し、このデータをGoogleがお客様を見たことのある他のサイトに結びつけます。これにより、サイトとデバイスの両方における閲覧状況のプロフィールが構築され、さらにお客様が個人的にそのページとどのように関わっているかが分かります。<br></li>
	</ul>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/06/Screen-Shot-2022-06-07-at-10.24.12-AM.png" class="kg-image" alt="" loading="lazy"></figure>
	<p><br></p>
	<p>PATを使用する場合、デバイスデータは分離され、関係者(メーカーとCloudflare)間で明示的に交換されることはありません</p>
	<ul>
		<li>Webサイトが知るのは、接続を行うために必要なURLとIPだけです。</li>
		<li>デバイスメーカー(アテスター)は、お客様のデバイスを認証するために必要なデバイスデータだけは分かりますが、お客様が閲覧したWebサイトは分かりませんし、IPも分かりません。</li>
		<li>Cloudflareは、お客様が訪問したサイトは把握していますが、デバイスやインタラクションの情報は一切分かりません。<br></li>
	</ul>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/06/image3-2.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>当社は、このプロセスのために収集された基本的なデータを実際に必要としませんし、求めてもいません。ただ、訪問者がデバイスやユーザーエージェントを偽装しているのかどうかを検証したいだけです。プライベートアクセストークンは、基本的なデータを一切必要とせず、その検証状態を直接取得することを可能にします。これにより、重要なシグナルを直接見ることなく、その信憑性をより確信することができます。</p>
	<h3 id="--3">プライベートアクセストークンによるデータの区分け方法</h3>
	<p><a href="https://www.ietf.org/archive/id/draft-ietf-privacypass-auth-scheme-01.html#name-security-considerations" target="_blank">プライベートアクセストークン</a>では、四者が共通のフレームワークで協力して、匿名かつ偽造不可能なトークンを生成・交換することに合意しています。このプロセスに四者すべてが参加しなければ、PATは機能しません。</p>
	<ol>
		<li><strong>オリジン</strong>。クライアントからリクエストを受け取るWebサイト、アプリケーションまたはAPIです。Webサイトがオリジンへのリクエストを受け取ると、オリジンはリクエストを送信したクライアントからトークンを探して要求することを把握する必要があります。Cloudflareのお客様の場合、Cloudflareがオリジンとして(お客様の代わりに)トークンのリクエストと処理を行います。</li>
		<li><strong>クライアント</strong>。訪問者がオリジンにアクセスするために使用するツールです。これは通常、Webブラウザまたはモバイルアプリケーションです。当社の例では、クライアントを<a href="https://developer.apple.com/wwdc22/10077" target="_blank">モバイルSafariブラウザ</a>とします。</li>
		<li><strong>アテスター</strong>。アテスターは、トークンが発行される前に、クライアントが何か(たとえば、モバイル端末が有効なIMEIを持っていること)を証明するよう依頼する者です。下記の例では、デバイスのベンダーであるAppleがアテスターにあたります。</li>
		<li><strong>イシュアー</strong>。イシュア―はプロセスの中で唯一、実際にトークンを生成、または発行する者です。アテスターはオリジンが信頼するイシュア―にAPIコールを行い、イシュア―にトークンを生成するよう指示します。当社の場合、Cloudflareもまたイシュア―となります。<br></li>
	</ol>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/06/Screen-Shot-2022-06-07-at-2.01.38-PM.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>上記は、訪問者がiPhoneでSafariブラウザを開き、example.comにアクセスしようとした例です。</p>
	<ol>
		<li>例ではオリジンをホストするためにCloudflareを使用しているので、Cloudflareはブラウザにトークンを要求します。</li>
		<li>SafariはPATをサポートしているので、AppleのアテスターにAPIコールを行い、認証を依頼します。</li>
		<li>Appleのアテスターは様々なデバイスコンポーネントをチェックし、それらが有効であることを確認した後、CloudflareイシュアーにAPIコールを行います(オリジンとして動作するCloudflareはCloudflareイシュアーを使うことを選択するため)。</li>
		<li>Cloudflareイシュアーはトークンを生成してブラウザに送信し、ブラウザはそれをオリジンに送信します。</li>
		<li>Cloudflareはこのトークンを受け取り、このユーザーにCAPTCHAを表示する必要がないと判断するために使用します。<br></li>
	</ol>
	<p>少し複雑に聞こえるかもしれませんが、一番良いのは、このプロセスにおいて<em><strong>Webサイトは何もしていないことです。</strong></em>トークンの要求、検証、トークンの生成、受け渡し、これらすべてが、ユーザーとWebサイトの両方からは目に見えないサードパーティによって舞台裏で行われているのです。AppleとCloudflareが協力することで、このリクエストはより安全になり、やり取りされるデータは減少し、ユーザーがCAPTCHAを見る必要がなくなるのです。そして、ユーザーデータの収集と交換を従来よりも少なくすることで、これを実現しました。</p>
	<h3 id="--4">ほとんどのお客様は、プライベートアクセストークンの利用のために何もする必要がありません<br></h3>
	<p>PATを活用するには、ファイアウォールルールの応答オプションとして、従来のCAPTCHAではなくManaged Challengeを選択するだけでよいのです。Cloudflareのお客様の65%以上は、すでにこれを実践しています。当社のManaged Challengeプラットフォームは、すべてのリクエストに自動的にトークンを要求し、クライアントがプライベートアクセストークンに対応している場合は、トークンを受け取ります。iOSまたはmacOSのデバイスを使用している訪問者は、OSをアップグレードすると、自動的にCAPTCHAをより少なく表示するようになります。 <br></p>
	<p>当社にとって、これは最初のステップにすぎません。当社は、他のクライアントやデバイスメーカーにもPATフレームワークを利用してもらえるよう、積極的に働きかけています。新しいクライアントがPATフレームワークを利用し始めると、そのクライアントからお客様のサイトに来るトラフィックは自動的にトークンを要求するようになり、訪問者は自動的にCAPTCHAを見る回数が減ることになります。 <br></p>
	<p>近々、他のセキュリティ製品にもPATを組み込んでいく予定です。近い将来、いくつかの発表がありますので、ご期待ください。 <br></p>
</div>