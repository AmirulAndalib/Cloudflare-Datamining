<div class="mb2 gray5 ">9 分で読了</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/12/image5-31.png" class="kg-image" alt="CloudflareがZarazを買収し、サードパーティツールのクラウド搭載を可能に" loading="lazy"></figure>
	<p>CloudflareのZaraz買収とCloudflare Zaraz（ベータ版）のリリースを発表でき、嬉しく思います。本日リリースするのは、Cloudflareのシステムとダッシュボードに統合されたZaraz製品のベータ版です。これを使用することで、サードパーティツールをクラウド上で管理したり読み込んだりできるほか、スピード、プライバシー、セキュリティを大幅に改善できます。私たちは創業当初からWorkers、そしてCloudflareテクノロジーとネットワークに力を掛けてきました。ですから、Cloudflareの全てのお客様にZarazを無料で提供できることは、実に喜ばしいことです。既にCloudflareをご利用のお客様は、ダッシュボードで<a href="https://dash.cloudflare.com/?to=%2F%3Aaccount%2F%3Azone%2Fzaraz">Zarazアイコン</a>をクリックするだけで、サードパーティツールスタックの構成を開始できます。コードの変更は不要です。当社ではこれから２か月かけて引き続き機能をリリースし、このベータ版を製品版として完成していく予定です。</p>
	<p>これまでのタグマネージャーやカスタマーデータプラットフォームに別れを告げる時が来ています。それらは役割をよく果たしてくれましたが、Webが進化するにつれていくつか重大な問題の原因にもなってきました。その状況をCloudflareが解決します。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/12/image6-22.png" class="kg-image" alt="" loading="lazy"></figure>
	<h3 id="-">サードパーティツールの肥大化問題</h3>
	<p>Yo'avと私は、サードパーティツール実装の闘いの相対する立場で働いた後、Zarazを設立しました。私はマーケティングマネージャーやプロダクトマネージャーと共に働き、「あともう1つだけWebサイトに分析ツールを実装したい」という要望を聞くことがよくありました。一方、Yo'avは開発者で、パフォーマンスへの悪影響やセキュリティリスクを考慮してそうした要望に抵抗する側でした。</p>
	<p>私たちは、フラストレーションを抱える世界中のエンジニア数百人と話した後に、Zarazの設立を開始しました。事が一気に動いたのは、2020年の冬にY Combinatorに申し込んでからです。当時、私たちはまったく異なる製品に取り組んでいました。Web分析ツール用の品質保証(QA)ソフトウェアです。新たなお客様に向けて提案する機会があるたびに、そのお客様のサイトで読み込まれるツールのリストを見せました。同時に、そうしたツールに関連する実装バグのリストも見せました。そこで繰り返し聞いたのが、本来のQAソフトウェアとは関係のない、「なぜこれほど多くのサードパーティツールを読み込むのか？これらは遅延の原因にならないのか？SEOへの影響は？これらのツールの1つでもハッキングされた場合、ユーザーを保護する手立ては？」といった疑問です。品質保証を真剣に心配している人はいませんでした。エンジニアが尋ねたのは、サードパーティツールが原因で増え続けるパフォーマンスへの悪影響とセキュリティリスクについてでした。</p>
	<p>私たちは、それらの質問に明確に答えることはできませんでしたが、質問の裏に何かもっと大きなものが隠れているかもしれないということに気がつきました。そこで、ちょっと調査してみることにしたのです。ボットを作成し、米国で訪問者数上位5000ドメインをスキャンしました。サードパーティツールがある場合とない場合で読み込みの結果を比較すると、サードパーティツールがWebを平均40％も遅くしていることが判明しました。2010年代の半ば、Google<a href="https://analytics.googleblog.com/2012/10/google-tag-manager.html">がTag Managerをリリース</a>してから数年経った頃、エンジニアから頻繁に「Google Tag Manager（GTM）を追加するとWebサイトが遅くなるか」と尋ねられました。当時ははっきり答えられる人はいませんでした。Googleの公式回答は、GTMは非同期で読み込むため、ページの「ユーザーに見える部分」については読み込みの遅れはないはずだというものでした。しかし、その答えがまったく不正確だったことがわかりました。</p>
	<p>Googleはさらに高速なWebサイトのローンチへと市場を推し進めているにもかかわらず、自社のスタックが肥大化の原因となっていることがよくあります。Google PageSpeed Insightsを使った経験があれば、Googleが診断機能のセクションで自社ツールを問題だと指摘しているのに気づいたことがあるかもしれません。<a href="https://lighthouse-dot-webdotdevsite.appspot.com//lh/html?url=https%3A%2F%2Fshop.googlemerchandisestore.com%2F">Googleのツールスタック（GTM、Analytics、Ads、DoubleClickなど）</a>を主に使用するGoogle Merchandise Storeでさえ、サードパーティツールがメインスレッドを4秒前後ブロックします。GTM自体に起因するブロックは1秒以上です。顧客データプラットフォームの発明など、この分野の最新動向により今まで以上の第三者コードが評価・実行されて、事態はますます悪化しています。</p>
	<p><a href="https://almanac.httparchive.org/en/2021/third-parties#fig-4">2021年のウェブサイトの中央値</a>は、モバイルで21、デスクトップで23のサードパーティソリューションを使用していますが、<a href="https://almanac.httparchive.org/en/2021/third-parties#fig-4">90パーセンタイル</a>では、この数字はモバイルで89、デスクトップで91というショッキングな量に上昇します。何十ものサードパーティツールを読み込んだ瞬間に、あなたのウェブサイトは遅くなることでしょう。総ブロック時間(TBT)、インタラクティブ時間(TTI)など、重要な指標にダメージを与えることになります。これは、事実上、負け戦なのです。</p>
	<p>何もかもがオンラインで行われる時代には、速度が競争優位になります。デジタルを巡る現在の情勢では、より速いWebサイトが収益性で優れ、競合相手を打ち負かすのは必然的です。GoogleとDeloitteが公開した<a href="https://www2.deloitte.com/content/dam/Deloitte/ie/Documents/Consulting/Milliseconds_Make_Millions_report.pdf">最新データ</a>によれば、わずか0.1秒の読み込み時間の差がユーザーの操作の一つひとつに影響し、各種の産業で究極的には最高10％のコンバージョン率上昇につながり得ることが示されています。さらに、Googleが昨年、Core Web Vitals（SEOランキングを左右する速度を測定するメトリクス一式）を発表しました。</p>
	<p>このように複数のツールを使うと、Webサイトはサーバーセキュリティやプライバシーの脅威にも晒されます。たいていのツールはリモートJavaScriptリソースを必要とするため、お客様は自社のWebサイトで何が読み込まれているかを絶えず把握しておくことができません。しかも、多くのサードパーティツールは他のサードパーティリソースを呼び出したり、存在すら知られていないエンドポイントへHTTPリクエストをリダイレクトしたりします。こうした悪慣行がユーザーを悪意ある脅威に晒らし、プライバシーの倫理に違反することが多々あります。一般データ保護規則（GDPR）、カリフォルニア州消費者プライバシー法（CCPA）、その他の規制が採択されている状況下では、頭の痛い問題です。</p>
	<p>トレンドは、サードパーティ（特に広告とマーケティングのツール）の使い方が大きく変わる方向にあります。主流のブラウザは、第三者クッキーの使用に対して厳しい制限をビルトインで課しています。世間一般でも、プライバシーとユーザー同意の問題に関する懸念が高まっています。マーケティングや広告のツールが第三者クッキーの使用を止めざるを得なくなるのは時間の問題です。それなら、それらのAPIを開放してお客様のためにクラウドでの読み込みを可能にするのが合理的でしょう。企業はこの変化を遂げるために、使いやすいインフラストラクチャを導入する必要があります。このインフラは、高パフォーマンス確保のためにエンドユーザーにできるだけ近いところで実行する必要があり、エッジで構築するのがやはり合理的です。</p>
	<h3 id="zaraz-web-">ZarazでWebサイトをより速く、より安全に！</h3>
	<p>Zarazは、サードパーティツールの読み込みを最適化することによってWebサイトのパフォーマンスを大幅に改善します。当社でサポートするツールはそれぞれ少しずつ異なりますが、主旨は、クラウドのバックエンドで実行可能なものはすべて、ブラウザでなくクラウドバックエンドで実行することです。お客様はダッシュボードを使って、インタラクティブウィジェット、分析ツール、広告ツール、マーケティング自動化、CRMツールなど、どんなタイプの第三者製ソリューションでも実装できます。ベータ版には、お客様のWebサイトに統合可能な18種のサードパーティツールが入ったライブラリが含まれています。数回のクリックで、ツール全体をクラウド上で読み込めるようになります。エンドユーザーのブラウザ上でJavaScriptを実行する必要はありません。この独自技術の詳細については、当社CTOのYo'av Mosheが書いた<a href="https://blog.cloudflare.com/zaraz-use-workers-to-make-third-party-tools-secure-and-fast">ブログ記事</a>をご覧ください。</p>
	<p>サードパーティスクリプトの実行をブラウザから分離すると、ページ読み込み時間が大幅に変化します。これは単に、ブラウザで実行されるコードが少ないからです。また、意図せずにサードパーティベンダーに渡してしまいがちな個人識別情報（PII）、保護対象医療情報（PHI）、その他の機密情報を保護するセキュリティと制御のレイヤーがもう一層追加されます。そして、サイトに何らかの第三者リソースが含まれている場合に関しては、Cloudflareが本日、お客様のWebサイトを潜在的リスクから保護するソリューション<a href="https://blog.cloudflare.com/page-shield-generally-available">PageShield</a>を発表します。これら2つの製品は、サードパーティがもたらすセキュリティとプライバシーへの脅威に対して、総合的なソリューションを提供します。</p>
	<p>より複雑な統合のテストを計画しているお客様向けに、イベントAPIを用意しているほか、事前設定された変数もご利用いただけます。これにより、Webサイトでのコンバージョン率や実行されたあらゆるアクションを背景情報とともに測定できます。Googleタグ マネージャーを現在利用されている方には、朗報があります。Zarazはすぐに使用できるdataLayerの後方互換性を備えています。Googleタグ マネージャーからZarazへの切り替えは容易で、コードベースでの変更は一切不要です。また、近い将来、現在のGoogleタグ マネージャーの設定をZarazへ簡単にインポートできるようにする予定です。</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/12/image3-43.png" class="kg-image" alt="" loading="lazy"></figure>
	<h3 id="instacart-0-zaraz-">Instacartはブロック時間0ミリ秒を実現し、Zarazと共にセキュリティを強化</h3>
	<blockquote>「InstacartはZarazを使って、サイト全体で必要な変更は最小限に抑えながら、Shopper固有のドメインのパフォーマンスを大幅に改善することができました。<a href="https://shoppers.instacart.com">https://shoppers.instacart.com/</a>をさまざまに最適化しましたが、パフォーマンスへの影響という面で次に取り組むべき問題はサードパーティツールだとわかりました。Zarazでサードパーティツールの読み込み時間を最適化し、Cloudflare Workersでサブドメインの統合を維持し、可視性とセキュリティの制御も維持することができました。」<br>- <strong>Marc Barry氏</strong>、Instacart、 Cloud Foundations スタッフソフトウェアエンジニア</blockquote>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/12/image2-62.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>Zarazを使うことのメリットを語るなら、既存のお客様以上の適任者はないでしょう。北米有数の食料品買い物代行・宅配オンラインプラットフォームであるInstacartは、自社ドメイン<a href="https://shoppers.instacart.com">shoppers.instacart.com</a>でZarazを試すことを決めました。目的は2つ。セキュリティとプライバシー保護の強化と、ページ表示速度（具体的には合計ブロック時間）の改善です。</p>
	<p>セキュリティとプライバシーに関しては、Zarazがエンドユーザーに関する情報を一切保存せず、単にパイプラインとして機能するのがデフォルトであるという事実が、試用を決断する重要要因でした。そして、サードパーティスクリプトがブラウザ上で直接実行されないようにすることで、サードパーティツールの使用に関連するセキュリティリスクを軽減しようとしたのです。Instacartは制御を強化するため、shoppers.instacart.comのサブドメインを通じてZarazサービスが送受信するすべてのリクエストを、Cloudflare Workersを使ってプロキシすることにしました。　これにより、Zaraz自体を含め、第三者へデータを送るプロセスが完全に可視化され、制御が効くようになります。</p>
	<p>Instacartは世界で最もテクノロジーに精通した企業の1つで、Shoppersのサブドメインは元々、他社のWebサイトに比べてかなり高速でした。これまでにも、速度メトリクスの改善策を多々実施しており、残る遅延の主原因はサードパーティスクリプトという段階に達していました。</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2021/12/image1-89.png" class="kg-image" alt="Speed metrics improvements measured on https://shoppers.instacart.com/, before and after implementing Zaraz. Measured on Mobile, US East." loading="lazy"></figure>
	<p>上のグラフが示す通り、Zarazのローンチによりモバイル端末のページ速度が大幅に改善しました。合計ブロック時間（TBT）は500ミリ秒から0ミリ秒になり、対話時間（TTI）は63%改善されて11.8秒から4.26秒に短縮されました。CPU時間は60%改善されて、3.62秒から1.45秒に短縮されました。JavaScriptは63%軽量化され、448 KBから165 KBへ圧縮されました。</p>
	<figure class="kg-card kg-image-card kg-width-wide"><img src="https://blog.cloudflare.com/content/images/2021/12/image4-36.png" class="kg-image" alt="Speed metrics improvements measured on https://shoppers.instacart.com/, before and after implementing Zaraz. Measured on Desktop, US East." loading="lazy"></figure>
	<p>デスクトップについても大幅な改善が見られました。合計ブロック時間は65ミリ秒から0ミリ秒へ短縮され、対話時間は23%改善されて1.64秒から1.26秒へ短縮されました。CPU時間は55%改善され、1.57秒から0.7秒へ短縮されました。JavaScriptの軽量化については、モバイル端末と同じく448 KBから165 KBへ改善されました。</p>
	<p>Instacartのようにツールをクラウドへオフロードしする業界リーダーが増えれば、SaaSベンダーやスタートアップ企業の大半がサーバーサイド統合をエッジで実行する完全なソリューションとして構築し始めるのも時間の問題です。サードパーティベンダーは決して害を及ぼそうとしていたのではありません。単に、スケーラブルな統合機能をエッジで構築するツールを持っていなかっただけです。当社はInstacartと共に、いくつかのベンダーと直接接触し、協力して最適化されたソリューションを追求するという機会を得ました。当社はこれからもSaaS企業やベンダーとの協業に尽力し、エッジで簡単にソリューションを構築できる手段を提供していきます。今後の動きにご注目ください。</p>
	<h3 id="-zaraz-">プラットフォームとしてのZarazの未来</h3>
	<p>本日は当社史上、重要なマイルストーンです。当社のチームはポルトガルにあるCloudflareのオフィスに移り、引き続きZarazの製品開発を主導します。Cloudflareの一部として、Zarazを、サードパーティベンダーがツールを容易に構築し、Cloudflareグローバルネットワークの能力を活用することができるプラットフォームにしていきます。当社は、第三者製ツールのサーバーサイド読み込みが普及するよう業界全体を先導し、誰もがより良く、より速く、より安全な製品を簡単に作れるようにします。</p>
	<p>ZarazはCloudflareの傘下に入る前からWorkersで稼働していたため、統合はシンプルで迅速に進みました。その結果、新機能の構築にすばやく取り掛かり、完全なサービスにして一般公開することができます。Cloudflare独自の社内能力のおかげで、Zarazの堅牢性を高め、新たなお客様のオンボーディングのプロセスをシンプルにすることができます。既に実現した著しい改善は、Cloudflareのお客様が何らコード変更する必要なくZarazを使えるようにしたことです。いったんトグルボタンをオンにすれば、当社のスクリプトがHTMLの&lt;head&gt;に直接埋め込まれます。もう1つの嬉しい成果は、サービス全体をお客様自身のドメインで実行できるようにしたことです。</p>
	<p>さらに、Cloudflareの専門知識を活かして機能セットを拡張し、サードパーティコードによるさらなるセキュリティ脅威やプライバシー侵害リスクにお客様が対処できるよう支援していく計画です。その一例が、ジオロケーショントリガーを追加して、世界の異なる地域からお客様のWebサイトを訪問するエンドユーザーに対し、異なるツールの読み込みを可能にすることです。これは、規制の違いに対処してコンプライアンスを確保するために必要です。もう一つの例は、DLP（Data Loss Prevention）機能で、これは現在、当社のいくつかの企業顧客に使用されているものです。DLP機能は、サードパーティのエンドポイントに向かうすべてのリクエストをスキャンし、名前、電子メールアドレス、SSNなどの機密情報が含まれていないことを確認する機能です。このほかにも、さまざまな機能を開発中です。</p>
	<p>Cloudflareのような影響力の大きい企業の力を借りて、市場のポジティブな変革を推し進め、ベンダーがエッジコンピューティングで構築するように、企業がクラウドでの読み込みを採用するように推めていきます。当社のSDKを拡張して、すべてのサードパーティベンダーが当社のプラットフォーム上で統合機能を構築し、Workersを使ってエッジでソリューションを簡単に実行できるようにする予定です。Cloudflareと共に、サードパーティコードのクラウド上での読み込みへ向けた変革で主導的役割を果たしていきます。タグマネージャーやカスタマーデータプラットフォームと決別する時が来ました。本日の発表は一時代の終わりを告げるものです。まもなく、私たちは皆、Webサイトがサードパーティツールを読み込む方法を最適化するだけで、40％速いブラウジングエクスペリエンスを楽しめるようになります。</p>
	<p>世界中の数百万ものCloudflareユーザーにZarazを提供することで、当社は「インターネットを誰にとってもより速く、より安全なものにする」という目標に一歩近づきます。当社では、規模を問わずどのWebサイトでも、分析ツールやチャットボット、その他の第三者製ツールの使用によってユーザーエクスペリエンスを劣化させてはならないと考えています。それらのツールはユーザーエクスペリエンスを<em>向上</em>させるべきであって、損なってはなりません。Web全体が第三者製ツールをクラウド上で読み込むようになり、ブラウザを解放して本来の仕事であるWebサイトの読み込みができるようにするまで、当社は弛まず努力します。そうした未来を築くことにワクワクしています。必ず実現させます。</p>
	<p>無料のベータ版を試されたい方は、<a href="https://dash.cloudflare.com/?to=%2F%3Aaccount%2F%3Azone%2Fzaraz">こちらをクリック</a>してください。追加要件やカスタム要件がおありの企業の方は、<a href="https://www.cloudflare.com/en-gb/cloudflare-zaraz-third-party-tool-manager-waitlist">こちらをクリック</a>して順番待ちリストにご登録ください。当社のDiscordチャンネルへのご登録は、<a href="https://discord.gg/cGDT6PdVyd">こちらをクリック</a>してください。</p>
</div>