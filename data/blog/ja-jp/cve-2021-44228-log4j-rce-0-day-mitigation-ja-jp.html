<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/12/image1-52.png" class="kg-image"></figure>
	<p><em>更新情報：3つのWAFルールすべてに、デフォルトのアクションとして ブロック が設定されました。</em></p>
	<p>人気の高い <a href="https://logging.apache.org/log4j/2.x/index.html" target="_blank"> &nbsp;Apache Log4j ユーティリティ</a> &nbsp;(<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228" target="_blank"> &nbsp;CVE-2021-44228</a> &nbsp;)に影響を与えるゼロデイエクスプロイトが2021年12月9日に公開され、リモートコード実行（RCE）に至ります。</p>
	<p>この脆弱性は積極的に悪用されており、Log4jを使用しているすべてのユーザーは、できるだけ早くバージョン2.15.0にアップデートする必要があります。最新のバージョンは、<a href="https://logging.apache.org/log4j/2.x/download.html" target="_blank"> &nbsp;Log4j のダウンロードページ</a> &nbsp;ですでに確認できます。</p>
	<p>最新バージョンへのアップデートが不可能な場合、クラスパスからJndiLookupクラスを削除することで、この脆弱性を軽減できます。さらに、Log4j バージョン2.10およびそれ以降では、システムプロパティ &nbsp;log4j2.formatMsgNoLookups または &nbsp;LOG4J_FORMAT_MSG_NO_LOOKUPS 環境変数を &nbsp;true に設定することで、この問題を軽減できます。</p>
	<p>また、Cloudflare WAFをご利用のお客様は、新たに導入された3つのルールを活用することで、悪用される可能性を軽減することができます。</p>
	<!--kg-card-begin: markdown-->
	<table>
		<thead>
			<tr>
				<th>ルールID</th>
				<th>説明</th>
				<th>デフォルトアクション</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td><code>100514</code> (旧バージョンのWAF)<br><code>6b1cc72dff9746469d4695a474430f12</code> (新しいWAF)</td>
				<td>Log4jのヘッダ</td>
				<td><code>BLOCK</code></td>
			</tr>
			<tr>
				<td><code>100515</code> (旧バージョンのWAF)<br><code>0c054d4e4dd5455c9ff8f01efe5abb10</code> (新しいWAF)</td>
				<td>Log4jのボディ</td>
				<td><code>BLOCK</code></td>
			</tr>
			<tr>
				<td><code>100516</code> (旧バージョンのWAF)<br><code>5f6744fa026a4638bda5b3d7d5e015dd</code> (新しいWAF)</td>
				<td>Log4jのURL</td>
				<td><code>BLOCK</code></td>
			</tr>
		</tbody>
	</table>
	<!--kg-card-end: markdown-->
	<p>この軽減措置は、HTTPヘッダー、ボディ、URLをそれぞれ検査する3つのルールに分かれています。</p>
	<p>引き続き状況を確認しており、WAFで管理されているルールを適宜更新していきます。</p>
	<p>脆弱性の詳細については、公式の <a href="https://logging.apache.org/log4j/2.x/security.html" target="_blank"> &nbsp;Log4j のセキュリティページ</a> &nbsp;に記載されています。</p>
	<h3 id="-"><strong>影響の対象</strong></h3>
	<p>Log4jは、Apache Software Foundationが管理する、Javaベースの強力なロギングライブラリです。</p>
	<p>すべての Log4j 2.0-beta9 から 2.14.1 までのバージョンにおいて、構成、ログメッセージ、およびパラメータで使用される JNDI 機能は、攻撃者に悪用され、リモートでコードが実行される可能性があります。具体的には、ログメッセージやログメッセージのパラメーターを制御できる攻撃者は、メッセージのルックアップ置換が有効な場合、LDAP サーバーから読み込んだ任意のコードを実行できます。</p>
</div>