<div class="mb2 gray5">7 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/12/http3-tube@2x-2.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>HTTPは30年以上も前からWebの基盤であり、ブラウジングや動画視聴、音楽鑑賞だけでなく、アプリやマシン間通信、さらには他のプロトコルを構築するための基盤として、インターネットの砂時計図における「第二の腰部」とも呼ばれるほど、インターネットにおいて最も人気のあるプロトコルの1つとなっています。</p>
	<p>HTTPがこれほど成功した理由は何でしょうか？1つの答えは、アプリケーションプロトコルを必要とするほとんどのアプリケーションの「スイートスポット」を突いていることです。「<a href="https://httpwg.org/specs/rfc9205.html" target="_blank">Building Protocols with HTTP</a>」（HTTPによるプロトコルの構築」（2022年に最良の現行の実践RFCとして<a href="https://httpwg.org" target="_blank">HTTPワーキンググループ</a>が発行）は、HTTPの成功は次のような要因に起因すると論じています。</p>
	<p>- 実装者、仕様策定者、管理者、開発者、利用者に親しまれている<br>- クライアント、サーバー、プロキシなど様々な実装が可能である<br>- 使いやすさ<br>- Webブラウザの可用性<br>- 認証や暗号化などの既存の仕組みを再利用できる<br>- ターゲット環境におけるHTTPサーバーとクライアントの存在<br>- ファイアウォールを通過する能力</p>
	<p>もう一つの重要な要素は、HTTPを使用し、実装し、標準化する人々のコミュニティです。私たちは、プロトコルの相互運用性と今日のニーズを満たすために、積極的にプロトコルの維持と開発に協力しています。HTTPが停滞すれば、別のプロトコルが（当然のことながら）それに取って代わり、コミュニティの投資、理解の共有、相互運用性のすべてを失うことになるでしょう。</p>
	<p>Cloudflareや他の多くの企業は、エンジニアを派遣して、<a href="https://blog.cloudflare.com/cloudflare-and-the-ietf">IETF</a>に参加しています。ここでは、ほとんどのインターネットプロトコルが議論され、標準化されています。また、<a href="https://httpwork.shop" target="_blank">HTTPワークショップ</a>のようなコミュニティのイベントにも参加し、スポンサーとなって、人々がどんな問題を抱えていて、何を必要としているかを話し合い、どんな変更が彼らを助けることができるかを理解するようにしています。</p>
	<p>では、2022年に開催されたワーキンググループ会議、仕様書、サイドイベントなどでは何が起こったのでしょうか？Webのプロトコルの実装者、展開者は何をしているのでしょうか？そして、次に来るのは？</p>
	<h3 id="-http-3">新しい仕様：HTTP/3</h3>
	<p>仕様面では、2022年にHTTP/3が公開されたことが最大の出来事でした。これは、ネットワークをより効率的に利用してWebパフォーマンスをブロックしないことで、最新のアプリケーションやサイトの要件に対応するための大きな一歩となったからです。</p>
	<p>90年代当時、HTTP/0.9とHTTP/1.0はリクエストのたびに新しいTCPコネクションを使用しており、ネットワークの使用効率が驚くほど悪かったのです。HTTP/1.1は持続的な接続を導入しました（これは「Connection: Keep-Alive」ヘッダーとともにHTTP/1.0に遡って実装されました）。これは、サーバーとネットワークがWebの爆発的な普及に対処するのに役立った改良でしたが、当時から、業界はこの技術には大きな限界、特に、ヘッドオブラインブロッキング（1つの接続で1つのリクエストが完了すると、他のリクエストがブロックされる現象）があることがわかっていました。</p>
	<p>これは、90年代から2000年代初頭にかけてはあまり問題になりませんでしたが、今日のWebページやアプリケーションは、これらの制限をパフォーマンス上重要なものにするような要求をネットワークに突きつけています。ページには何百ものアセットがあり、それらがすべてネットワークリソースを奪い合うことがよくありますが、HTTP/1.1はそのタスクに対応できていなかったのです。いくつかの<a href="https://www.w3.org/Protocols/HTTP-NG" target="_blank">誤ったスタート</a>を切った後、コミュニティはついに<a href="https://blog.cloudflare.com/http-2-for-web-developers">2015年にHTTP/2でこれらの問題に対処しました</a>。</p>
	<p>しかし、HTTPのヘッドオブラインブロッキングを解除すると、1層下のTCPでも同じ問題が発生することがわかりました。TCPは順次配信の信頼性の高いプロトコルであるため、フローの中の1つのパケットが失われると、それ以降のパケットがOSのバッファに格納されていたとしても、アクセスを遮断する可能性があります。これは、HTTP/2の展開、特に最適でないネットワーク上での展開において問題となることが明らかになりました。</p>
	<p>もちろん、その答えは、TCP-インターネットの多くがその上に構築されている由緒あるトランスポートプロトコルを置き換えることでした。<a href="https://quicwg.org" target="_blank">QUICワーキンググループ</a>で多くの議論と草案の提出がなされた後、<a href="https://blog.cloudflare.com/quic-version-1-is-live-on-cloudflare">QUICバージョン1がその置き換えとして発行されました</a>。</p>
	<p>HTTP/3は、QUICを使用するHTTPのバージョンです。ワーキンググループはQUICとともに2021年に事実上終了しましたが、その公開は他の文書の公開と同期させるため2022年まで保留されました（下記参照）。2022年は、<a href="https://blog.cloudflare.com/cloudflare-view-http3-usage">HTTP/3の展開にとってマイルストーンの年でもありました</a>。Cloudflareでは<a href="https://radar.cloudflare.com/adoption-and-usage?range=28d" target="_blank">新しいプロトコルの採用と信頼が高まっていることを確認しました</a>。</p>
	<p>HTTP/2とHTTP/3の間には数年の短いギャップしかありませんでしたが、コミュニティではすぐにHTTP/4に取り組もうという意欲はあまり感じられません。QUICとHTTP/3はどちらも新しいプロトコルであり、どのように実装し、どのように運用し、どのようにサイトやアプリケーションを構築するのがベストなのか、世界はまだ学んでいる最中でもあるのです。将来的に新しいバージョンが必要になる可能性は否定できませんが、IETFは最新のネットワークに関する幅広い業界経験に基づいてこれらのプロトコルを構築しており、必要な変更を容易にするための重要な拡張性を備えています。</p>
	<h3 id="-http-core">新しい仕様です：HTTP "core"</h3>
	<p>2022年のHTTP仕様のもう1つの注目すべきイベントは、HTTPの仕様の中心となる「core」ドキュメントの公開でした。<a href="https://httpwg.org/specs/rfc9110.html" target="_blank">HTTP Semantics（セマンティクス）</a>－メソッド、ヘッダー、ステータスコードおよびメッセージフォーマットなど。<a href="https://httpwg.org/specs/rfc9111.html" target="_blank">HTTP Caching</a>－HTTPのキャッシュの仕組み。<a href="https://httpwg.org/specs/rfc9112.html" target="_blank">HTTP/1.1</a>－誰もが知っていて好きなフォーマットを使って、Semanticsをワイヤーにマッピングする。</p>
	<p>さらに、<a href="https://httpwg.org/specs/rfc9113.html" target="_blank">HTTP/2が再発行され、</a>セマンティクス文書と適切に統合し、いくつかの未解決の問題が修正されました。</p>
	<p>これは、これらの文書の長い一連の改訂の中で最新のものです。過去には、RFC 723xシリーズ、（おそらく最もよく知られている）RFC 2616、RFC 2068、そしてすべての祖先であるRFC 1945があります。改訂のたびに、読みやすさの向上、誤りの修正、概念の説明、プロトコルの動作の明確化などを目指してきました。仕様の悪い（または実装された）機能は非推奨とし、プロトコルの動作を改善する新しい機能を追加しています。詳細については、各ドキュメントの付録の「変更点（Changes from...）」をご覧ください。そして、重要なことは、古いRFCはもう時代遅れのため、常に上記のリンク先の最新改訂版を参照することです。</p>
	<h3 id="early-hints-">Early Hintsのデプロイ</h3>
	<p>HTTP/2には<em>server push</em>という機能が含まれています。これは、クライアントが何かを必要とすることがわかっているときに、サーバーがリクエストとレスポンスのペアをクライアントに「プッシュ」できるように設計されており、リクエストを行いレスポンスを待つというレイテンシーのペナルティを回避できるようにするものです。</p>
	<p>2015年にHTTP/2が完成した後、Cloudflareや他の多くのHTTP実装は、すぐに<a href="https://blog.cloudflare.com/announcing-support-for-http-2-server-push-2">server pushを展開し</a>、大きなパフォーマンスの勝利を期待しました。残念なことに、これは想定よりも困難であることが判明しました。server pushは、クライアントが送信するリクエストだけでなく、ネットワークの状態も含めて、サーバーが未来を予測することを効果的に必要とします。そして、サーバーがそれを誤ると（「オーバープッシュ」）、プッシュされたリクエストはブラウザが行っている実際のリクエストと直接競合し、パフォーマンスを助けるというよりむしろ害を与える可能性のある重大な機会コストとなります。ブラウザがすでにキャッシュにコピーを持っていて、プッシュをまったく必要としない場合、その影響はさらにひどくなります。</p>
	<p>その結果、<a href="https://developer.chrome.com/blog/removing-push" target="_blank">Chromeは2022年にHTTP/2 server pushを削除しました</a>。他のブラウザやサーバーはまだサポートしているかもしれませんが、コミュニティは、現状ではブラウザ通知専用の<a href="https://www.rfc-editor.org/rfc/rfc8030.html" target="_blank">Web Pushプロトコル</a>のような特殊な用途にしか適さないということで意見が一致しているようです。</p>
	<p>とはいえ、あきらめたわけではありません。<a href="https://httpwg.org/specs/rfc8297.html" target="_blank">103（Early Hints）</a>ステータスコードは、2017年にHTTPワーキンググループによって実験的RFCとして公開されました。これは、サーバーが「本当の」最終レスポンスの前に、非最終レスポンスで<em>ヒント</em>をブラウザに送信することを可能にします。これは、コンテンツにブラウザが取得するリソースへのリンクがいくつか含まれることがわかっているが、クライアントへのレスポンスの取得に時間が必要な場合（生成に時間がかかるため、またはCDNが行うように、サーバーがどこかから取得する必要があるため）に便利です。</p>
	<p>Early Hintsは、server pushが設計された多くの状況で使用できます。例えば、ページが読み込む必要のあるCSSやJavaScriptがある場合です。理論的には、server pushほど最適ではありません。なぜなら、未処理のリクエストがあるときだけヒントを送ることができ、ヒントをクライアントに送って処理するまでに多少の遅延が生じるからです。</p>
	<p>しかし実際には、Cloudflareと当社のパートナー（ShopifyやGoogleなど）は2022年をかけてEarly Hintsを実験し、より安全に使用できることを確認しました。Early Hintsでは、主なウェブパフォーマンス指標の大幅な削減を含む<a href="https://blog.cloudflare.com/early-hints-performance">パフォーマンス上の利点が期待できます</a>。</p>
	<p><a href="https://blog.cloudflare.com/early-hints-on-cloudflare-pages">Cloudflare Pagesに統合</a>するほど、私たちはEarly Hintsが示す可能性に興奮しています。また、このプロトコルの新機能を使ってパフォーマンスを向上させる新しい方法を評価しています。</p>
	<h3 id="-">プライバシーを重視した仲介</h3>
	<p>2022年のHTTPプロトコル拡張の中で最もエキサイティングだったのは、プロキシ、ゲートウェイ、および同様のコンポーネントをプロトコルに挿入して特定の目標を達成する機能、つまり多くの場合プライバシーの向上に焦点を当てた仲介機能でした。</p>
	<p><a href="https://ietf-wg-masque.github.io" target="_blank">MASQUEワーキンググループ</a>などは、HTTPに新しいトンネリング機能を追加するための取り組みであり、仲介者がトンネリングしたトラフィックを別のサーバーに渡すことができるようにしようとしています。</p>
	<p>CONNECTは以前からTCPトンネルを可能にしていましたが、MASQUEは<a href="https://datatracker.ietf.org/doc/html/rfc9298" target="_blank">UDPトンネル</a>を可能にし、QUICやHTTP/3を含む、より効率的にトンネルできるプロトコルを増やしています。</p>
	<p>Cloudflareでは、Appleと協力してMASQUEを使用し、<a href="https://blog.cloudflare.com/icloud-private-relay">iCloud Private Relay</a>を実装し、1社だけに頼ることなく彼らの顧客のプライバシーを強化できることを熱烈に歓迎しています。また、MASQUEベースのVPNを可能にする<a href="https://blog.cloudflare.com/unlocking-quic-proxying-potential">IPトンネリング</a>など、ワーキンググループの今後の活動にも大きな関心を持っています。</p>
	<p>仲介に焦点を当てたもうひとつの仕様は、<a href="https://www.ietf.org/archive/id/draft-ietf-ohai-ohttp-06.html" target="_blank">Oblivious HTTP</a>（OHTTP）です。OHTTPは、サーバーがコネクションやIPアドレスを使用してクライアントを追跡することを防ぐために、一連の仲介者を使用し、遠隔測定やその他の機密データを収集するような場合に、より高いプライバシー保証を提供します。この仕様は標準化プロセスを終えたばかりですが、私たちはこの仕様を使って重要な新製品、<a href="https://blog.cloudflare.com/building-privacy-into-internet-standards-and-how-to-make-your-app-more-private-today">Privacy Gateway</a>を構築し、当社の顧客のプライバシーを保護しています。</p>
	<p>私たちをはじめ、インターネットコミュニティの多くの人たちは、これがまさに始まったばかりだと考えています。なぜなら、仲介はコミュニケーションを仕切り、<a href="https://intarchboard.github.io/draft-obliviousness/draft-kpw-iab-privacy-partitioning.html" target="_blank">プライバシーを改善するための貴重なツールになるからです</a>。</p>
	<h3 id="--1">プロトコルの安全性</h3>
	<p>最後に、2022年はHTTPのセキュリティ関連の側面で多くの取り組みが行われました。<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-digest-headers.html" target="_blank">Digest Fields</a>仕様は、今では古くなった「Digest」ヘッダーフィールドを更新し、メッセージに整合性ダイジェストを追加できるようにしたものです。<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-message-signatures.html" target="_blank">HTTP Message Signatures</a>仕様はリクエストとレスポンスに暗号署名を可能にするものです。これはアドホックに広く展開されているものですが、今までは標準がありませんでした。どちらの仕様も標準化の最終段階にあります。</p>
	<p><a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-rfc6265bis.html" target="_blank">Cookie仕様の改訂</a>も2022年に多くの進展があり、間もなく最終版になるはずです。すぐに完全になくすことはできないので、新しい「SameSite」属性など、プライバシーとセキュリティを向上させるために、操作方法を制限するための多くの取り組みが行われました。</p>
	<p>Cloudflareが<a href="https://blog.cloudflare.com/cloudflare-supports-privacy-pass">長年にわたって投資してきた</a>セキュリティ関連の仕様のもう一つのセットは<a href="https://www.ietf.org/archive/id/draft-ietf-privacypass-architecture-09.html" target="_blank">プライバシーパス</a>（プライベートアクセストークン）です。これは暗号化されたトークンで、クライアントがボットではなく本物の人間であることを、邪魔なCAPTCHAを使わずに、またユーザーのオンラインでの行動を追跡することなく保証することができるものです。これはHTTPでは、<a href="https://www.ietf.org/archive/id/draft-ietf-privacypass-auth-scheme-07.html" target="_blank">新しい認証スキーム</a>の形式をとります。</p>
	<p>プライバシーパスはまだ標準化プロセスを完全に経てはいませんが、2022年には<a href="https://blog.cloudflare.com/ja-jp/eliminating-captchas-on-iphones-and-macs-using-new-standard-ja-jp">Appleによる広範な展開</a>が見られ、大きな前進となりました。また<a href="https://blog.cloudflare.com/ja-jp/turnstile-private-captcha-alternative-ja-jp">CloudflareはCAPTCHAの代替手段としてTurnstileでプライバシーパスを使用している</a>ため、ユーザーは今日より良いエクスペリエンスを得ることができます。</p>
	<h3 id="2023-">2023年はどうでしょうか？</h3>
	<p>さて、次は何でしょうか？<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-safe-method-w-body.html" target="_blank">QUERYメソッド</a>（GETと同じだがボディがある）、<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-resumable-upload.html" target="_blank">Resumable Upload</a>（<a href="https://tus.io" target="_blank">tus</a>に基づく）、<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-variants.html" target="_blank">Variants</a>（キャッシュ用の改良型Varyヘッダー）、<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-sfbis.html" target="_blank">Structured Fields</a>（新しい日付タイプを含む）、および<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-retrofit.html" target="_blank">既存のヘッダーをStructured Fieldsに後付けする方法</a>など、いくつかの取り組みが進行中です。これらについては、2023年に進展があれば、また書きたいと思います。</p>
	<p><a href="https://github.com/HTTPWorkshop/workshop2022/blob/main/report.md" target="_blank">2022年のHTTPワークショップ</a>では、コミュニティはプロトコルを改善するためにどのような新しい作業を引き受けることができるかについても話しました。議論されたいくつかのアイデアには、共有プロトコルテストインフラストラクチャの改善（現在、<a href="https://github.com/httpwg/wiki/wiki/HTTP-Testing-Resources" target="_blank">いくつかのリソース</a>がありますが、はるかに優れている可能性があります）、よりインテリジェントで正確な接続管理をするための<a href="https://httpwg.org/specs/rfc7838.html" target="_blank">代替サービス</a>の改善（または置き換え）、そして<a href="https://mnot.github.io/I-D/draft-nottingham-binary-structured-headers.html" target="_blank">ヘッダーの代替バイナリシリアル化</a>のような根本的な変更を含んでいます。</p>
	<p>また、HTTPがpub/subに対応すべきか、あるいはWebSocket（将来的にWebTransport）上で動作するように標準化すべきかについて、コミュニティで継続的に議論が行われています。今すぐというわけにはいきませんが、最近始まった<a href="https://datatracker.ietf.org/group/moq/about" target="_blank">Media over QUIC</a>は、これを推進する機会を提供してくれるかも<em>しれません</em>。</p>
	<p>もちろん、それがすべてではありませんし、2023年（以降）のHTTPがどうなるかは未知数です。HTTPは、史上最大の分散型ハイパーテキストシステムであるWorld Wide Webと互換性を保ちながら、今もなお進化を続けています。</p>
</div>