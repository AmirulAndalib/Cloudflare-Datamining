<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/09/image1-69.png" class="kg-image" alt="Private by design: building privacy-preserving products with Cloudflare's Privacy Edge"></figure>
	<p>When Cloudflare was founded, our value proposition had three pillars: more secure, more reliable, and more performant. Over time, we’ve realized that a better Internet is also a more private Internet, and we want to play a role in building it.</p>
	<p>User awareness and expectations of and for privacy are higher than ever, but we believe that application developers and platforms shouldn’t have to start from scratch. We’re excited to introduce Privacy Edge – Code Auditability, Privacy Gateway, Privacy Proxy, and Cooperative Analytics – a suite of products that make it easy for site owners and developers to build privacy into their products, by default.</p>
	<h3 id="building-network-level-privacy-into-the-foundations-of-app-infrastructure">Building network-level privacy into the foundations of app infrastructure</h3>
	<p>As you’re browsing the web every day, information from the networks and apps you use can expose more information than you intend. When accumulated over time, <a href="https://coveryourtracks.eff.org/" target="_blank">identifiers</a> like your IP address, cookies, browser and device characteristics create a unique profile that can be used to track your browsing activity. We don’t think this status quo is right for the Internet, or that consumers should have to understand the complex ecosystem of third-party trackers to maintain privacy. Instead, we’ve been working on technologies that encourage and enable website operators and app developers to build privacy into their products at the protocol level.</p>
	<p>Getting privacy right is hard. We figured we’d start in the area we know best: building privacy into our network infrastructure. Like other work we’ve done in this space – offering free <a href="https://blog.cloudflare.com/introducing-universal-ssl/">SSL certificates</a> to make encrypted HTTP requests the norm, and <a href="https://blog.cloudflare.com/announcing-1111/">launching 1.1.1.1</a>, a privacy-respecting DNS resolver, for example – the products we’re announcing today are built upon the foundations of open Internet standards, many of which are co-authored by members of our <a href="https://research.cloudflare.com/" target="_blank">Research Team</a>.</p>
	<p>Privacy Edge – the collection of products we’re announcing today, includes:</p>
	<ul>
		<li><strong>Privacy Gateway:</strong> A lightweight proxy that encrypts request data and forwards it through an IP-blinding relay</li>
		<li><strong>Code Auditability:</strong> A solution to verifying that code delivered in your browser hasn’t been tampered with</li>
		<li><strong>Private Proxy: </strong>A proxy that offers the protection of a VPN, built natively into application architecture</li>
		<li><strong>Cooperative Analytics:</strong> A multi-party computation approach to measurement and analytics based on an emerging distributed aggregation protocol.</li>
	</ul>
	<p>Today’s announcement of Privacy Edge isn’t exhaustive. We’re continuing to explore, research and develop new privacy-enabling technologies, and we’re excited about all of them.</p>
	<h3 id="privacy-gateway-ip-address-privacy-for-your-users">Privacy Gateway: IP address privacy for your users</h3>
	<p>There are situations in which applications only need to receive certain HTTP requests for app functionality, but linking that data with who or where it came from creates a privacy concern.</p>
	<p>We recently partnered with <a href="https://www.theverge.com/2022/9/14/23351957/flo-period-tracker-privacy-anonymous-mode" target="_blank">Flo Health</a>, a period tracking app, to solve exactly that privacy concern: for users that have turned on “Anonymous mode,” Flo encrypts and forwards traffic through Privacy Gateway so that the network-level request information (most importantly, users’ IP addresses) are replaced by the Cloudflare network.</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2022/09/image2-60.png" class="kg-image">
		<figcaption>How data is encapsulated, forwarded, and decapsulated in the Privacy Gateway system.</figcaption>
	</figure>
	<p>So how does it work? <strong>Privacy Gateway</strong> is based on Oblivious HTTP, an <a href="https://datatracker.ietf.org/doc/draft-ietf-ohai-ohttp/" target="_blank">emerging IETF standard</a>, and at a high level describes the following data flow:</p>
	<ol>
		<li>The client <a href="https://datatracker.ietf.org/doc/html/draft-ietf-ohai-ohttp-04#section-4.3" target="_blank">encapsulates an HTTP request </a>using the public key of the customer’s gateway server, and sends it to the relay over a client&lt;&gt;relay HTTPS connection.</li>
		<li>The relay forwards the request to the server over its own relay&lt;&gt;gateway HTTPS connection.</li>
		<li>The gateway server decapsulates the request, forwarding it to the application server.</li>
		<li>The gateway server returns an <a href="https://datatracker.ietf.org/doc/html/draft-thomson-http-oblivious-02#section-5.2" target="_blank">encapsulated response</a> to the relay, which then forwards the result to the client.</li>
	</ol>
	<p>The novel feature Privacy Gateway implements from the OHTTP specification is that messages sent through the relay are encrypted (via <a href="https://blog.cloudflare.com/hybrid-public-key-encryption/">HPKE</a>) <em>to the application server</em>, so that the relay learns nothing of the application data beyond the source and destination of each message.</p>
	<p>The end result is that the relay will know where the data request is coming from (i.e. users’ IP addresses) but not what it contains (i.e. contents of the request), and the application can see what the data contains but won’t know where it comes from. A win for end-user privacy.</p>
	<h3 id="delivering-verifiable-and-authentic-code-for-privacy-critical-applications">Delivering verifiable and authentic code for privacy-critical applications</h3>
	<p>How can you ensure that the code — the JavaScript, CSS or even HTML —delivered to a browser hasn’t been tampered with?</p>
	<p>One way is to generate a hash (a consistent, unique, and shorter representation) of the code, and have two independent parties compare those hashes when delivered to the user's browser.</p>
	<p>Our <strong>Code Auditability </strong>service does exactly that, and our recent <a href="https://blog.cloudflare.com/cloudflare-verifies-code-whatsapp-web-serves-users/">partnership with Meta</a> deployed it at scale to WhatsApp Web. Installing their <a href="https://chrome.google.com/webstore/detail/code-verify/llohflklppcaghdpehpbklhlfebooeog/" target="_blank">Code Verify browser extension</a> ensures users can be sure that they are delivered the code they’re intended to run – free of tampering or corrupted files.</p>
	<p>With WhatsApp Web:</p>
	<ol>
		<li>WhatsApp publishes the latest version of their JavaScript libraries to their servers, and the corresponding hash for that version to Cloudflare’s audit endpoint.</li>
		<li>A WhatsApp web client fetches the latest libraries from WhatsApp.</li>
		<li>The Code Verify browser extension subsequently fetches the hash for that version from Cloudflare over a separate, secure connection.</li>
		<li>Code Verify compares the “known good” hash from Cloudflare with the hash of the libraries it locally computed.</li>
	</ol>
	<p>If the hashes match, as they should under almost any circumstance, the code is “verified” from the perspective of the extension. If the hashes don’t match, it indicates that the code running on the user's browser is different from the code WhatsApp intended to run on all its user's browsers.</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2022/09/image4-22.png" class="kg-image">
		<figcaption>How Cloudflare and WhatsApp Web verify code shipped to users isn't tampered with.</figcaption>
	</figure>
	<p>Right now, we call this "Code Auditability" and we see a ton of other potential use cases including password managers, email applications, certificate issuance – all technologies that are potentially targets of tampering or security threats because of the sensitive data they handle.</p>
	<p>In the near term, we’re working with other app developers to co-design solutions that meet their needs for privacy-critical products. In the long term, we’re working on standardizing the approach, including building on existing <a href="https://w3c.github.io/webappsec-csp" target="_blank">Content Security Policy</a> standards, or the <a href="https://github.com/WICG/isolated-web-apps" target="_blank">Isolated Web Apps</a> proposal, and even an approach towards building Code Auditability natively into the browser so that a browser extension (existing or new) isn't required.</p>
	<h3 id="privacy-preserving-proxying-built-into-applications">Privacy-preserving proxying – built into applications</h3>
	<p>What if applications could build the protection of a VPN into their products, by default?</p>
	<p><strong>Privacy Proxy</strong> is our platform to proxy traffic through Cloudflare using a combination of privacy protocols that make it much more difficult to track users’ web browsing activity over time. At a high level, the Privacy Proxy Platform encrypts browsing traffic, replaces a device’s IP address with one from the Cloudflare network, and then forwards it onto its destination.</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2022/09/image5-21.png" class="kg-image">
		<figcaption>System architecture for Privacy Proxy.</figcaption>
	</figure>
	<p>The Privacy Proxy platform consists of several pieces and protocols to make it work:</p>
	<ol>
		<li>Privacy API: a service that issues unique <a href="https://www.ietf.org/archive/id/draft-private-access-tokens-01.html" target="_blank">cryptographic tokens</a>, later redeemed against the proxy service to ensure that only valid clients are able to connect to the service.</li>
		<li>Geolocated IP assignment: a service that assigns each connection a new Cloudflare IP address based on the client’s <a href="https://blog.cloudflare.com/geoexit-improving-warp-user-experience-larger-network/">approximate location</a>.</li>
		<li>Privacy Proxy: the <a href="https://datatracker.ietf.org/wg/masque/about/?cf_target_id=FFEC349381334FBB00C45C937C7B2088" target="_blank">HTTP CONNECT</a>-based service running on Cloudflare’s network that handles the proxying of traffic. This service validates the privacy token passed by the client, enforces any double spend prevention necessary for the token.</li>
	</ol>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/09/image3-41.png" class="kg-image"></figure>
	<p>We’re working on several partnerships to provide network-level protection for user’s browsing traffic, most recently with Apple for <a href="https://blog.cloudflare.com/icloud-private-relay/">Private Relay</a>. Private Relay’s design adds privacy to the traditional proxy design by adding an additional hop – an ingress proxy, operated by Apple – that separates handling users’ identities (i.e., whether they’re a valid iCloud+ user) from the proxying of traffic – the egress proxy, operated by Cloudflare.</p>
	<h3 id="measurements-and-analytics-without-seeing-individual-inputs">Measurements and analytics without seeing individual inputs</h3>
	<p>What if you could calculate the results of a poll, without seeing individuals' votes, or update inputs to a machine learning model that predicted COVID-19 exposure without seeing who was exposed?</p>
	<p>It might seem like magic, but it's actually just cryptography. <strong>Cooperative Analytics</strong> is a multi-party computation system for aggregating privacy-sensitive user measurements that doesn’t reveal individual inputs, based on the <a href="https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap" target="_blank">Distributed Aggregation Protocol</a> (DAP).</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2022/09/image6-11.png" class="kg-image">
		<figcaption>How data flows through the Cooperative Analytics system.</figcaption>
	</figure>
	<p>At a high-level, DAP takes the core concept behind <a href="https://en.wikipedia.org/wiki/MapReduce" target="_blank">MapReduce</a> — what became a fundamental way to aggregate large amounts of data — and rethinks how it would work with privacy-built in, so that each individual input cannot be (provably) mapped back to the original user.</p>
	<p>Specifically:</p>
	<ol>
		<li>Measurements are first "secret shared," or split into multiple pieces. For example, if a user's input is the number 5, her input could be split into two shares of [10,-5].</li>
		<li>The input share pieces are then distributed between different, non-colluding servers for aggregation (in this example, simply summed up). Similar to Privacy Gateway or Private Proxy, no one party has all the information needed to reconstruct any user's input.</li>
		<li>Depending on the use case, the servers will then communicate with one another in order to verify that the input is "valid" – so that no one can insert an input that throws off the entire results. The magic of multi-party computation is that the servers can perform this computation without learning anything about the input beyond its validity.</li>
		<li>Once enough input shares have been aggregated to ensure strong anonymity and a statistically significant sample size – each server sends its sum of the input shares to the overall consumer of this service to then compute the final result.</li>
	</ol>
	<p>For simplicity, the above example talks about measurements as summed up numbers, but DAP describes algorithms for multiple different types of inputs: the most common string input, or a linear regression, for example.</p>
	<p>Early iterations of this system have been implemented by Apple and Google for COVID-19<a href="https://www.abetterinternet.org/post/prio-services-for-covid-en/" target="_blank"> exposure notifications</a>, but there are many other potential use cases for a system like this: think sensitive browser telemetry, geolocation data – any situation where one has a question about a population of users, but doesn't want to have to measure them directly.</p>
	<p>Because this system requires different parties to operate separate aggregation servers, Cloudflare is working with several partners to act as one of the aggregation servers for DAP. We’re calling our implementation <a href="https://github.com/cloudflare/daphne" target="_blank">Daphne</a>, and it’s built on top of Cloudflare Workers.</p>
	<h3 id="privacy-still-requires-trust">Privacy still requires trust</h3>
	<p>Part of what's cool about these systems is that they distribute information — whether user data, network traffic, or both — amongst multiple parties.</p>
	<p>While we think that products included in Privacy Edge are moving the Internet in the right direction, we understand that trust only goes so far. To that end, we're trying to be as transparent as possible.</p>
	<ul>
		<li>We've open sourced the code for Privacy Gateway's server and DAP's aggregation server, and all the standards work we're doing is in public with the IETF.</li>
		<li>We're also working on detailed and accessible privacy notices for each product that describe exactly what kind of network data Cloudflare sees, doesn't see, and how long we retain it for.</li>
		<li>And, most importantly, we’re continuing to develop new protocols (like <a href="https://datatracker.ietf.org/doc/draft-ietf-ohai-ohttp/" target="_blank">Oblivious HTTP</a>) and technologies that don’t just require trust, but that can provably minimize the data observed or logged.</li>
	</ul>
	<p>We'd love to see more folks get involved in the standards space, and we welcome feedback from privacy experts and potential customers on how we can improve the integrity of these systems.</p>
	<h3 id="we-re-looking-for-collaborators">We’re looking for collaborators</h3>
	<p>Privacy Edge products are currently in early access.</p>
	<p>We're looking for application developers who want to build more private user-facing apps with Privacy Gateway; browser and existing VPN vendors looking to improve network-level security for their users via Privacy Proxy; and anyone shipping sensitive software on the Internet that is looking to iterate with us on code auditability and web app signing.</p>
	<p>If you're interested in working with us on furthering privacy on the Internet, then <a href="https://www.cloudflare.com/lp/privacy-edge/" target="_blank">please reach out</a>, and we’ll be in touch!</p>
</div>