{
	"locale": "en-us",
	"post": {
		"id": "622756be209782000bc6a03f",
		"uuid": "e965b7cb-a43b-4dc6-8b82-fa3f7f6e1783",
		"title": "CVE-2022-26143: TP240PhoneHome reflection/amplification DDoS attack vector",
		"slug": "cve-2022-26143",
		"html": "<p>Beginning in mid-February 2022, security researchers, network operators, and security vendors observed a spike in DDoS attacks sourced from <a href=\"https://www.cloudflare.com/learning/ddos/glossary/user-datagram-protocol-udp/\">UDP</a> port 10074 targeting broadband access ISPs, financial institutions, logistics companies, and organizations in other vertical markets.</p><p>Upon further investigation, it was determined that the devices abused to launch these attacks are MiCollab and MiVoice Business Express collaboration systems produced by <a href=\"https://www.mitel.com\">Mitel</a>, which incorporate TP-240 VoIP- processing interface cards and supporting software; their primary function is to provide Internet-based site-to-site voice connectivity for PBX systems.</p><p>Approximately 2600 of these systems have been incorrectly provisioned so that an unauthenticated system test facility has been inadvertently exposed to the public Internet, allowing attackers to leverage these PBX VoIP gateways as DDoS reflectors/amplifiers.</p><p>Mitel is aware that these systems are being abused to facilitate high-pps (packets-per-second) DDoS attacks, and have been actively working with customers to remediate abusable devices with patched software that disables public access to the system test facility.</p><p>In this blog, we will further explore the observed activity, explain how the driver has been abused, and share recommended mitigation steps. This research was created cooperatively among a team of researchers from Akamai SIRT, Cloudflare, Lumen Black Lotus Labs, NETSCOUT ASERT, TELUS, Team Cymru, and The Shadowserver Foundation.</p><h3 id=\"ddos-attacks-in-the-wild\">DDoS attacks in the wild</h3><p>While spikes of network traffic associated with the vulnerable service were observed on January 8th and February 7,th 2022, we believe the first actual attacks leveraging the exploit began on February 18th.</p><p>Observed attacks were primarily predicated on packets-per-second, or throughput, and appeared to be UDP reflection/amplification attacks sourced from UDP/10074 that were mainly directed towards destination ports UDP/80 and UDP/443. The single largest observed attack of this type preceding this one was approximately 53 Mpps and 23 Gbps. The average packet size for that attack was approximately 60 bytes, with an attack duration of approximately 5 minutes. The amplified attack packets are not fragmented.</p><p>This particular attack vector differs from most UDP reflection/amplification attack methodologies in that the exposed system test facility can be abused to launch a sustained DDoS attack of up to 14 hours in duration by means of <em>a single spoofed attack initiation packet</em>, resulting in a record-setting packet amplification ratio of <em>4,294,967,296:1</em>. A controlled test of this DDoS attack vector yielded more than 400 Mmpps of sustained DDoS attack traffic.</p><p>It should be noted that this single-packet attack initiation capability has the effect of precluding network operator traceback of the spoofed attack initiator traffic. This helps mask the attack traffic generation infrastructure, making it less likely that the attack origin can be traced compared with other UDP reflection/amplification DDoS attack vectors.</p><h3 id=\"abusing-the-tp240dvr-driver\">Abusing the tp240dvr driver</h3><p>The abused service on affected Mitel systems is called tp240dvr (“TP-240 driver”) and appears to run as a software bridge to facilitate interactions with TDM/VoIP PCI interface cards. The service listens for commands on UDP/10074 and is not meant to be exposed to the Internet, as confirmed by the manufacturer of these devices. It is this exposure to the Internet that ultimately allows it to be abused.</p><p>The tp240dvr service exposes an unusual command that is designed to stress-test its clients in order to facilitate debugging and performance testing. This command can be abused to cause the tp240dvr service to send this stress-test to attack victims. The traffic consists of a high rate of short informative status update packets that can potentially overwhelm victims and cause the DDoS scenario.</p><p>This command can also be abused by attackers to launch very high-throughput attacks. Attackers can use specially-crafted commands to cause the tp240dvr service to send larger informative status update packets, significantly increasing the amplification ratio.</p><p>By extensively testing isolated virtual TP-240-based systems in a lab setting, researchers were able to cause these devices to generate massive amounts of traffic in response to comparatively small request payloads. We will cover this attack scenario in greater technical depth in the following sections.</p><h3 id=\"calculating-the-potential-attack-impact\">Calculating the potential attack impact</h3><p>As previously mentioned, amplification via this abusable test facility differs substantially from how it is accomplished with most other UDP reflection/amplification DDoS vectors. Typically, reflection/amplification attacks require the attacker to continuously transmit malicious payloads to abusable nodes for as long as they wish to attack the victim. In the case of TP-240 reflection/amplification, this continuous transmission is not necessary to launch high-impact DDoS attacks.</p><p>Instead, an attacker leveraging TP-240 reflection/amplification can launch a high-impact DDoS attack using a single packet. Examination of the tp240dvr binary reveals that, due to its design, an attacker can theoretically cause the service to emit 2,147,483,647 responses to a single malicious command. Each response generates two packets on the wire, leading to approximately 4,294,967,294 amplified attack packets being directed toward the attack victim.</p><p>For each response to a command, the first packet contains a counter that increments with each sent response. As the counter value increments, the size of this first packet will grow from 36 bytes to 45 bytes. The second packet contains diagnostic output from the function, which can be influenced by the attacker. By optimizing each initiator packet to maximize the size of the second packet, every command will result in amplified packets that are up to 1,184 bytes in length.</p><p>In theory, a single abusable node generating the upper limit of 4,294,967,294 packets at a rate of 80kpps would result in an attack duration of roughly 14 hours. Over the course of the attack, the “counter” packets alone would generate roughly 95.5GB of amplified attack traffic destined for the targeted network. The maximally-padded “diagnostic output” packets would account for an additional 2.5TB of attack traffic directed towards the target.</p><p>This would yield a sustained flood of just under 393mb/sec of attack traffic from a single reflector/amplifier, all resulting from a single spoofed attack initiator packet of only 1,119 bytes in length. This results in a nearly unimaginable amplification ratio of 2,200,288,816:1 — a multiplier of <em>220 billion percent</em>, triggered by a single packet.</p><h3 id=\"upper-boundaries-of-attack-volume-and-simultaneity\">Upper boundaries of attack volume and simultaneity</h3><p>The tp240dvr service processes commands using a single thread. This means they can only process a single command at a time, and thus can only be used to launch one attack at a time. In the example scenario presented above, during the 14 hours that the abused device would be attacking the target, it cannot be leveraged to attack any other target. This is somewhat unique in the context of DDoS reflection/amplification vectors.</p><p>Although this characteristic also causes the tp240dvr service to be unavailable to legitimate users, it is much preferable to having these devices be leveraged in parallel by multiple attackers — and leaving legitimate operators of these systems to wonder why their outbound Internet data capacity is being consumed at much higher rates.</p><p>Additionally, it appears these devices are on relatively low-powered hardware, in terms of their traffic-generation capabilities. On an Internet where 100/Gbps links, dozens of CPU cores, and multi-threading capabilities have become commonplace, we can all be thankful this abusable service is not found on top-of-the-line hardware platforms capable of individually generating millions of packets per second, and running with thousands of parallelized threads.</p><p>Lastly, it is also good news that of the tens of thousands of these devices, which have been purchased and deployed historically by governments, commercial enterprises, and other organizations worldwide, a relatively small number of them have been configured in a manner that leaves them in this abusable state, and of those, many have been properly secured and taken offline from an attacker’s perspective.</p><h3 id=\"collateral-impact\">Collateral impact</h3><p>The collateral impact of TP-240 reflection/amplification attacks is potentially significant for organizations with Internet-exposed Mitel MiCollab and MiVoice Business Express collaboration systems that are abused as DDoS reflectors/amplifiers.</p><p>This may include partial or full interruption of voice communications through these systems, as well as additional service disruption due to transit capacity consumption, state-table exhaustion of NATs, and stateful firewalls, etc.</p><p>Wholesale filtering of all UDP/10074-sourced traffic by network operators may potentially overblock legitimate Internet traffic, and is therefore contraindicated.</p><h3 id=\"recommended-actions\">Recommended actions</h3><p>TP-240 reflection/amplification DDoS attacks are sourced from UDP/10074 and destined for the UDP port of the attacker’s choice. This amplified attack traffic can be detected, classified, traced back, and safely mitigated using standard DDoS defense tools and techniques.</p><p>Flow telemetry and packet capture via open-source and commercial analysis systems can alert network operators and end customers of TP-240 reflection/amplification attacks.</p><p>Network access control lists (ACLs), flowspec, destination-based remotely triggered blackhole (D/RTBH), source-based remotely triggered blackhole (S/RTBH), and intelligent DDoS mitigation systems can be used to mitigate these attacks.</p><p>Network operators should perform reconnaissance to identify and facilitate remediation of abusable TP-240 reflectors/amplifiers on their networks and/or the networks of their customers.  Operators of Mitel MiCollab and MiVoice Business Express collaboration systems should proactively contact Mitel in order to receive specific remediation instructions from the vendor.</p><p>Organizations with business-critical public-facing Internet properties should ensure that all relevant network infrastructure, architectural, and operational Best Current Practices (BCPs) have been implemented, including situationally specific network access policies that only permit Internet traffic via required IP protocols and ports. Internet access network traffic to/from internal organizational personnel should be isolated from Internet traffic to/from public-facing Internet properties, and served via separate upstream Internet transit links.</p><p><a href=\"https://www.cloudflare.com/ddos/\">DDoS defenses</a> for all public-facing Internet properties and supporting infrastructure should be implemented in a situationally appropriate manner, including periodic testing to ensure that any changes to the organization’s servers/services/applications are incorporated into its DDoS defense plan.</p><p>It is imperative that organizations operating mission-critical public-facing Internet properties and/or infrastructure ensure that all servers/services/application/datastores/infrastructure elements are protected against DDoS attack, and are included in periodic, realistic tests of the organization’s DDoS mitigation plan. Critical ancillary supporting services such as authoritative and recursive DNS servers must be included in this plan.</p><p>Network operators should implement ingress and egress source address validation in order to prevent attackers from initiating reflection/amplification DDoS attacks.</p><p>All potential DDoS attack mitigation measures described in this document <em><strong>MUST</strong></em> be tested and customized in a situationally appropriate manner prior to deployment on production networks.</p><h3 id=\"mitigating-factors\">Mitigating factors</h3><p>Operators of Internet-exposed TP-240-based Mitel MiCollab and MiVoice Business Express collaboration systems can prevent abuse of their systems to launch DDoS attacks by blocking incoming Internet traffic destined for UDP/10074 via access control lists (ACLs), firewall rules, and other standard network access control policy enforcement mechanisms.</p><p>Mitel have provided patched software versions that prevent TP-240-equipped MiCollab and MiVoice Business Express collaboration systems from being abused as DDoS reflectors/amplifiers by preventing exposure of the service to the Internet. Mitel customers should contact the vendor for remediation instructions.</p><p>Collateral impact to abusable TP-240 reflectors/amplifiers can alert network operators and/or end-customers to remove affected systems from “demilitarized zone” (DMZ) networks or Internet Data Centers (IDCs), or to disable relevant UDP port-forwarding rules that allow specific UDP/10074 traffic sourced from the public Internet to reach these devices, thereby preventing them from being abused to launch reflection/amplification DDoS attacks.</p><p>The amplified attack traffic is not fragmented, so there is no additional attack component consisting of non-initial fragments, as is the case with many other UDP reflection/amplification DDoS vectors.</p><p>Implementation of ingress and egress source-address validation (SAV; also known as anti-spoofing) can <a href=\"https://www.cloudflare.com/learning/ddos/how-to-prevent-ddos-attacks/\">prevent attackers</a> from launching reflection/amplification DDoS attacks.</p><h3 id=\"conclusion\">Conclusion</h3><p>Unfortunately, many abusable services that should not be exposed to the public Internet are nevertheless left open for attackers to exploit. This scenario is yet another example of real-world deployments not adhering to vendor guidance. Vendors can prevent this situation by adopting “safe by default” postures on devices before shipping.</p><p>Reflection/amplification DDoS attacks would be impossible to launch if all network operators implemented ingress and egress source-address validation (SAV, also known as anti-spoofing).  The ability to spoof the IP address(es) of the intended attack target(s) is required to launch such attacks. Service providers must continue to implement SAV in their own networks, and require that their downstream customers do so.</p><p>As is routinely the case with newer DDoS attack vectors, it appears that after an initial period of employment by advanced attackers with access to bespoke DDoS attack infrastructure, TP-240 reflection/amplification has been weaponized and added to the arsenals of so-called “booter/stresser” DDoS-for-hire services, placing it within the reach of the general attacker population.</p><p>Collaboration across the operational, research, and vendor communities is central to the continued viability of the Internet. The quick response to and ongoing remediation of this high-impact DDoS attack vector has only been possible as a result of such collaboration. Organizations with a vested interest in the stability and resiliency of the Internet should embrace and support cross-industry cooperative efforts as a core principle.</p><p>The combined efforts of the research and mitigation task force demonstrates that successful collaboration across industry peers to quickly remediate threats to availability and resiliency is not only possible, but is also increasingly critical for the continued viability of the global Internet.</p><h3 id=\"sources\">Sources</h3><p><a href=\"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-26143/\">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-26143/</a><br><a href=\"https://www.mitel.com/en-ca/support/security-advisories/mitel-product-security-advisory-22-0001\">https://www.mitel.com/en-ca/support/security-advisories/mitel-product-security-advisory-22-0001</a><br><a href=\"https://www.cisa.gov/uscert/ncas/alerts/TA14-017A\">https://www.cisa.gov/uscert/ncas/alerts/TA14-017A</a><br><a href=\"https://www.senki.org/ddos-attack-preparation-workbook/\">https://www.senki.org/ddos-attack-preparation-workbook/</a><br><a href=\"https://www.manrs.org/resources/\">https://www.manrs.org/resources/</a><br><a href=\"https://www.rfc-editor.org/info/bcp38/\">https://www.rfc-editor.org/info/bcp38</a><br><a href=\"https://www.rfc-editor.org/info/bcp84\">https://www.rfc-editor.org/info/bcp84</a><br><a href=\"https://datatracker.ietf.org/doc/html/rfc7039\">https://datatracker.ietf.org/doc/html/rfc7039</a></p><h3 id=\"research-and-mitigation-task-force-contributors\">Research and mitigation task force contributors</h3><p>Researchers from the following organizations have contributed to the findings and recommendations described in this document:</p><ul><li><a href=\"https://www.akamai.com/blog/security\">Akamai SIRT</a></li><li><a href=\"https://www.cloudflare.com\">Cloudflare</a></li><li><a href=\"https://www.lumen.com/en-us/security/black-lotus-labs.html\">Lumen Black Lotus Labs</a></li><li><a href=\"https://www.mitel.com\">Mitel</a></li><li><a href=\"https://www.netscout.com/asert\">NETSCOUT ASERT</a></li><li><a href=\"https://www.telus.com/\">TELUS</a></li><li><a href=\"https://team-cymru.com\">Team Cymru</a></li><li><a href=\"https://shadowserver.org\">The Shadowserver Foundation</a></li></ul><p>In particular, the Mitigation Task Force would like to cite Mitel for their exemplary cooperation, rapid response, and ongoing participation in remediation efforts. Mitel quickly created and disseminated patched software, worked with their customers and partners to update affected systems, and supplied valuable expertise as the Task Force worked to formulate this document.</p>",
		"comment_id": "622756be209782000bc6a03f",
		"feature_image": "http://blog.cloudflare.com/content/images/2022/03/image1-80.png",
		"featured": false,
		"visibility": "public",
		"created_at": "2022-03-08T13:14:38.000+00:00",
		"updated_at": "2023-10-27T21:39:04.000+01:00",
		"published_at": "2022-03-08T14:59:58.000+00:00",
		"custom_excerpt": "A new reflection/amplification distributed denial-of-service (DDoS) vector with a record-breaking potential amplification ratio of 4,294,967,296:1 has been abused by attackers in the wild to launch multiple high-impact DDoS attacks",
		"codeinjection_head": null,
		"codeinjection_foot": null,
		"custom_template": null,
		"canonical_url": null,
		"tags": [
			{
				"id": "622756d3209782000bc6a043",
				"name": "#BLOG-1020",
				"slug": "hash-blog-1020",
				"description": null,
				"feature_image": null,
				"visibility": "internal",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/404/"
			},
			{
				"id": "5d16450341acde0011a951e3",
				"name": "DDoS",
				"slug": "ddos",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/ddos/"
			},
			{
				"id": "5d16450341acde0011a951aa",
				"name": "Vulnerabilities",
				"slug": "vulnerabilities",
				"description": "Vulnerabilities (EN)",
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/vulnerabilities/"
			},
			{
				"id": "62275fe0209782000bc6a08c",
				"name": "Mitel",
				"slug": "mitel",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/mitel/"
			}
		],
		"authors": [
			{
				"id": "6156592e2d69dd02a8a9b114",
				"name": "Alex Forster",
				"slug": "alex-forster",
				"profile_image": "http://blog.cloudflare.com/content/images/2021/10/me-even-smaller-crushed.png",
				"cover_image": null,
				"bio": null,
				"website": null,
				"location": null,
				"facebook": null,
				"twitter": "@alex_forster",
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/alex-forster/"
			}
		],
		"primary_author": {
			"id": "6156592e2d69dd02a8a9b114",
			"name": "Alex Forster",
			"slug": "alex-forster",
			"profile_image": "http://blog.cloudflare.com/content/images/2021/10/me-even-smaller-crushed.png",
			"cover_image": null,
			"bio": null,
			"website": null,
			"location": null,
			"facebook": null,
			"twitter": "@alex_forster",
			"meta_title": null,
			"meta_description": null,
			"url": "http://blog.cloudflare.com/author/alex-forster/"
		},
		"primary_tag": null,
		"url": "http://blog.cloudflare.com/cve-2022-26143/",
		"excerpt": "A new reflection/amplification distributed denial-of-service (DDoS) vector with a record-breaking potential amplification ratio of 4,294,967,296:1 has been abused by attackers in the wild to launch multiple high-impact DDoS attacks",
		"reading_time": 9,
		"access": true,
		"comments": false,
		"og_image": "http://blog.cloudflare.com/content/images/2022/03/CVE-2022-26143--TP240PhoneHome-reflection-amplification-DDoS-attack-vector-OG-1.png",
		"og_title": null,
		"og_description": null,
		"twitter_image": "http://blog.cloudflare.com/content/images/2022/03/CVE-2022-26143--TP240PhoneHome-reflection-amplification-DDoS-attack-vector-OG.png",
		"twitter_title": null,
		"twitter_description": null,
		"meta_title": null,
		"meta_description": "A new reflection/amplification distributed denial-of-service (DDoS) vector with a record-breaking potential amplification ratio of 4,294,967,296:1 has been abused by attackers in the wild to launch multiple high-impact DDoS attacks.",
		"email_subject": null,
		"frontmatter": null,
		"feature_image_alt": null,
		"feature_image_caption": null
	}
}