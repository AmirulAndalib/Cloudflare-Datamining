{
	"locale": "en-us",
	"post": {
		"id": "5d16453b41acde0011a95646",
		"uuid": "0734653b-fcf8-4e02-9b32-46cef960eed4",
		"title": "There’s Always Cache in the Banana Stand",
		"slug": "theres-always-cache-in-the-banana-stand",
		"html": "<!--kg-card-begin: markdown--><p><img src=\"http://blog.cloudflare.com/content/images/2017/12/banana-stand_1@2x.png\" alt=\"\" loading=\"lazy\"><br>\n<br>We’re happy to announce that we now support all HTTP Cache-Control response directives. This puts powerful control in the hands of you, the people running origin servers around the world. We believe we have the strongest support for Internet standard cache-control directives of any large scale cache on the Internet.</p>\n<p>Documentation on Cache-Control is available <a href=\"https://support.cloudflare.com/hc/en-us/articles/115003206852\">here</a>.</p>\n<p>Cloudflare runs a Content Distribution Network (CDN) across our globally distributed network edge. Our CDN works by caching our customers’ web content at over 119 data centers around the world and serving that content to the visitors nearest to each of our network locations. In turn, our customers’ websites and applications are <a href=\"https://www.cdnperf.com/\">much faster</a>, more<br>\navailable, and more secure for their end users.</p>\n<p>A CDN’s fundamental working principle is simple: storing stuff closer to where it’s needed means it will get to its ultimate destination faster. And, serving something from more places means it’s more reliably available.</p>\n<p><img src=\"https://www.cloudflare.com/img/learning/cdn/what-is-a-cdn/what-is-a-cdn.png\" alt=\"Caching\" loading=\"lazy\"></p>\n<p>To use a simple banana analogy: say you want a banana. You go to your local fruit stand to pick up a bunch to feed your inner monkey. You expect the store to have bananas in stock, which would satisfy your request instantly. But, what if they’re out of stock? Or what if all of the bananas are old and stale? Then, the store might need to place an order with the banana warehouse. That order might take some time to fill, time you would spend waiting in the store for the banana delivery to arrive. But you don’t want bananas that badly; you’ll probably just walk out and figure out some other way to get your tropical fix.</p>\n<p>Now, what if we think about the same scenario in the context of an Internet request? Instead of bananas, you are interested in the latest banana meme. You go to bananameme.com, which sits behind Cloudflare’s edge network, and you get served your meme faster!</p>\n<p>Of course, there’s a catch. A CDN in-between your server (the “origin” of your content) and your visitor (the “eyeball” in network engineer slang) might cache content that is out-of-date or incorrect. There are two ways to manage this:</p>\n<p><em>1) the origin should give the best instructions it can on when to treat content as stale.</em></p>\n<p><em>2) the origin can tell the edge when it has made a change to content that makes content stale.</em></p>\n<p>Cache-Control headers allow servers and administrators to give explicit instructions to the edge on how to handle content.</p>\n<h4 id=\"challengesofstoringephemeralcontentornostalebananas\">Challenges of Storing Ephemeral Content (or: No Stale Bananas)</h4>\n<p>When using an edge cache like Cloudflare in-between your origin and visitors, the origin server no longer has direct control over the cached assets being served. Internet standards allow for the origin to emit Cache-Control headers with each response it serves. These headers give intermediate and browser caches fine-grained instruction over how content should be cached.</p>\n<p>The current RFC covering these directives (and HTTP caching in general) is <a href=\"https://tools.ietf.org/html/rfc7234\">RFC 7234</a>. It’s worth a skim if you’re into this kind of stuff. The relevant section on Response Cache-Control is laid out in <a href=\"https://tools.ietf.org/html/rfc7234#section-5.2.2\">section 5.2.2</a> of that document. In addition, some interesting extensions to the core directives were defined in <a href=\"https://tools.ietf.org/html/rfc5861\">RFC 5861</a>, covering how caches should behave when origins are unreachable or in the process of being revalidated against.</p>\n<h4 id=\"toputthisintermsofbananas\">To put this in terms of bananas:</h4>\n<p>George Michael sells bananas at a small stand. He receives a shipment of bananas for resale from Anthony’s Banana Company (ABC) on Monday. Anthony’s Banana Company serves as the origin for bananas for stores spread across the country. ABC is keenly interested in protecting their brand; they want people to associate them with only the freshest, perfectly ripe bananas with no stale or spoiled fruit to their name.</p>\n<p>To ensure freshness, ABC provides explicit instructions to its vendors and eaters of its bananas. Bananas can’t be held longer than 3 days before sale to prevent overripening/staleness. Past 3 days, if a customer tries to buy a banana, George Michael must call ABC to revalidate that the bananas are fresh. If ABC can’t be reached, the bananas must not be sold.</p>\n<h4 id=\"toputthisintermsofbananamemesvgs\">To put this in terms of banana meme SVGs:</h4>\n<p>Kari uses Cloudflare to cache banana meme SVGs at edge locations around the world to reduce visitor latency. Banana memes should only be cached for up to 3 days to prevent the memes from going stale. Past 3 days, if a visitor requests bananameme.com, Cloudflare must make a revalidation request to the bananameme.com origin. If the request to origin fails, Cloudflare must serve the visitor an error page instead of their zesty meme.</p>\n<h4 id=\"ifonlyabcandkarihadstrongsupportforcachecontrolresponseheaders\">If only ABC and Kari had strong support for Cache-Control response headers!</h4>\n<p>If they did, they could serve their banana related assets with the following header:</p>\n<p><code>Cache-Control: public, max-age=259200, proxy-revalidate</code></p>\n<p>Public means this banana is allowed to be served from an edge cache. Max-age=259200 means it can stay in cache for up to 3 days (3 days * 24 hours * 60 minutes * 60 seconds = 259200). Proxy-revalidate means the edge cache must revalidate the content with the origin when that expiration time is up, no exceptions.</p>\n<p>For a full list of supported directives and a lot more examples (but no more bananas), check out the <a href=\"https://support.cloudflare.com/hc/en-us/articles/115003206852s\">documentation</a> in our Help Center.</p>\n<!--kg-card-end: markdown-->",
		"comment_id": "5007",
		"feature_image": "http://blog.cloudflare.com/content/images/2017/12/banana-stand.png",
		"featured": false,
		"visibility": "public",
		"created_at": "2017-09-11T23:34:29.000+01:00",
		"updated_at": "2019-09-03T22:23:26.000+01:00",
		"published_at": "2017-12-14T16:09:22.000+00:00",
		"custom_excerpt": "We’re happy to announce that we now support all HTTP Cache-Control response directives. This puts powerful control in the hands of you, the people running origin servers around the world. ",
		"codeinjection_head": null,
		"codeinjection_foot": null,
		"custom_template": null,
		"canonical_url": null,
		"authors": [
			{
				"id": "5d1644b141acde0011a94f9c",
				"name": "Anthony Davanzo",
				"slug": "anthony-davanzo",
				"profile_image": "http://blog.cloudflare.com/content/images/2018/06/Screen-Shot-2018-06-07-at-3.48.53-PM.png",
				"cover_image": "http://blog.cloudflare.com/content/images/2018/08/general@2x-14.png",
				"bio": null,
				"website": null,
				"location": "San Francisco, CA",
				"facebook": null,
				"twitter": "@exclesium",
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/anthony-davanzo/"
			}
		],
		"tags": [
			{
				"id": "5d16450341acde0011a95157",
				"name": "Cache",
				"slug": "cache",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/cache/"
			},
			{
				"id": "5d16450341acde0011a95160",
				"name": "Speed & Reliability",
				"slug": "speed-and-reliability",
				"description": null,
				"feature_image": "http://blog.cloudflare.com/content/images/2020/10/Speed---Reliability-1.png",
				"visibility": "public",
				"meta_title": "Cloudflare Blog: Speed & Reliability",
				"meta_description": "Collection of Cloudflare blog posts tagged 'Speed & Reliability'.",
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/speed-and-reliability/"
			},
			{
				"id": "5d16450341acde0011a951ee",
				"name": "Product News",
				"slug": "product-news",
				"description": "Product News (EN)",
				"feature_image": "http://blog.cloudflare.com/content/images/2020/10/Product-News-1.png",
				"visibility": "public",
				"meta_title": "Cloudflare Blog: Product News",
				"meta_description": "Collection of Cloudflare blog posts tagged 'Product News'.",
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/product-news/"
			}
		],
		"primary_author": {
			"id": "5d1644b141acde0011a94f9c",
			"name": "Anthony Davanzo",
			"slug": "anthony-davanzo",
			"profile_image": "http://blog.cloudflare.com/content/images/2018/06/Screen-Shot-2018-06-07-at-3.48.53-PM.png",
			"cover_image": "http://blog.cloudflare.com/content/images/2018/08/general@2x-14.png",
			"bio": null,
			"website": null,
			"location": "San Francisco, CA",
			"facebook": null,
			"twitter": "@exclesium",
			"meta_title": null,
			"meta_description": null,
			"url": "http://blog.cloudflare.com/author/anthony-davanzo/"
		},
		"primary_tag": {
			"id": "5d16450341acde0011a95157",
			"name": "Cache",
			"slug": "cache",
			"description": null,
			"feature_image": null,
			"visibility": "public",
			"meta_title": null,
			"meta_description": null,
			"og_image": null,
			"og_title": null,
			"og_description": null,
			"twitter_image": null,
			"twitter_title": null,
			"twitter_description": null,
			"codeinjection_head": null,
			"codeinjection_foot": null,
			"canonical_url": null,
			"accent_color": null,
			"url": "http://blog.cloudflare.com/tag/cache/"
		},
		"url": "http://blog.cloudflare.com/theres-always-cache-in-the-banana-stand/",
		"excerpt": "We’re happy to announce that we now support all HTTP Cache-Control response directives. This puts powerful control in the hands of you, the people running origin servers around the world. ",
		"reading_time": 4,
		"access": true,
		"comments": false,
		"og_image": null,
		"og_title": null,
		"og_description": null,
		"twitter_image": null,
		"twitter_title": null,
		"twitter_description": null,
		"meta_title": "There’s Always Cache in the Banana Stand",
		"meta_description": "We’re happy to announce that we now support all HTTP Cache-Control response directives.",
		"email_subject": null,
		"frontmatter": null,
		"feature_image_alt": null,
		"feature_image_caption": null
	}
}