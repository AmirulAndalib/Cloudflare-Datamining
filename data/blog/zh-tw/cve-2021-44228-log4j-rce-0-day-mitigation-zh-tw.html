<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/12/image1-52.png" class="kg-image"></figure>
	<p><em>更新：所有三條 WAF 規則現已設定預設動作封鎖。</em></p>
	<p>2021 年 12 月 9 日，公開了一個會影響常用 <a href="https://logging.apache.org/log4j/2.x/index.html" target="_blank">Apache Log4j 公用程式</a>的零時差漏洞 (<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228" target="_blank">CVE-2021-44228</a>)，該漏洞利用可能導致遠端代碼執行 (RCE)。</p>
	<p>該漏洞目前正被大肆利用，使用 Log4j 的所有人都應盡快更新至 v2.15.0。最新版本可在 <a href="https://logging.apache.org/log4j/2.x/download.html" target="_blank">Log4j 下載頁面</a>找到。</p>
	<p>如果無法更新至最新版本，則可以透過從類別路徑中移除 JndiLookup 類別來減輕漏洞。此外，對於 &gt;=2.10 的 Log4j 版本，可透過將系統屬性 log4j2.formatMsgNoLookups 或 LOG4J_FORMAT_MSG_NO_LOOKUPS 環境變數設定為 true 來緩解問題。</p>
	<p>使用 Cloudflare WAF 的客戶還可以利用三條最新部署的規則來幫助緩解任何漏洞利用嘗試：</p>
	<!--kg-card-begin: markdown-->
	<table>
		<thead>
			<tr>
				<th>規則 ID</th>
				<th>描述</th>
				<th>預設動作</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td><code>100514</code> (舊版 WAF)<br><code>6b1cc72dff9746469d4695a474430f12</code> (新版 WAF)</td>
				<td>Log4j 標頭</td>
				<td><code>BLOCK</code></td>
			</tr>
			<tr>
				<td><code>100515</code> (舊版 WAF)<br><code>0c054d4e4dd5455c9ff8f01efe5abb10</code> (新版 WAF)</td>
				<td>Log4j 主體</td>
				<td><code>BLOCK</code></td>
			</tr>
			<tr>
				<td><code>100516</code> (舊版 WAF)<br><code>5f6744fa026a4638bda5b3d7d5e015dd</code> (新版 WAF)</td>
				<td>Log4j URL</td>
				<td><code>BLOCK</code></td>
			</tr>
		</tbody>
	</table>
	<!--kg-card-end: markdown-->
	<p>該緩解被拆分為三條規則，分別檢查 HTTP 標頭、內文和 URL 。</p>
	<p>我們將繼續監視狀況，並相應地更新任何 WAF 受管理規則。</p>
	<p>有關該漏洞的更多詳情，請見官方 <a href="https://logging.apache.org/log4j/2.x/security.html" target="_blank">Log4j 安全性頁面</a>。</p>
	<h3 id="-"><strong>受影響人群</strong></h3>
	<p>Log4j 是一個強大的 Java，基於 Apache Software Foundation 維護的記錄庫。</p>
	<p>在 &gt;= 2.0-beta9 且 &lt;= 2.14.1 的所有 Log4j 版本中，設定、記錄訊息和參數中使用的 JNDI 功能可能被攻擊者利用來執行遠端代碼。尤其是，當訊息查詢替代啟用時，能夠控制記錄訊息或記錄訊息參數的攻擊者可以執行從 LDAP 伺服器載入的任意代碼。</p>
</div>