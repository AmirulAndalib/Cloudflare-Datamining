{
	"locale": "en-us",
	"localesAvailable": [],
	"post": {
		"authors": [
			{
				"name": "John Graham-Cumming",
				"slug": "john-graham-cumming",
				"bio": null,
				"profile_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/5vGNsXzZrtSLn2X30pnpUY/a43660c54db33a4289ab5a7d99d3d414/john-graham-cumming.jpg",
				"location": "Lisbon, Portugal",
				"website": null,
				"twitter": null,
				"facebook": null
			}
		],
		"excerpt": "Two weeks ago CloudFlare announced that it was supporting HTTP/2 Server Push for all our customers. By simply adding a Link header to an HTTP response specifying preload CloudFlare would automatically push items to web browsers that support Server Push.",
		"feature_image": "https://cf-assets.www.cloudflare.com/slt3lc6tev37/4NPP0lk9059Fun7XgYDpJv/105101437ca8cc8d6749c77f4af7bb34/using-http-2-server-push-with-php.png",
		"featured": false,
		"html": "<p>Two weeks ago CloudFlare announced that it was supporting <a href=\"/announcing-support-for-http-2-server-push-2/\">HTTP/2 Server</a> Push for all our customers. By simply adding a <code>Link</code> header to an HTTP response specifying <code>preload</code> CloudFlare would automatically push items to web browsers that support Server Push.</p><p>To illustrate how easy this is I create a small PHP page that uses the PHP <a href=\"https://secure.php.net/manual/en/function.header.php\"><code>header</code></a> function to insert appropriate <code>Link</code> headers to push images to the web browser via CloudFlare. The web page looks like this when loaded:</p>\n            <figure class=\"kg-card kg-image-card \">\n            \n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/2KEen2kNGsrXXEKZZnQSni/ec4e708f9f475f5c606fb41ded670011/Screen-Shot-2016-05-13-at-11-50-00-AM.png\" alt=\"\" class=\"kg-image\" width=\"436\" height=\"675\" loading=\"lazy\"/>\n            \n            </figure><p>There are two images loaded from the same server both of which are pushed if the web browser supports Server Push. This is achieved by inserting two <code>Link</code> headers in the HTTP response. The response looks like:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">HTTP/1.1 200 OK\nServer: nginx/1.9.15\nDate: Fri, 13 May 2016 10:52:13 GMT\nContent-Type: text/html\nTransfer-Encoding: chunked\nConnection: keep-alive\nLink: </images/drucken.jpg>; rel=preload; as=image\nLink: </images/empire.jpg>; rel=preload; as=image</pre></code>\n            <p>At the bottom are the two <code>Link</code> headers corresponding to the two images on the page with the <code>rel=preload</code> directive as specified in W3C <a href=\"https://www.w3.org/TR/preload/#server-push-http-2\">preload draft</a>.</p><p>The complete code can be found in this <a href=\"https://gist.github.com/jgrahamc/df91229381366105c7ff0f88c8c38485\">gist</a> but the core of the code looks like this:</p>\n            <pre class=\"language-php\"><code class=\"language-php\">    <?php\n    function pushImage($uri) {\n        header(\"Link: <{$uri}>; rel=preload; as=image\", false);\n        return <<<HTML\n    <img src=\"{$uri}\">\n    HTML;\n    }\n\n    $image1 = pushImage(\"/images/drucken.jpg\");\n    $image2 = pushImage(\"/images/empire.jpg\");\n    ?>\n\n    <html>\n\n    <head><title>PHP Server Push</title></head>\n    <body>\n\n    <h1>PHP Server Push</h1>\n\n    <?php\n    echo ccbysa($image1, \"https://bit.ly/1Wu5bYx\",\n       \"https://www.flickr.com/photos/hiperactivo/\", \"Javier Candeira\");\n\n    echo ccbynd($image2, \"https://bit.ly/24PHue3\",\n        \"https://www.flickr.com/photos/bobsfever/\", \"Robert McGoldrick\");\n    ?>\n\n    </body>\n    </html></pre></code>\n            <p>Since you have to call the PHP <code>header</code> function before any output (such as HTML) has occurred the code makes two calls to a helper function called <code>pushImage</code> first. <code>pushImage</code> adds the appropriate <code>Link</code> header and returns the HTML needed to insert the actual image in the page.</p><p>Later the variables <code>$image1</code> and <code>$image2</code> (which contain the HTML needed to display the images) is inserted use two other helper functions (<code>ccbysa</code> and <code>ccbynd</code>) that add captions. Those two helper functions don&#39;t play any part in the Server Push, they just ensure that the HTML is placed correctly on the page with a caption.</p><p>Notice that the <code>Link</code> header is added as follows:</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">header(\"Link: <{$uri}>; rel=preload; as=image\", false);</pre></code>\n            <p>The <code>false</code> second parameter tells <code>header</code> to <i>not</i> override an existing <code>Link</code> header. With that option specified multiple <code>Link</code> headers can be added. Without it the last call to <code>pushImage</code> would win.</p><h2>Effect of Server Push</h2><p>To understand the effect of Server Push on the example I used Google Chrome Canary and loaded the page twice (once without the <code>Link</code> headers so that no push would occur and once with).</p><p>Here&#39;s the simple waterfall over HTTP/2 with no Server Push:</p>\n            <figure class=\"kg-card kg-image-card \">\n            <a href=/content/images/2016/05/Screen-Shot-2016-05-13-at-12-22-24-PM.png>\n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/5oN4WtS0666At1eTeB2Xkr/4bddfb71d899aa81f067e797a08f632f/Screen-Shot-2016-05-13-at-12-22-24-PM.png\" alt=\"\" class=\"kg-image\" width=\"1181\" height=\"388\" loading=\"lazy\"/>\n            </a>\n            </figure><p>The page load time was 651ms. You can see the initial page HTML load in 175ms followed by the two images.</p><p>How here&#39;s the waterfall with HTTP/2 Server Push:</p>\n            <figure class=\"kg-card kg-image-card \">\n            <a href=/content/images/2016/05/Screen-Shot-2016-05-13-at-12-20-58-PM.png>\n            <Image src=\"https://cf-assets.www.cloudflare.com/slt3lc6tev37/2thpvABMv76ref5uY2LIhX/1df7cc75f59f74f092450b71e74fe3f0/Screen-Shot-2016-05-13-at-12-20-58-PM.png\" alt=\"\" class=\"kg-image\" width=\"1171\" height=\"366\" loading=\"lazy\"/>\n            </a>\n            </figure><p>The page load time was 251ms (the HTML loaded in 168ms) and Chrome is showing that the two images were pushed (see the Initiator column).</p><p>It&#39;s not 100% obvious what happened there but digging into chrome://net-internals/ it&#39;s possible to see a detailed HTTP/2 timeline. I&#39;ve edited out a few details of the protocol (such as the window size changes) to focus in on the requests and responses.</p><p>The <code>t</code> value gives the tick time (1ms per tick).</p>\n            <pre class=\"language-bash\"><code class=\"language-bash\">t=910212 [st=   1]    HTTP2_SESSION_SEND_HEADERS\n                      --> exclusive = true\n                      --> fin = true\n                      --> has_priority = true\n                      --> :method: GET\n                          :scheme: https\n                          :path: /index.php\n                          pragma: no-cache\n                          cache-control: no-cache\n                          upgrade-insecure-requests: 1\n                          accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\n                          accept-encoding: gzip, deflate, sdch, br\n                          accept-language: en-US,en;q=0.8\n                          cookie: [52 bytes were stripped]\n                      --> parent_stream_id = 0\n                      --> priority = 0\n                      --> stream_id = 1\n\n[...]\n\nt=910404 [st= 193]    HTTP2_SESSION_RECV_HEADERS\n                      --> fin = false\n                      --> :status: 200\n                          date: Fri, 13 May 2016 11:28:16 GMT\n                          content-type: text/html\n                          content-encoding: gzip\n                      --> stream_id = 1\nt=910405 [st= 194]    HTTP2_SESSION_RECV_PUSH_PROMISE\n                      --> :method: GET\n                          :path: /images/drucken.jpg\n                          :scheme: https\n                          accept-encoding: gzip, deflate, sdch, br\n                      --> id = 1\n                      --> promised_stream_id = 2\nt=910405 [st= 194]    HTTP2_SESSION_RECV_PUSH_PROMISE\n                      --> :method: GET\n                          :path: /images/empire.jpg\n                          :scheme: https\n                          accept-encoding: gzip, deflate, sdch, br\n                      --> id = 1\n                      --> promised_stream_id = 4\nt=910405 [st= 194]    HTTP2_SESSION_RECV_DATA\n                      --> fin = false\n                      --> size = 298\n                      --> stream_id = 1\nt=910405 [st= 194]    HTTP2_SESSION_RECV_DATA\n                      --> fin = true\n                      --> size = 0\n                      --> stream_id = 1\nt=910409 [st= 198]    HTTP2_SESSION_RECV_HEADERS\n                      --> fin = false\n                      --> :status: 200\n                          date: Fri, 13 May 2016 11:28:16 GMT\n                          content-type: image/jpeg\n                          content-length: 49852\n                          set-cookie: [124 bytes were stripped]\n                          etag: \"5735aac0-12f99\"\n                          last-modified: Fri, 13 May 2016 10:21:52 GMT\n                          cf-cache-status: HIT\n                          vary: Accept-Encoding\n                          expires: Fri, 13 May 2016 15:28:16 GMT\n                          cache-control: public, max-age=14400\n                          accept-ranges: bytes\n                          server: cloudflare-nginx\n                      --> stream_id = 2\nt=910409 [st= 198]    HTTP2_SESSION_RECV_DATA\n                      --> fin = false\n                      --> size = 987\n                      --> stream_id = 2\nt=910409 [st= 198]    HTTP2_SESSION_RECV_DATA\n                      --> fin = false\n                      --> size = 1369\n                      --> stream_id = 2\nt=910410 [st= 199]    HTTP2_SESSION_RECV_DATA\n                      --> fin = false\n                      --> size = 1369\n                      --> stream_id = 2</pre></code>\n            <p>The web browser sends an <code>HTTP2_SESSION_SEND_HEADERS</code> request asking for the web page (that&#39;s the first item above) and subsequently receives the response headers and page followed immediately by two push promises for the two images. It then immediately starts receiving image data (see the <code>stream_id</code> 2).</p><p>CloudFlare&#39;s web server is pushing the image contents before the browser asked for them. When CloudFlare pushes an item specified in a <code>Link</code> header the header itself is stripped (to prevent the browser from re-requesting the resource).</p><h2>The Future Starts Here</h2><p>We released HTTP/2 Server Push support to help kick start innovative use of this critical feature of HTTP/2. We would love people to start experimenting with it to see how much of a speed improvement is possible with their specific websites.</p><p>As can be seen from this blog post making use of Server Push in a web application is easy: just insert <code>Link</code> headers with the appropriate format. Server Push will be particularly fast if the items being pushed are also stored in CloudFlare&#39;s cache (as was the case with the examples above).</p><p>Please let us know how you use Server Push. We&#39;re particularly interested in experiences with pushing different types of resources (images vs. styles vs. scripts) and working out the optimal number of items to push (we currently allow up to 50 resources per page).</p>",
		"id": "3nkrcgnTrCQJfUc4OyxsDC",
		"localeList": {
			"name": "Using HTTP/2 Server Push with PHP Config",
			"enUS": "English for Locale",
			"zhCN": "No Page for Locale",
			"zhHansCN": "No Page for Locale",
			"zhTW": "No Page for Locale",
			"frFR": "No Page for Locale",
			"deDE": "No Page for Locale",
			"itIT": "No Page for Locale",
			"jaJP": "No Page for Locale",
			"koKR": "No Page for Locale",
			"ptBR": "No Page for Locale",
			"esLA": "No Page for Locale",
			"esES": "No Page for Locale",
			"enAU": "No Page for Locale",
			"enCA": "No Page for Locale",
			"enIN": "No Page for Locale",
			"enGB": "No Page for Locale",
			"idID": "No Page for Locale",
			"ruRU": "No Page for Locale",
			"svSE": "No Page for Locale",
			"viVN": "No Page for Locale",
			"plPL": "No Page for Locale",
			"arAR": "No Page for Locale",
			"nlNL": "No Page for Locale",
			"thTH": "No Page for Locale",
			"trTR": "No Page for Locale",
			"heIL": "No Page for Locale",
			"lvLV": "No Page for Locale",
			"etEE": "No Page for Locale",
			"ltLT": "No Page for Locale"
		},
		"meta_description": null,
		"metadata": {
			"imgPreview": ""
		},
		"primary_author": {},
		"published_at": "2016-05-13T14:11:28.000+01:00",
		"reading_time": 4,
		"slug": "using-http-2-server-push-with-php",
		"tags": [
			{
				"id": "3lxBe7kJ3IDjqgqMaBU1QJ",
				"name": "HTTP2",
				"slug": "http2"
			},
			{
				"id": "2k241cFxquq61M0W7HZ6hB",
				"name": "Server Push",
				"slug": "server-push"
			},
			{
				"id": "6ftpwHnREWzIsAvyv4blrq",
				"name": "php",
				"slug": "php"
			},
			{
				"id": "48r7QV00gLMWOIcM1CSDRy",
				"name": "Speed & Reliability",
				"slug": "speed-and-reliability"
			}
		],
		"title": "Using HTTP/2 Server Push with PHP",
		"updated_at": "2024-08-27T02:34:41.860Z",
		"url": "https://blog.cloudflare.com/using-http-2-server-push-with-php"
	},
	"translations": {
		"posts.by": "By",
		"footer.gdpr": "GDPR",
		"lang_blurb1": "This post is also available in {lang1}.",
		"lang_blurb2": "This post is also available in {lang1} and {lang2}.",
		"lang_blurb3": "This post is also available in {lang1}, {lang2} and {lang3}.",
		"footer.blurb": "Cloudflare's connectivity cloud protects <a target='_blank' href='https://www.cloudflare.com/network-services/' rel='noreferrer'>entire corporate networks</a>, helps customers build <a target='_blank' href='https://workers.cloudflare.com/' rel='noreferrer'>Internet-scale applications efficiently</a>, accelerates any <a target='_blank' href='https://www.cloudflare.com/performance/accelerate-internet-applications/' rel='noreferrer'>website or Internet application</a>, <a target='_blank' href='https://www.cloudflare.com/ddos/' rel='noreferrer'>wards off DDoS attacks</a>, keeps <a target='_blank' href='https://www.cloudflare.com/application-security/' rel='noreferrer'>hackers at bay</a>, and can help you on <a target='_blank' href='https://www.cloudflare.com/products/zero-trust/' rel='noreferrer'>your journey to Zero Trust</a>.<br/><br/>Visit <a target='_blank' href='https://one.one.one.one/' rel='noreferrer'>1.1.1.1</a> from any device to get started with our free app that makes your Internet faster and safer.<br/><br/>To learn more about our mission to help build a better Internet, <a target='_blank' href='https://www.cloudflare.com/learning/what-is-cloudflare/' rel='noreferrer'>start here</a>. If you&apos;re looking for a new career direction, check out <a target='_blank' href='http://www.cloudflare.com/careers' rel='noreferrer'>our open positions</a>.",
		"footer.press": "Press",
		"header.title": "The Cloudflare Blog",
		"footer.careers": "Careers",
		"footer.company": "Company",
		"footer.support": "Support",
		"footer.the_net": "theNet",
		"footer.our_team": "Our team",
		"footer.webinars": "Webinars",
		"page.more_posts": "More posts",
		"posts.time_read": "{time} min read",
		"footer.community": "Community",
		"footer.resources": "Resources",
		"footer.solutions": "Solutions",
		"footer.trademark": "Trademark",
		"header.subscribe": "Subscribe",
		"footer.compliance": "Compliance",
		"footer.free_plans": "Free plans",
		"footer.impact_ESG": "Impact/ESG",
		"posts.follow_on_X": "Follow on X",
		"footer.help_center": "Help center",
		"footer.network_map": "Network Map",
		"header.please_wait": "Please Wait",
		"page.related_posts": "Related posts",
		"footer.case_studies": "Case Studies",
		"footer.connect_2024": "Connect 2024",
		"footer.terms_of_use": "Terms of Use",
		"footer.white_papers": "White Papers",
		"footer.cloudflare_tv": "Cloudflare TV",
		"footer.community_hub": "Community Hub",
		"footer.compare_plans": "Compare plans",
		"footer.contact_sales": "Contact Sales",
		"header.contact_sales": "Contact Sales",
		"header.email_address": "Email Address",
		"page.error.not_found": "Page not found",
		"footer.developer_docs": "Developer docs",
		"footer.privacy_policy": "Privacy Policy",
		"footer.request_a_demo": "Request a demo",
		"page.continue_reading": "Continue reading",
		"footer.analysts_report": "Analyst reports",
		"footer.for_enterprises": "For enterprises",
		"footer.getting_started": "Getting Started",
		"footer.learning_center": "Learning Center",
		"footer.project_galileo": "Project Galileo",
		"pagination.newer_posts": "Newer Posts",
		"pagination.older_posts": "Older Posts",
		"posts.social_buttons.x": "Discuss on X",
		"footer.about_cloudflare": "About Cloudflare",
		"footer.athenian_project": "Athenian Project",
		"footer.become_a_partner": "Become a partner",
		"footer.cloudflare_radar": "Cloudflare Radar",
		"footer.network_services": "Network services",
		"footer.trust_and_safety": "Trust & Safety",
		"header.get_started_free": "Get Started Free",
		"page.search.placeholder": "Search Cloudflare",
		"footer.cloudflare_status": "Cloudflare Status",
		"footer.cookie_preference": "Cookie Preferences",
		"header.valid_email_error": "Must be valid email.",
		"footer.connectivity_cloud": "Connectivity cloud",
		"footer.developer_services": "Developer services",
		"footer.investor_relations": "Investor relations",
		"page.not_found.error_code": "Error Code: 404",
		"footer.logos_and_press_kit": "Logos & press kit",
		"footer.application_services": "Application services",
		"footer.get_a_recommendation": "Get a recommendation",
		"posts.social_buttons.reddit": "Discuss on Reddit",
		"footer.sse_and_sase_services": "SSE and SASE services",
		"page.not_found.outdated_link": "You may have used an outdated link, or you may have typed the address incorrectly.",
		"footer.report_security_issues": "Report Security Issues",
		"page.error.error_message_page": "Sorry, we can't find the page you are looking for.",
		"header.subscribe_notifications": "Subscribe to receive notifications of new posts:",
		"footer.cloudflare_for_campaigns": "Cloudflare for Campaigns",
		"header.subscription_confimation": "Subscription confirmed. Thank you for subscribing!",
		"posts.social_buttons.hackernews": "Discuss on Hacker News",
		"footer.diversity_equity_inclusion": "Diversity, equity & inclusion",
		"footer.critical_infrastructure_defense_project": "Critical Infrastructure Defense Project"
	}
}