{
	"locale": "en-us",
	"post": {
		"id": "5d16453b41acde0011a95372",
		"uuid": "442848f8-6f1c-42ca-a289-8e5b6ee2c138",
		"title": "Why secure systems require random numbers",
		"slug": "why-randomness-matters",
		"html": "<!--kg-card-begin: markdown--><p>If you've been following recent news about technical spying by the US National Security Agency and the UK's Government Communications Headquarters you may have come across a claim that the NSA was involved in weakening a random number generator. The obvious question to ask is... why mess with random number generation?</p>\n<p>The answer is rather simple: good random numbers are fundemental to almost all secure computer systems. Without them everything from Second World War ciphers like <a href=\"https://en.wikipedia.org/wiki/Lorenz_cipher\">Lorenz</a> to the SSL your browser uses to secure web traffic are in serious trouble.</p>\n<p>To understand why, and the threat that bad random numbers pose, it's necessary to understand a little about random numbers themselves (such as &quot;what is a good random number anyway?&quot;) and how they are used in secure systems.</p>\n<h3 id=\"ahackernewshack\">A Hacker News Hack</h3>\n<p>As an example of how random numbers go wrong I'll begin with a hack of the popular programming and technology web site <a href=\"http://news.ycombinator.com/\">Hacker News</a>.</p>\n<p><img alt=\"Hacker News\" src=\"http://blog.cloudflare.com/content/images/hn.png\" title=\"Hacker News\"><noscript><img alt=\"Hacker News\" src=\"http://blog.cloudflare.com/content/images/hn.png\" title=\"Hacker News\"></noscript></p>\n<p>Four years ago I <a href=\"https://news.ycombinator.com/item?id=596126\">mentioned</a> on the site that its random number generator was vulnerable to being used to attack the site. Not long after, and entirely independently, another contributor to the site actually <a href=\"https://news.ycombinator.com/item?id=639976\">carried out the attack</a> with the permission of the site owner.</p>\n<p>Here's how it worked. When you log into a web site you are typically assigned a unique ID for that session (the period you are logged in). That unique ID needs to be unique to you and not guessable by someone else. If someone else can guess it they can impersonate you.</p>\n<p>In the case of Hacker News, the unique ID is a string of random<br>\ncharacters such as lBGn0tWMcx7380gZyrUO9B. Each logged in user has a<br>\ndifferent string and the strings should be very, very difficult to<br>\nguess or figure out.</p>\n<h3 id=\"pseudorandomness\">Pseudo-randomness</h3>\n<p>The IDs are generated internally using a pseudo-random number<br>\ngenerator. That's a mathematical function that can be called<br>\nrepeatedly to get apparently random numbers. I say apparently because, as the great mathematician John von Neumann said: &quot;Anyone who considers arithmetical methods of producing random digits is, of course, in a state of sin.&quot; The computer scientist Donald Knuth tells a story of inventing a pseudo-random number generator himself only to be shocked at how poor it was.</p>\n<p>Although pseudo-random number generators can generate a sequence of apparently random numbers they have weaknesses.</p>\n<p><img alt=\"The Three\" src=\"http://blog.cloudflare.com/content/images/vonneumann.jpg\" title=\"The Three\"><noscript><img alt=\"The Three\" src=\"http://blog.cloudflare.com/content/images/vonneumann.jpg\" title=\"The Three\"></noscript></p>\n<p>von Neumann used a simple pseudo-random number generator called the<br>\n<a href=\"https://en.wikipedia.org/wiki/Middle-square_method\">middle square</a> that works as follows. You start with some number (called a seed) and square it. You take the four middle digits as your random number and square them to get the next random number, and so on.</p>\n<p>For example, if you chose 4181 as a seed the sequence 4807, 1072,<br>\n1491, 2230, 9279, ... would be generated as follows:</p>\n<pre>     Random number        Its Square    Middle digits\n     4181                 17480761      4807\n     4807                 23107249      1072\n     1072                  1149184      1491\n     1491                  2223081      2230\n     2230                  4972900      9729\n     9279                 94653441      6534\n     and so on\n</pre>\n<p>This particular pseudo-random number has long since been replaced by better ones such as the <a href=\"https://en.wikipedia.org/wiki/Mersenne_twister\">Mersenne Twister</a> whose output is harder to predict. The middle square method is trivial to predict: the next number it generates is entirely determined by the number it last produced. The Mersenne Twister on the other hand is much harder to predict because it has internal state that it uses to produce random numbers.</p>\n<p>In the world of cryptography there are <a href=\"https://en.wikipedia.org/wiki/CSPRNG\">cryptographically secure pseudo-random number generators</a> which are designed to be unpredictable no matter how many random cnumbers you ask it to generate. (The Mersenne Twister isn't cryptographically secure because it can be predicted if enough of the random numbers it generates are observed.)</p>\n<p>For secure systems it's vital that the random number generator be unpredictable.</p>\n<h3 id=\"startingwithaseed\">Starting With A Seed</h3>\n<p>And all pseudo-random number generators need to start somewhere; they need to be seeded and that's where Hacker News failed. The random number generator was seeded with the time in milliseconds when the Hacker News software was last started. By some careful work, the attacker managed to make Hacker News crash and could then predict when it restarted within a window of about one minute. From it he was able to predict the unique IDs assigned to users as they logged in and could, therefore, impersonate them. (Similar random number problems enabled one group of people to cheat at <a href=\"http://www.cigital.com/papers/download/developer_gambling.php\">online poker</a>.)</p>\n<p>The full details of how the Hacker News Hack worked are <a href=\"https://news.ycombinator.com/item?id=639976\">here</a>. The attack worked because once Hacker News crashed the attacker would wait for it to start and note the current time. Amusingly, the Hacker News server was willing to give out that information. The attacker then had 60s worth of possible seeds (60,000 seeds since the seed was in milliseconds).</p>\n<p>So, the attacker would log in and look at their own unique ID. It had been generated by random numbers inside Hacker News's software. He then tried out each of the 60,000 seeds and ran the random number generation algorithm used by Hacker News until he found a match with his own unique ID. That told him which seed had been used, and it let him keep generating further unique IDs by generating the same sequence  of random numbers that Hacker News was using. From that he could predict the unique IDs given out to users as they logged in and he could then impersonate them.</p>\n<p>The Hacker News code was changed to use the Linux /dev/urandom source of random numbers which means that today unique IDs are generated with a good random number generator and without the weak seed previously used.</p>\n<p>So, there are two ways in which pseudo-random number generation can<br>\nfail: the seed could be bad or the algorithm itself could be weak and predictable.</p>\n<h3 id=\"randomnumberseverywhere\">Random Numbers Everywhere</h3>\n<p>The Hacker News example isn't about cryptography itself, but random numbers are vital to cryptographic schemes. For example, any HTTPS session starts as follows:</p>\n<ol>\n<li>\nThe web browser sends information to the server about which version\nof SSL it wants to use and other information.\n</li>\n<li>\nThe web server replies with similar information about SSL versions\nand its SSL certificate.\n</li>\n<li>\nThe web browser checks that the certificate is valid. If it is, it generates a random &apos;pre-main secret&apos; that will be used to secure the connection.\n</li>\n</ol>\nAfter that further exchanges occur all based on the randomly chosen pre-main secret. It needs to be unpredictable for the connection to be secure.\n<p>Here's part of how a computer using WiFi establishes a secure connection to an access point using the popular <a href=\"https://en.wikipedia.org/wiki/IEEE_802.11i-2004\">WPA2</a> protocol:</p>\n<ol>\n<li>\n<p>The access point generates a random <a href=\"https://en.wikipedia.org/wiki/Cryptographic_nonce\">nonce</a> and sends it to the computer.\n</li>\n<li>\nThe computer generates a random nonce and sends it to the access\npoint.\n</li>\n</ol>\n<p>The access point and the computer continue on from there using those<br>\nrandom nonce values to secure the connection.</p>\n<p>Similarly, random numbers turn up when logging into web sites (and other systems), creating secure connections to servers using <a href=\"https://www.cloudflare.com/learning/access-management/what-is-ssh/\">SSH</a>, holding Skype video chats, sending encrypted email and more.</p>\n<p><img alt=\"Soviet one-time pad\" src=\"http://blog.cloudflare.com/content/images/otp.jpg\" title=\"Soviet one-time pad\"><noscript><img alt=\"Soviet one-time pad\" src=\"http://blog.cloudflare.com/content/images/otp.jpg\" title=\"Soviet one-time pad\"></noscript></p>\n<p>And the Achilles' Heel of the only completely secure cryptosystem, the <a href=\"https://en.wikipedia.org/wiki/One_time_pad\">one-time pad</a> is that the pad itself must be completely randomly generated. Any predictability or non-uniformity in the random numbers used can lead to breaking of a one-time pad. (The other problem with one-time pads is reuse: they must be used <a href=\"https://en.wikipedia.org/wiki/VENONA#Breakthrough\">only once</a>.)</p>\n<h3 id=\"cloudflaresrandomnumbersource\">CloudFlare's Random Number Source</h3>\n<p>At CloudFlare we need lots of random numbers for cryptographic purposes: we need them to secure SSL connections, <a href=\"http://blog.cloudflare.com/cacheing-the-uncacheable-cloudflares-railgun-73454\">Railgun</a>, generating public/private key pairs, and authentication systems. They are an important part of <a href=\"http://blog.cloudflare.com/staying-on-top-of-tls-attacks\">forward secrecy</a> which we've rolled out for all our customers.</p>\n<p>We currently obtain most of our random numbers from either OpenSSL's random number generation system or from the Linux kernel. Both seed their random number generators from a variety of sources to make them as unpredictable as possible. Sources include things like network data, or the seek time of disks. But we think we can improve on them by adding some truly random data into the system, and, as a result, improve security for our customers.</p>\n<p><img alt=\"The sky above the port was the color of television, tuned to a dead channel\" src=\"http://blog.cloudflare.com/content/images/neuromancer.jpg\" title=\"The sky above the port was the color of television, tuned to a dead channel.\"><noscript><img alt=\"The sky above the port was the color of television, tuned to a dead channel\" src=\"http://blog.cloudflare.com/content/images/neuromancer.jpg\" title=\"The sky above the port was the color of television, tuned to a dead channel.\"></noscript></p>\n<p>We've embarked on a project to further improve our random numbers by providing a source of truly random numbers that don't come from a mathematical process. That can be done using things like <a href=\"http://www.fourmilab.ch/hotbits/\">radioactive decay</a>, the <a href=\"https://en.wikipedia.org/wiki/Lavarand\">motion of fluids</a>, <a href=\"http://www.random.org/\">atmospheric noise</a>, or <a href=\"http://www.lavarnd.org/what/process.html\">other chaos</a>.</p>\n<p>We'll be posting details of the new system when it's online.</p>\n<!--kg-card-end: markdown-->",
		"comment_id": "4220",
		"feature_image": "http://blog.cloudflare.com/content/images/2018/08/neuromancer.jpg",
		"featured": false,
		"visibility": "public",
		"created_at": "2014-08-20T11:03:46.000+01:00",
		"updated_at": "2023-07-05T20:02:50.000+01:00",
		"published_at": "2013-09-13T07:00:00.000+01:00",
		"custom_excerpt": "If you've been following recent news about technical spying by the US National Security Agency and the UK's Government Communications Headquarters you may have come across a claim that the NSA was involved in weakening a random number generator. ",
		"codeinjection_head": null,
		"codeinjection_foot": null,
		"custom_template": null,
		"canonical_url": null,
		"authors": [
			{
				"id": "5d1644b141acde0011a94f2c",
				"name": "John Graham-Cumming",
				"slug": "john-graham-cumming",
				"profile_image": "http://blog.cloudflare.com/content/images/2017/03/url-2.jpg",
				"cover_image": "http://blog.cloudflare.com/content/images/2023/05/Twitter-Header-@cloudflare-US.png",
				"bio": null,
				"website": null,
				"location": "Lisbon, Portugal",
				"facebook": null,
				"twitter": null,
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/john-graham-cumming/"
			}
		],
		"tags": [
			{
				"id": "5d16450341acde0011a951da",
				"name": "SSL",
				"slug": "ssl",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/ssl/"
			},
			{
				"id": "5d16450341acde0011a951e7",
				"name": "Privacy",
				"slug": "privacy",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/privacy/"
			},
			{
				"id": "5d16450341acde0011a95169",
				"name": "Attacks",
				"slug": "attacks",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/attacks/"
			}
		],
		"primary_author": {
			"id": "5d1644b141acde0011a94f2c",
			"name": "John Graham-Cumming",
			"slug": "john-graham-cumming",
			"profile_image": "http://blog.cloudflare.com/content/images/2017/03/url-2.jpg",
			"cover_image": "http://blog.cloudflare.com/content/images/2023/05/Twitter-Header-@cloudflare-US.png",
			"bio": null,
			"website": null,
			"location": "Lisbon, Portugal",
			"facebook": null,
			"twitter": null,
			"meta_title": null,
			"meta_description": null,
			"url": "http://blog.cloudflare.com/author/john-graham-cumming/"
		},
		"primary_tag": {
			"id": "5d16450341acde0011a951da",
			"name": "SSL",
			"slug": "ssl",
			"description": null,
			"feature_image": null,
			"visibility": "public",
			"meta_title": null,
			"meta_description": null,
			"og_image": null,
			"og_title": null,
			"og_description": null,
			"twitter_image": null,
			"twitter_title": null,
			"twitter_description": null,
			"codeinjection_head": null,
			"codeinjection_foot": null,
			"canonical_url": null,
			"accent_color": null,
			"url": "http://blog.cloudflare.com/tag/ssl/"
		},
		"url": "http://blog.cloudflare.com/why-randomness-matters/",
		"excerpt": "If you've been following recent news about technical spying by the US National Security Agency and the UK's Government Communications Headquarters you may have come across a claim that the NSA was involved in weakening a random number generator. ",
		"reading_time": 6,
		"access": true,
		"comments": false,
		"og_image": null,
		"og_title": null,
		"og_description": null,
		"twitter_image": null,
		"twitter_title": null,
		"twitter_description": null,
		"meta_title": null,
		"meta_description": null,
		"email_subject": null,
		"frontmatter": null,
		"feature_image_alt": null,
		"feature_image_caption": null
	}
}