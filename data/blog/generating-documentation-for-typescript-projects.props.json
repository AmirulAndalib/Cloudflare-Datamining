{
	"locale": "en-us",
	"post": {
		"access": true,
		"authors": [
			{
				"id": "5d1644b141acde0011a94f7a",
				"name": "John Fawcett",
				"slug": "john-fawcett",
				"profile_image": "http://blog.cloudflare.com/content/images/2017/03/767070.jpg",
				"cover_image": "http://blog.cloudflare.com/content/images/2018/08/general@2x-6.png",
				"bio": null,
				"website": null,
				"location": null,
				"facebook": null,
				"twitter": null,
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/john-fawcett/"
			}
		],
		"canonical_url": null,
		"codeinjection_foot": null,
		"codeinjection_head": null,
		"comment_id": "4877",
		"comments": false,
		"created_at": "2016-11-21T17:14:17.000+00:00",
		"custom_excerpt": "Documentation for JavaScript projects has traditionally been generated via annotations inserted as code comments. While this gets the job done, it seems far from ideal. In this post, I’ll explore how to use TypeScript to generate documentation from source code alone.",
		"custom_template": null,
		"email_subject": null,
		"excerpt": "Documentation for JavaScript projects has traditionally been generated via annotations inserted as code comments. While this gets the job done, it seems far from ideal. In this post, I’ll explore how to use TypeScript to generate documentation from source code alone.",
		"feature_image": "http://blog.cloudflare.com/content/images/2018/08/511102367_1ce398ad1d_o.png",
		"feature_image_alt": null,
		"feature_image_caption": null,
		"featured": false,
		"frontmatter": null,
		"html": "<!--kg-card-begin: markdown--><p>Documentation for JavaScript projects has traditionally been generated via annotations inserted as code comments. While this gets the job done, it seems far from ideal. In this post, I’ll explore how to use TypeScript to generate documentation from source code alone.</p>\n<p><img src=\"http://blog.cloudflare.com/content/images/2016/11/511102367_1ce398ad1d_o.png\" alt=\"\" loading=\"lazy\"><br>\n<small><a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC BY-SA 2.0</a> <a href=\"https://www.flickr.com/photos/davidjoyner/511102367/in/photolist-MawVM-7zyucG-7aZ4QT-6GBfU4-aFrGn6-unAh43-axBGXx-ciiroq-92cKAD-iER1r2-5bRGPh-92fVBf-92fQBm-iER1Gc-2JMg5k-8rfzDR-iERFKo-jL2WXi-iEU2RU-jL4n6N-nqbf3-iER2q6-6H9k7G-dgnntH-eMMtEx-hHiLuM-9Sx4wb-9pCef2-9RLkVe-iEU1Nb-jL27Jr-ai89xS-dWQYFd-dyZqij-7cnSxN-8dyQSg-6yATnF-3om4q-nMWdCg-2KEjsj-eoQ3Lw-eoQfdN-9snnkJ-abB6Hb-2KEvib-eoQcXG-iEU2xh-9Hz7sB-5VhaNf-2KzRJp\">image</a> by <a href=\"https://www.flickr.com/photos/davidjoyner/\">David Joyner</a></small></p>\n<p><a href=\"https://www.typescriptlang.org/\">TypeScript</a> is JavaScript with optional types. Here’s a simple example:</p>\n<pre><code class=\"language-javascript\">// Sends some data to some analytics endpoint\nfunction sendAnalyticsJS(data) {\n  if (typeof data.type !== 'string') {\n    throw new Error('The `type` property is required')\n  }\n\n  navigator.sendBeacon('/beacon', JSON.stringify(data))\n}\n\n\n// Results in run-time error\n//    The `type` property is required\nsendAnalyticsJS({ foo: 'bar' })\n</code></pre>\n<p>The JavaScript code will result in a run-time error. This is fine if the developer catches it early, but it would be better if the developer were warned as the bug was introduced. Here’s the same code written using TypeScript:</p>\n<pre><code class=\"language-javascript\">// Describe the shape of the data parameter\ninterface IAnalyticsData {\n  // Type is required\n  type: string\n  // All other fields are fair game\n  [propName: string]: string\n}\n\n\n// We don’t particularly need the data.type check here since\n// the compiler will stamp out the majority of those cases.\nfunction sendAnalytics(data: IAnalyticsData) {\n  if (typeof data.type !== 'string') {\n    throw new Error('The `type` property is required')\n  }\n\n  navigator.sendBeacon('/beacon', JSON.stringify(data))\n}\n\n\n// Results in compile-time error:\n//   Argument of type '{ foo: string; }' is not assignable to\n//   parameter of type 'IAnalyticsData'.\n//   Property 'type' is missing in type '{ foo: string; }'.\nsendAnalytics({ foo: 'bar' })\n</code></pre>\n<p>These annotations are all optional and the more you add, the more the compiler can help you. Compiling the TypeScript version results in code equivalent to the first example. The only difference is that the developer is warned about an error while writing the code.</p>\n<p>With TypeScript, JavaScript developers are given powerful tools that aid the development of applications, large and small. Anders Hejlsberg, lead architect of C# and core dev for TypeScript, describes the language as, “JavaScript that scales.”</p>\n<p><img src=\"http://storage.j0.hn/code-peek.gif\" alt=\"Typescript + VSCode\" loading=\"lazy\"></p>\n<p>Using TypeScript means you can:</p>\n<ul>\n<li>Interactively explore library interfaces from your text editor</li>\n<li>Enjoy useful auto-completion</li>\n<li>Use good refactoring tools</li>\n<li>Navigate your codebase via the ontology that describes it (by that, I mean jumping to class and interface definitions, modules, etc. from individual instances/references)</li>\n<li>And most importantly to this post, generate documentation that’s tightly coupled to your codebase.</li>\n</ul>\n<p><img src=\"http://storage.j0.hn/amp-viewer-docs-2.png\" alt=\"AMP Viewer Docs 1\" loading=\"lazy\"></p>\n<p><em>The screenshot above is of the generated documentation from a TypeScript project at Cloudflare.</em></p>\n<h3 id=\"whynotjsdoc\">Why not JSDoc?</h3>\n<p><img src=\"http://storage.j0.hn/jsdoc-example-1.png\" alt=\"JSDoc Example 1\" loading=\"lazy\"></p>\n<p>The amount of work required to annotate source code with JSDoc comments is comparable to adopting TypeScript annotations. However, JSDoc comments are not tightly coupled to the codebase, so when the code changes, an independent change of the JSDoc comment is also required. Contrast to TypeScript where the structure is gleaned directly from the source. Here’s a side-by-side comparison between JSDoc and TypeScript:</p>\n<p><strong>JSDoc</strong></p>\n<pre><code class=\"language-javascript\">/**\n * A class representing a point\n * @class  Point\n */\nclass Point {\n  /**\n   * Create a point.\n   * @param {number} x - The x value.\n   * @param {number} y - The y value.\n   */\n  constructor(x, y) {\n    /**\n     * The x coordinate\n     * @name  Point#x\n     * @type {number}\n     */\n    this.x = x\n    /**\n     * The y coordinate\n     * @name  Point#y\n     * @type {number}\n     */\n    this.y = y\n  }\n\n\n  /**\n   * Get the x value.\n   * @return {number} The x value.\n   */\n  getX() {\n    return this.x\n  }\n\n\n  /**\n   * Get the y value.\n   * @return {number} The y value.\n   */\n  getY() {\n    return this.y\n  }\n\n\n  /**\n   * Convert a string containing two comma-separated numbers into a point.\n   * @param {string} str - The string containing two comma-separated numbers.\n   * @return {Point} A Point object.\n   */\n  static fromString(str) {\n    const args = str.split(',').map(arg =&gt; +arg)\n    return new Point(args[0], args[1])\n  }\n}\n</code></pre>\n<p><strong>TypeScript</strong></p>\n<pre><code class=\"language-javascript\">/** Class representing a point. */\nclass Point {\n  /** The x coordinate */\n  public x: number\n  /** The x coordinate */\n  public y: number\n\n\n  /**\n   * Create a point.\n   * @param x - The x value.\n   * @param y - The y value.\n   */\n  constructor(x: number, y: number) {\n    this.x = x\n    this.y = y\n  }\n\n\n  /**\n   * Get the x value.\n   */\n  getX() {\n    return this.x\n  }\n\n\n  /**\n   * Get the y value.\n   */\n  getY() {\n    return this.y\n  }\n\n  /**\n   * Convert a string containing two comma-separated numbers into a point.\n   * @param str - The string containing two comma-separated numbers.\n   */\n  static fromString(str: string): Point {\n    const args = str.split(',').map(arg =&gt; +arg)\n    return new Point(args[0], args[1])\n  }\n}\n</code></pre>\n<p>The above code sample was taken from the <a href=\"http://usejsdoc.org/howto-es2015-classes.html#documenting-a-simple-class\">JSDoc documentation</a> and adapted for use with TypeScript.</p>\n<p>The annotations for TypeScript are much more compact, they’re syntax-highlighted, and most importantly, if something is wrong, the compiler lets us know. Long-form descriptions of things are still made in comments, but the type information has been moved into language semantics.</p>\n<p>The downside to adopting TypeScript is the large amount of work required to fit the build tools into your current processes. However, we won’t focus on the nitty-gritty details of build tools since the ecosystem is rapidly changing.</p>\n<h3 id=\"usingtypedoc\">Using TypeDoc</h3>\n<p>At Cloudflare, we use a tool called <a href=\"http://typedoc.org/\">TypeDoc</a> to help build documentation. It’s set up such that documentation-generation is on watch and will re-build on codebase changes. Anybody hacking on the project will always have up-to-date docs at localhost:3000/docs.</p>\n<p>If you’re using TypeScript 2.x, use the following command to install TypeDoc for your project:</p>\n<pre><code class=\"language-bash\">npm install --save-dev https://github.com/DatenMetzgerX/typedoc/tarball/typescript-2-build\n</code></pre>\n<p>Otherwise, for prior versions of TypeScript, you can install straight from NPM:</p>\n<pre><code class=\"language-bash\">npm install --save-dev typedoc\n</code></pre>\n<p>From within your project directory, run the following command:</p>\n<pre><code class=\"language-bash\"># Change the --out flag to wherever you’d like the output to be stored\n./node_modules/.bin/typedoc --out dist/docs --mode modules .\n</code></pre>\n<p>You should see a bunch of HTML documents generated. One for each class and module.</p>\n<pre><code>dist/docs\n├── assets\n│   ├── css\n│   │   ├── main.css\n│   │   └── main.css.map\n│   ├── images\n│   │   ├── icons.png\n│   │   ├── icons@2x.png\n│   │   ├── widgets.png\n│   │   └── widgets@2x.png\n│   └── js\n│       ├── main.js\n│       └── search.js\n├── classes\n│   ├── _src_my_class.html\n│   └── ...\n├── globals.html\n├── index.html\n├── interfaces\n│   ├── _src.my_interface.html\n└── modules\n    ├── _src_my_module_.html\n    └── ...\n</code></pre>\n<p>I wanted to build something akin to <a href=\"https://lodash.com/docs\">Lodash’s documentation</a> (a beautiful single page API reference with examples and links to source code). Luckily, you can use TypeDoc’s --json flag to produce a set of useful descriptions of your codebase in JSON format.</p>\n<pre><code class=\"language-bash\">./node_modules/.bin/typedoc --json dist/docs.json --mode modules\n</code></pre>\n<p><em>Note: In order to use the --json flag, you’ll need to setup a proper <a href=\"https://www.typescriptlang.org/docs/handbook/tsconfig-json.html\">tsconfig.json</a> for your TypeScript project.</em></p>\n<p><img src=\"http://storage.j0.hn/ts-docs-post-screen-1.png\" alt=\"AMP Viewer JSON Docs\" loading=\"lazy\"></p>\n<p>With this high-level, structured description of our code base, we can render any HTML we’d like with a few scripts and a templating language like <a href=\"http://handlebarsjs.com\">Handlebars</a>. Here’s a simple script to render a list of code base modules:</p>\n<pre><code class=\"language-javascript\">const fs = require('fs')\nconst hbs = require('handlebars')\nconst project = require('./dist/docs.json')\n\n\n// The HTML template to use for our simple docs\nconst tmpl = `\n&lt;!DOCTYPE HTML&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;My Project Documentation&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;h1&gt;Modules&lt;/h1&gt;\n    &lt;ul&gt;\n    {{#each project.children}}\n      &lt;li&gt;{{this.name}}&lt;/li&gt;\n    {{/each}}\n    &lt;/ul&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n`\n\n\n// Compile the template with handlebars using our project\n// object as context key\nconst result = hbs.compile(tmpl)({ project })\n\n\nfs.writeFileSync('dist/docs.html', result)\n</code></pre>\n<p>While this means that there is a lot of work up front to create a template that suits the needs of this particular code base, I hope to use the same infrastructure for TypeScript projects at Cloudflare moving forward.</p>\n<h3 id=\"morethanapireference\">More Than API Reference</h3>\n<p>TypeDoc gets us halfway there. It provides a structured and automated way to create reference material that is always in sync with our codebase; but we can do more than reference material. Suppose you’re writing a getting-started.md file. You might say something like this:</p>\n<pre><code>To get started, call the `viewer.init()` method.\n</code></pre>\n<p>Since we’re using TypeDoc and Handlebars, we can assume we have all the information necessary to actually link to the source code. That might look something like this:</p>\n<pre><code class=\"language-handlebars\">{{!-- Pull the AMPViewer class into scope --}}\n{{#Class &quot;AMPViewer&quot;}}\n{{!-- Pull the init member from AMPViewer into scope --}}\n{{#Member &quot;init&quot;}}\n{{!-- Link viewer.init(...) to its location in the source code --}}\n{{!-- Also, if the function signature of the .init() method ever changes, --}}\n{{!-- it will be reflected here --}}\nTo get started, call the\n`viewer.[init({{&gt; signature signature=signatures.0}})]({{getSourceURL this.sources.0}})`\n{{/Member}}\n{{/Class}}\n</code></pre>\n<p>While the above looks arcane, it’s just Markdown and Handlebars. The template contains a block helper called Class that will pull the AMPViewer class object into the current scope. Then using the AMPViewer class, we pull the init member into the current scope. We use the {{&gt; signature}} partial to pretty-print the function’s signature and the getSourceUrl helper to link to this method in the source code.</p>\n<p>If the source code changes, our docs update too.</p>\n<h3 id=\"opensourceandbeyond\">Open Source and Beyond</h3>\n<p>Over next couple of months, we’ll be open sourcing the tools we’ve created to generate our documentation. We’ll also open source the theme shown in this post so you can generate docs without worrying about the styling. We hope to create a rich TypeScript ecosystem and to have fantastic documentation for all of our projects.</p>\n<p>If you’re thinking of generating documentation by annotating your source, use TypeScript instead and enjoy the benefits.</p>\n<!--kg-card-end: markdown-->",
		"id": "5d16453b41acde0011a955db",
		"meta_description": null,
		"meta_title": null,
		"og_description": null,
		"og_image": null,
		"og_title": null,
		"primary_author": {
			"id": "5d1644b141acde0011a94f7a",
			"name": "John Fawcett",
			"slug": "john-fawcett",
			"profile_image": "http://blog.cloudflare.com/content/images/2017/03/767070.jpg",
			"cover_image": "http://blog.cloudflare.com/content/images/2018/08/general@2x-6.png",
			"bio": null,
			"website": null,
			"location": null,
			"facebook": null,
			"twitter": null,
			"meta_title": null,
			"meta_description": null,
			"url": "http://blog.cloudflare.com/author/john-fawcett/"
		},
		"primary_tag": {
			"id": "5d16450341acde0011a95165",
			"name": "JavaScript",
			"slug": "javascript",
			"description": null,
			"feature_image": null,
			"visibility": "public",
			"meta_title": null,
			"meta_description": null,
			"og_image": null,
			"og_title": null,
			"og_description": null,
			"twitter_image": null,
			"twitter_title": null,
			"twitter_description": null,
			"codeinjection_head": null,
			"codeinjection_foot": null,
			"canonical_url": null,
			"accent_color": null,
			"url": "http://blog.cloudflare.com/tag/javascript/"
		},
		"published_at": "2016-11-22T13:28:43.000+00:00",
		"reading_time": 7,
		"slug": "generating-documentation-for-typescript-projects",
		"tags": [
			{
				"id": "5d16450341acde0011a95165",
				"name": "JavaScript",
				"slug": "javascript",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/javascript/"
			},
			{
				"id": "5d16450341acde0011a951cb",
				"name": "AMP",
				"slug": "amp-tag",
				"description": "AMP",
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/amp-tag/"
			},
			{
				"id": "5d16450341acde0011a95218",
				"name": "Open Source",
				"slug": "open-source",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/open-source/"
			},
			{
				"id": "5d16450341acde0011a95214",
				"name": "Programming",
				"slug": "programming",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/programming/"
			}
		],
		"title": "Generating Documentation for TypeScript Projects",
		"twitter_description": null,
		"twitter_image": null,
		"twitter_title": null,
		"updated_at": "2018-08-28T22:18:19.000+01:00",
		"url": "http://blog.cloudflare.com/generating-documentation-for-typescript-projects/",
		"uuid": "41ff6393-ede6-43b7-b62d-2117a6fc8b77",
		"visibility": "public"
	}
}