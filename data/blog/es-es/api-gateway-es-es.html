<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/03/image5-4.png" class="kg-image" alt="Announcing the Cloudflare API Gateway" loading="lazy"></figure>
	<p>En la última década, Internet ha experimentado una profunda transformación. Antes estaba formado por sitios web estáticos con texto, imágenes y algún vídeo integrado, pero ha crecido de forma masiva. Ahora dependemos de aplicaciones basadas en las API para ayudarnos en casi todos los aspectos de la vida. Ya no solo nos limitamos a descargar archivos, ahora podemos <em>interactuar</em> con las aplicaciones mediante el intercambio de datos enriquecidos. Monitorizamos nuestros entrenamientos y enviamos los resultados a la nube, utilizamos bloqueos inteligentes y todo tipo de dispositivos IoT, e interactuamos con nuestros amigos en línea.</p>
	<p>Todo esto es maravilloso, pero entraña una enorme complejidad en el lado del back-end. ¿Por qué? Los desarrolladores tienen que gestionar las API para dar soporte a esta funcionalidad. Tienen que supervisar y autenticar cada una de las solicitudes. Además, como estas tareas son tan difíciles, se suele subcontratar a un proveedor de soluciones de puertas de enlace de la API.</p>
	<p>Lamentablemente, las puertas de enlace actuales dejan mucho que desear. No son baratas, afectan al rendimiento, y, por último, conllevan cierto riesgo para los datos y la privacidad, ya que <a href="https://blog.cloudflare.com/landscape-of-api-traffic">más del 50 % del tráfico</a> llega a las API (y supuestamente se envía a través de una puerta de enlace de terceros). ¡Un lío!</p>
	<p>Hoy anunciamos Cloudflare API Gateway. <strong>Sustituimos por completo tu actual puerta de enlace a un coste mínimo.</strong> Nuestra solución utiliza la tecnología detrás de <a href="https://workers.cloudflare.com" target="_blank">Workers</a>, <a href="https://www.cloudflare.com/products/bot-management" target="_blank">Gestión de bots</a>, <a href="https://www.cloudflare.com/products/zero-trust/access" target="_blank">Access</a>, y <a href="https://developers.cloudflare.com/rules/transform" target="_blank">Reglas de transformación</a> para ofrecer el conjunto de herramientas de API más avanzado del mercado.</p>
	<h2 id="-qu-es-api-gateway">¿Qué es API Gateway?</h2>
	<p>En pocas palabras, es un paquete de funciones que lo hará todo por tus API. Se divide en tres categorías:</p>
	<p><strong>Seguridad</strong><br>Son productos de los que ya hemos hablado en el blog. Herramientas como <a href="https://developers.cloudflare.com/api-shield/products/api-discovery" target="_blank">Detección</a>, <a href="https://developers.cloudflare.com/api-shield/products/schema-validation" target="_blank">Validación de esquemas</a>, <a href="https://developers.cloudflare.com/api-shield/products/volumetric-abuse-detection" target="_blank">Detección de abusos</a>, entre otras. Hemos pasado mucho tiempo aplicando nuestra experiencia en seguridad al mundo de las API.</p>
	<p><strong>Gestión y supervisión</strong><br>Son herramientas fundamentales que mantienen tus API en orden. Algunos ejemplos son el análisis, el enrutamiento y la autenticación. Ya somos capaces de hacer estas cosas con productos como <a href="https://www.cloudflare.com/products/zero-trust/access" target="_blank">Cloudflare Access</a> y hay más funciones en camino.</p>
	<p><strong>Todo lo demás</strong><br>Son elementos pequeños (pero cruciales) que hacen que todo funcione. Cloudflare ya ofrece servicios de terminación SSL/TLS, equilibrio de carga y proxy que se pueden ejecutar por defecto.</p>
	<p>Esta publicación del blog describe cada función en detalle. Nos complace anunciar que <em>todas</em> las funciones de seguridad están ya disponibles de forma general, así que vamos a empezar hablando de ellas.</p>
	<h2 id="detecci-n">Detección</h2>
	<p>Nuestros clientes desean proteger sus API. Por desgracia, no siempre tienen estos puntos finales documentados, o peor aún, <em>creen</em> que todo está documentado, pero han perdido o modificado los puntos finales sin saberlo. Estos puntos finales ocultos se denominan a veces <a href="https://www.bearer.com/resources/shadow-apis-detect-business-risk" target="_blank">Shadow API</a> (API de sombra).Tenemos que empezar nuestro recorrido explicando de forma exhaustiva (y precisa) la superficie de las API.</p>
	<p>Ahí es donde entra en juego nuestra herramienta Detección. Ve al panel de control de Cloudflare, selecciona la pestaña <strong>Seguridad</strong> y elige "API Shield". Activa la función y dinos cómo quieres identificar tu tráfico de API. La mayoría de los usuarios proporcionan un encabezado (disponible hoy), pero también podemos utilizar el cuerpo de la solicitud o la cookie (disponible próximamente).<br></p>
	<figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2022/03/image7.jpg" class="kg-image" alt="The Cloudflare API Shield tab, showing various endpoints that have been discovered and a set of recommended rate limiting thresholds." loading="lazy">
		<figcaption>Pestaña de Cloudflare API Shield, que muestra varios puntos finales que se han detectado y un conjunto de umbrales de limitación de velocidad recomendados</figcaption>
	</figure>
	<p>Proporcionamos una lista exhaustiva de tus puntos finales de la API. Cloudflare enumera cada método, ruta y metadatos adicionales para ayudarte a entender tu superficie. Incluso <em>contraemos</em> los puntos finales que incluyen variables (p. ej. <em>/cuenta/<strong>217</strong></em>) para que sean de aplicación general (por ejemplo, <em>/cuenta/<strong>{var1}</strong></em>).</p>
	<p>Nuestra herramienta Detección es una medida eficaz para contrarrestar la entropía. Nuestros clientes a menudo esperan encontrar 30 puntos finales, pero se sorprenden al saber que tienen más de <em>100 </em>activos.</p>
	<h2 id="validaci-n-de-esquemas">Validación de esquemas</h2>
	<p>Tal vez ya tienes un esquema para tus puntos finales de la API. Un esquema es como una plantilla, proporciona las rutas, los métodos y los datos adicionales que esperas que incluyan las solicitudes de la API. Muchos desarrolladores siguen el estándar <a href="https://swagger.io/specification" target="_blank">OpenAPI</a> para generar (y mantener) un esquema.</p>
	<p>Para reforzar tu seguridad, podemos <em>validar</em> el tráfico entrante cotejándolo con este esquema. Es una buena manera de detener los ataques básicos. Cloudflare rechazará las solicitudes no conformes, descartando el tráfico sin sentido que ignora las normas. Simplemente carga tu esquema en el panel de control, selecciona las acciones que deseas realizar e implementa:<br></p>
	<figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2022/03/image9.jpg" class="kg-image" alt="A step in the schema upload process, after a schema has already been provided. Cloudflare lists out each endpoint with path, query, header, cookies, and body provided as metadata." loading="lazy">
		<figcaption>Paso en el proceso de carga de esquemas después de que se haya proporcionado un esquema. Cloudflare enumera cada punto final con la ruta, la consulta, el encabezado, las cookies y el cuerpo proporcionados como metadatos</figcaption>
	</figure>
	<p>La validación de esquemas ya ha examinado el tráfico de algunos de los mayores sitios de criptografía, servicios de entrega y plataformas de pago del mundo. Ya está disponible, y en breve añadiremos la validación del cuerpo.</p>
	<h2 id="detecci-n-de-abusos">Detección de abusos</h2>
	<p>Un enfoque de seguridad eficaz utilizará la Validación de esquemas <em>y</em> la Detección en conjunto para garantizar que el tráfico coincide con el formato esperado. Pero, ¿qué ocurre con el tráfico abusivo que consigue pasar?</p>
	<p>Cuando descubrimos nuevos puntos finales de la API, <em>sugerimos límites de velocidad</em> para cada uno de ellos. Esa es la función de la detección de abusos, y abre la puerta a un tipo de seguridad más sofisticado.</p>
	<p>Considera un punto final de la API que devuelve pronósticos meteorológicos. En concreto, el punto final devolverá "sí" si es probable que nieve en la próxima hora, y "no" en caso contrario. Nuestro algoritmo podría detectar que el usuario medio solicita estos datos una vez cada 10 minutos. Sin embargo, un pequeño grupo de usuarios realiza 37 solicitudes cada 10 minutos. Cloudflare recomienda automáticamente un umbral intermedio, ponderado, para dar un respiro a los usuarios normales. Se evitaría así que servicios abusivos de apropiación accedan al tiempo con demasiada frecuencia.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/03/image3-18.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>Ofrecemos la opción de crear una regla utilizando nuestro nuevo motor de <a href="https://blog.cloudflare.com/advanced-rate-limiting">Limitación de velocidad avanzada</a>. Puedes utilizar cookies, encabezados y otros elementos para ajustar los umbrales. Llevamos meses utilizando la detección de abusos para proteger <a href="https://api.cloudflare.com" target="_blank">api.cloudflare.com</a>.</p>
	<p>Lo que más nos gusta de esta función es el enfoque de aprendizaje automático que utilizamos para <a href="https://www.cloudflare.com/products/bot-management" target="_blank">Gestión de bots</a>. Otra forma de que nuestros productos interactúen (y se beneficien) entre sí.</p>
	<p>Nuestra solución Detección de abusos ya está disponible. Si te interesa la Detección de abusos <em>secuencial</em> que utilizamos para señalar los flujos de solicitudes anómalos, consulta nuestra <a href="https://blog.cloudflare.com/api-abuse-detection">publicación anterior</a>. Ya está disponible el acceso anticipado de la parte secuencial y seguimos ajustándola antes de su lanzamiento oficial.</p>
	<h2 id="mtls">mTLS</h2>
	<p>El TLS mutuo lleva la seguridad a un nuevo nivel. Puedes utilizar certificados para validar el tráfico entrante cuando llega a tus API, lo que resulta especialmente útil para los dispositivos móviles y de IoT. Además, se trata de un excelente modelo de seguridad positiva que se puede (y debe) adoptar para la mayoría de los ecosistemas de dispositivos.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/03/image1-48.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>Como ejemplo, volvamos a nuestra API meteorológica. Quizá este servicio incluye un segundo punto final que <em>recibe</em> la temperatura actual de un termómetro. Pero hay un problema. Cualquiera puede hacer solicitudes falsas, proporcionando lecturas inexactas al punto final. Para evitarlo, utiliza mTLS para instalar un certificado de cliente en el termómetro <em>legítimo</em>, y luego deja que Cloudflare valide ese certificado. Cualquier otra solicitud será rechazada. ¡Problema resuelto!</p>
	<p>Ya ofrecemos un conjunto de certificados gratuitos a todos los clientes de Cloudflare y seguirá siendo así. Sin embargo, a partir de hoy, los clientes de API Gateway obtienen certificados <em>ilimitados</em> por defecto.</p>
	<h2 id="autenticaci-n">Autenticación</h2>
	<p>Muchas API modernas requieren autenticación. De hecho, la autenticación desbloquea todo tipo de capacidades. Permite las sesiones (con inicio de sesión), el intercambio de datos personales y la eficiencia de la infraestructura. Y, por supuesto, Cloudflare protege el tráfico autenticado cuando pasa por nuestra red.</p>
	<p>Sin embargo, con API Gateway, Cloudflare desempeña un papel más activo en la autenticación del tráfico, ayudando a <strong>emitir</strong> y <strong>validar</strong>:</p>
	<ul>
		<li>Claves de API</li>
		<li>Tokens web JSON (JWT)</li>
		<li>Tokens OAuth 2.0</li>
	</ul>
	<p>El uso de listas de control de acceso, nos permite ayudarte a gestionar diferentes grupos de usuarios con distintos permisos. Y esto es importante porque tu proveedor actual añade una latencia elevada e intercambio de datos innecesarios. Si una solicitud tiene que ir a algún lugar <em>fuera</em> del ecosistema de Cloudflare, está viajando más lejos de lo necesario:</p>
	<figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2022/03/image2-39.png" class="kg-image" alt="Additional latency incurred by sending requests out of the Cloudflare network for authentication." loading="lazy">
		<figcaption>Latencia adicional que se produce al enviar solicitudes fuera de la red de Cloudflare para la autenticación</figcaption>
	</figure>
	<p>Cloudflare puede autenticar en nuestra red global y gestionar las solicitudes en una pequeña fracción del tiempo. Este tipo de tecnología es difícil de implementar, pero pensamos que era demasiado importante como para ignorarla. ¿Cómo lo desarrollamos tan rápidamente? <a href="https://www.cloudflare.com/products/zero-trust/access" target="_blank">Cloudflare Access</a>. Adquirimos nuestra experiencia trabajando con proveedores de identidad y, una vez más, la trasladamos al mundo de las API. Nuestra puerta de enlace incluye autenticación ilimitada e intercambio de tokens. Estas funciones estarán disponibles en breve.</p>
	<h2 id="enrutamiento-y-gesti-n">Enrutamiento y gestión</h2>
	<p>Hablemos brevemente de los <a href="https://www.cloudflare.com/learning/serverless/glossary/serverless-microservice" target="_blank">microservicios</a>. Las aplicaciones modernas son monstruosas, por lo que los desarrolladores las dividen en partes más pequeñas llamadas "microservicios".</p>
	<p>Pensemos en una aplicación que nos ayude a reservar una habitación de hotel. Puedes utilizar un microservicio para obtener las fechas disponibles, otro para obtener los precios y otro para acceder a los tipos de habitación. Tal vez un equipo diferente gestione cada microservicio, pero todos deben estar disponibles desde un único punto de entrada público:</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2022/03/image8.png" class="kg-image" alt="Various steps in an architecture that relies on microservices. A visitor makes a request to a hotel API, which is then routed towards available dates, prices, or room types." loading="lazy">
		<figcaption>Pasos en una arquitectura que se apoya en microservicios. Un visitante realiza una solicitud a la API de un hotel, que luego se enruta hacia las fechas, los precios o los tipos de habitación disponibles</figcaption>
	</figure>
	<p>Ese único punto de entrada, tradicionalmente gestionado por una puerta de enlace de API, se encarga de <em>enrutar</em> cada solicitud hacia el microservicio adecuado. Muchos de nuestros clientes han estado pagando servicios independientes por esto durante años, pero ya no es necesario. Hemos desarrollado nuestro producto <a href="https://blog.cloudflare.com/introducing-transform-rules-with-url-rewriting-at-the-edge">Reglas de transformación</a> para reescribir y reenrutar dinámicamente en nuestro perímetro. Es fácil de configurar, rápido de implementar y está integrado de forma nativa en API Gateway. Cloudflare puede ser ahora el único punto de entrada de tu API.</p>
	<p>Eso es solo la punta del iceberg. API Gateway puede realmente <em>reemplazar</em> tus microservicios a través de una integración con nuestro producto <a href="https://workers.cloudflare.com" target="_blank">Workers</a>. ¿Cómo? Considera la posibilidad de escribir un Worker que realice alguna acción. Tal vez responder con los precios de los hoteles, que se almacenan con <a href="https://blog.cloudflare.com/durable-objects-ga">Durable Objects</a> en nuestra red. Con API Gateway, las solicitudes llegan a nuestra red, se dirigen al microservicio correcto con Reglas de transformación, y luego se sirven completamente con Workers (¡todavía en nuestra red!). Estos Workers pueden ponerse en contacto con tu servidor de origen para obtener más información, cuando sea necesario.</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2022/03/image4-3.png" class="kg-image" alt="Cloudflare’s simplified API architecture. With authentication, routing, management, and storage handled at the edge, several hops are eliminated." loading="lazy">
		<figcaption>Arquitectura simplificada de la API de Cloudflare. Con la autenticación, el enrutamiento, la gestión y el almacenamiento gestionados en el perímetro, se eliminan varios saltos</figcaption>
	</figure>
	<p>Los Workers son más rápidos, baratos y sencillos que las alternativas de microservicios. Esta integración estará disponible en breve.</p>
	<h2 id="an-lisis-de-la-api">Análisis de la API</h2>
	<p>Los clientes nos han comentado que <em>ver</em> el tráfico de la API es a veces más importante que actuar sobre él. De hecho, esta tendencia no es específica de las API. Hoy hemos publicado <a href="https://blog.cloudflare.com/envoy-media-machine-learning-bot-management">otro artículo en el blog</a> que analiza cómo un cliente utiliza nuestros datos de bots para registrar de forma pasiva información sobre amenazas.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/03/image6.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>Con los análisis de la API, hemos recurrido a nuestros otros productos para mostrar datos útiles en tiempo real. Puedes ver los puntos finales más populares, filtrar por información basada en ML, ver histogramas de umbrales de abuso y capturar tendencias.</p>
	<p>Los análisis de la API estarán disponibles próximamente. Además, podrás exportar informes personalizados y compartir información dentro de tu organización.</p>
	<h2 id="registro-gesti-n-de-cuotas-y-m-s">Registro, gestión de cuotas y más</h2>
	<p><em>Todas</em> nuestras funciones establecidas, como el almacenamiento en caché, el equilibrio de carga y las integraciones de registros funcionan de forma nativa con API Gateway. Estas funciones no deberían pasarse por alto como funciones primitivas de la puerta de enlace. Son esenciales. Y como Cloudflare realiza todas estas funciones en el mismo lugar, conseguirás los beneficios de la latencia sin tener que hacer nada.</p>
	<p>También estamos ampliando nuestra funcionalidad de Registros Enterprise para realizar registros en tiempo real. Si decides autenticarte en la red de Cloudflare, podrás ver registros detallados de cada usuario que haya accedido a una API. Del mismo modo, hacemos un seguimiento de la duración de cada solicitud conforme se recibe, valida, enruta y responde. Todo queda registrado.</p>
	<p>Por último, estamos desarrollando la función Gestión de cuotas, que cuenta las solicitudes de la API durante un periodo de tiempo más largo (como un mes) y te permite gestionar los umbrales para tus usuarios. También hemos lanzado <a href="https://blog.cloudflare.com/advanced-rate-limiting">Limitación de velocidad avanzada</a> para ayudar en casos más sofisticados (incluida la inspección del cuerpo para GraphQL).</p>
	<h2 id="conclusi-n">Conclusión</h2>
	<p>Todas nuestras funciones de seguridad, Detección, Validación de esquemas, Detección de abusos y mTLS, ya están disponibles. Llamamos a estas funciones <a href="https://developers.cloudflare.com/api-shield" target="_blank">API Shield</a> porque forman el escudo que protege el resto de las funciones de la puerta de enlace. Los clientes Enterprise pueden solicitar el acceso a sus equipos de cuenta hoy mismo.</p>
	<p>Ya están disponibles otras partes de API Gateway como acceso anticipado. Según Gartner®, "en 2025, menos del 50 % de las API empresariales estarán gestionadas, ya que el crecimiento explosivo de las API supera las capacidades de las herramientas de gestión de las API". Nuestro objetivo es ofrecer una puerta de enlace asequible que invierta esta tendencia. Si deseas probar una función específica, coméntalo con tu equipo de cuenta para que podamos incorporarla lo antes posible.</p><!--kg-card-begin: markdown-->
	<p><small>Fuente: Gartner, "Predicts 2022: APIs Demand Improved Security and Management", Shameen Pillai, Jeremy D'Hoinne, John Santoro, Mark O'Neill, Sham Gill, 6 de diciembre de 2021. GARTNER es una marca comercial registrada y marca de servicio de Gartner, Inc. o sus filiales en los Estados Unidos e internacionalmente, y se usan aquí con permiso. Todos los derechos reservados.</small></p>
	<!--kg-card-end: markdown-->
</div>