<div class="mb2 gray5">8 min read</div>
<div class="post-content lh-copy gray1">
	<p>Cloudflare pretende poner fin al Internet sin cifrar. Pero la web tiene el problema del huevo y la gallina al cambiarse a HTTPS.</p>
	<p>Hace mucho tiempo era difícil, caro y lento configurar un sitio web que funcionara con HTTPS. Luego aparecieron servicios como <a href="https://blog.cloudflare.com/introducing-universal-ssl">Universal SSL</a> de Cloudflare, que cambia de http:// a https://, de forma tan fácil como hacer clic en un botón. Con un clic, se servía un sitio mediante HTTPS con un certificado SSL (Secure Sockets Layer, en español, capa de sockets seguros) gratuito recién acuñado.</p>
	<p>Hala.</p>
	<p>De pronto, el sitio web está disponible mediante HTTPS y, aún mejor, es más rápido porque puede aprovechar el último protocolo web <a href="https://www.cloudflare.com/http2" target="_blank">HTTP/2</a>.</p>
	<p>Por desgracia, la historia no termina ahí. Muchos sitios que por lo demás son seguros sufren el problema del contenido mixto. Y contenido mixto significa que el icono del candado verde no se mostrará en un sitio https:// porque, de hecho, no es realmente seguro.</p>
	<p>El problema es este: si un sitio de Internet con https:// incluye cualquier contenido de un sitio web (incluso propio) servido mediante http:// el candado verde no se puede mostrar. Eso se debe a que los recursos como imágenes, JavaScript, audio, vídeo, etc., incluidos mediante http:// abren un agujero de seguridad en el sitio web seguro. Una puerta trasera a que haya problemas.</p>
	<p>Los navegadores web sabían que esto era un problema desde hace mucho, mucho tiempo. En 1997, Internet Explorer 3.0.2 advertía a los usuarios de sitios con contenido mixto con el siguiente cuadro de diálogo.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2016/09/IC310968.gif" class="kg-image" alt="" loading="lazy"></figure>
	<p>Hoy, Google Chrome muestra un círculo con una "i" en las https:// que tengan contenido no seguro.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2016/09/Screen-Shot-2016-09-22-at-11.22.08.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>Y Firefox muestra un candado con un símbolo de advertencia. Que salga un candado verde en cualquiera de estos navegadores requiere que todos y cada uno de los subrecursos individuales (recursos cargados por una página) se sirvan mediante HTTPS.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2016/09/Screen-Shot-2016-09-22-at-11.23.45.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>Si hubieras hecho clic en "Sí" en 1997, Internet Explorer habría ignorado los peligros de contenido mixto y habría pasado a cargar subrecursos usando texto no cifrado HTTP. Hacer clic en "No" les habría impedido cargarlos, lo que a menudo habría mostrado una página rota pero segura.</p>
	<h3 id="transici-n-a-contenido-totalmente-seguro"><strong>Transición a contenido totalmente seguro</strong></h3>
	<p>Es tentador, pero ingenuo, pensar que la solución para el contenido mixto es fácil: "Simplemente carga todo con https:// y arregla tu sitio de Internet". Desgraciadamente, la plétora de contenido cargado en los sitios web modernos propios y de terceros dificulta mucho que "simplemente" se haga ese cambio.</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2016/09/14127169401_54ca5e9c1f_z.jpg" class="kg-image" alt="" loading="lazy">
		<figcaption><a href="https://creativecommons.org/licenses/by/2.0" target="_blank">Imagen</a> <a href="https://www.flickr.com/photos/jeepersmedia/14127169401/in/photolist-nwnrhe-nwFTKm-nwpaXy-nd8jZZ-nwnqMB-6bsjcC-nwFSD3-aQ5Zk4-c4uV99-6itRSF-6iy17Y-8iDUTL-jb2wag-MvpRU-B61f-B61b-7GcrpR-jCxYo4-bTkuiD-2rLaU-a7VsfV-eyNEd-dUEjYu-4iVNkY-a3Gcnb-nJhD2H-nHasXC-5L7FZy-2i8iQ9-qN5RF-6HHCqb-6HDxai-6HDxnK-6HHCvU-5T9v3L-6ytdUs-6HHCyG-2WZgpg-5XZ5BD-b4SFeF-hNBK9K-8JDyeY-pbysVv-5dkLUi-6iy19o-6HDxiV-4o63bZ-kiN76q-ik1o7a-qkcqbe" target="_blank">CC BY 2.0</a> por Mike Mozart</figcaption>
	</figure>
	<p>En Wired <a href="https://www.wired.com/2016/09/now-encrypting-wired-com" target="_blank">documentaron</a> su transición a https:// con una serie de entradas de blog que muestran lo difícil que puede ser cambiar todo a HTTPS. Comenzaron en <a href="https://www.wired.com/2016/04/wired-launching-https-security-upgrade" target="_blank">abril</a> y pasaron 5 meses en el proceso (después de haberse preparado durante meses solo para pasar a https:// su sitio web principal). En mayo escribieron acerca de un <a href="https://www.wired.com/2016/05/wired-first-big-https-rollout-snag" target="_blank">imprevisto</a>:</p>
	<p><em>«[...] uno de los mayores retos de migrar a HTTPS es preparar todo nuestro contenido para que se entregue con conexiones seguras. Si se carga una página mediante HTTPS, todos los demás activos (como imágenes y archivos Javascript) deben cargarse mediante HTTPS. Hemos visto un gran volumen de informes sobre estas cuestiones de "contenido mixto" o casos en los que un activo HTTP inseguro se carga en el contexto de una página segura, HTTPS. Para hacer nuestro despliegue correctamente, debemos asegurarnos de que tenemos pocos problemas de contenido mixto, que entregamos tanto contenido seguro de WIRED.com como sea posible".</em></p>
	<p>En 2014, el New York Times identificó el contenido mixto como un <a href="http://open.blogs.nytimes.com/2014/11/13/embracing-https" target="_blank">gran obstáculo</a> para ser seguros:</p>
	<p><em>"Para migrar correctamente a HTTPS, todas las solicitudes de activos de página deben hacerse mediante un canal seguro. Es un desafío de enormes proporciones y hay un montón de piezas en movimiento. Debemos tener en cuenta los recursos que actualmente se están cargando desde dominios inseguros: todo desde JavaScript a activos de publicidad".</em></p>
	<p>Y el W3C <a href="https://www.w3.org/TR/upgrade-insecure-requests" target="_blank">reconoció</a> que esto era un gran problema diciendo: <em>"Especialmente, la comprobación de contenido mixto tiene el potencial de dar problemas a los administradores encargados de pasar gran cantidad de contenido preexistente a HTTPS. En particular, revisar el contenido antiguo y reescribir URL de recursos manualmente es una tarea enorme".</em> Y citó el <a href="http://www.bbc.co.uk/blogs/internet/entries/f7126d19-2afa-3231-9c4e-0f7198c468ab" target="_blank">enorme archivo</a> de la BBC como un ejemplo complicado.</p>
	<p>Pero no solo los sitios de medios de comunicación tienen un problema con el contenido mixto. A muchos usuarios de sistemas de gestión de contenidos les resulta difícil o imposible actualizar todos los enlaces que su sistema genera, ya que pueden estar escondidos entre archivos de configuración, código fuente o bases de datos. Además, los sitios que tienen que gestionar contenido generado por el usuario también se enfrentan a un problema con los URI (Uniform Resource Identifiers, en español, identificadores de recursos uniformes) de http://.</p>
	<h3 id="los-peligros-del-contenido-mixto"><strong>Los peligros del contenido mixto</strong></h3>
	<p>El contenido mixto viene con dos sabores: activo y pasivo. Los navegadores web modernos abordan los peligros de estos diferentes tipos de contenido mixto como sigue: el contenido mixto activo (el más peligroso) es automáticamente y totalmente bloqueado, el contenido mixto pasivo se permite pero aparece una advertencia.</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2016/09/6714200883_2ba8167533_b.jpg" class="kg-image" alt="" loading="lazy">
		<figcaption><a href="https://creativecommons.org/licenses/by/2.0" target="_blank">Imagen</a> <a href="https://www.flickr.com/photos/99mph/6714200883/in/photolist-bej31c-szQAb-i2swr-fnz3A-avkaMz-SB8LC-4kKK2r-6UFtFq-5EhUFH-i2sBe-dHEMmA-A4cie-aC6Wtc-4ZRUkX-srjkGs-5raEpY-eosHU-Ee7Ye-6vWtxh-6Pd2Nq-5Yz5u2-nU1Pfn-nBPiU4-N6B99-7WL2J9-FEkU5X-dU1PPb-JbHZad-aBEqKL-6w5v1r-65Nths-6DbhPs-nsfgLN-67jbBc-nAxzxi-7krEou-4GxJDe-nUsvgg-9kk75E-8AAsi-jJpNkj-4a5Znf-NQtE-d5xmAL-qiBCh-8cM-qXdkTc-9aLMpU-dWVoe-4A1jyr" target="_blank">CC BY 2.0</a> por Ben Tilley</figcaption>
	</figure>
	<p>El contenido activo es todo aquello que puede modificar el modelo de objetos del documento (la propia página web). Los recursos incluidos a través de las etiquetas <code>&lt;script&gt;</code>, <code>&lt;link&gt;</code>, <code>&lt;iframe&gt;</code> y <code>&lt;object&gt;</code>, los valores de CSS que utilizan <code>url</code> y cualquier cosa solicitada con <code>XMLHTTPRequest</code> pueden modificar una página, leer las cookies y acceder a las credenciales de usuario.</p>
	<p>El contenido pasivo es lo demás: imágenes, audio, vídeo, que están escritos en la página pero que no pueden acceder a la página.</p>
	<p>El contenido activo es una amenaza real porque si un atacante logra interceptar una solicitud de un URI de http://, puede reemplazar el contenido con el suyo. Esta no es una preocupación teórica. En 2015 Github fue atacado por un sistema denominado <a href="https://citizenlab.org/2015/04/chinas-great-cannon" target="_blank">Great Cannon</a> que interceptaba las solicitudes de archivos comunes de JavaScript mediante HTTP y los reemplazaba con una secuencia de comandos de ataque de JavaScript. Great Cannon convirtió en armas los equipos de usuarios inocentes interceptando el TCP (Transmission Control Protocol, en español, protocolo de control de transmisión) y explotando la vulnerabilidad inherente al contenido activo cargado desde los URI de http://.</p>
	<p>El contenido pasivo es un tipo diferente de amenaza: debido a que las solicitudes de contenido pasivo se envían sin peligro, un espía pueden controlar las solicitudes y extraer información. Por ejemplo, un espía bien situado puede controlar las cookies, las páginas web visitadas y potencialmente la información de autenticación.</p>
	<p>El complemento de Firefox <a href="http://codebutler.com/firesheep" target="_blank">Firesheep</a> puede utilizarse para vigilar una red local (por ejemplo, en una cafetería) para ver las solicitudes que se envían a través de HTTP y automáticamente robar cookies, permitiendo que un usuario robe la identidad de alguien con un solo clic.</p>
	<p>Hoy en día, los navegadores modernos bloquean el contenido activo que se carga de manera insegura, pero permiten el contenido pasivo. No obstante, la transición de todo a https:// es la única manera de solucionar todos los problemas de seguridad del contenido mixto.</p>
	<h3 id="arreglar-el-contenido-mixto-autom-ticamente"><strong>Arreglar el contenido mixto automáticamente</strong></h3>
	<p>Llevamos mucho tiempo queriendo ayudar a arreglar correctamente el contenido mixto y nuestro objetivo es que la web quede totalmente cifrada. Y, como otros servicios de Cloudflare, queríamos hacer de esto una experiencia de "un clic".</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2016/09/1078317132_0e96301aef_b--1-.jpg" class="kg-image" alt="" loading="lazy">
		<figcaption><a href="https://creativecommons.org/licenses/by/2.0" target="_blank">Imagen</a> <a href="https://www.flickr.com/photos/pinkmoose/1078317132/in/photolist-2DhE7G-pvcxy5-k8yyU-dGahX9-7cRyRV-byeo7f-cNka9m-5VqLgk-byenTE-dG4STe-dGafYU-dG4RnT-tAGvqC-tAGA6u-uxhxfW-4Wrx7L-dGahZQ-dGafW9-dG4QiZ-dGagHY-4K5jAk-dwrgVQ-dGafTE-xyEYA-dG4SYP-9LEfKd-7cRy3F-dGainJ-dGahAN-4LPBp9-bnWEe3-bNknmF-pTFtg2-dG4Ra8-6hZDxR-AobuPS-bM92up-dGafDC-yuJw-q8ZsgV-4GGuAM-4Twy1U-dGaf9s-dG4QfX-52rQZg-dpK5hj-dG4RSz-dpJU8v-4EJ5JP-5pvYKT" target="_blank">CC BY 2.0</a> por Anthony Easton</figcaption>
	</figure>
	<p>Tuvimos en cuenta diferentes enfoques:</p>
	<p><em>Insertar automáticamente la actualización de solicitudes inseguras (upgrade-insecure-requests) de la directiva de la Política de seguridad de contenido</em></p>
	<p>La directiva de <a href="https://www.w3.org/TR/upgrade-insecure-requests" target="_blank">actualización de funciones inseguras</a> puede agregarse en un encabezado de <a href="https://www.w3.org/TR/CSP" target="_blank">Política de seguridad de contenido</a> así:</p><!--kg-card-begin: markdown-->
	<pre><code>Content-Security-Policy: upgrade-insecure-requests
</code></pre>
	<!--kg-card-end: markdown-->
	<p>que ordena al navegador que actualice automáticamente cualquier solicitud HTTP a HTTPS. Esto puede ser útil si el propietario del sitio web sabe que todos los subrecursos están disponibles mediante HTTPS. El sitio web no tendrá que cambiar los URI de http:// insertados en la web a https://, el navegador se encargará de ello automáticamente.</p>
	<p>Por desgracia, hay una gran desventaja en la actualización de solicitudes inseguras. Puesto que el navegador actualiza ciegamente todos los URI a https://, independientemente de si el URI resultante funcionará realmente, las páginas pueden <a href="https://www.w3.org/TR/upgrade-insecure-requests/#example-failed" target="_blank">romperse</a>.</p>
	<p><em>Modificar todos los enlaces para que usen https://</em></p>
	<p>Puesto que no todos los navegadores utilizados por los visitantes de sitios web de Cloudflare son compatibles con la actualización de solicitudes inseguras, consideramos actualizar todos los URI de http:// a https:// a medida que las páginas atraviesan nuestro servicio. Puesto que podemos analizar y modificar páginas web en tiempo real, podríamos haber creado un servicio de "actualización de solicitudes inseguras" que no dependiera del soporte del navegador.</p>
	<p>Por desgracia, eso todavía trae el mismo problema de enlaces rotos cuando un URI de http:// se transforma en https:// pero el recurso no se puede cargar realmente usando HTTPS</p>
	<p><em>Modificar enlaces que llevan a otros sitios de Cloudflare</em></p>
	<p>Cloudflare ofrece a todos nuestros 4 millones de clientes <a href="https://blog.cloudflare.com/introducing-universal-ssl">Universal SSL</a> gratis y cubrimos un gran porcentaje del tráfico web que hemos considerado simplemente actualizando de http:// a https:// los URI que sabemos que van a funcionar (porque utilizan nuestro servicio).</p>
	<p>Esto resuelve parte del problema, pero no es una buena solución para el problema general de la actualización de HTTP a HTTPS</p>
	<p><em>Crear un sistema que reescribe los URI que se sabe que funcionarán con HTTPS</em></p>
	<p>Finalmente, nos decidimos a hacer algo inteligente: actualizar los URI de http:// a https:// si sabemos que pueden servirse usando HTTPS. Para averiguar qué enlaces son actualizables, recurrimos a la estupenda extensión <a href="https://www.eff.org/https-Everywhere" target="_blank">HTTPS Everywhere</a> de la EFF y a la lista<a href="https://github.com/chromium/hstspreload.appspot.com" target="_blank">HSTS preload</a> de Google Chrome para aumentar nuestro conocimiento de sitios de Cloudflare que tienen SSL habilitado.</p>
	<p>Agradecemos que la EFF haya aceptado gentilmente ayudarnos con este proyecto.</p>
	<p>El conjunto de reglas de HTTPS Everywhere va mucho más allá de simplemente cambiar de http:// a https://. Contiene las reglas y exclusiones que le permiten (y a nosotros también) apuntar a URI específicos. Por ejemplo, esta es una regla real de HTTP Everywhere para gstatic.com:</p><!--kg-card-begin: markdown-->
	<pre><code>&lt;rule from="^http://(csi|encrypted-tbn\d|fonts|g0|[\w-]+\.metric|ssl|t\d)\.
gstatic\.com/" to="https://$1.gstatic.com/"/&gt;
</code></pre>
	<!--kg-card-end: markdown-->
	<p>Utiliza una expresión regular para identificar subdominios específicos de gstatic.com que se pueden actualizar sin riesgos para utilizar HTTPS. El conjunto completo de reglas puede consultarse <a href="https://www.eff.org/https-everywhere/atlas" target="_blank">aquí</a>.</p>
	<p>Como tenemos que actualizar un gran número de URI insertados en páginas web (calculamos unos 5 millones por segundo) identificamos los analizadores HTML actuales y decidimos escribir uno nuevo para este tipo de tarea de reescritura. Escribiremos más acerca de su diseño, pruebas y rendimiento en una publicación futura.</p>
	<h3 id="reescrituras-https-autom-ticas"><strong>Reescrituras HTTPS automáticas</strong></h3>
	<p>Las reescrituras HTTPS automáticas ya están disponibles en el panel de control del cliente para todos los clientes de Cloudflare. Ahora, esta característica está deshabilitada por defecto y puede habilitarse con un clic:</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2016/09/Screen-Shot-2016-09-22-at-11.06.05.png" class="kg-image" alt="" loading="lazy"></figure>
	<p>Supervisaremos el rendimiento y la eficacia de esta función y la activaremos por defecto para los clientes de las versiones gratuita y profesional este año. También planeamos usar las funciones de la Política de seguridad de contenido para que los clientes tengan una vista automática de qué URI quedan por actualizar, a fin de que su transición a https:// sea lo más sencilla posible; a veces, solo averiguar qué URI deben cambiarse puede ser tan difícil como <a href="https://www.wired.com/2016/05/wired-first-big-https-rollout-snag" target="_blank">descubrieron</a> en Wired.</p>
	<p>Me encantaría que me contaras cómo te funciona esta característica.<br></p>
</div>