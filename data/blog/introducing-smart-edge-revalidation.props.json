{
	"post": {
		"id": "60faf26f4794ac01bc9d678c",
		"uuid": "32e68159-3564-4d89-911c-b6fe65558e45",
		"title": "Introducing Smart Edge Revalidation",
		"slug": "introducing-smart-edge-revalidation",
		"html": "<!--kg-card-begin: markdown--><p><em><small>This post is also available in <a href=\"http://blog.cloudflare.com/zh-cn/introducing-smart-edge-revalidation-zh-cn/\">简体中文</a>.</small></em></p>\n<!--kg-card-end: markdown--><figure class=\"kg-card kg-image-card\"><img src=\"http://blog.cloudflare.com/content/images/2021/07/image1-31.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>Today we’re excited to announce Smart Edge Revalidation. It was designed to ensure that compute resources are synchronized efficiently between our edge and a browser. Right now, as many as 30% of objects cached on Cloudflare’s edge do not have the HTTP response headers required for revalidation. This can result in unnecessary origin calls. Smart Edge Revalidation fixes this: it does the work to ensure that these headers are present, even when an origin doesn’t send them to us. The advantage of this? There’s less wasted bandwidth and compute for objects that do not need to be redownloaded. And there are faster browser page loads for users.</p><h2 id=\"so-what-is-revalidation\">So What Is Revalidation?</h2><figure class=\"kg-card kg-image-card\"><img src=\"http://blog.cloudflare.com/content/images/2021/07/Cache-Hit--Miss.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>Revalidation is one part of a longer story about efficiently serving objects that live on an origin server from an intermediary cache. Visitors to a website want it to be fast. One foundational way to make sure that a website is fast for visitors is to serve objects from cache. In this way, requests and responses do not need to transit unnecessary parts of the Internet back to an origin and, instead, can be served from a data center that is closer to the visitor. As such, website operators generally only want to serve content from an origin when content has changed. So how do objects stay in cache for as long as necessary?</p><p>One way to do that is with HTTP response headers.</p><p>When Cloudflare gets a response from an origin, included in that response are a number of headers. You can see these headers by opening any webpage, inspecting the page, going to the network tab, and clicking any file. In the response headers section there will generally be a header known as “<code>Cache-Control</code>.” This header is a way for origins to answer caching intermediaries’ questions like: is this object eligible for cache? How long should this object be in cache? And what should the caching intermediary do after that time expires?</p><!--kg-card-begin: html--><div style=\"position: relative; padding-top: 50.250178699070766%;\"><iframe src=\"https://iframe.videodelivery.net/0ec6b5865c9f8b287b854a5db67bae61?preload=true\" style=\"border: none; position: absolute; top: 0; height: 100%; width: 100%;\"  allow=\"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;\" allowfullscreen=\"true\"></iframe></div><!--kg-card-end: html--><p>How long something should be in cache can be specified through the <code>max-age</code> or <code>s-maxage</code> directives. These directives specify a TTL or time-to-live for the object in seconds. Once the object has been in cache for the requisite TTL, the clock hits 0 (zero) and it is marked as expired. Cache can no longer safely serve expired content to requests without figuring out if the object has changed on the origin or if it is the same.</p><p>If it has changed, it must be redownloaded from the origin. If it hasn’t changed, then it can be marked as fresh and continue to be served. This check, again, is known as revalidation.</p><p>We’re excited that Smart Edge Revalidation extends the efficiency of revalidation to everyone, regardless of an origin sending the necessary response headers</p><h2 id=\"how-is-revalidation-accomplished\">How is Revalidation Accomplished?</h2><p>Two additional headers, <a href=\"https://datatracker.ietf.org/doc/html/rfc7232#section-2.2\"><code>Last-Modified</code></a> and <a href=\"https://datatracker.ietf.org/doc/html/rfc7232#section-2.3\"><code>ETag</code></a>, are set by an origin in order to distinguish different versions of the same URL/object across modifications. After the object expires and the revalidation check occurs, if the <code>ETag</code> value hasn’t changed or a more recent <code>Last-Modified</code> timestamp isn’t present, the object is marked “revalidated” and the expired object can continue to be served from cache. If there has been a change as indicated by the <code>ETag</code> value or <code>Last-Modified</code> timestamp, then the new object is downloaded and the old object is removed from cache.</p><p>Revalidation checks occur when a browser sends a request to a cache server using <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Modified-Since\"><code>If-Modified-Since</code></a> or <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-None-Match\"><code>If-None-Match</code></a> headers. These <em>request headers</em> are questions sent from the browser cache about when an object has last changed that can be answered via the <code>ETag</code> or <code>Last-Modified</code> <em>response headers </em>on the cache server. For example, if the browser sends a request to a cache server with <code>If-Modified-Since: Tue, 8 Nov 2021 07:28:00 GMT</code> the cache server must look at the object being asked about and if it has not changed since November 8 at 7:28 AM, it will respond with a <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/304\">304 status code</a> indicating it’s unchanged. If the object has changed, the cache server will respond with the new object.</p><figure class=\"kg-card kg-image-card\"><img src=\"http://blog.cloudflare.com/content/images/2021/07/Cache-Response-Header.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>Sending a 304 status code that indicates an object can be reused is much more efficient than sending the entire object. It’s like if you ran a news website that updated every 24 hours. Once the content is updated for the day, you wouldn’t want to keep redownloading the same unchanged content from the origin and instead, you would prefer to make sure that the day’s content was just reused by sending a lightweight signal to that effect, until the site changes the next day.</p><p>The problem with this system of browser questions and revalidation responses is that sometimes origins don’t set <code>ETag</code> or <code>Last-Modified</code> headers, or they aren’t configured by the website’s admin, making revalidation impossible. This means that every time an object expires, it must be redownloaded regardless of if there has been a change or not, because we have to assume that the asset has been updated, or else risk serving stale content.</p><figure class=\"kg-card kg-image-card\"><img src=\"http://blog.cloudflare.com/content/images/2021/07/Origin-Response-Header.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>This is an incredible waste of resources which costs hundreds of GB/sec of needless bandwidth between the edge and the visitor. Meaning browsers are downloading hundreds of GB/sec of content they<em> may already have</em>. If our baseline of revalidation is around 10% of all traffic and in initial tests, Smart Edge Revalidation increased revalidation just under 50%, this means that without a user needing to configure <strong>anything</strong>, we can increase total revalidations by around 5%!</p><p>Such a large reduction in bandwidth use also comes with potential environmental benefits. Based on Cloudflare's carbon emissions per byte, the needless bandwidth being used could amount to 2000+ metric tons CO2e/year, the equivalent of the <a href=\"https://www.epa.gov/energy/greenhouse-gas-equivalencies-calculator\">CO2 emissions </a> from more than 400 cars in a year.</p><p>Revalidation also comes with a performance improvement because it usually means a browser is downloading less than 1KB of data to check if the asset has changed or not, while pulling the full asset can be 100sKB. This can improve performance and reduce the bandwidth between the visitor and our edge.</p><h2 id=\"how-smart-edge-revalidation-works\">How Smart Edge Revalidation Works</h2><p>When both <code>Last-Modified</code> and <code>Etag</code> headers are <em>absent</em> from the origin server response, Smart Edge Revalidation will use the time the object was cached on Cloudflare’s edge as the <code>Last-Modified</code> header value. When a browser sends a revalidation request to Cloudflare using <code>If-Modified-Since</code> or <code>If-None-Match</code>, our edge can answer those revalidation questions using the <code>Last-Modified</code> header generated from Smart Edge Revalidation. In this way, our edge can ensure efficient revalidation even if the headers are not sent from the origin.</p><p>Smart Edge Revalidation will be enabled automatically for all Cloudflare customers over the coming weeks. If this behavior is undesired, you can always ensure that Smart Edge Revalidation is not activated by <a href=\"https://web.dev/http-cache/#response-headers\">confirming your origin</a> is sending <code>ETag</code> or <code>Last-Modified</code> headers when you want to indicate changed content. Additionally, you could have your origin direct your desired revalidation behavior by making sure it sets appropriate <a href=\"https://support.cloudflare.com/hc/en-us/articles/115003206852-Understanding-Origin-Cache-Control\">cache-control headers</a>.</p><p>Smart Edge Revalidation is a win for everyone: visitors will get more content faster from cache, website owners can serve and revalidate additional content from Cloudflare efficiently, and the Internet will get a bit greener and more efficient.</p><p>Smart Edge Revalidation is the latest announcement to join the list of ways we're making our network more sustainable to help build a greener Internet — check out posts from earlier this week to learn about our <a href=\"http://blog.cloudflare.com/cloudflare-committed-to-building-a-greener-internet/\">climate commitments</a>, <a href=\"http://blog.cloudflare.com/announcing-green-compute/\">Green Compute with Workers</a>, <a href=\"https://assets.ctfassets.net/slt3lc6tev37/2YzIeTtzSbyKkM4GsryP5S/62ce0dff98e92a142281a0b462ce4408/Cloudflare_Emissions_Inventory_-_2020.pdf\">Carbon Impact Report</a>, <a href=\"http://blog.cloudflare.com/green-hosting-with-cloudflare-pages/\">Pages x Green Web Foundation partnership</a>, and <a href=\"http://blog.cloudflare.com/crawler-hints-how-cloudflare-is-reducing-the-environmental-impact-of-web-searches/\">crawler hints</a>.</p><figure class=\"kg-card kg-image-card\"><img src=\"http://blog.cloudflare.com/content/images/2021/07/Green-Cache.png\" class=\"kg-image\" alt loading=\"lazy\"></figure>",
		"comment_id": "60faf26f4794ac01bc9d678c",
		"feature_image": "http://blog.cloudflare.com/content/images/2021/07/image1-30.png",
		"featured": false,
		"visibility": "public",
		"created_at": "2021-07-23T17:46:39.000+01:00",
		"updated_at": "2023-11-17T00:39:57.000+00:00",
		"published_at": "2021-07-28T13:59:17.000+01:00",
		"custom_excerpt": "When both Last-Modified and Etag headers are absent from the origin response, Smart Edge Revalidation will use the time the object was cached on Cloudflare as the Last-Modified header value. When Cloudflare receives a revalidation request, our edge can respond using the generated header. ",
		"codeinjection_head": null,
		"codeinjection_foot": null,
		"custom_template": null,
		"canonical_url": null,
		"tags": [
			{
				"id": "610015f5cd1cea01bd6be02e",
				"name": "#BLOG-596",
				"slug": "hash-blog-596",
				"description": null,
				"feature_image": null,
				"visibility": "internal",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/404/"
			},
			{
				"id": "60fae1684794ac01bc9d6738",
				"name": "Impact Week",
				"slug": "impact-week",
				"description": "Cloudflare's mission is to help build a better Internet. We believe a better Internet can be not only a force for good, but an engine of global sustainability.",
				"feature_image": "http://blog.cloudflare.com/content/images/2022/12/2022-Impact-Week-Hero.png",
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/impact-week/"
			},
			{
				"id": "5d16450341acde0011a95157",
				"name": "Cache",
				"slug": "cache",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/cache/"
			},
			{
				"id": "5d16450341acde0011a951ee",
				"name": "Product News",
				"slug": "product-news",
				"description": "Product News (EN)",
				"feature_image": "http://blog.cloudflare.com/content/images/2020/10/Product-News-1.png",
				"visibility": "public",
				"meta_title": "Cloudflare Blog: Product News",
				"meta_description": "Collection of Cloudflare blog posts tagged 'Product News'.",
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/product-news/"
			},
			{
				"id": "5ed92bf4a4d58c01bce907a8",
				"name": "Edge",
				"slug": "edge",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/edge/"
			},
			{
				"id": "64a3e2b834124c000b00b717",
				"name": "Developer Platform",
				"slug": "developer-platform",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/developer-platform/"
			},
			{
				"id": "6556b5f37f068e000a84fdfe",
				"name": "Agile Developer Services",
				"slug": "agile-developer-services",
				"description": null,
				"feature_image": null,
				"visibility": "public",
				"meta_title": null,
				"meta_description": null,
				"og_image": null,
				"og_title": null,
				"og_description": null,
				"twitter_image": null,
				"twitter_title": null,
				"twitter_description": null,
				"codeinjection_head": null,
				"codeinjection_foot": null,
				"canonical_url": null,
				"accent_color": null,
				"url": "http://blog.cloudflare.com/tag/agile-developer-services/"
			}
		],
		"authors": [
			{
				"id": "5d1644b141acde0011a94f9e",
				"name": "Alex Krivit",
				"slug": "alex",
				"profile_image": "http://blog.cloudflare.com/content/images/2018/08/RE0BQ6EF_400x400.jpg",
				"cover_image": "http://blog.cloudflare.com/content/images/2018/08/general@2x-68.png",
				"bio": null,
				"website": null,
				"location": null,
				"facebook": null,
				"twitter": "@ackriv",
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/alex/"
			},
			{
				"id": "5e78c6e942df4b01bd4fcd4f",
				"name": "Yuchen Wu",
				"slug": "yuchen",
				"profile_image": "https://blog-cloudflare-com-assets.storage.googleapis.com/2020/03/yuchen--1-.jpg",
				"cover_image": "https://blog-cloudflare-com-assets.storage.googleapis.com/2020/03/general@2x-12.png",
				"bio": null,
				"website": null,
				"location": null,
				"facebook": null,
				"twitter": null,
				"meta_title": null,
				"meta_description": null,
				"url": "http://blog.cloudflare.com/author/yuchen/"
			}
		],
		"primary_author": {
			"id": "5d1644b141acde0011a94f9e",
			"name": "Alex Krivit",
			"slug": "alex",
			"profile_image": "http://blog.cloudflare.com/content/images/2018/08/RE0BQ6EF_400x400.jpg",
			"cover_image": "http://blog.cloudflare.com/content/images/2018/08/general@2x-68.png",
			"bio": null,
			"website": null,
			"location": null,
			"facebook": null,
			"twitter": "@ackriv",
			"meta_title": null,
			"meta_description": null,
			"url": "http://blog.cloudflare.com/author/alex/"
		},
		"primary_tag": null,
		"url": "http://blog.cloudflare.com/introducing-smart-edge-revalidation/",
		"excerpt": "When both Last-Modified and Etag headers are absent from the origin response, Smart Edge Revalidation will use the time the object was cached on Cloudflare as the Last-Modified header value. When Cloudflare receives a revalidation request, our edge can respond using the generated header. ",
		"reading_time": 6,
		"access": true,
		"comments": false,
		"og_image": "http://blog.cloudflare.com/content/images/2021/07/Introducing-Project-SER---Smart-Edge-Revalidation-OG-3.png",
		"og_title": null,
		"og_description": null,
		"twitter_image": "http://blog.cloudflare.com/content/images/2021/07/Introducing-Project-SER---Smart-Edge-Revalidation-OG-2.png",
		"twitter_title": null,
		"twitter_description": null,
		"meta_title": null,
		"meta_description": "When both Last-Modified and Etag headers are absent from the origin response, Smart Edge Revalidation will use the time the object was cached on Cloudflare as the Last-Modified header value. When Cloudflare receives a revalidation request, our edge can respond using the generated header. ",
		"email_subject": null,
		"frontmatter": null,
		"feature_image_alt": null,
		"feature_image_caption": null
	},
	"locale": "en-us"
}