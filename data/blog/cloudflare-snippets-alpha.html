<div class="mb2 gray5">6 min read</div>
<div class="mt4">This post is also available in <a href="https://blog.cloudflare.com/ja-jp/cloudflare-snippets-alpha">日本語</a> and <a href="https://blog.cloudflare.com/es-es/cloudflare-snippets-alpha">Español</a>.</div><img class="mr2" src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/QsjzJhsf8r9VVdwAMAEDk/815a2c2bb02fef2888af5a1dfc54a4e4/cloudflare-snippets-alpha.png" alt="">
<div class="post-content lh-copy gray1">
	<p></p>
	<p>Today we are excited to announce that <a href="https://blog.cloudflare.com/snippets-announcement">Cloudflare Snippets</a> is available in alpha. In the coming weeks we will be opening access to our waiting list.</p>
	<h3>What are Snippets?</h3>
	<p>Over the past two years we have released a number of new rules products such as Transform Rules, Cache Rules, Origin Rules, Config Rules and Redirect Rules. These new products give more control to customers on how we process their traffic as it flows through our global network. The feedback on these products so far has been overwhelmingly positive. However, our customers still occasionally need the ability to do more than the out-of-the-box functionality allows. Not just adding an HTTP header - but performing some advanced calculation to create the output.</p>
	<p>For these cases, Cloudflare Snippets comes to the rescue. Snippets are small pieces of user created JavaScript that are run by Cloudflare before your website, API or application is served to the user. If you're familiar with <a href="https://developers.cloudflare.com/workers">Cloudflare Workers</a>, our robust developer platform, then you'll find Snippets to be a familiar addition. For those who are not, Snippets are designed to be easily created, tested, and deployed. Providing you with the ability to deploy your custom JavaScript Snippet to our <a href="https://www.cloudflare.com/en-gb/network">global network</a> in a matter of seconds.</p>
	<p>While Snippets are built on top of the Workers Platform, they do have a number of differences. The first lies in how Snippets operate within the <a href="https://developers.cloudflare.com/ruleset-engine/about/rulesets">Ruleset Engine</a> as a dedicated new phase, similar to <a href="https://blog.cloudflare.com/transform-rules-requests-transform-and-roll-out">Transform Rules</a> and <a href="https://blog.cloudflare.com/introducing-cache-rules">Cache Rules</a>. This means that customers can select and execute a Snippet based on any Ruleset Engine filter. This gives customers the flexibility to run a Snippet on every request or apply it selectively based on various criteria they provide, such as specific bot scores, country of origin, or certain cookies.</p>
	<p>Moreover, Snippets are cumulative in nature, allowing users to have multiple Snippets that execute if they meet the defined conditions. For instance, one Snippet could add an HTTP header and another rewrite the URL, both of which will be executed if their respective conditions are met.</p>
	<p>Users now have the flexibility to choose between using a rule for simple, no-code-required tasks, such as adding a basic response Cookie header with Transform Rules, or writing a Cloudflare Snippet for more complex cookie functionality, such as dynamically changing the host or date within the cookie value. Snippets empower customers to get the job done quickly and effortlessly within the Cloudflare ecosystem, without incurring extra expenses (though a fair usage cap applies).</p>
	<h3>The difference between Snippets and Workers</h3>
	<p>Another significant advantage is that Cloudflare Snippets are available across all plan levels at no extra cost. This empowers customers to migrate their simple workloads from legacy solutions like VCL to the Cloudflare platform, actively reducing their monthly expenses.</p>
	<p>Whether you're on the <a href="https://www.cloudflare.com/plans/free">Free</a>, Pro, Business, or Enterprise plan, Snippets are at your disposal. Free plan users have access to five Snippets per zone, while Pro, Business, and Enterprise plans offer 10, 25, and 50 Snippets per zone, respectively.</p>
	<p>In terms of resources, Cloudflare Snippets are lightweight compared to Workers. They have a maximum execution time of 5ms, a maximum memory of 2MB, and a total package size of 32KB. These limits are more than sufficient for common use cases like modifying HTTP headers, rewriting URLs, and routing traffic tasks that do not require the additional features and resources Cloudflare Workers has to offer.</p>
	<p>Snippets also run before Workers; this means that users will be able to move simple logic out of a Cloudflare Worker into Snippets or use Cloudflare Workers and its features to further modify a request. The <a href="https://blog.cloudflare.com/traffic-sequence-which-product-runs-first">Traffic Sequence UI</a> has also been updated to incorporate Snippets allowing you to easily understand how all the products fit together and understand how HTTP requests flow between them.</p>
	<figure class="kg-card kg-image-card ">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/6mzGrins7tVyfuUDsaHVYI/2a990cdd3e9c4d488bc803e1857074b2/image4-13.png" alt="" class="kg-image" width="1386" height="884" loading="lazy">

	</figure>
	<h3>What can you build with Cloudflare Snippets?</h3>
	<p>Snippets allow customers to migrate their existing workloads to Cloudflare. For example, customers that wish to set a dynamic cookie on all of their responses for a percentage of requests can use the `math.random` function within their Snippet.</p>
	<figure class="kg-card kg-image-card kg-width-wide">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/6FMCvZXK5bgjhsyzLkFo4G/8dde6a902e294596d74b57d2fe5a0951/Screenshot-2023-06-12-at-15.40.26.png" alt="" class="kg-image" width="1600" height="902" loading="lazy">

	</figure>
	<p>By leveraging the Ruleset Engine, we can improve the implementation by moving the set cookie logic to the rule instead of executing it on every response or handling it within a Snippet. For example if I only want to set this cookie on my shop subdomain and only for German or UK customers I can create the following rule.</p>
	<figure class="kg-card kg-image-card kg-width-wide">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/6hvl6NIA5Qd6JUu9zCJQTl/7c8c81c539cf11b621766aba2c4e076f/pasted-image-0-1.png" alt="" class="kg-image" width="1600" height="1334" loading="lazy">

	</figure>
	<p>This approach ensures that the snippet will only execute when necessary, minimizing additional processing and reducing the complexity of the code required.</p>
	<p>We are excited to see what other use cases Cloudflare Snippets unlock for our customers.</p>
	<h3>Using Snippets</h3>
	<p>Snippets are located within the Rules section of the Cloudflare Dashboard. Here customers can use the UI to write, preview and deploy their first Snippet.</p>
	<figure class="kg-card kg-image-card kg-width-wide">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/65jEwkBoBxpxT5hDxVcXFX/38e95c1ed5598456c86a7cd018624fc8/pasted-image-0--1-.png" alt="" class="kg-image" width="1600" height="677" loading="lazy">

	</figure>
	<p>As with all Cloudflare products users can deploy their Snippets via the API and Terraform. Allowing users to easily incorporate Snippets within their CI/CD pipelines. The added benefit of using the Ruleset engine allows users to test their code on a subset of traffic. For example, by specifying your own office IP or secret header within the filter that will only trigger the Snippet if present. Finally we will be integrating Snippets within the <a href="https://developers.cloudflare.com/api/operations/account-request-tracer-request-trace">Account Request Tracer</a> allowing users to easily identify all Rules that are executing on a specific request.</p>
	<h3>How did we build Snippets?</h3>
	<p>During Developer Week, we discussed the process of <a href="https://blog.cloudflare.com/building-cloudflare-on-cloudflare">Building Cloudflare on Cloudflare</a>, using our Cloudflare Workers developer platform to enhance our products in terms of speed, robustness, and ease of development. Snippets, the latest Cloudflare product, is built on top of Workers for Platforms.</p>
	<figure class="kg-card kg-image-card kg-width-wide">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/6ZjJrhzjJN19EPkBsFs1pF/8aa3cfe243be0e881229eaa07ace3391/pasted-image-0--2-.png" alt="" class="kg-image" width="1600" height="434" loading="lazy">

	</figure>
	<p>A snippet is a piece of user-defined JavaScript that, upon creation, generates a unique Snippet ID. This Snippet ID is then associated with a user-defined rule created using the Rule Engine syntax. When a rule is created, a unique Rule ID is assigned to it. The Snippet ID and Rule ID are then linked in a one-to-one relationship. Customers have the flexibility to create multiple snippets and rules, each with its own unique Snippet and Rule. Customers with multiple snippets can easily prioritize them within the user interface (UI) or via API, similar to our other rules-based products.</p>
	<p>When a customer's request reaches Cloudflare, we evaluate the request parameters against the created Snippet rules within a user's zone. If a Snippet rule is matched, the corresponding unique Snippet ID is added to a Snippet table. Once all the rules have been evaluated and the Snippet table has been compiled, the completed table is passed to the Snippets Internal Worker Service.</p>
	<figure class="kg-card kg-image-card kg-width-wide">

		<img src="https://cf-assets.www.cloudflare.com/slt3lc6tev37/5pfQrVdEz8jHYz1pTV7HYI/33db32f7bf3332cb3a00c638f330f201/pasted-image-0--3-.png" alt="" class="kg-image" width="1600" height="660" loading="lazy">

	</figure>
	<p>This Worker receives all the Snippet IDs stored within the table that are to be sequentially executed. The system's design allows for the flexibility of keeping Snippets simple, where users can manage individual snippets independently, that execute on the same request. This approach grants users the freedom to control and fine-tune their own individual snippets rather than merging them into a single entity.</p>
	<p>Each Snippet receives the modified request from the previous Snippet and applies new modifications to it. After executing the final Snippet IDs, the resulting modified request is passed back to FL for the next step of the request processing.</p>
	<h3>Snip into action</h3>
	<p>We are excited to see the innovative use cases that our customers will create with Snippets. In the upcoming weeks, we will start granting access to the alpha version to those on our waitlist. If you haven't joined the waitlist yet, you can still <a href="https://www.cloudflare.com/en-gb/lp/cloudflare-snippets">sign up</a> with an open beta available later this year.</p>
</div>