<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2022/03/image3-13.png" class="kg-image" alt="Wie Cloudflare den von WhatsApp Web an Nutzer übermittelten Programmcode prüft" loading="lazy"></figure>
	<p>Cloudflare hilft WhatsApp dabei, sicherzustellen, dass der für die sichere Nachrichtenübermittlung verwendete Programmcode nicht manipuliert wurde. Hier erfahren Sie, wie wir dabei vorgehen.</p>
	<p>Woher wissen Sie beim Aufrufen einer Website, dass Ihr Webbrowser auch wirklich den für die Ausführung vorgesehenen Programmcode herunterlädt? Das Web bietet deutlich weniger Gewissheit, dass der Programmcode nicht manipuliert wurde, als dies bei einer App für Mobilgeräte aus einem vertrauenswürdigen App Store der Fall ist. <a href="https://engineering.fb.com/2022/03/10/security/code-verify/" target="_blank">Wir freuen uns, eine Partnerschaft mit WhatsApp</a> zur Bereitstellung eines Systems verkünden zu können, mit dem die Nutzer beim Aufrufen von WhatsApp über das Internet die Sicherheit haben, dass auch wirklich der von dem Unternehmen beabsichtigte Programmcode ausgeführt wird. </p>
	<p>WhatsApp wird immer häufiger über den Browser genutzt und auch die Zahl der gefährdeten Anwender – darunter Journalisten und Aktivisten, etwa im Bereich Menschenrechte – steigt. Deshalb wollte das Unternehmen Maßnahmen ergreifen, um Usern, die den Dienst über den Browser nutzen, eine gewisse Sicherheit bieten zu können. Akteuren, die den für die Ende-zu-Ende-Verschlüsselung von Nachrichten zwischen WhatsApp-Nutzern verantwortlichen Programmcode kompromittieren oder manipulieren wollen, wollte WhatsApp deutlich mehr entgegensetzen als bisher. Dafür ist das Unternehmen an uns herangetreten.</p>
	<p>Wie funktioniert die Abwehr? Cloudflare speichert den Hash des Programmcodes, der bei WhatsApp-Nutzern ausgeführt werden sollte. Wenn ein User WhatsApp im Browser öffnet, vergleicht die Erweiterung WhatsApp Code Verify einen Hash des im Browser ausgeführten Programmcodes mit dem bei Cloudflare gespeicherten Hashwert. So lässt sich leicht feststellen, ob alles seine Ordnung hat.</p>
	<p>Durch einen Abgleich von Hashes manipulierte oder beschädigte Dateien aufzuspüren, ist an sich keine neue Idee. Die Innovation besteht erstens darin, das Verfahren zu automatisieren, damit es in großem Maßstab eingesetzt werden kann. Zweitens wird dafür gesorgt, dass es für WhatsApp-Anwender „einfach funktioniert“. In Anbetracht der Verbreitung von WhatsApp und dem unausgesprochenen Vertrauen, das Cloudflare entgegengebracht wird, möchten wir einen tieferen Einblick in die technische Funktionsweise dieses Systems geben. </p>
	<p>Zunächst wollen wir aber noch explizit darauf hinweisen, dass Cloudflare einen vertrauenswürdigen Überprüfungsendpunkt zur Unterstützung von Code Verify bereitstellt. Chat- und sonstige Nachrichten sowie sonstiger Datenverkehr zwischen WhatsApp-Nutzern wird niemals an Cloudflare übermittelt; dieser Traffic bleibt vertraulich und wird Ende-zu-Ende verschlüsselt. Im Rahmen dieses Systems werden keine Nachrichten oder Medieninhalte durch das Cloudflare-Netzwerk geleitet. Darauf legen wir als zuverlässiger Drittanbieter besonderen Wert.<br></p>
	<h3 id="erleichterte-verifizierung">Erleichterte Verifizierung</h3>
	<p>Machen wir zunächst eine kleine Zeitreise zurück in das Jahr 2013, als die auf Red Hat basierende und sich inzwischen großer Beliebtheit erfreuende Linux-Distribution Fedora gerade herausgekommen war. Sie wollen sie gern herunterladen, möchten aber sicherstellen, dass es sich auch um das „echte“ Fedora-Betriebssystem handelt und nicht um eine Fake-Version, mit der Ihre Passwörter abgegriffen oder Ihre Tastatureingaben protokolliert werden. Sie rufen also die Downloadseite auf, beginnen mit dem Herunterladen und bekommen einen MD5-Hashwert (der damals als sicher galt) angezeigt. Nach vollendetem Download führen Sie „md5 fedora-download.iso“ aus und vergleichen den Hashwert mit dem auf der Seite. Da beide übereinstimmen, sind Sie beruhigt und beginnen damit, Fedora auf Ihrem Rechner zu installieren.</p>
	<p>Doch halt: Wenn auf der Download-Webseite auch der Hashwert bereitgestellt wird, könnte dann nicht jemand, der Böses im Schilde führt, sowohl das herunterzuladende Programm als auch den Hashwert durch eigene Inhalte ersetzen? Der „md5“-Abgleich würde weiterhin ein positives Ergebnis liefern. Aber es besteht keinerlei Garantie, dass es sich um die „echte“ (nicht manipulierte) Version der Software handelt, die heruntergeladen werden soll.</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://lh3.googleusercontent.com/80nl675dGLdiR6iokx0GTDyxEJ0QhnrFoDvJoHjMSFmO6Y8IVgR5mMBwnK5U8dmzt2iFpR6FVFdjIo9HreolRgwf5BAAxnsTcjOD6Er_hyuxKeYl16IQcCZhBHHrHkQByeNrHCMI" class="kg-image" alt="" loading="lazy">
		<figcaption>Auch im Jahr 2022 ist es weiterhin üblich, Hashwert und Software auf demselben Server zu hosten.</figcaption>
	</figure>
	<p>Mit anderen Ansätzen wird versucht, diese Methode zu optimieren. So können unterzeichnete Signaturen bereitgestellt werden. Bei diesen können die Nutzer verifizieren, dass sie mit „bekannten“ öffentlichen Schlüsseln signiert wurden, die an anderer Stelle gehostet werden. Werden solche Signaturen (auch „Hashes“ genannt) bei einem vertrauenswürdigen Drittanbieter gehostet, erschwert das Manipulationen ganz erheblich. Allerdings muss der User in diesem Fall nicht nur wissen, wem er trauen kann, sondern sich auch Kenntnisse zu Tools wie <a href="https://www.debian.org/CD/verify" target="_blank">GnuPG</a> aneignen. Insofern ist die für das moderne Internet erforderliche Vertrauens- und Verifizierungsgrundlage für Software damit nicht gegeben.</p>
	<p>An diesem Punkt kommen <a href="https://chrome.google.com/webstore/detail/code-verify/llohflklppcaghdpehpbklhlfebooeog/related" target="_blank">Code Verify</a> und Cloudflare ins Spiel. Die von Meta Open Source veröffentlichte Erweiterung automatisiert das Verfahren: Der kryptografische Hashwert der von WhatsApp verwendeten Bibliotheken wird lokal erstellt <em> und </em> mit einem Hash von einer vertrauenswürdigen externen Quelle (in diesem Fall Cloudflare) abgeglichen. </p>
	<p>In der folgenden Abbildung soll der Ablauf ein wenig veranschaulicht werden. Sie zeigt, wie die drei Beteiligten – der Nutzer, WhatsApp und Cloudflare – miteinander interagieren.</p>
	<figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2022/03/image1-37.png" class="kg-image" alt="" loading="lazy">
		<figcaption>Das Schaubild zeigt die vier Schritte zur Verifizierung des Programmcodes von WhatsApp Web.</figcaption>
	</figure>
	<p>Mit diesen vier Schritten wird im Wesentlich überprüft, ob der Programmcode nicht nachträglich verändert wurde:</p>
	<ol>
		<li>WhatsApp veröffentlicht die neueste Version der eigenen JavaScript-Bibliotheken auf firmeneigenen Servern und übermittelt den zugehörigen Hashwert für diese Version an den Überprüfungsendpunkt von Cloudflare.</li>
		<li>Ein Webclient von WhatsApp ruft die neuesten Bibliotheken von WhatsApp ab.</li>
		<li>Anschließend ruft die Browsererweiterung Code Verify über eine gesonderte, sichere Verbindung den Hashwert für diese Version bei Cloudflare ab.</li>
		<li>Code Verify gleicht den Hashwert von Cloudflare, über dessen Vertrauenswürdigkeit Gewissheit herrscht, mit dem lokal generierten Hashwert für die Bibliotheken ab.</li>
	</ol>
	<p>Stimmen die beiden Hashes überein, was unter so gut wie allen Umständen der Fall sein sollte, gilt der Programmcode aus Sicht der Erweiterung als „verifiziert“. Falls die Hashwerte jedoch <em>nicht</em> deckungsgleich sind, wird auf dem Browser des Nutzers ein anderer Programmcode ausgeführt, als von WhatsApp beabsichtigt.</p>
	<h3 id="sicherheit-muss-unkompliziert-sein">Sicherheit muss unkompliziert sein</h3>
	<p>Dieses Verfahren – und die Tatsache, dass es für den Nutzer automatisch abläuft – trägt dazu bei, auf skalierbare Weise für Transparenz zu sorgen. Müssten die Anwender die Hashwerte selbst manuell anfordern, generieren und abgleichen, würde nur eine kleine Menge an technisch versierten Usern Manipulationen entdecken können. Aus Sicht eines so großen Diensts wie WhatsApp wäre eine solche Herangehensweise weder sonderlich praktikabel noch nutzerfreundlich. </p>
	<p>Bei diesem Vorgehen bestehen Parallelen zu einer Reihe von Technologien, die heute genutzt werden. Dazu zählt <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity" target="_blank">Subresource Integrity</a> in Webbrowsern: Bei der Anforderung eines Elements von einem Drittanbieter (etwa eines Skripts oder Stylesheets) überprüft der Browser, ob dieses dem beschriebenen Hash entspricht. Ist das nicht der Fall, wird das Element nicht geladen. Dadurch wird verhindert, dass potenziell kompromittierte Skripte Nutzerdaten abgreifen. Weitere Verfahren sind das Projekt <a href="https://certificate.transparency.dev/" target="_blank">Certificate Transparency</a> und das damit verwandte Vorhaben <a href="https://binary.transparency.dev/" target="_blank">Binary Transparency</a>. Beide bieten öffentlich überprüfbare Transparenz für kritische Assets, unter anderem in Form von WebPKI-Zertifikaten und weiteren Binärblobs. Das in diesem Beitrag beschriebene Verfahren lässt sich – noch – nicht für beliebige Assets skalieren. Wir prüfen aber Möglichkeiten für die Ausweitung dieses Angebots auf ein breiter ausgelegtes und in größerem Stil nutzbares System wie Binary Transparency.</p>
	<p>Bei unserem Bemühen um mehr Datenschutzfreundlichkeit und Sicherheit im Web ist die Zusammenarbeit mit dem Team von WhatsApp erst der Anfang. &nbsp;Künftig wollen wir auch anderen Unternehmen dabei helfen, zu überprüfen, ob bei den Nutzern auch wirklich der Programmcode ankommt, der ausgeführt werden soll. Der Schutz der Internetanwender im großen Maßstab und die Gewährleistung des Datenschutzes gehören zu den Grundprinzipien von Cloudflare und wir freuen uns schon darauf, den Rest des Jahres 2022 weiter auf diese Ziele hinzuarbeiten.</p>
</div>