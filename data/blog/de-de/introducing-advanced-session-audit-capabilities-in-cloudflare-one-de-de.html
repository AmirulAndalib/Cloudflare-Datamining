<div class="mb2 gray5">6 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/11/image5.png" class="kg-image" alt="" loading="lazy" width="1999" height="1126"></figure>
	<p>Durch das Definieren von genau auf die jeweilige Anwendung, den jeweiligen Nutzer und das jeweilige Geräte abgestimmten Kontrollen und Autorisierungsrichtlinien wird das Fundament für Zero Trust geschaffen. Damit die Vorschriften und Sicherheitsvorgaben eingehalten werden können, muss ein System über ausreichend umfangreiche Möglichkeiten zur Feinabstimmung verfügen. Eine große Zahl von Kontrollen hat unter Umständen aber einen Haken: Um Nutzerprobleme zu beheben, muss ein Administrator eine komplexe Kombination von Variablen in Bezug auf Anwendungen, Nutzeridentität und Geräteinformationen berücksichtigen. Das kann bedeuten, dass Protokolle sorgfältig überprüft werden müssen.</p>
	<p>Unserer Meinung nach gibt es dafür aber einen besseren Weg. Ab heute können Administratoren alle aktiven Nutzersitzungen und die damit verbundenen Daten, die von ihren Cloudflare One-Richtlinien verwendet werden, einfach kontrollieren. Dadurch erhält man das Beste aus beiden Welten: extrem fein justierte Kontrollen und gleichzeitig verbesserte Fehlerbehebungs- und Diagnosemöglichkeiten für <a href="https://www.cloudflare.com/learning/security/glossary/what-is-zero-trust" target="_blank">Zero Trust</a>-Implementierungen mit einer einzigen, einfachen Steuerungsebene. Damit können Administratoren nun auf Informationen zugreifen, die zuvor im Browser des Nutzers gespeichert wurden oder sich dynamisch geändert haben, ohne einen Endnutzer zu belästigen oder Protokolle durchforsten zu müssen.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/11/image4.png" class="kg-image" alt="" loading="lazy" width="1828" height="893"></figure>
	<h3 id="eine-kurze-einf%C3%BChrung-in-die-authentifizierung-und-autorisierung-bei-anwendungen"><strong>Eine kurze Einführung in die Authentifizierung und Autorisierung bei Anwendungen</strong></h3>
	<p><em>Authentifizierung</em> und <em>Autorisierung</em> sind die beiden Komponenten, die von einer Zero Trust-Richtlinie ausgewertet werden, bevor diese einem Nutzer den Zugriff auf eine Ressource erlaubt.</p>
	<p>Bei der <strong>Authentifizierung</strong> wird die Identität eines Nutzers, eines Geräts oder eines Systems überprüft. Zu den üblichen <a href="https://www.cloudflare.com/learning/access-management/what-is-authentication" target="_blank">Authentifizierungsmethoden</a> gehören die Eingabe von Benutzernamen und Kennwörtern, die Vorlage eines digitalen Zertifikats oder sogar biometrischer Daten wie Fingerabdrücke oder Gesichtsscans. Bei der <a href="https://www.cloudflare.com/learning/access-management/what-is-multi-factor-authentication" target="_blank">Multi-Faktor-Authentifizierung (MFA)</a> werden zwei oder mehr separate Authentifizierungsmethoden vorgeschrieben, um die Sicherheit zu erhöhen, z. B. ein Security-Token in Kombination mit einem Passwort.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/11/image6.png" class="kg-image" alt="" loading="lazy" width="814" height="586"></figure>
	<p>Unter <strong>Autorisierung</strong> versteht man das Gewähren oder Verweigern des Zugriffs auf bestimmte Ressourcen oder der erforderlichen Berechtigungen nach erfolgreicher Authentifizierung. Dabei wird festgelegt, was die authentifizierte Einheit innerhalb des Systems tun darf und was nicht.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/11/image1-3.png" class="kg-image" alt="" loading="lazy" width="1555" height="757"></figure>
	<h3 id="mechanismen-der-authentifizierungautorisierung-bei-anwendungen"><strong>Mechanismen der Authentifizierung/Autorisierung bei Anwendungen</strong></h3>
	<p>Im Fall von Webanwendungen, auf die hier der Fokus gelegt werden soll, werden im Allgemeinen HTTP-Cookies zur Durchführung sowohl der Authentifizierung als auch der Autorisierung verwendet.</p>
	<p><strong>Authentifizierung:</strong></p>
	<ol>
		<li><strong>Login:</strong> Meldet sich ein User bei einer Webanwendung durch Eingabe seines Benutzernamens und seines Kennworts an, gleicht die Applikation diese Anmeldedaten mit ihrer Datenbank oder einem <a href="https://www.cloudflare.com/learning/access-management/what-is-an-identity-provider" target="_blank">Identitätsanbieter (IdP)</a> ab. Bei der Authentifizierung können auch zusätzliche Faktoren einbezogen werden. Wird eine Übereinstimmung festgestellt, erachtet der Server oder der externe Sicherheitsdienst (z. B. Cloudflare Access) den Nutzer als authentifiziert.</li>
		<li><strong>Cookie/Token-Erstellung:</strong> Der Server erstellt dann eine Sitzung für den Nutzer in Form eines Cookies oder JSON-Web-Token. Das Cookie ist für einen bestimmten Zeitraum gültig, nach dessen Ablauf sich der Nutzer erneut authentifizieren muss.</li>
		<li><strong>Senden und Speichern von Cookies</strong>: Der Server sendet eine Antwort an den Browser des Nutzers zurück, die die Sitzungs-ID und andere identifizierende Informationen zu dem Nutzer in dem Cookie enthält. Der Browser speichert dann dieses Cookie. Damit kann der Nutzer bei weiteren Anfragen wiedererkannt werden.</li>
	</ol>
	<p><strong>Autorisierung:</strong></p>
	<ol>
		<li><strong>Folgende Anfragen:</strong> Bei allen folgenden Anfragen an die Webanwendung fügt der Browser des Nutzers automatisch das Cookie (mit der Sitzungs-ID und anderen identifizierenden Informationen) in die Anfrage ein.</li>
		<li><strong>Serverseitige Verifizierung:</strong> Der Server erhält die Nutzerdaten aus dem Cookie und prüft, ob die Sitzung gültig ist. Ist das der Fall, ruft er auch die Nutzerdaten und die mit der Sitzungs-ID verbundenen Zugriffsberechtigungen ab.</li>
		<li><strong>Berechtigungsentscheidung: </strong>Auf Grundlage der Zugriffsberechtigungen des Nutzers entscheidet der Server, ob der Nutzer berechtigt ist, die angeforderte Operation durchzuführen oder auf die angeforderte Ressource zuzugreifen.</li>
	</ol>
	<p>So bleibt die Authentifizierung des Nutzers bei allen folgenden Anfragen bestehen (und seine Berechtigung kann überprüft werden), bis die Sitzung abläuft oder er sich ausloggt.</p>
	<p>In modernen Webanwendungen wird dieser Sitzungsstatus in der Regel in Form eines JSON-Web-Token (JWT) gespeichert.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/11/image8.png" class="kg-image" alt="" loading="lazy" width="1820" height="678"></figure>
	<h3 id="fehlersuche-bei-jwt-basierter-authentifizierung"><strong>Fehlersuche bei JWT-basierter Authentifizierung</strong></h3>
	<p>JWT werden in vielen modernen Webanwendungen und <a href="https://www.cloudflare.com/learning/access-management/what-is-ztna" target="_blank">Zero Trust Network Access (ZTNA)</a>-Lösungen wie Cloudflare Access zur Authentifizierung und Autorisierung verwendet. Ein JWT enthält eine Payload, also Informationen zu dem Nutzer und möglicherweise andere Daten in verschlüsselter Form, und wird vom Server signiert, um Manipulationen zu verhindern. JWT werden häufig zustandslos verwendet, d. h. der Server speichert keine Kopie sämtlicher JWT, sondern verifiziert und entschlüsselt einfach jedes JWT, das mit Anfragen eintrifft. Aufgrund ihrer Zustandslosigkeit sind JWT für die Verwaltung von Nutzersitzungen nicht auf ein zentrales System angewiesen, wodurch Skalierungsprobleme vermieden werden, wenn die Zahl der auf ein System zugreifenden Nutzer steigt.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/11/image2-2.png" class="kg-image" alt="" loading="lazy" width="1470" height="662"></figure>
	<p>Allerdings erschwert die gleiche Eigenschaft die Fehlersuche bei der JWT-basierten Authentifizierung, wenn man nicht das spezifische JWT eines Nutzers erhält. Das hat folgende Gründe:</p>
	<p><strong>1. Spezifität des Token:</strong> Jedes JWT ist spezifisch für einen Nutzer und eine Sitzung. Es enthält Informationen (Behauptungen) bezüglich des Nutzers, der ausstellenden Instanz, der Ausstellungszeit des Token, der Ablaufzeit und möglicherweise weitere Daten. Um ein Problem beheben zu können, wird deshalb oft genau das JWT benötigt, das es verursacht.</p>
	<p><strong>2. Keine serverseitigen Aufzeichnungen: </strong>Da JWT zustandslos sind, werden Sitzungen vom Server standardmäßig nicht gespeichert. Er kann keine früheren Token oder deren zugehörigen Status zum Abgleich abrufen – es sei denn, er wurde speziell dafür entwickelt, sie zu protokollieren, was aus Gründen des Datenschutzes und der Datenminimierung normalerweise nicht der Fall ist.</p>
	<p><strong>3. Vorübergehende Probleme:</strong> JWT-Probleme treten unter Umständen nur vorübergehend auf und hängen daher möglicherweise mit dem spezifischen Zeitpunkt zusammen, zu dem das Token verwendet wurde. Wenn beispielsweise ein Token abgelaufen war, als ein Nutzer versucht hat, es zu verwenden, benötigt man genau dieses Token zur Behebung des Problems.</p>
	<p><strong>4. Datenschutz und Sicherheit:</strong> JWT können sensible Informationen enthalten, deshalb sollte man damit sorgfältig umgehen. Erhält man ein JWT von einem Nutzer, werden dabei eventuell dessen personenbezogene Informationen oder Sicherheitsdaten demjenigen offengelegt, der das Problem behebt. Wenn ein Nutzer sein JWT auf unsicherem Weg an einen Entwickler oder ein IT-Helpdesk sendet, könnte es außerdem abgefangen werden. (Cloudflare hat kürzlich das kostenlose Tool <a href="https://blog.cloudflare.com/introducing-har-sanitizer-secure-har-sharing">HAR Sanitizer</a> auf den Markt gebracht, um das zu verhindern.)</p>
	<p>Diese Faktoren erschweren die Fehlersuche bei Problemen mit JWT-basierter Authentifizierung, wenn man keinen Zugriff auf das fragliche Token hat.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/11/image3.png" class="kg-image" alt="" loading="lazy" width="1825" height="740"></figure>
	<h3 id="eine-bessere-methode-zur-fehlerbehebung-bei-problemen-mit-der-identit%C3%A4ts%C3%BCberpr%C3%BCfung"><strong>Eine bessere Methode zur Fehlerbehebung bei Problemen mit der Identitätsüberprüfung</strong></h3>
	<p>Wir haben uns vorgenommen, eine bessere Lösung für Probleme im Zusammenhang mit der Nutzeridentität bei Cloudflare Zero Trust anzubieten, für die keine JWT oder HAR-Dateien hin und her geschickt werden müssen. Administratoren können sich jetzt die Registry-Identität eines Nutzers (die für Gateway-Richtlinien verwendet wird) und alle aktiven Access-Sitzungen anzeigen lassen.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/11/image7.png" class="kg-image" alt="" loading="lazy" width="1536" height="536"></figure>
	<p>Diese Sitzungsinformationen umfassen die vollständige Identität, die von unserer Zero Trust-Lösung ausgewertet wird, einschließlich Identitätsanbieter-Anforderungen, Informationen zum Gerätestatus, Netzwerkkontext und mehr. Durch die Verwendung von Cloudflare Workers KV ist es uns gelungen, diese Funktion ohne zusätzliche Belastung der Authentifizierungslogik von Access zu entwickeln. Wenn sich ein Nutzer bei Access authentifiziert, wird die zugehörige Identität sofort in einem Schlüssel-Wert-Paar in Workers KV gespeichert. Dies geschieht alles im Kontext des Ereignisses der Nutzerauthentifizierung, sodass die Auswirkungen auf die Latenz oder die Abhängigkeit von einem externen Dienst minimal sind.</p>
	<p>Diese Funktion ist für alle Kunden und sämtliche Zero Trust-Tarife verfügbar. Wenn Sie mit Cloudflare Zero Trust loslegen möchten, melden Sie sich noch heute für ein <a href="https://dash.cloudflare.com/sign-up/teams" target="_blank">kostenloses Konto</a> an, das von bis zu 50 Nutzern verwendet werden kann. Oder <a href="https://www.cloudflare.com/products/zero-trust/plans/enterprise" target="_blank">arbeiten Sie mit Cloudflare-Experten zusammen</a>, um über eine SSE- oder SASE-Lösung für Ihr Unternehmen zu sprechen und Ihre Zero Trust-Anwendungsfälle Schritt für Schritt anzugehen.</p>
</div>