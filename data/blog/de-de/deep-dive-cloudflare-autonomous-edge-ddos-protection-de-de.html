<div class="mb2 gray5">5 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/03/image1-25.png" class="kg-image" alt="A deep-dive into Cloudflare’s autonomous edge DDoS protection" loading="lazy"></figure>
	<p>Heute freue ich mich, über unser autonomes DDoS-Schutzsystem (<a href="https://www.cloudflare.com/de-de/learning/ddos/what-is-a-ddos-attack" target="_blank">Distributed Denial of Service</a>) zu sprechen. Dieses System wurde weltweit in allen unseren über 200 Rechenzentren implementiert und schützt alle unsere Kunden aktiv vor DDoS-Angriffen auf den Ebenen 3 bis 7 (im <a href="https://www.cloudflare.com/de-de/learning/ddos/glossary/open-systems-interconnection-model-osi" target="_blank">OSI-Modell</a>), ohne dass ein menschliches Eingreifen erforderlich ist. Im Rahmen unsereres <a href="https://blog.cloudflare.com/unmetered-mitigation">Commitments zu zeitlich unbeschränktem DDoS-Schutz</a>, stellen wir unseren Kunden keine höheren Kosten in Rechnung, nur weil sie von einem DDoS-Angriff betroffen sind.</p>
	<h3 id="autonomer-schutz-an-der-edge">Autonomer Schutz an der Edge</h3>
	<p>Um unsere Kunden schnell und präzise vor DDoS-Angriffen zu schützen, haben wir ein autonomes Edge-Erkennungs- und Abwehrsystem entwickelt, das eigenständig Entscheidungen treffen kann, ohne dass ein zentraler Konsens erforderlich ist. Es ist vollständig softwaredefiniert und läuft auf unserer Edge auf Commodity-Servern. Es wird von unserem Denial-of-Service-Daemon (dosd) betrieben, der ursprünglich Mitte 2019 zum Schutz vor L3/4-DDoS-Angriffen in Betrieb genommen wurde. Seitdem haben wir in die Erweiterung und Verbesserung seiner Fähigkeiten investiert, um Angreifern einen Schritt voraus zu sein und die Wirtschaftlichkeit von Angriffen zu stören. Mit den jüngsten Verbesserungen haben wir unsere Edge-Abwehr-Komponente erweitert, um zusätzlich zu L3/4-Angriffen auch vor L7-Angriffen zu schützen.</p>
	<p>Dieses System läuft auf jedem einzelnen Server in allen unseren Edge-Rechenzentren. Es analysiert ständig Pakete und HTTP-Anfragen und scannt nach DDoS-Angriffen. Bei einer Erkennung wird sofort eine Abwehrregel mit einer in Echtzeit generierten Signatur an die optimale Stelle im Linux-Stack verschoben, an der die kosteneffizienteste Abwehrmaßnahme angewendet werden kann.</p>
	<figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2021/03/DDoS-mitigation-diagram@2x-1.png" class="kg-image" alt="A conceptual diagram of Cloudflare DDoS mitigation systems" loading="lazy">
		<figcaption>Ein konzeptionelles Diagramm zu den Cloudflare-Systemen für DDoS-Abwehr</figcaption>
	</figure>
	<p>Unsere neuen Edge-Erkennungsfunktionen ergänzen unseren bestehenden globalen Mechanismus zur Erkennung von Bedrohungen, <a href="https://blog.cloudflare.com/meet-gatebot-a-bot-that-allows-us-to-sleep">Gatebot</a>, der sich im Zentrum unseres Netzwerks befindet. Die Erkennung von Angriffen im Kern des Netzwerks mit Gatebot eignet sich hervorragend für größere, verteilte volumetrische Angriffe, die eine Koordination über die gesamte Cloudflare-Edge erfordern, aber kleinere, lokalisierte Angriffe erfordern einen anderen Ansatz. Die Erkennung von Angriffen auf der Netzwerkebene und von HTTP-Angriffen an der Edge bedeutet, dass wir schneller Stichproben durchführen können, sowohl kleine als auch große Angriffe erkennen und sofort eine Regel zur Schadensbegrenzung erstellen können. In den letzten Monaten wurden 98,6 % aller L3/4 DDoS-Angriffe von dosd erkannt. Seit der Einführung der erweiterten Version von dosd wurden 81 % aller L7-Angriffe abgewehrt.</p>
	<p>Wir haben bereits in vorangegangenen Blogbeiträgen über <a href="https://blog.cloudflare.com/meet-gatebot-a-bot-that-allows-us-to-sleep">Gatebot</a> und <a href="https://blog.cloudflare.com/announcing-flowtrackd">flowtrackd</a> berichtet. In diesem Blogbeitrag werden wir uns also auf die erweiterten Dosd-Funktionen konzentrieren.</p>
	<h3 id="linux-netzwerke-nutzen-um-pakete-und-anfragen-mit-hoher-geschwindigkeit-zu-verwerfen">Linux-Netzwerke nutzen, um Pakete und Anfragen mit hoher Geschwindigkeit zu verwerfen</h3>
	<p>Vor zehn Jahren waren die Linux-Netzwerke langsam. Heute verwerfen wir dank Linux Pakete mit Hochgeschwindigkeit – insbesondere mit iptables und dem eXpress Data Path (XDP).</p>
	<h3 id="der-lebenszyklus-eines-pakets">Der Lebenszyklus eines Pakets</h3>
	<p>Ein Paket, das für einen von Cloudflare geschützten Kunden bestimmt ist, bahnt sich seinen Weg zum nächstgelegenen <a href="https://www.cloudflare.com/de-de/network" target="_blank">Cloudflare-Rechenzentrum</a> über <a href="https://www.cloudflare.com/de-de/learning/cdn/glossary/anycast-network" target="_blank">BGP Anycast</a>. Sobald es ankommt, wird es vom Router über Netzwerk-Switches mithilfe des ECMP-Algorithmus (<a href="https://en.wikipedia.org/wiki/Equal-cost_multi-path_routing" target="_blank">ECMP</a>) an einen Server weitergeleitet. Wenn es bei einem Server ankommt, wird das Paket an eine Gruppe von eXpress Data Path (<a href="https://en.wikipedia.org/wiki/Express_Data_Path" target="_blank">XDP</a>)-Programmen gesendet. Die erste Gruppe von XDP-Programmen, <a href="https://blog.cloudflare.com/l4drop-xdp-ebpf-based-ddos-mitigations">L4Drop</a>, wendet Abwehrregeln aus zuvor entdeckten Angriffen an und übermittelt Paketproben zur weiteren Analyse an dosd.</p>
	<p>Wenn ein Paket nicht als schädlich verworfen wird, wird es an <a href="https://blog.cloudflare.com/unimog-cloudflares-edge-load-balancer">Unimog</a>, unseren proprietären L4-Load Balancer, weitergeleitet. Anhand von Daten über den Zustand und die Performance des Servers entscheidet Unimog, ob das Paket auf demselben Server verbleiben oder an einen anderen Server im Rechenzentrum weitergeleitet werden soll, der es besser verarbeiten kann. Nach Unimog wird es durch die iptables-Firewall und dann, wenn es auf eine L7-Anwendung abzielt, z.B. einen durch die Cloudflare WAF geschützten Dienst, an unseren HTTP-Reverse-Proxy weitergeleitet. Der Reverse-Proxy läuft im Userspace und HTTP-Anfragen durchlaufen unsere <a href="https://www.cloudflare.com/waf" target="_blank">Web Application Firewall</a>, die Regeln der Application Firewall und zusätzliche Kundenkonfigurationen. Wenn das Paket stattdessen für eine TCP/UDP-Anwendung (Spectrum) oder ein IP-Ziel bestimmt ist, das geroutet und nicht über einen Proxy geleitet wird (Magic Transit), würde es diese Systeme durchlaufen und nicht unseren HTTP-Proxy.</p>
	<figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="https://blog.cloudflare.com/content/images/2021/04/L7-ddos-diagram@2x-1-1.png" class="kg-image" alt="Life of a packet" loading="lazy">
		<figcaption>Lebenszyklus eines Pakets</figcaption>
	</figure>
	<p>Zusätzlich zu L4Drop überträgt unser HTTP-Proxy auch Proben und Metadaten von HTTP-Anfragen an dosd. Dieses Edge-Sampling erfolgt mit einer 10-mal höheren Geschwindigkeit als das Core-Sampling, da die Signale nun lokal analysiert (und verarbeitet) werden können, anstatt an ein zentrales Rechenzentrum gesendet zu werden. Ebenso werden die Pakete von dosd 81 Mal schneller geprüft als von gatebot.</p>
	<p>Gemeinsam analysieren dosd, gatebot und flowtrackd die empfangenen Proben und wenden Abwehrregeln an, wenn DDoS-Angriffe entdeckt werden. Sie übertragen Abwehrregeln in den Web-Proxy, um HTTP-Angriffe abzuwehren. Angriffsanfragen wird je nach Entscheidung des Systems entweder mit einer Sperre, Durchsatzbegrenzung oder Challenge begegnet. Wenn es sich jedoch um einen sehr umfangreichen Angriff handelt, wird die Abwehrregel nach unten in die iptables-Firewall geleitet und L7-Angriffe werden mit <a href="https://blog.cloudflare.com/rolling-with-the-punches-shifting-attack-tactics-dropping-packets-faster-cheaper-at-the-edge/#jails">IP Jails</a> auf L4 verworfen, um die Abwehr kosteneffizienter zu gestalten. In ähnlicher Weise werden L3/4-Angriffe in der iptables-Firewall mit erweiterten Berkeley Packet Filter (<a href="https://blog.cloudflare.com/de-de/cloudflare-architecture-and-how-bpf-eats-the-world-de-de">eBPF</a>)-Programmen innerhalb von L4Drop abgewehrt. Die Nutzung dieser Komponenten ermöglicht es uns, DDoS-Angriffe in großem Umfang automatisch abzuwehren.</p>
	<h3 id="damit-angriffe-nicht-mehr-wirtschaftlich-sind">Damit Angriffe nicht mehr wirtschaftlich sind</h3>
	<p>Unser oben beschriebenes erweitertes autonomes System wurde zusammen mit unseren bestehenden Komponenten zur Bedrohungsabwehr entwickelt, um unsere Kunden vor DDoS-Angriffen zu schützen, die inzwischen sehr einfach und billig ausgeführt werden können. Diese Angriffe werden von böswilligen Akteuren eingesetzt, die darauf abzielen, eine Website, eine mobile App, ein Spiel oder ein anderes mit dem Internet verbundenes Objekt lahmzulegen. Diese erweiterten Schutzmaßnahmen waren ein notwendiger Schritt, da im vergangenen Jahr die Zahl der Angriffe gestiegen ist, wie wir in unseren <a href="https://blog.cloudflare.com/network-layer-ddos-attack-trends-for-q3-2020">Berichten zu DDoS-Trends</a> dokumentiert haben. Außerdem werden die Angriffe immer größer und <a href="https://blog.cloudflare.com/beat-an-acoustics-inspired-ddos-attack">ausgefeilter</a>, wie z.B. der Angriff, bei dem akustische Beats imitiert wurden. Genauso wichtig sind kleine Angriffe, die eine kleine Webseite lahmlegen könnten. Wir wollen die großen und kleinen Angriffe blockieren.</p>
	<p>In vielen Fällen können Angreifer DDoS-Angriffe kostenlos mit öffentlich zugänglichen Tools starten oder gegen eine geringe Gebühr einen DDoS-as-a-Service-<a href="https://www.cloudflare.com/de-de/learning/ddos/what-is-a-ddos-botnet" target="_blank">Botnetz</a> wie <a href="https://blog.cloudflare.com/moobot-vs-gatebot-cloudflare-automatically-blocks-botnet-ddos-attack-topping-at-654-gbps">Moobot</a> im Dark Web anheuern. Laut dem <a href="https://www.privacyaffairs.com/dark-web-price-index-2020" target="_blank">Dark Web Price Index für 2020</a> kann man schon ab 10 $ einen einstündigen DDoS-Angriff mit einer Geschwindigkeit von 10-50.000 Anfragen pro Sekunde erhalten. Die Kosten für Angriffe sind weitaus geringer als der Schaden, den sie verursachen. Indem sie einen Ausfall verursachen oder auch <em>nur </em>den Service verschlechtern, können Angreifer ihrem Opfer einen erheblichen Schaden zufügen. Wenn beispielsweise eine E-Commerce-Website ausfällt, können sich Nutzer nicht mehr anmelden und keine Einkäufe tätigen. Auch eine erhöhte Latenzzeit kann dazu führen, dass Nutzer ihre Warenkörbe aufgeben und zur Konkurrenz wechseln. Eine Minute Ausfallzeit kann sich leicht auf den Verlust von <a href="https://www.gremlin.com/ecommerce-cost-of-downtime" target="_blank">Zehntausenden von Dollar</a> auswirken.</p>
	<p>Die Häufigkeit, Raffinesse und Größe von DDoS-Angriffen erfordern einen neuen Ansatz – einen, der schnell, genau und präzise ist. Aus diesem Grund haben wir die in diesem Beitrag beschriebenen erweiterten Schutzmaßnahmen entwickelt.</p>
	<h3 id="unser-ziel-ein-besseres-internet">Unser Ziel: ein besseres Internet</h3>
	<p>Cloudflare möchte ein besseres Internet schaffen – ein sicheres, schnelleres und zuverlässigeres Internet für alle. Die Vision des DDoS-Teams leitet sich von dieser Mission ab: Unser Ziel ist es, die Auswirkungen von DDoS-Angriffen der Vergangenheit angehören zu lassen. In den 90er und 2000er Jahren wurden <a href="https://en.wikipedia.org/wiki/History_of_email_spam" target="_blank">Spam-E-Mails zu einem ernsthaften Problem</a>. Heute werden sie von den E-Mail-Diensten für uns herausgefiltert, und unser Ziel ist es, dasselbe für DDoS-Angriffe zu tun.</p>
	<p>Wenn Sie sich näher für den DDoS-Schutz von Cloudflare interessieren, <a href="https://www.cloudflare.com/de-de/enterprise" target="_blank">wenden Sie sich an uns</a> oder probieren Sie ihn mit unserem Free-Tarif <a href="https://dash.cloudflare.com/sign-up" target="_blank">hier</a> kostenlos aus.</p>
	<p>Übrigens, wenn Sie daran interessiert sind, im Engineering-Team für DDoS-Schutz zu arbeiten, stellen wir derzeit Mitarbeiter an unseren Standorten in London und Austin ein. Reichen Sie Ihre Bewerbung hier ein:</p>
	<p>Austin: <a href="https://boards.greenhouse.io/cloudflare/jobs/2291040?gh_jid=2291040" target="_blank">https://boards.greenhouse.io/cloudflare/jobs/2291040?gh_jid=2291040</a></p>
	<p>London: <a href="https://boards.greenhouse.io/cloudflare/jobs/2291038?gh_jid=2291038" target="_blank">https://boards.greenhouse.io/cloudflare/jobs/2291038?gh_jid=2291038</a></p>
</div>