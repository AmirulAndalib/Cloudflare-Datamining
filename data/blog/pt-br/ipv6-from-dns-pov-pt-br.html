<div class="mb2 gray5">11 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/12/image2-3.png" class="kg-image" alt="Using DNS to estimate the worldwide state of IPv6 adoption" loading="lazy" width="1200" height="676"></figure>
	<p>Para que um dispositivo se comunique com outros dispositivos na internet usando o apropriadamente denominado <a href="https://en.wikipedia.org/wiki/Internet_Protocol">protocolo de internet</a> (IP), primeiro deve ser atribuído a ele um endereço numérico exclusivo. A aparência desse endereço depende da versão do IP usada: <a href="https://en.wikipedia.org/wiki/Internet_Protocol_version_4">IPv4</a> ou <a href="https://en.wikipedia.org/wiki/IPv6">IPv6</a>.</p>
	<p>O IPv4 foi implantado pela primeira vez em 1983. &nbsp;É a versão do IP que deu origem à internet moderna e ainda hoje permanece dominante. &nbsp;O IPv6 pode ser rastreado desde o início de 1998, mas somente na última década ele começou a ganhar aceitação significativa, passando de menos de 1% para algo entre 30 e 40%, dependendo de quem está relatando e de como estão medindo.</p>
	<p>Com o crescimento dos dispositivos conectados excedendo em muito o número de endereços IPv4 disponíveis <a href="https://blog.cloudflare.com/amazon-2bn-ipv4-tax-how-avoid-paying">e os seus custos aumentando</a>, o espaço de endereços muito maior fornecido pelo IPv6 deveria tê-lo tornado o protocolo dominante até agora. Contudo, como veremos, este não é o caso.</p>
	<p>A Cloudflare tem sido uma forte defensora do IPv6 <a href="https://www.cloudflare.com/press-releases/2011/cloudflare-announces-the-automatic-ipv6-gateway">há muitos anos</a> e, por meio do <a href="https://radar.cloudflare.com">Cloudflare Radar</a>, temos acompanhado de perto a adoção do IPv6 na internet. Aos três anos, o Radar ainda é uma plataforma relativamente recente. Para voltar no tempo, podemos recorrer brevemente aos nossos amigos do <a href="https://stats.labs.apnic.net/ipv6/XA">APNIC</a>, um dos cinco Registros Regionais da Internet (<a href="https://en.wikipedia.org/wiki/Regional_Internet_registry">RIRs</a>). Através dos seus dados, que remontam a 2012, podemos ver que o IPv6 passou por um período de crescimento aparentemente exponencial até meados de 2017, após o qual entrou num período de crescimento linear que ainda continua:</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/12/pasted-image-0--7--2.png" class="kg-image" alt="" loading="lazy" width="1600" height="700"></figure>
	<p>A adoção do IPv6 é prejudicada pela falta de compatibilidade entre os dois protocolos, os dispositivos devem receber um endereço IPv4 <em>e</em> um endereço IPv6, juntamente com o fato de que praticamente todos os dispositivos na internet ainda são compatíveis com IPv4. No entanto, o IPv6 é fundamental para o futuro da internet e é necessário um esforço contínuo para aumentar a sua implantação.</p>
	<p>O Cloudflare Radar, assim como o APNIC e a maioria das outras fontes hoje, publica números que refletem principalmente até que ponto os provedores de serviços de internet (ISPs) implantaram o IPv6: o <em>lado do cliente</em>. É um ângulo muito importante e que impacta diretamente os usuários finais, mas há também o outro extremo da equação: o <em>lado do servidor</em>.</p>
	<p>Com isso em mente, convidamos você a nos acompanhar em um experimento rápido onde pretendemos ter uma ideia da adoção do IPv6 no lado do servidor e com que frequência os clientes são realmente (ou provavelmente) capazes de se comunicar com servidores através do IPv6. &nbsp;Contaremos com o DNS para esta exploração e, como dizem, os resultados podem surpreender você.</p>
	<h3 id="ado%C3%A7%C3%A3o-de-ipv6-no-lado-do-cliente-a-partir-de-http">Adoção de IPv6 no lado do cliente (a partir de HTTP)</h3>
	<p>No final de outubro de 2023, da <a href="https://radar.cloudflare.com/adoption-and-usage?dateStart=2023-08-01&amp;dateEnd=2023-10-31">perspectiva</a> da Cloudflare, a adoção do IPv6 na internet era de aproximadamente <strong>36%</strong> de todo o tráfego, com pequenas variações dependendo da hora do dia e do dia da semana. Ao excluir os bots, a estimativa sobe para pouco mais de 46%, enquanto a exclusão dos humanos reduz a estimativa para perto de 24%. Esses números referem-se à parcela de solicitações HTTP atendidas por IPv6 <a href="https://developers.cloudflare.com/radar/glossary/#ipv6-adoption">em todo o conteúdo habilitado para IPv6</a> (a configuração padrão).</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/12/pasted-image-0-2.png" class="kg-image" alt="" loading="lazy" width="1600" height="900"></figure>
	<p>Para este exercício, o que mais importa é o número de humanos <em>e</em> de bots. Existem muitas razões para a diferença na adoção entre ambos os tipos de tráfego, desde os diferentes níveis de compatibilidade com IPv6 nos inúmeros softwares de cliente utilizados, até os diversos níveis de implementação do IPv6 nas diversas redes de onde o tráfego provém, até o tamanho variável dessas redes, etc, mas isso é uma questão para outro dia. Se você tiver curiosidade sobre os números de um país ou rede específicos, pode encontrá-los no <a href="https://radar.cloudflare.com/adoption-and-usage">Cloudflare Radar</a> e no nosso relatório <a href="https://radar.cloudflare.com/year-in-review/2023#ipv6-adoption">Análise do ano</a> de 2023.</p>
	<h3 id="%C3%A9-preciso-trabalhar-em-conjunto">É preciso trabalhar em conjunto</h3>
	<p>Você, que está lendo, pode evidenciar que medir o lado do cliente da equação cliente-servidor conta apenas metade da história: para um cliente compatível com IPv6 estabelecer uma conexão com um servidor via IPv6, o servidor também deve ser compatível com IPv6.</p>
	<p>Isso levanta duas questões:</p>
	<ol>
		<li>Qual é a extensão da adoção do IPv6 no lado do servidor?</li>
		<li>Até que ponto a adoção do IPv6 no lado do cliente se alinha com a adoção no lado do servidor?</li>
	</ol>
	<p>Existem diversas respostas possíveis, dependendo se estamos falando de usuários, dispositivos, bytes transferidos e assim por diante. Vamos nos concentrar nas <em>conexões</em> (o porquê ficará claro em um momento), e a pergunta combinada que fazemos é:</p>
	<blockquote><em>Com que frequência um cliente compatível com IPv6 pode usar IPv6 ao se conectar a servidores na internet, sob padrões típicos de uso?</em></blockquote>
	<p>Os padrões típicos de uso incluem pessoas seguindo sua rotina diária, visitando alguns sites com mais frequência do que outros, ou clientes automatizados chamando APIs. &nbsp;Recorreremos ao DNS para obter essa perspectiva. </p>
	<h3 id="inserir-o-dns">Inserir o DNS</h3>
	<p>Antes que um cliente possa tentar estabelecer uma conexão com um servidor por nome, usando o protocolo IPv4 clássico ou o IPv6 mais moderno, ele deve procurar o endereço de IP do servidor na <a href="https://en.wikipedia.org/wiki/Telephone_directory">lista telefônica</a> da internet, o <a href="https://www.cloudflare.com/learning/dns/what-is-dns">Sistema de Nomes de Domínio (DNS)</a>.</p>
	<p>Procurar um hostname no DNS <a href="https://www.cloudflare.com/learning/dns/what-is-dns">é um processo recursivo</a>. Para encontrar o endereço de IP de um servidor, a hierarquia do domínio (os componentes separados por pontos do nome de um servidor) deve ser seguida por vários <em>servidores DNS autoritativos</em> até que um deles retorne a resposta desejada. A maioria dos clientes, entretanto, não faz isso diretamente e, em vez disso, pede a um servidor intermediário, chamado <a href="https://www.cloudflare.com/learning/dns/what-is-recursive-dns"><em>resolvedor recursivo</em></a>, que faça isso por eles. A Cloudflare opera um resolvedor recursivo que qualquer pessoa pode usar: o <a href="https://one.one.one.one/dns">1.1.1.1</a>.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/12/pasted-image-0--1--2.png" class="kg-image" alt="" loading="lazy" width="1600" height="800"></figure><!--kg-card-begin: markdown-->
	<p>Como um exemplo simplificado, quando um cliente pede ao 1.1.1.1 o endereço de IP onde reside “www.example.com”, o 1.1.1.1 pergunta aos servidores raiz de DNS sobre “.com”, depois pergunta aos servidores de DNS .com sobre “example.com” e, finalmente, pergunta aos servidores de DNS de example.com sobre “www.example.com”, que têm conhecimento direto dele e respondem com um endereço de IP. Para tornar as coisas mais rápidas para o próximo cliente que fizer uma pergunta semelhante, o 1.1.1.1 armazena em cache (lembra por um tempo) a resposta final e as etapas intermediárias.</p>
	<!--kg-card-end: markdown-->
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/12/pasted-image-0--2--3.png" class="kg-image" alt="" loading="lazy" width="1600" height="384"></figure>
	<p>Isso significa que o 1.1.1.1 está em uma posição muito boa para contar com que frequência os clientes tentam procurar endereços IPv4 (consultas do tipo A) <em>comparado com</em> a frequência que eles tentam procurar endereços IPv6 (consultas do tipo AAA), cobrindo a maior parte da internet observável.</p>
	<p>Mas como um cliente sabe quando solicitar o endereço IPv4 ou IPv6 de um servidor?</p>
	<p>A resposta curta é que os clientes com IPv6 disponível apenas solicitam ambos, fazendo pesquisas <a href="https://www.cloudflare.com/learning/dns/dns-records/dns-a-record">A</a> e <a href="https://www.cloudflare.com/learning/dns/dns-records/dns-aaaa-record">AAAA</a> separadas para cada servidor ao qual desejam se conectar. Esses clientes compatíveis com IPv6 vão priorizar a conexão via IPv6 quando obtiverem uma resposta AAAA não vazia, independentemente de também obterem uma resposta A não vazia (o que quase sempre obtêm, como veremos). O algoritmo que impulsiona essa preferência pela modernidade é chamado <a href="https://en.wikipedia.org/wiki/Happy_Eyeballs">Happy Eyeballs</a>, se você tiver interesse nos detalhes.</p>
	<p>Agora estamos prontos para começar a analisar alguns dados reais…</p>
	<h3 id="ado%C3%A7%C3%A3o-de-ipv6-no-lado-do-cliente-a-partir-do-dns">Adoção de IPv6 no lado do cliente (a partir do DNS)</h3>
	<p>A primeira etapa é estabelecer uma linha de base medindo a implantação do IPv6 pelos clientes a partir da perspectiva do 1.1.1.1 &nbsp;e compará-la com os números das solicitações HTTP com os quais começamos. </p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/12/pasted-image-0--3--2.png" class="kg-image" alt="" loading="lazy" width="1600" height="529"></figure>
	<p>É tentador contar com que frequência os clientes se conectam ao 1.1.1.1 usando IPv6, mas os resultados são enganosos por alguns motivos, sendo o mais forte oculto à vista de todos: o 1.1.1.1 é o <strong>endereço</strong> mais memorável do conjunto de endereços IPv4 e IPv6 que os clientes podem usar para realizar pesquisas de DNS por meio do <strong>serviço</strong> 1.1.1.1. Idealmente, os clientes compatíveis com IPv6 que usam o 1.1.1.1 como seu resolvedor recursivo devem ter todos os quatro endereços de IP a seguir configurados, não apenas os dois primeiros:</p>
	<ul>
		<li><strong>1.1.1.1</strong> (IPv4)</li>
		<li><strong>1.0.0.1</strong> (IPv4)</li>
		<li><strong>2606:4700:4700::1111</strong> (IPv6)</li>
		<li><strong>2606:4700:4700::1001</strong> (IPv6)</li>
	</ul>
	<p>Mas, quando a configuração manual está envolvida, os humanos consideram os endereços IPv6 menos memoráveis do que os endereços IPv4 e têm menos probabilidade de configurá-los, considerando suficientes apenas os endereços IPv4.</p>
	<p>Um fator de confusão relacionado, mas menos óbvio, é que muitos clientes compatíveis com IPv6 ainda vão realizar pesquisas de DNS sobre IPv4 mesmo quando tiverem endereços &nbsp;IPv6 do 1.1.1.1 configurados, já que distribuir pesquisas pelos endereços disponíveis é uma opção padrão popular.</p>
	<p>Uma abordagem mais sensata para avaliar a adoção do IPv6 a partir da atividade de DNS do cliente é calcular a porcentagem de consultas do tipo AAAA sobre a quantidade total de consultas do tipo A, assumindo que os clientes IPv6 sempre realizam ambas, conforme mencionado anteriormente.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/12/pasted-image-0--4--2.png" class="kg-image" alt="" loading="lazy" width="1600" height="555"></figure>
	<p>Então, da perspectiva do 1.1.1.1, a adoção do IPv6 no <strong>lado do cliente </strong>é estimada em<strong> 30,5%</strong> por volume de consultas. Isso está um pouco abaixo do que observamos no tráfego HTTP no mesmo período (35,9%), mas essa diferença entre duas perspectivas diferentes não é inesperada.</p>
	<h3 id="uma-observa%C3%A7%C3%A3o-sobre-ttls">Uma observação sobre TTLs</h3>
	<p>Não são apenas os resolvedores recursivos que armazenam em cache as respostas de DNS; a maioria dos clientes de DNS também tem seus próprios caches locais. &nbsp;Seu navegador da web, sistema operacional e até mesmo seu roteador doméstico mantêm as respostas na esperança de acelerar as consultas subsequentes.</p>
	<p>O tempo que cada resposta permanece no cache depende do campo <a href="https://developers.cloudflare.com/dns/manage-dns-records/reference/ttl">tempo de vida</a> (TTL) enviado de volta com os registros de DNS. Se você conhece DNS, deve estar se perguntando se os registros A e AAAA têm TTLs semelhantes. Caso contrário, poderemos receber menos consultas para apenas um desses dois tipos (porque ele fica armazenado em cache por mais tempo no nível do cliente), distorcendo os números de adoção resultantes. </p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/12/pasted-image-0--5--2.png" class="kg-image" alt="" loading="lazy" width="1256" height="708"></figure>
	<p>Os gráficos de pizza aqui detalham os TTLs mínimos enviados de volta pelo 1.1.1.1 em resposta às consultas A e AAAA. Existe alguma diferença entre os dois tipos, mas a diferença é muito pequena.</p>
	<h3 id="ado%C3%A7%C3%A3o-do-ipv6-no-lado-do-servidor">Adoção do IPv6 no lado do servidor</h3>
	<p>O gráfico a seguir mostra com que frequência as consultas do tipo A e AAAA obtêm respostas não vazias, esclarecendo a adoção do IPv6 no <strong>lado do servidor</strong> e nos aproximando da resposta que buscamos:</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/12/pasted-image-0--6--2.png" class="kg-image" alt="" loading="lazy" width="1600" height="549"></figure>
	<p>A adoção do IPv6 pelos servidores é estimada em <strong>43,3%</strong> por volume de consultas, valor visivelmente superior ao observado para os clientes.</p>
	<h3 id="com-que-frequ%C3%AAncia-os-dois-lados-combinam">Com que frequência os dois lados combinam</h3>
	<p>Se 30,5% das pesquisas de endereços de IP tratadas pelo 1.1.1.1 pudessem fazer uso de um endereço IPv6 para se conectar aos destinos pretendidos, mas apenas 43,3% dessas pesquisas obtivessem uma resposta não vazia, isso poderia nos dar uma boa base de como muitas vezes, as conexões IPv6 são feitas entre cliente e servidor, aproximadamente <strong>13,2%</strong> das vezes.</p>
	<h3 id="o-poss%C3%ADvel-impacto-dos-dom%C3%ADnios-populares">O possível impacto dos domínios populares</h3>
	<p>A adoção do IPv6 do lado do servidor medida pelo volume de consultas para os domínios na lista dos <a href="https://radar.cloudflare.com/domains">Top 100</a> do Radar é de 60,8%. Se excluirmos estes domínios dos nossos cálculos globais, o valor anterior de 13,2% cai para 8%. Esta é uma diferença significativa, mas não inesperada, já que os Top 100 domínios representam mais de 55% de todas as consultas A e AAAA para o 1.1.1.1.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/12/pasted-image-0--8--2.png" class="kg-image" alt="" loading="lazy" width="1600" height="552"></figure>
	<p>Se apenas mais alguns desses domínios altamente populares implantassem o IPv6 hoje, a adoção observada aumentaria visivelmente e, com ela, a chance de clientes compatíveis com IPv6 estabelecerem conexões usando IPv6.</p>
	<h3 id="considera%C3%A7%C3%B5es-finais">Considerações finais</h3>
	<p>Observar a extensão da adoção do IPv6 na internet pode significar coisas diferentes:</p>
	<ul>
		<li>Contagem de <strong>usuários</strong> com acesso à internet compatíveis com IPv6.</li>
		<li>Contagem de <strong>dispositivos</strong> ou software compatíveis com IPv6 nesses dispositivos (clientes e/ou servidores).</li>
		<li>Cálculo da quantidade de <strong>tráfego</strong> que flui através de conexões IPv6, medido em bytes.</li>
		<li>Contagem da fração de <strong>conexões</strong> (ou <strong>solicitações</strong> individuais) em IPv6.</li>
	</ul>
	<p>Neste exercício optamos por analisar conexões e solicitações. &nbsp;Tendo em mente que a realidade subjacente só pode ser verdadeiramente compreendida considerando diversas perspectivas diferentes, vimos três números diferentes de adoção do IPv6:</p>
	<ul>
		<li><strong>35,9%</strong> (lado do cliente) ao contar as solicitações HTTP atendidas pela CDN da Cloudflare.</li>
		<li><strong>30,5%</strong> (lado do cliente) ao contar consultas de DNS do tipo A e AAAA tratadas pelo <a href="https://one.one.one.one/dns">1.1.1.1</a>.</li>
		<li><strong>43,3%</strong> (lado do servidor) de respostas positivas a consultas de DNS do tipo AAAA, também a partir do 1.1.1.1.</li>
	</ul>
	<p>Combinamos os números do <em>lado do cliente</em> e do <em>servidor</em> a partir do DNS para estimar a frequência com que as conexões a servidores de terceiros são provavelmente estabelecidas através de IPv6 em vez de IPv4: apenas <strong>13,2%</strong> do tempo.</p>
	<p>Para melhorar estes números, os provedores de internet, os fornecedores de nuvem e de hospedagem, bem como as empresas, devem aumentar a taxa de disponibilização do IPv6 para dispositivos nas suas redes. Mas grandes sites e fontes de conteúdo também têm um papel crítico a desempenhar para permitir que clientes compatíveis com IPv6 usem IPv6 com mais frequência, já que <strong>39,2%</strong> das consultas para domínios nos <a href="https://radar.cloudflare.com/domains">Top 100</a> do Radar (representando mais da metade de todas as consultas A e AAAA para o 1.1.1.1) ainda estão limitados a respostas apenas IPv4.</p>
	<p>A internet ainda tem um caminho a percorrer na adoção completa do IPv6. Mas o esforço contínuo de todos os envolvidos pode ajudar a impulsionar seu avanço, e talvez até acelerar o progresso.</p>
	<p><em>No lado do servidor, a Cloudflare tem ajudado nesse esforço mundial há muitos anos, fornecendo </em><a href="https://developers.cloudflare.com/support/network/understanding-and-configuring-cloudflares-ipv6-support"><em>compatibilidade com IPv6</em></a><em> gratuita para todos os domínios. No lado do cliente, o </em><a href="https://one.one.one.one"><em>aplicativo 1.1.1.1</em></a><em> habilita automaticamente seu dispositivo para IPv6, mesmo que seu provedor de internet não seja compatível com IPv6. E, se acontecer de você gerenciar uma rede somente IPv6, o </em><a href="https://developers.cloudflare.com/1.1.1.1/infrastructure/ipv6-networks"><em>suporte DNS64</em></a><em> do 1.1.1.1 também vai ajudar.</em></p><!--kg-card-begin: markdown-->
	<p><small>***</small><br>
		<small><sup>1</sup>O resolvedor de DNS público da Cloudflare (1.1.1.1) é operado em parceria com a APNIC. Você pode ler mais sobre isso no <a href="https://blog.cloudflare.com/dns-resolver-1-1-1-1">post original do anúncio no blog</a> e na <a href="https://developers.cloudflare.com/1.1.1.1/privacy/public-dns-resolver">política de privacidade</a> do 1.1.1.1.<br>
			<sup>2</sup>Há mais informações sobre como o DNS funciona na seção “<a href="https://www.cloudflare.com/learning/dns/what-is-dns">O que é DNS?</a>” do nosso site. Se você é um aluno prático, sugerimos que dê uma olhada em “<a href="https://messwithdns.net">mess with dns</a>” de Julia Evans.<br>
			<sup>3</sup>Qualquer resolvedor recursivo já conhece previamente os endereços de IP dos <a href="https://www.iana.org/domains/root/servers">13 servidores raiz</a>. A Cloudflare também participa no nível mais alto do DNS, fornecendo <a href="https://blog.cloudflare.com/f-root">serviço anycast para as instâncias E e F-Root</a>, o que significa que o 1.1.1.1 não precisa ir muito longe para a primeira etapa de pesquisa.<br>
			<sup>4</sup>Ao usar o <a href="https://one.one.one.one">aplicativo 1.1.1.1</a>, todos os quatro endereços de IP são configurados automaticamente.<br>
			<sup>5</sup>Para simplificar, deduzimos que a quantidade de clientes somente IPv6 ainda é insignificantemente pequena.É uma suposição razoável de forma geral, e outros conjuntos de dados disponíveis confirmam isso.<br>
			<sup>6</sup>O 1.1.1.1, como outros resolvedores recursivos, retorna TTLs ajustados: o TTL original do registro menos o número de segundos desde que o registro foi armazenado em cache pela última vez. As respostas vazias A e AAAA são armazenadas em cache pelo período de tempo definido no registro <a href="https://www.cloudflare.com/learning/dns/dns-records/dns-soa-record">Start of Authority</a> (SOA) do domínio, conforme especificado pela RFC 2308.<br>
		</small>
	</p>
	<!--kg-card-end: markdown-->
</div>