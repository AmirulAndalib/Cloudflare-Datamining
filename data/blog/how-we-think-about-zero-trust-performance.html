<div class="mb2 gray5">9 min read</div>
<div class="post-content lh-copy gray1">
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/06/image1-27.png" class="kg-image" alt="How we think about Zero Trust Performance" loading="lazy" width="1800" height="1013"></figure>
	<p>Cloudflare has done several deep dives into Zero Trust performance in 2023 alone: <a href="https://blog.cloudflare.com/network-performance-update-cio-edition">one in January</a>, <a href="https://blog.cloudflare.com/network-performance-update-security-week-2023">one in March</a>, and one for Speed Week. In each of them, we outline a series of tests we perform and then show that weâ€™re the fastest. While some may think that this is a marketing stunt, itâ€™s not: the tests we devised arenâ€™t necessarily built to make us look the best, our network makes us look the best when we run the tests.</p>
	<p>Weâ€™ve discussed why performance matters in our blogs before, but the short version is that poor performance is a threat vector: the last thing we want is for your users to turn off Zero Trust to get an experience that is usable for them. Our goal is to improve performance because it helps improve the security of your users, the security of the things that matter most to you, and enables your users to be more productive.</p>
	<p>When we run Zero Trust performance tests, we start by measuring end-to-end latency from when a user sends a packet to when the Zero Trust proxy receives, forwards, and inspects the packet, to when the destination website processes the packet and all the way back to the user. This number, called HTTP Response, is often used in Application Services tests to measure the performance of CDNs. We use this to measure our Zero Trust services as well, but itâ€™s not the only way to measure performance. Zscaler measures their performance through something called proxy latency, while Netskope measures theirs through a decrypted latency SLA. Some providers donâ€™t think about performance at all!</p>
	<p>There are many ways to view network performance. However, at Cloudflare we believe the best way to measure performance is to use end-to-end HTTP response measurements. In this blog, weâ€™re going to talk about why end-to-end performance is the most important thing to look at, why other methods like proxy latency and decrypted latency SLAs are insufficient for performance evaluations, and how you can measure your Zero Trust performance like we do.</p>
	<h2 id="let%E2%80%99s-start-at-the-very-beginning">Letâ€™s start at the very beginning</h2>
	<p>When evaluating performance for any scenario, the most important thing to consider is what exactly youâ€™re supposed to be measuring. This may seem obvious, but oftentimes the things weâ€™re evaluating donâ€™t do a great job of actually measuring the impact users see. A great example of this is <a href="https://blog.cloudflare.com/making-home-internet-faster">when users look at network speed tests</a>: measuring bandwidth doesnâ€™t accurately measure how fast your Internet connection is.</p>
	<p>So we must ask ourselves a fundamental question: how do users interact with Zero Trust products? The answer is they shouldnâ€™t: or they shouldnâ€™t know theyâ€™re interacting with <a href="https://www.cloudflare.com/learning/security/glossary/what-is-zero-trust">Zero Trust</a> services. Users actually interact with websites and applications hosted somewhere on the Internet: maybe theyâ€™re interacting with a private instance of Microsoft Exchange, or maybe theyâ€™re accessing Salesforce in the cloud. In any case, the Zero Trust services that sit in between serve as a forward proxy: they receive the packets from the user, filter for security and access evaluations, and then send the packets along to their destination. If the services are doing their job correctly, users wonâ€™t notice their presence at all.</p>
	<p>So when we look at Zero Trust services, we have to look at scenarios where transparency becomes opacity: when the Zero Trust services reveal themselves and result in high latency, or even application failures. In order to simulate these scenarios, we have to access sites users would access on a regular basis. If we simulate accessing those websites through a Zero Trust platform, we can look at what happens when Zero Trust is present in the request path.</p>
	<p>Fortunately for us, we know exactly how to simulate user requests hitting websites. We have a lot of experience measuring performance for our <a href="https://blog.cloudflare.com/r2-is-faster-than-s3">Developer Platform</a>, and for our <a href="https://blog.cloudflare.com/network-performance-update-security-week">Network Benchmarking analysis</a>. By framing Zero Trust performance in the context of our other performance analysis initiatives, itâ€™s easy to make performance better and ensure that all of our efforts are focused on making the most people as fast as possible. Just like our analyses of other Cloudflare products, this approach puts customers and users first and ensures they get the best performance.</p>
	<h2 id="challenges-of-the-open-internet">Challenges of the open Internet</h2>
	<p>Zero Trust services naturally come at a disadvantage when it comes to performance: they automatically add an additional network hop between users and the services theyâ€™re trying to access. Thatâ€™s because a forward proxy sits between the user and the public Internet to filter and protect traffic. This means that the Zero Trust service needs to <a href="https://blog.cloudflare.com/10000-networks-and-beyond">maintain connectivity with end-user ISPs</a>, maintain connectivity with cloud providers, and transit networks that connect services that send and receive most public Internet traffic. This is generally done through peering and interconnectivity relationships. In addition to maintaining all of that connectivity, thereâ€™s also the time it takes for the service to actually process rules and packet inspections. Given all of these challenges, performance management in this scenario is complex.</p>
	<p>Some providers try to circumvent this by scoping performance down. This is essentially what Zscalerâ€™s proxy latency and Netskopeâ€™s decrypted latency are: an attempt to remove parts of the network path that are difficult to control and only focus on the aspects of a request they can control. To be more specific, these latencies only focus on the time that a request spends on Zscalerâ€™s or Netskopeâ€™s physical hardware. The upside of this is that it allows these providers to make some amount of guarantee in regards to latency. This line of thinking traditionally comes from trying to replace hardware firewalls and <a href="https://www.cloudflare.com/learning/access-management/what-is-a-casb">CASB</a> services that may not process requests inline. Zscaler and Netskope are trying to prove that they can process rules and actions inline with a request and still be performant.</p>
	<p>But as we showed with our blog back in January, the time spent on a machine in a Zero Trust network is only a small portion of the request time experienced by the end user. The majority of a requestsâ€™ time is spent on the wire between machines. When you look at performance, you need to look at it holistically and not at a single element, like on-box processing latency. So by scoping performance down to only looking at on-box processing latencies, youâ€™re not actually looking at anything close to the full picture of performance. To be fast, providers need to look at every aspect of the network and how they function. So letâ€™s talk about all the elements needed to make zero trust service performance better.</p>
	<h2 id="how-do-you-get-better-zero-trust-performance">How do you get better Zero Trust performance?</h2>
	<p>A good way to think of Zero Trust performance is like driving on a highway. If youâ€™re hungry and need to eat, you want to go to a place thatâ€™s close to the highway and fast. If a restaurant that serves burgers in one second is 15 minutes out of the way, it doesnâ€™t matter how fast they serve the burgers: the time it takes to get to that restaurant isnâ€™t worth the trip. A McDonaldâ€™s at a rest stop may take the same amount of time as the other restaurant, but is faster end-to-end. The restaurant you pick should be close to the highway AND serve food fast. Only looking at one of the two will impact your overall time if the other aspect is slow.</p>
	<p>Based on this analogy, in addition to having good processing times, the best ways to improve Â&nbsp;Zero Trust performance are to be well peered on the last mile, be well peered with networks that host important applications, and have diverse paths on the Internet to steer traffic around should things go wrong. Letâ€™s go over each of those and why theyâ€™re important.</p>
	<h3 id="last-mile-peering">Last mile peering</h3>
	<p>Weâ€™ve talked before about how <a href="https://blog.cloudflare.com/last-mile-insights">getting closer to users is critical to increase performance</a>, but hereâ€™s a quick summary: Having a Zero Trust provider that receives your packets physically close to you straightens the path your packets take between your device and what applications youâ€™re trying to access. Because Zero Trust networking will always incur an additional hop, if that hop is inline with the path your requests to your website would normally take, the overhead your Zero Trust network incurs is minimal.</p>
	<figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2023/06/image2-23.png" class="kg-image" alt="" loading="lazy" width="1999" height="1454"></figure>
	<p>In the diagram above, you can see three connectivity models: one from a user straight to a website, one going through a generic forward proxy, and one going through Cloudflare. The length of each line is representative of the point to point latency. Based on that, you can see that the forward proxy path is longer because the two segments add up to be longer than the direct connection is. This additional travel path is referred to as a hairpin in the networking world. The goal is to keep the line between user and website as straight as possible, because thatâ€™s the shortest distance between the two.</p>
	<p>The closer your Zero Trust provider is to you, the easier keeping the path small is to achieve. This challenge is something <a href="https://blog.cloudflare.com/how-cloudflare-helps-next-generation-markets">weâ€™re really good at</a>, as weâ€™re always investing to get closer to users no matter where they are by leveraging our over <a href="https://blog.cloudflare.com/cloudflare-connected-in-over-300-cities">12,000 peered networks</a>.</p>
	<h3 id="cloud-peering">Cloud peering</h3>
	<p>But getting close to users is only half the battle. Once the traffic is on the Zero Trust network, it needs to be delivered to the destination. Oftentimes, those destinations are hosted in hyperscale cloud providers like Azure, Amazon Web Services, or Google Cloud. These hyperscalers are global networks with hundreds of locations for users to store data and host services. If a Zero Trust network is not well peered with all of these networks in all of the places they offer compute, that straight path starts to diverge: less than it would on the last mile, but still enough to be noticeable by end-users.</p>
	<p>Cloudflare helps out here by being peered with these major cloud providers where they are, ensuring that the handoff between Cloudflare and the respective cloud is short and seamless. Cloudflare has peering with the major cloud providers in over 40 different metros around the world, ensuring that wherever applications may be hosted, Cloudflare is there to connect to them.</p>
	<h3 id="alternative-paths-for-everything-in-between">Alternative paths for everything in between</h3>
	<p>If a Zero Trust network has good connectivity on the last mile and good connectivity to the clouds, the only thing left is being able to pass traffic between the two. Having diverse network paths within the Zero Trust network is incredibly valuable for being able to shift traffic around networking issues and provide private connectivity on the Zero Trust network that is reliable and performant. Cloudflare leverages <a href="https://blog.cloudflare.com/cloudflare-backbone-internet-fast-lane">our own private backbone</a> for this purpose, and that backbone is what helps us deliver next-level performance for all scenario types.</p>
	<h2 id="getting-the-measurements-that-matter">Getting the measurements that matter</h2>
	<p>So now that we know what scenarios weâ€™re trying to measure and how to make them faster, how are we measuring them? The answer is elegantly simple: we make HTTP calls through our Zero Trust services and measure the Response times. When we perform our Gateway tests, we configure a client program that periodically connects to a bunch of websites commonly used by enterprises through our Zero Trust client and measure the HTTP timings to calculate HTTP response.</p>
	<p>As we discussed before, Response is the time it takes for a user to send a packet to the Zero Trust proxy which receives, forwards, and inspects the packet, then sends it to the destination website which processes the packet and returns a response all the way back to the user. This measurement is valuable because it allows us to focus specifically on network performance and not necessarily the ability of a web application to load and render content. We donâ€™t measure things like Largest Contentful Paint because those have dependencies on the software stack on the destination, whether the destination is fronted by a CDN and how their performance is, or even the browser making the request. We want to measure how well the Zero Trust service can deliver packets from a device to a website and back. Our current measurement methodology is focused on the time to deliver a response to the client and ignores some client side processing like browser render time (Largest Contentful Paint) and application specific metrics like UDP Video delivery.</p>
	<h2 id="you-can-do-it-too">You can do it too</h2>
	<p>Measuring performance may seem complicated, but at Cloudflare weâ€™re trying to make it easy. Your goals of measuring user experience and our goals of providing a faster experience are perfectly aligned, and the tools we build to view performance are not only user-facing but are used internally for performance improvements. We purpose-built our <a href="https://blog.cloudflare.com/introducing-digital-experience-monitoring">Digital Experience Monitoring</a> product to not just show where things are going wrong, but to monitor your Zero Trust performance so that you can track your user experience right alongside us. We use this data to help identify regressions and issues on our network to help ensure that you are having a good experience. With DEX, you can make tests to measure endpoints you care about just like we do in our tests, and you can see the results for HTTP Response in the Cloudflare dashboard. And the more tests you make and better visibility you get into your experience, the more youâ€™re helping us better see Zero Trust experiences across our network and the broader Internet.</p>
	<p>Just like everything else at Cloudflare, our performance measurements are designed with users in mind. When we measure these numbers and investigate them, we know that by making these numbers look better, weâ€™ll improve the end-to-end experience for Zero Trust users.</p>
</div>